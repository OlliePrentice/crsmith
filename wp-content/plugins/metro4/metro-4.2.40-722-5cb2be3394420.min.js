!function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):factory(jQuery)}(function(jQuery){"use strict";var $=jQuery;$=jQuery;if(void 0===jQuery)throw new Error("Metro 4 requires jQuery!");if("MutationObserver"in window==!1)throw new Error("Metro 4 requires MutationObserver!");var meta_init=$("meta[name='metro4:init']").attr("content"),meta_locale=$("meta[name='metro4:locale']").attr("content"),meta_week_start=$("meta[name='metro4:week_start']").attr("content"),meta_date_format=$("meta[name='metro4:date_format']").attr("content"),meta_date_format_input=$("meta[name='metro4:date_format_input']").attr("content"),meta_animation_duration=$("meta[name='metro4:animation_duration']").attr("content"),meta_callback_timeout=$("meta[name='metro4:callback_timeout']").attr("content"),meta_timeout=$("meta[name='metro4:timeout']").attr("content"),meta_scroll_multiple=$("meta[name='metro4:scroll_multiple']").attr("content"),meta_cloak=$("meta[name='metro4:cloak']").attr("content"),meta_cloak_duration=$("meta[name='metro4:cloak_duration']").attr("content"),meta_about=$("meta[name='metro4:about']").attr("content");void 0===window.METRO_SHOW_ABOUT&&(window.METRO_SHOW_ABOUT=void 0===meta_about||JSON.parse(meta_about)),void 0===window.METRO_INIT&&(window.METRO_INIT=void 0===meta_init||JSON.parse(meta_init)),void 0===window.METRO_DEBUG&&(window.METRO_DEBUG=!0),void 0===window.METRO_WEEK_START&&(window.METRO_WEEK_START=void 0!==meta_week_start?parseInt(meta_week_start):0),void 0===window.METRO_DATE_FORMAT&&(window.METRO_DATE_FORMAT=void 0!==meta_date_format?meta_date_format:"%Y-%m-%d"),void 0===window.METRO_DATE_FORMAT_INPUT&&(window.METRO_DATE_FORMAT_INPUT=void 0!==meta_date_format_input?meta_date_format_input:"%Y-%m-%d"),void 0===window.METRO_LOCALE&&(window.METRO_LOCALE=void 0!==meta_locale?meta_locale:"en-US"),void 0===window.METRO_ANIMATION_DURATION&&(window.METRO_ANIMATION_DURATION=void 0!==meta_animation_duration?parseInt(meta_animation_duration):300),void 0===window.METRO_CALLBACK_TIMEOUT&&(window.METRO_CALLBACK_TIMEOUT=void 0!==meta_callback_timeout?parseInt(meta_callback_timeout):500),void 0===window.METRO_TIMEOUT&&(window.METRO_TIMEOUT=void 0!==meta_timeout?parseInt(meta_timeout):2e3),void 0===window.METRO_SCROLL_MULTIPLE&&(window.METRO_SCROLL_MULTIPLE=void 0!==meta_scroll_multiple?parseInt(meta_scroll_multiple):20),void 0===window.METRO_CLOAK_REMOVE&&(window.METRO_CLOAK_REMOVE=void 0!==meta_cloak?(""+meta_cloak).toLowerCase():"fade"),void 0===window.METRO_CLOAK_DURATION&&(window.METRO_CLOAK_DURATION=void 0!==meta_cloak_duration?parseInt(meta_cloak_duration):500),void 0===window.METRO_HOTKEYS_FILTER_CONTENT_EDITABLE&&(window.METRO_HOTKEYS_FILTER_CONTENT_EDITABLE=!0),void 0===window.METRO_HOTKEYS_FILTER_INPUT_ACCEPTING_ELEMENTS&&(window.METRO_HOTKEYS_FILTER_INPUT_ACCEPTING_ELEMENTS=!0),void 0===window.METRO_HOTKEYS_FILTER_TEXT_INPUTS&&(window.METRO_HOTKEYS_FILTER_TEXT_INPUTS=!0),void 0===window.METRO_HOTKEYS_BUBBLE_UP&&(window.METRO_HOTKEYS_BUBBLE_UP=!1),void 0===window.METRO_THROWS&&(window.METRO_THROWS=!0),window.METRO_MEDIA=[],"function"!=typeof Object.create&&(Object.create=function(o){function F(){}return F.prototype=o,new F}),"function"!=typeof Object.values&&(Object.values=function(obj){return Object.keys(obj).map(function(e){return obj[e]})}),"function"!=typeof window.setImmediate&&(window.setImmediate=function(fn){return setTimeout(fn,0)});var isTouch="ontouchstart"in window||0<navigator.MaxTouchPoints||0<navigator.msMaxTouchPoints,Metro={version:"4.2.40",versionFull:"4.2.40.722 ",isTouchable:isTouch,fullScreenEnabled:document.fullscreenEnabled,sheet:null,controlsPosition:{INSIDE:"inside",OUTSIDE:"outside"},groupMode:{ONE:"one",MULTI:"multi"},aspectRatio:{HD:"hd",SD:"sd",CINEMA:"cinema"},fullScreenMode:{WINDOW:"window",DESKTOP:"desktop"},position:{TOP:"top",BOTTOM:"bottom",LEFT:"left",RIGHT:"right",TOP_RIGHT:"top-right",TOP_LEFT:"top-left",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",LEFT_BOTTOM:"left-bottom",LEFT_TOP:"left-top",RIGHT_TOP:"right-top",RIGHT_BOTTOM:"right-bottom"},popoverEvents:{CLICK:"click",HOVER:"hover",FOCUS:"focus"},stepperView:{SQUARE:"square",CYCLE:"cycle",DIAMOND:"diamond"},listView:{LIST:"list",CONTENT:"content",ICONS:"icons",ICONS_MEDIUM:"icons-medium",ICONS_LARGE:"icons-large",TILES:"tiles",TABLE:"table"},events:{click:"click.metro",start:isTouch?"touchstart.metro":"mousedown.metro",stop:isTouch?"touchend.metro":"mouseup.metro",move:isTouch?"touchmove.metro":"mousemove.metro",enter:isTouch?"touchstart.metro":"mouseenter.metro",startAll:"mousedown.metro touchstart.metro",stopAll:"mouseup.metro touchend.metro",moveAll:"mousemove.metro touchmove.metro",leave:"mouseleave.metro",focus:"focus.metro",blur:"blur.metro",resize:"resize.metro",keyup:"keyup.metro",keydown:"keydown.metro",keypress:"keypress.metro",dblclick:"dblclick.metro",input:"input.metro",change:"change.metro",cut:"cut.metro",paste:"paste.metro",scroll:"scroll.metro",scrollStart:"scrollstart.metro",scrollStop:"scrollstop.metro",mousewheel:"mousewheel.metro",inputchange:"change.metro input.metro propertychange.metro cut.metro paste.metro copy.metro",dragstart:"dragstart.metro",dragend:"dragend.metro",dragenter:"dragenter.metro",dragover:"dragover.metro",dragleave:"dragleave.metro",drop:"drop.metro",drag:"drag.metro"},keyCode:{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,BREAK:19,CAPS:20,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,COMMA:188},media_queries:{FS:"(min-width: 0px)",XS:"(min-width: 360px)",SM:"(min-width: 576px)",MD:"(min-width: 768px)",LG:"(min-width: 992px)",XL:"(min-width: 1200px)",XXL:"(min-width: 1452px)"},media_sizes:{FS:0,XS:360,SM:576,LD:640,MD:768,LG:992,XL:1200,XXL:1452},media_mode:{FS:"fs",XS:"xs",SM:"sm",MD:"md",LG:"lg",XL:"xl",XXL:"xxl"},media_modes:["fs","xs","sm","md","lg","xl","xxl"],actions:{REMOVE:1,HIDE:2},hotkeys:[],about:function(f){console.log("Metro 4 - v"+(!0===f?this.versionFull:this.version))},aboutDlg:function(f){alert("Metro 4 - v"+(!0===f?this.versionFull:this.version))},ver:function(f){return!0===f?this.versionFull:this.version},observe:function(){new MutationObserver(function(mutations){mutations.map(function(mutation){if("attributes"===mutation.type&&"data-role"!==mutation.attributeName){var element=$(mutation.target),mc=element.data("metroComponent");void 0!==mc&&$.each(mc,function(){var plug=element.data(this);plug&&plug.changeAttribute(mutation.attributeName)})}else if("childList"===mutation.type&&0<mutation.addedNodes.length){var i,obj,widgets={},plugins={},nodes=mutation.addedNodes;for(i=0;i<nodes.length;i++){var node=mutation.addedNodes[i];"SCRIPT"!==node.tagName&&"STYLE"!==node.tagName&&(plugins=(obj=$(mutation.addedNodes[i])).find("[data-role]"),(widgets=void 0!==obj.data("role")?$.merge(plugins,obj):plugins).length&&Metro.initWidgets(widgets))}}})}).observe($("html")[0],{childList:!0,attributes:!0,subtree:!0})},init:function(){var widgets=$("[data-role]"),hotkeys=$("[data-hotkey]"),html=$("html");return!0===isTouch?html.addClass("metro-touch-device"):html.addClass("metro-no-touch-device"),this.sheet=Utils.newCssSheet(),window.METRO_MEDIA=[],$.each(Metro.media_queries,function(key,query){Utils.media(query)&&METRO_MEDIA.push(Metro.media_mode[key])}),this.observe(),this.initHotkeys(hotkeys),this.initWidgets(widgets),METRO_SHOW_ABOUT&&this.about(!0),"fade"!==METRO_CLOAK_REMOVE?$(".m4-cloak").removeClass("m4-cloak"):$(".m4-cloak").animate({opacity:1},METRO_CLOAK_REMOVE,function(){$(".m4-cloak").removeClass("m4-cloak")}),this},initHotkeys:function(hotkeys){$.each(hotkeys,function(){var element=$(this),hotkey=!!element.data("hotkey")&&element.data("hotkey").toLowerCase();!1!==hotkey&&!0!==element.data("hotKeyBonded")&&(Metro.hotkeys.push(hotkey),$(document).on(Metro.events.keyup,null,hotkey,function(e){if(void 0!==element)return"A"===element[0].tagName&&void 0!==element.attr("href")&&""!==element.attr("href").trim()&&"#"!==element.attr("href").trim()?document.location.href=element.attr("href"):element.click(),METRO_HOTKEYS_BUBBLE_UP}),element.data("hotKeyBonded",!0))})},initWidgets:function(widgets){$.each(widgets,function(){var $this=$(this);$this.data("role").split(/\s*,\s*/).map(function(func){if(void 0!==$.fn[func]&&void 0===$this.attr("data-role-"+func)){$.fn[func].call($this),$this.attr("data-role-"+func,!0);var mc=$this.data("metroComponent");void 0===mc?mc=[func]:mc.push(func),$this.data("metroComponent",mc)}})})},plugin:function(name,object){$.fn[name]=function(options){return this.each(function(){$.data(this,name,Object.create(object).init(options,this))})}},destroyPlugin:function(element,name){var p,mc;if(element=Utils.isJQueryObject(element)?element[0]:element,p=$(element).data(name),!Utils.isValue(p))throw new Error("Component can not be destroyed: the element is not a Metro 4 component.");if(!Utils.isFunc(p.destroy))throw new Error("Component can not be destroyed: method destroy not found.");p.destroy(),mc=$(element).data("metroComponent"),Utils.arrayDelete(mc,name),$(element).data("metroComponent",mc),$.removeData(element,name),$(element).removeAttr("data-role-"+name)},destroyPluginAll:function(element){element=Utils.isJQueryObject(element)?element[0]:element;var mc=$(element).data("metroComponent");void 0!==mc&&0<mc.length&&$.each(mc,function(){Metro.destroyPlugin(element,this)})},initPlugin:function(element,name){element=$(element);try{if(void 0!==$.fn[name]&&void 0===element.attr("data-role-"+name)){$.fn[name].call(element),element.attr("data-role-"+name,!0);var mc=element.data("metroComponent");void 0===mc?mc=[name]:mc.push(name),element.data("metroComponent",mc)}}catch(e){console.log(e.message,e.stack)}},reinitPlugin:function(element,name){this.destroyPlugin(element,name),this.initPlugin(element,name)},reinitPluginAll:function(element){var mc=$(element).data("metroComponent");void 0!==mc&&0<mc.length&&$.each(mc,function(){Metro.reinitPlugin(element,this)})},noop:function(){},noop_true:function(){return!0},noop_false:function(){return!1},stop:function(e){e.stopPropagation(),e.preventDefault()},requestFullScreen:function(element){element.mozRequestFullScreen?element.mozRequestFullScreen():element.webkitRequestFullScreen?element.webkitRequestFullScreen():element.msRequestFullscreen?element.msRequestFullscreen():element.requestFullscreen()},exitFullScreen:function(){document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.exitFullscreen()},inFullScreen:function(){return void 0!==(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}};window.Metro=Metro,$(window).on(Metro.events.resize,function(){window.METRO_MEDIA=[],$.each(Metro.media_queries,function(key,query){Utils.media(query)&&METRO_MEDIA.push(Metro.media_mode[key])})});var Animation={duration:METRO_ANIMATION_DURATION,func:"swing",switch:function(current,next){current.hide(),next.css({top:0,left:0}).show()},slideUp:function(current,next,duration,func){var h=current.parent().outerHeight(!0);void 0===duration&&(duration=this.duration),void 0===func&&(func=this.func),current.css("z-index",1).animate({top:-h,opacity:0},duration,func),next.css({top:h,left:0,zIndex:2}).animate({top:0,opacity:1},duration,func)},slideDown:function(current,next,duration,func){var h=current.parent().outerHeight(!0);void 0===duration&&(duration=this.duration),void 0===func&&(func=this.func),current.css("z-index",1).animate({top:h,opacity:0},duration,func),next.css({left:0,top:-h,zIndex:2}).animate({top:0,opacity:1},duration,func)},slideLeft:function(current,next,duration,func){var w=current.parent().outerWidth(!0);void 0===duration&&(duration=this.duration),void 0===func&&(func=this.func),current.css("z-index",1).animate({left:-w,opacity:0},duration,func),next.css({left:w,zIndex:2}).animate({left:0,opacity:1},duration,func)},slideRight:function(current,next,duration,func){var w=current.parent().outerWidth(!0);void 0===duration&&(duration=this.duration),void 0===func&&(func=this.func),current.css("z-index",1).animate({left:w,opacity:0},duration,func),next.css({left:-w,zIndex:2}).animate({left:0,opacity:1},duration,func)},fade:function(current,next,duration){void 0===duration&&(duration=this.duration),current.animate({opacity:0},duration),next.css({top:0,left:0}).animate({opacity:1},duration)}};function RGB(r,g,b){this.r=r||0,this.g=g||0,this.g=b||0}function HSV(h,s,v){this.h=h||0,this.s=s||0,this.v=v||0}function CMYK(c,m,y,k){this.c=c||0,this.m=m||0,this.y=y||0,this.k=k||0}Metro.animation=Animation;var Colors={TYPES:{HEX:"hex",RGB:"rgb",RGBA:"rgba",HSV:"hsv",HSL:"hsl",CMYK:"cmyk",UNKNOWN:"unknown"},PALETTES:{ALL:"colorList",METRO:"colorListMetro",STANDARD:"colorListStandard"},colorListMetro:{lime:"#a4c400",green:"#60a917",emerald:"#008a00",blue:"#00AFF0",teal:"#00aba9",cyan:"#1ba1e2",cobalt:"#0050ef",indigo:"#6a00ff",violet:"#aa00ff",pink:"#dc4fad",magenta:"#d80073",crimson:"#a20025",red:"#CE352C",orange:"#fa6800",amber:"#f0a30a",yellow:"#fff000",brown:"#825a2c",olive:"#6d8764",steel:"#647687",mauve:"#76608a",taupe:"#87794e"},colorListStandard:{aliceBlue:"#f0f8ff",antiqueWhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedAlmond:"#ffebcd",blue:"#0000ff",blueViolet:"#8a2be2",brown:"#a52a2a",burlyWood:"#deb887",cadetBlue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerBlue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkBlue:"#00008b",darkCyan:"#008b8b",darkGoldenRod:"#b8860b",darkGray:"#a9a9a9",darkGreen:"#006400",darkKhaki:"#bdb76b",darkMagenta:"#8b008b",darkOliveGreen:"#556b2f",darkOrange:"#ff8c00",darkOrchid:"#9932cc",darkRed:"#8b0000",darkSalmon:"#e9967a",darkSeaGreen:"#8fbc8f",darkSlateBlue:"#483d8b",darkSlateGray:"#2f4f4f",darkTurquoise:"#00ced1",darkViolet:"#9400d3",deepPink:"#ff1493",deepSkyBlue:"#00bfff",dimGray:"#696969",dodgerBlue:"#1e90ff",fireBrick:"#b22222",floralWhite:"#fffaf0",forestGreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#DCDCDC",ghostWhite:"#F8F8FF",gold:"#ffd700",goldenRod:"#daa520",gray:"#808080",green:"#008000",greenYellow:"#adff2f",honeyDew:"#f0fff0",hotPink:"#ff69b4",indianRed:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderBlush:"#fff0f5",lawnGreen:"#7cfc00",lemonChiffon:"#fffacd",lightBlue:"#add8e6",lightCoral:"#f08080",lightCyan:"#e0ffff",lightGoldenRodYellow:"#fafad2",lightGray:"#d3d3d3",lightGreen:"#90ee90",lightPink:"#ffb6c1",lightSalmon:"#ffa07a",lightSeaGreen:"#20b2aa",lightSkyBlue:"#87cefa",lightSlateGray:"#778899",lightSteelBlue:"#b0c4de",lightYellow:"#ffffe0",lime:"#00ff00",limeGreen:"#32dc32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumAquaMarine:"#66cdaa",mediumBlue:"#0000cd",mediumOrchid:"#ba55d3",mediumPurple:"#9370db",mediumSeaGreen:"#3cb371",mediumSlateBlue:"#7b68ee",mediumSpringGreen:"#00fa9a",mediumTurquoise:"#48d1cc",mediumVioletRed:"#c71585",midnightBlue:"#191970",mintCream:"#f5fffa",mistyRose:"#ffe4e1",moccasin:"#ffe4b5",navajoWhite:"#ffdead",navy:"#000080",oldLace:"#fdd5e6",olive:"#808000",oliveDrab:"#6b8e23",orange:"#ffa500",orangeRed:"#ff4500",orchid:"#da70d6",paleGoldenRod:"#eee8aa",paleGreen:"#98fb98",paleTurquoise:"#afeeee",paleVioletRed:"#db7093",papayaWhip:"#ffefd5",peachPuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderBlue:"#b0e0e6",purple:"#800080",rebeccaPurple:"#663399",red:"#ff0000",rosyBrown:"#bc8f8f",royalBlue:"#4169e1",saddleBrown:"#8b4513",salmon:"#fa8072",sandyBrown:"#f4a460",seaGreen:"#2e8b57",seaShell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",slyBlue:"#87ceeb",slateBlue:"#6a5acd",slateGray:"#708090",snow:"#fffafa",springGreen:"#00ff7f",steelBlue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whiteSmoke:"#f5f5f5",yellow:"#ffff00",yellowGreen:"#9acd32"},colorList:{},options:{angle:30,algorithm:1,step:.1,distance:5,tint1:.8,tint2:.4,shade1:.6,shade2:.3,alpha:1},init:function(){return this.colorList=$.extend({},this.colorListStandard,this.colorListMetro),this},setup:function(options){this.options=$.extend({},this.options,options)},color:function(name,palette){return void 0!==this[palette=palette||this.PALETTES.ALL][name]&&this[palette][name]},palette:function(palette){return palette=palette||this.PALETTES.ALL,Object.keys(this[palette])},colors:function(palette){var c=[];return palette=palette||this.PALETTES.ALL,$.each(this[palette],function(){c.push(this)}),c},hex2rgb:function(hex){hex=hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(m,r,g,b){return r+r+g+g+b+b});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null},rgb2hex:function(rgb){return"#"+((1<<24)+(rgb.r<<16)+(rgb.g<<8)+rgb.b).toString(16).slice(1)},rgb2hsv:function(rgb){var h,s,v,hsv=new HSV,r=rgb.r/255,g=rgb.g/255,b=rgb.b/255,max=Math.max(r,g,b),min=Math.min(r,g,b),delta=max-min;return s=0===(v=max)?0:1-min/max,h=max===min?0:max===r&&b<=g?(g-b)/delta*60:max===r&&g<b?(g-b)/delta*60+360:max===g?(b-r)/delta*60+120:max===b?(r-g)/delta*60+240:0,hsv.h=h,hsv.s=s,hsv.v=v,hsv},hsv2rgb:function(hsv){var r,g,b,h=hsv.h,s=100*hsv.s,v=100*hsv.v,Vmin=(100-s)*v/100,alpha=h%60/60*(v-Vmin),Vinc=Vmin+alpha,Vdec=v-alpha;switch(Math.floor(h/60)){case 0:r=v,g=Vinc,b=Vmin;break;case 1:r=Vdec,g=v,b=Vmin;break;case 2:r=Vmin,g=v,b=Vinc;break;case 3:r=Vmin,g=Vdec,b=v;break;case 4:r=Vinc,g=Vmin,b=v;break;case 5:r=v,g=Vmin,b=Vdec}return{r:Math.round(255*r/100),g:Math.round(255*g/100),b:Math.round(255*b/100)}},hsv2hex:function(hsv){return this.rgb2hex(this.hsv2rgb(hsv))},hex2hsv:function(hex){return this.rgb2hsv(this.hex2rgb(hex))},rgb2cmyk:function(rgb){var cmyk=new CMYK,r=rgb.r/255,g=rgb.g/255,b=rgb.b/255;return cmyk.k=Math.min(1-r,1-g,1-b),cmyk.c=(1-r-cmyk.k)/(1-cmyk.k),cmyk.m=(1-g-cmyk.k)/(1-cmyk.k),cmyk.y=(1-b-cmyk.k)/(1-cmyk.k),cmyk.c=Math.round(100*cmyk.c),cmyk.m=Math.round(100*cmyk.m),cmyk.y=Math.round(100*cmyk.y),cmyk.k=Math.round(100*cmyk.k),cmyk},cmyk2rgb:function(cmyk){var rgb=new RGB,c=cmyk.c/100,m=cmyk.m/100,y=cmyk.y/100,k=cmyk.k/100;return rgb.r=1-Math.min(1,c*(1-k)+k),rgb.g=1-Math.min(1,m*(1-k)+k),rgb.b=1-Math.min(1,y*(1-k)+k),rgb.r=Math.round(255*rgb.r),rgb.g=Math.round(255*rgb.g),rgb.b=Math.round(255*rgb.b),rgb},hsv2hsl:function(hsv){var h,s,l;return h=hsv.h,l=(2-hsv.s)*hsv.v,s=hsv.s*hsv.v,{h:h,s:s/=l<=1?l:2-l,l:l/=2}},hsl2hsv:function(hsl){var h,s,v,l;return h=hsl.h,v=((l=2*hsl.l)+(s=hsl.s*(l<=1?l:2-l)))/2,{h:h,s:s=2*s/(l+s),l:v}},rgb2websafe:function(rgb){return{r:51*Math.round(rgb.r/51),g:51*Math.round(rgb.g/51),b:51*Math.round(rgb.b/51)}},rgba2websafe:function(rgba){return{r:51*Math.round(rgba.r/51),g:51*Math.round(rgba.g/51),b:51*Math.round(rgba.b/51),a:rgba.a}},hex2websafe:function(hex){return this.rgb2hex(this.rgb2websafe(this.toRGB(hex)))},hsv2websafe:function(hsv){return this.rgb2hsv(this.rgb2websafe(this.toRGB(hsv)))},hsl2websafe:function(hsl){return this.hsv2hsl(this.rgb2hsv(this.rgb2websafe(this.toRGB(hsl))))},cmyk2websafe:function(cmyk){return this.rgb2cmyk(this.rgb2websafe(this.cmyk2rgb(cmyk)))},websafe:function(color){return this.isHEX(color)?this.hex2websafe(color):this.isRGB(color)?this.rgb2websafe(color):this.isRGBA(color)?this.rgba2websafe(color):this.isHSV(color)?this.hsv2websafe(color):this.isHSL(color)?this.hsl2websafe(color):this.isCMYK(color)?this.cmyk2websafe(color):color},is:function(color){return this.isHEX(color)?this.TYPES.HEX:this.isRGB(color)?this.TYPES.RGB:this.isRGBA(color)?this.TYPES.RGBA:this.isHSV(color)?this.TYPES.HSV:this.isHSL(color)?this.TYPES.HSL:this.isCMYK(color)?this.TYPES.CMYK:this.TYPES.UNKNOWN},toRGB:function(color){if(this.isHSV(color))return this.hsv2rgb(color);if(this.isHSL(color))return this.hsv2rgb(this.hsl2hsv(color));if(this.isRGB(color))return color;if(this.isHEX(color))return this.hex2rgb(color);if(this.isCMYK(color))return this.cmyk2rgb(color);throw new Error("Unknown color format!")},toRGBA:function(color,alpha){var result=this.toRGB(color);return result.a=alpha||1,result},toHSV:function(color){return this.rgb2hsv(this.toRGB(color))},toHSL:function(color){return this.hsv2hsl(this.rgb2hsv(this.toRGB(color)))},toHSLA:function(color,alpha){var hsla;return(hsla=this.hsv2hsl(this.rgb2hsv(this.toRGB(color)))).a=alpha||this.options.alpha,hsla},toHEX:function(color){return this.rgb2hex(this.toRGB(color))},toCMYK:function(color){return this.rgb2cmyk(this.toRGB(color))},toHexString:function(color){return this.toHEX(color)},toHsvString:function(color){var hsv=this.toHSV(color);return"hsv("+[hsv.h,hsv.s,hsv.v].join(",")+")"},toHslString:function(color){var hsl=this.toHSL(color);return"hsl("+[Math.round(hsl.h),Math.round(100*hsl.s)+"%",Math.round(100*hsl.l)+"%"].join(",")+")"},toHslaString:function(color){var hsl=this.toHSLA(color);return"hsl("+[Math.round(hsl.h),Math.round(100*hsl.s)+"%",Math.round(100*hsl.l)+"%",hsl.a].join(",")+")"},toCmykString:function(color){var cmyk=this.toCMYK(color);return"cmyk("+[cmyk.c,cmyk.m,cmyk.y,cmyk.k].join(",")+")"},toRgbString:function(color){var rgb=this.toRGB(color);return"rgb("+[rgb.r,rgb.g,rgb.b].join(",")+")"},toRgbaString:function(color){var rgb=this.toRGBA(color);return"rgba("+[rgb.r,rgb.g,rgb.b,rgb.a].join(",")+")"},toString:function(color){if(this.isHEX(color))return this.toHexString(color);if(this.isRGB(color))return this.toRgbString(color);if(this.isRGBA(color))return this.toRgbaString(color);if(this.isHSV(color))return this.toHsvString(color);if(this.isHSL(color))return this.toHslString(color);if(this.isHSLA(color))return this.toHslaString(color);if(this.isCMYK(color))return this.toCmykString(color);throw new Error("Unknown color format!")},grayscale:function(color,output){output=output||"hex";var rgb=this.toRGB(color),gray=Math.round(.2125*rgb.r+.7154*rgb.g+.0721*rgb.b),mono={r:gray,g:gray,b:gray};return this["rgb2"+output](mono)},darken:function(color,amount){return void 0===amount&&(amount=10),this.lighten(color,-1*Math.abs(amount))},lighten:function(color,amount){var type,res,alpha=1,ring=0<amount,calc=function(_color,_amount){var col=_color.slice(1),num=parseInt(col,16),r=(num>>16)+_amount;255<r?r=255:r<0&&(r=0);var b=(num>>8&255)+_amount;255<b?b=255:b<0&&(b=0);var g=(255&num)+_amount;return 255<g?g=255:g<0&&(g=0),res="#"+(g|b<<8|r<<16).toString(16)};for(void 0===amount&&(amount=10),(type=this.is(color))===this.TYPES.RGBA&&(alpha=color.a);res=calc(this.toHEX(color),amount),ring?amount--:amount++,res.length<7;);switch(type){case"rgb":return this.toRGB(res);case"rgba":return this.toRGBA(res,alpha);case"hsv":return this.toHSV(res);case"hsl":return this.toHSL(res);case"cmyk":return this.toCMYK(res);default:return res}},isDark:function(color){var rgb=this.toRGB(color);return(299*rgb.r+587*rgb.g+114*rgb.b)/1e3<128},isLight:function(hex){return!this.isDark(hex)},isHSV:function(val){return Utils.isObject(val)&&"h"in val&&"s"in val&&"v"in val},isHSL:function(val){return Utils.isObject(val)&&"h"in val&&"s"in val&&"l"in val},isHSLA:function(val){return Utils.isObject(val)&&"h"in val&&"s"in val&&"l"in val&&"a"in val},isRGB:function(val){return Utils.isObject(val)&&"r"in val&&"g"in val&&"b"in val},isRGBA:function(val){return Utils.isObject(val)&&"r"in val&&"g"in val&&"b"in val&&"a"in val},isCMYK:function(val){return Utils.isObject(val)&&"c"in val&&"m"in val&&"y"in val&&"k"in val},isHEX:function(val){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(val)},isColor:function(color){return this.isHEX(color)||this.isRGB(color)||this.isRGBA(color)||this.isHSV(color)||this.isHSL(color)||this.isCMYK(color)},hueShift:function(h,s){for(h+=s;360<=h;)h-=360;for(;h<0;)h+=360;return h},getScheme:function(color,name,format,options){var i;this.options=$.extend({},this.options,options);var hsv,scheme=[],that=this;if(hsv=this.toHSV(color),!1===this.isHSV(hsv))return console.log("The value is a not supported color format!"),!1;function clamp(num,min,max){return Math.max(min,Math.min(num,max))}function toRange(a,b,c){return a<b?b:c<a?c:a}var rgb,h=hsv.h,s=hsv.s,v=hsv.v,o=this.options;switch(name){case"monochromatic":case"mono":if(1===o.algorithm)(rgb=this.hsv2rgb(hsv)).r=toRange(Math.round(rgb.r+(255-rgb.r)*o.tint1),0,255),rgb.g=toRange(Math.round(rgb.g+(255-rgb.g)*o.tint1),0,255),rgb.b=toRange(Math.round(rgb.b+(255-rgb.b)*o.tint1),0,255),scheme.push(this.rgb2hsv(rgb)),(rgb=this.hsv2rgb(hsv)).r=toRange(Math.round(rgb.r+(255-rgb.r)*o.tint2),0,255),rgb.g=toRange(Math.round(rgb.g+(255-rgb.g)*o.tint2),0,255),rgb.b=toRange(Math.round(rgb.b+(255-rgb.b)*o.tint2),0,255),scheme.push(this.rgb2hsv(rgb)),scheme.push(hsv),(rgb=this.hsv2rgb(hsv)).r=toRange(Math.round(rgb.r*o.shade1),0,255),rgb.g=toRange(Math.round(rgb.g*o.shade1),0,255),rgb.b=toRange(Math.round(rgb.b*o.shade1),0,255),scheme.push(this.rgb2hsv(rgb)),(rgb=this.hsv2rgb(hsv)).r=toRange(Math.round(rgb.r*o.shade2),0,255),rgb.g=toRange(Math.round(rgb.g*o.shade2),0,255),rgb.b=toRange(Math.round(rgb.b*o.shade2),0,255),scheme.push(this.rgb2hsv(rgb));else if(2===o.algorithm)for(scheme.push(hsv),i=1;i<=o.distance;i++)v=clamp(v-o.step,0,1),s=clamp(s-o.step,0,1),scheme.push({h:h,s:s,v:v});else if(3===o.algorithm)for(scheme.push(hsv),i=1;i<=o.distance;i++)v=clamp(v-o.step,0,1),scheme.push({h:h,s:s,v:v});else v=clamp(hsv.v+2*o.step,0,1),scheme.push({h:h,s:s,v:v}),v=clamp(hsv.v+o.step,0,1),scheme.push({h:h,s:s,v:v}),scheme.push(hsv),s=hsv.s,v=hsv.v,v=clamp(hsv.v-o.step,0,1),scheme.push({h:h,s:s,v:v}),v=clamp(hsv.v-2*o.step,0,1),scheme.push({h:h,s:s,v:v});break;case"complementary":case"complement":case"comp":scheme.push(hsv),h=this.hueShift(hsv.h,180),scheme.push({h:h,s:s,v:v});break;case"double-complementary":case"double-complement":case"double":scheme.push(hsv),console.log(h),h=this.hueShift(h,180),scheme.push({h:h,s:s,v:v}),console.log(h),h=this.hueShift(h,o.angle),scheme.push({h:h,s:s,v:v}),console.log(h),h=this.hueShift(h,180),scheme.push({h:h,s:s,v:v}),console.log(h);break;case"analogous":case"analog":h=this.hueShift(h,o.angle),scheme.push({h:h,s:s,v:v}),scheme.push(hsv),h=this.hueShift(hsv.h,0-o.angle),scheme.push({h:h,s:s,v:v});break;case"triadic":case"triad":for(scheme.push(hsv),i=1;i<3;i++)h=this.hueShift(h,120),scheme.push({h:h,s:s,v:v});break;case"tetradic":case"tetra":scheme.push(hsv),h=this.hueShift(hsv.h,180),scheme.push({h:h,s:s,v:v}),h=this.hueShift(hsv.h,-1*o.angle),scheme.push({h:h,s:s,v:v}),h=this.hueShift(h,180),scheme.push({h:h,s:s,v:v});break;case"square":for(scheme.push(hsv),i=1;i<4;i++)h=this.hueShift(h,90),scheme.push({h:h,s:s,v:v});break;case"split-complementary":case"split-complement":case"split":h=this.hueShift(h,180-o.angle),scheme.push({h:h,s:s,v:v}),scheme.push(hsv),h=this.hueShift(hsv.h,180+o.angle),scheme.push({h:h,s:s,v:v});break;default:console.log("Unknown scheme name")}return function(source,format){var result=[],o=that.options;switch(format){case"hex":result=source.map(function(v){return Colors.toHEX(v)});break;case"rgb":result=source.map(function(v){return Colors.toRGB(v)});break;case"rgba":result=source.map(function(v){return Colors.toRGBA(v,o.alpha)});break;case"hsl":result=source.map(function(v){return Colors.toHSL(v)});break;case"cmyk":result=source.map(function(v){return Colors.toCMYK(v)});break;default:result=source}return result}(scheme,format)}};Metro.colors=Colors.init(),$.easing.jswing=$.easing.swing,$.extend($.easing,{def:"easeOutQuad",swing:function(x,t,b,c,d){return $.easing[$.easing.def](x,t,b,c,d)},easeInQuad:function(x,t,b,c,d){return c*(t/=d)*t+b},easeOutQuad:function(x,t,b,c,d){return-c*(t/=d)*(t-2)+b},easeInOutQuad:function(x,t,b,c,d){return(t/=d/2)<1?c/2*t*t+b:-c/2*(--t*(t-2)-1)+b},easeInCubic:function(x,t,b,c,d){return c*(t/=d)*t*t+b},easeOutCubic:function(x,t,b,c,d){return c*((t=t/d-1)*t*t+1)+b},easeInOutCubic:function(x,t,b,c,d){return(t/=d/2)<1?c/2*t*t*t+b:c/2*((t-=2)*t*t+2)+b},easeInQuart:function(x,t,b,c,d){return c*(t/=d)*t*t*t+b},easeOutQuart:function(x,t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b},easeInOutQuart:function(x,t,b,c,d){return(t/=d/2)<1?c/2*t*t*t*t+b:-c/2*((t-=2)*t*t*t-2)+b},easeInQuint:function(x,t,b,c,d){return c*(t/=d)*t*t*t*t+b},easeOutQuint:function(x,t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},easeInOutQuint:function(x,t,b,c,d){return(t/=d/2)<1?c/2*t*t*t*t*t+b:c/2*((t-=2)*t*t*t*t+2)+b},easeInSine:function(x,t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b},easeOutSine:function(x,t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b},easeInOutSine:function(x,t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b},easeInExpo:function(x,t,b,c,d){return 0==t?b:c*Math.pow(2,10*(t/d-1))+b},easeOutExpo:function(x,t,b,c,d){return t==d?b+c:c*(1-Math.pow(2,-10*t/d))+b},easeInOutExpo:function(x,t,b,c,d){return 0==t?b:t==d?b+c:(t/=d/2)<1?c/2*Math.pow(2,10*(t-1))+b:c/2*(2-Math.pow(2,-10*--t))+b},easeInCirc:function(x,t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b},easeOutCirc:function(x,t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b},easeInOutCirc:function(x,t,b,c,d){return(t/=d/2)<1?-c/2*(Math.sqrt(1-t*t)-1)+b:c/2*(Math.sqrt(1-(t-=2)*t)+1)+b},easeInElastic:function(x,t,b,c,d){var s=1.70158,p=0,a=c;return 0==t?b:1==(t/=d)?b+c:(p||(p=.3*d),s=a<Math.abs(c)?(a=c,p/4):p/(2*Math.PI)*Math.asin(c/a),-a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)+b)},easeOutElastic:function(x,t,b,c,d){var s=1.70158,p=0,a=c;return 0==t?b:1==(t/=d)?b+c:(p||(p=.3*d),s=a<Math.abs(c)?(a=c,p/4):p/(2*Math.PI)*Math.asin(c/a),a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b)},easeInOutElastic:function(x,t,b,c,d){var s=1.70158,p=0,a=c;return 0==t?b:2==(t/=d/2)?b+c:(p||(p=d*(.3*1.5)),s=a<Math.abs(c)?(a=c,p/4):p/(2*Math.PI)*Math.asin(c/a),t<1?a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*-.5+b:a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b)},easeInBack:function(x,t,b,c,d,s){return null==s&&(s=1.70158),c*(t/=d)*t*((s+1)*t-s)+b},easeOutBack:function(x,t,b,c,d,s){return null==s&&(s=1.70158),c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},easeInOutBack:function(x,t,b,c,d,s){return null==s&&(s=1.70158),(t/=d/2)<1?c/2*(t*t*((1+(s*=1.525))*t-s))+b:c/2*((t-=2)*t*((1+(s*=1.525))*t+s)+2)+b},easeInBounce:function(x,t,b,c,d){return c-$.easing.easeOutBounce(x,d-t,0,c,d)+b},easeOutBounce:function(x,t,b,c,d){return(t/=d)<1/2.75?c*(7.5625*t*t)+b:t<2/2.75?c*(7.5625*(t-=1.5/2.75)*t+.75)+b:t<2.5/2.75?c*(7.5625*(t-=2.25/2.75)*t+.9375)+b:c*(7.5625*(t-=2.625/2.75)*t+.984375)+b},easeInOutBounce:function(x,t,b,c,d){return t<d/2?.5*$.easing.easeInBounce(x,2*t,0,c,d)+b:.5*$.easing.easeOutBounce(x,2*t-d,0,c,d)+.5*c+b}});var Export={init:function(){return this},options:{csvDelimiter:"\t",csvNewLine:"\r\n",includeHeader:!0},setup:function(options){return this.options=$.extend({},this.options,options),this},base64:function(data){return window.btoa(unescape(encodeURIComponent(data)))},b64toBlob:function(b64Data,contentType,sliceSize){contentType=contentType||"",sliceSize=sliceSize||512;var offset,byteCharacters=window.atob(b64Data),byteArrays=[];for(offset=0;offset<byteCharacters.length;offset+=sliceSize){var i,slice=byteCharacters.slice(offset,offset+sliceSize),byteNumbers=new Array(slice.length);for(i=0;i<slice.length;i+=1)byteNumbers[i]=slice.charCodeAt(i);var byteArray=new window.Uint8Array(byteNumbers);byteArrays.push(byteArray)}return new Blob(byteArrays,{type:contentType})},tableToCSV:function(table,filename,options){var body,head,i,j,row,cell,o=this.options,data="";if(o=$.extend({},o,options),Utils.isJQueryObject(table)&&(table=table[0]),Utils.bool(o.includeHeader))for(head=table.querySelectorAll("thead")[0],i=0;i<head.rows.length;i++){for(row=head.rows[i],j=0;j<row.cells.length;j++)cell=row.cells[j],data+=(j?o.csvDelimiter:"")+cell.textContent.trim();data+=o.csvNewLine}for(body=table.querySelectorAll("tbody")[0],i=0;i<body.rows.length;i++){for(row=body.rows[i],j=0;j<row.cells.length;j++)cell=row.cells[j],data+=(j?o.csvDelimiter:"")+cell.textContent.trim();data+=o.csvNewLine}return Utils.isValue(filename)?this.createDownload(this.base64("\ufeff"+data),"application/csv",filename):data},createDownload:function(data,contentType,filename){var blob,anchor,url;return(anchor=document.createElement("a")).style.display="none",document.body.appendChild(anchor),blob=this.b64toBlob(data,contentType),url=window.URL.createObjectURL(blob),anchor.href=url,anchor.download=filename||Utils.elementId("download"),anchor.click(),window.URL.revokeObjectURL(url),document.body.removeChild(anchor),!0}};Metro.export=Export.init(),$.fn.extend({toggleAttr:function(a,v){return this.each(function(){var el=$(this);void 0!==v?el.attr(a,v):void 0!==el.attr(a)?el.removeAttr(a):el.attr(a,""+a)})},clearClasses:function(){return this.each(function(){this.className=""})},fire:function(eventName,data){return this.each(function(){var e=jQuery.Event(eventName);e.detail=data,$(this).trigger(e)})}}),Array.prototype.shuffle=function(){for(var temporaryValue,randomIndex,currentIndex=this.length;0!==currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),temporaryValue=this[currentIndex-=1],this[currentIndex]=this[randomIndex],this[randomIndex]=temporaryValue;return this},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.unique=function(){for(var a=this.concat(),i=0;i<a.length;++i)for(var j=i+1;j<a.length;++j)a[i]===a[j]&&a.splice(j--,1);return a},Array.from||(Array.from=function(val){var i,a=[];if(void 0===val.length&&"object"==typeof val)return Object.values(val);if(void 0===val.length)throw new Error("Value can not be converted to array");for(i=0;i<val.length;i++)a.push(val[i]);return a}),"function"!=typeof Array.contains&&(Array.prototype.contains=function(val,from){return-1<this.indexOf(val,from)}),Number.prototype.format=function(n,x,s,c){var re="\\d(?=(\\d{"+(x||3)+"})+"+(0<n?"\\D":"$")+")",num=this.toFixed(Math.max(0,~~n));return(c?num.replace(".",c):num).replace(new RegExp(re,"g"),"$&"+(s||","))},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.contains=function(){return!!~String.prototype.indexOf.apply(this,arguments)},String.prototype.toDate=function(format,locale){var normalized,formatItems,dateItems,monthIndex,dayIndex,yearIndex,hourIndex,minutesIndex,secondsIndex,year,month,day,hour,minute,second,parsedMonth;locale=locale||"en-US";if(null==format||""===format)return new Date(this);if(normalized=this.replace(/[\/,.:\s]/g,"-"),formatItems=format.toLowerCase().replace(/[^a-zA-Z0-9%]/g,"-").split("-"),dateItems=normalized.split("-"),""===normalized.replace(/\-/g,"").trim())return"Invalid Date";if(monthIndex=-1<formatItems.indexOf("mm")?formatItems.indexOf("mm"):formatItems.indexOf("%m"),dayIndex=-1<formatItems.indexOf("dd")?formatItems.indexOf("dd"):formatItems.indexOf("%d"),yearIndex=-1<formatItems.indexOf("yyyy")?formatItems.indexOf("yyyy"):-1<formatItems.indexOf("yy")?formatItems.indexOf("yy"):formatItems.indexOf("%y"),hourIndex=-1<formatItems.indexOf("hh")?formatItems.indexOf("hh"):formatItems.indexOf("%h"),minutesIndex=-1<formatItems.indexOf("ii")?formatItems.indexOf("ii"):-1<formatItems.indexOf("mi")?formatItems.indexOf("mi"):formatItems.indexOf("%i"),secondsIndex=-1<formatItems.indexOf("ss")?formatItems.indexOf("ss"):formatItems.indexOf("%s"),!(-1<monthIndex&&""!==dateItems[monthIndex]))return"Invalid Date";if(isNaN(parseInt(dateItems[monthIndex]))){if(dateItems[monthIndex]=function(month){var d,months,index,i;if(month=month.substr(0,3),void 0!==locale&&"en-US"!==locale&&void 0!==Locales&&void 0!==Locales[locale]&&void 0!==Locales[locale].calendar&&void 0!==Locales[locale].calendar.months){for(months=Locales[locale].calendar.months,i=12;i<months.length;i++)if(months[i].toLowerCase()===month.toLowerCase()){index=i-12;break}month=Locales["en-US"].calendar.months[index]}return d=Date.parse(month+" 1, 1972"),isNaN(d)?-1:new Date(d).getMonth()+1}(dateItems[monthIndex]),-1===dateItems[monthIndex])return"Invalid Date"}else if((parsedMonth=parseInt(dateItems[monthIndex]))<1||12<parsedMonth)return"Invalid Date";return year=-1<yearIndex&&""!==dateItems[yearIndex]?dateItems[yearIndex]:null,month=-1<monthIndex&&""!==dateItems[monthIndex]?dateItems[monthIndex]:null,day=-1<dayIndex&&""!==dateItems[dayIndex]?dateItems[dayIndex]:null,hour=-1<hourIndex&&""!==dateItems[hourIndex]?dateItems[hourIndex]:null,minute=-1<minutesIndex&&""!==dateItems[minutesIndex]?dateItems[minutesIndex]:null,second=-1<secondsIndex&&""!==dateItems[secondsIndex]?dateItems[secondsIndex]:null,new Date(year,month-1,day,hour,minute,second)},String.prototype.toArray=function(delimiter,type,format){return type=type||"string",format=null!=format&&format,(""+this).split(delimiter=delimiter||",").map(function(s){var result;switch(type){case"int":case"integer":result=parseInt(s);break;case"number":case"float":result=parseFloat(s);break;case"date":result=format?s.toDate(format):new Date(s);break;default:result=s.trim()}return result})},Date.prototype.getWeek=function(dowOffset){var nday,newYear,day,daynum,weeknum;return dowOffset=Utils.isValue(dowOffset)?"number"==typeof dowOffset?parseInt(dowOffset):0:METRO_WEEK_START,day=0<=(day=(newYear=new Date(this.getFullYear(),0,1)).getDay()-dowOffset)?day:day+7,daynum=Math.floor((this.getTime()-newYear.getTime()-6e4*(this.getTimezoneOffset()-newYear.getTimezoneOffset()))/864e5)+1,day<4?52<(weeknum=Math.floor((daynum+day-1)/7)+1)&&(weeknum=(nday=0<=(nday=new Date(this.getFullYear()+1,0,1).getDay()-dowOffset)?nday:nday+7)<4?1:53):weeknum=Math.floor((daynum+day-1)/7),weeknum},Date.prototype.getYear=function(){return this.getFullYear().toString().substr(-2)},Date.prototype.format=function(format,locale){void 0===locale&&(locale="en-US");var cal=(void 0!==Metro.locales&&void 0!==Metro.locales[locale]?Metro.locales[locale]:Metro.locales["en-US"]).calendar,date=this,nDay=date.getDay(),nDate=date.getDate(),nMonth=date.getMonth(),nYear=date.getFullYear(),nHour=date.getHours(),aDays=cal.days,aMonths=cal.months,aDayCount=[0,31,59,90,120,151,181,212,243,273,304,334],getThursday=function(){var target=new Date(date);return target.setDate(nDate-(nDay+6)%7+3),target},zeroPad=function(nNum,nPad){return(""+(Math.pow(10,nPad)+nNum)).slice(1)};return format.replace(/(%[a-z])/gi,function(sMatch){return{"%a":aDays[nDay].slice(0,3),"%A":aDays[nDay],"%b":aMonths[nMonth].slice(0,3),"%B":aMonths[nMonth],"%c":date.toUTCString(),"%C":Math.floor(nYear/100),"%d":zeroPad(nDate,2),dd:zeroPad(nDate,2),"%e":nDate,"%F":date.toISOString().slice(0,10),"%G":getThursday().getFullYear(),"%g":(""+getThursday().getFullYear()).slice(2),"%H":zeroPad(nHour,2),"%I":zeroPad((nHour+11)%12+1,2),"%j":zeroPad(aDayCount[nMonth]+nDate+(1<nMonth&&(nYear%4==0&&nYear%100!=0||nYear%400==0)?1:0),3),"%k":""+nHour,"%l":(nHour+11)%12+1,"%m":zeroPad(nMonth+1,2),"%M":zeroPad(date.getMinutes(),2),"%p":nHour<12?"AM":"PM","%P":nHour<12?"am":"pm","%s":Math.round(date.getTime()/1e3),"%S":zeroPad(date.getSeconds(),2),"%u":nDay||7,"%V":function(){var target=getThursday(),n1stThu=target.valueOf();target.setMonth(0,1);var nJan1=target.getDay();return 4!==nJan1&&target.setMonth(0,1+(4-nJan1+7)%7),zeroPad(1+Math.ceil((n1stThu-target)/6048e5),2)}(),"%w":""+nDay,"%x":date.toLocaleDateString(),"%X":date.toLocaleTimeString(),"%y":(""+nYear).slice(2),"%Y":nYear,"%z":date.toTimeString().replace(/.+GMT([+-]\d+).+/,"$1"),"%Z":date.toTimeString().replace(/.+\((.+?)\)$/,"$1")}[sMatch]||sMatch})},Date.prototype.addHours=function(n){return this.setTime(this.getTime()+60*n*60*1e3),this},Date.prototype.addDays=function(n){return this.setDate(this.getDate()+n),this},Date.prototype.addMonths=function(n){return this.setMonth(this.getMonth()+n),this},Date.prototype.addYears=function(n){return this.setFullYear(this.getFullYear()+n),this};var Locales={"en-US":{calendar:{months:["January","February","March","April","May","June","July","August","September","October","November","December","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Su","Mo","Tu","We","Th","Fr","Sa","Sun","Mon","Tus","Wen","Thu","Fri","Sat"],time:{days:"DAYS",hours:"HOURS",minutes:"MINS",seconds:"SECS",month:"MON",day:"DAY",year:"YEAR"}},buttons:{ok:"OK",cancel:"Cancel",done:"Done",today:"Today",now:"Now",clear:"Clear",help:"Help",yes:"Yes",no:"No",random:"Random",save:"Save",reset:"Reset"}},"cn-ZH":{calendar:{months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月","1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六","日","一","二","三","四","五","六","周日","周一","周二","周三","周四","周五","周六"],time:{days:"天",hours:"时",minutes:"分",seconds:"秒",month:"月",day:"日",year:"年"}},buttons:{ok:"确认",cancel:"取消",done:"完成",today:"今天",now:"现在",clear:"清除",help:"帮助",yes:"是",no:"否",random:"随机",save:"保存",reset:"重啟"}},"de-DE":{calendar:{months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],days:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag","Sn","Mn","Di","Mi","Do","Fr","Sa","Son","Mon","Die","Mit","Don","Fre","Sam"],time:{days:"TAGE",hours:"UHR",minutes:"MIN",seconds:"SEK"}},buttons:{ok:"OK",cancel:"Abbrechen",done:"Fertig",today:"Heute",now:"Jetzt",clear:"Reinigen",help:"Hilfe",yes:"Ja",no:"Nein",random:"Zufällig",save:"Sparen",reset:"Zurücksetzen"}},"hu-HU":{calendar:{months:["Január","Február","Március","Április","Május","Június","Július","Augusztus","Szeptember","Október","November","December","Jan","Feb","Már","Ápr","Máj","Jún","Júl","Aug","Szep","Okt","Nov","Dec"],days:["Vasárnap","Hétfő","Kedd","Szerda","Csütörtök","Péntek","Szombat","V","H","K","Sz","Cs","P","Sz","Vas","Hét","Ke","Sze","Csü","Pén","Szom"],time:{days:"NAP",hours:"ÓRA",minutes:"PERC",seconds:"MP"}},buttons:{ok:"OK",cancel:"Mégse",done:"Kész",today:"Ma",now:"Most",clear:"Törlés",help:"Segítség",yes:"Igen",no:"Nem",random:"Véletlen",save:"Mentés",reset:"Visszaállítás"}},"ru-RU":{calendar:{months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь","Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],days:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Вс","Пн","Вт","Ср","Чт","Пт","Сб","Вос","Пон","Вто","Сре","Чет","Пят","Суб"],time:{days:"ДНИ",hours:"ЧАСЫ",minutes:"МИН",seconds:"СЕК"}},buttons:{ok:"ОК",cancel:"Отмена",done:"Готово",today:"Сегодня",now:"Сейчас",clear:"Очистить",help:"Помощь",yes:"Да",no:"Нет",random:"Случайно",save:"Сохранить",reset:"Сброс"}},"uk-UA":{calendar:{months:["Січень","Лютий","Березень","Квітень","Травень","Червень","Липень","Серпень","Вересень","Жовтень","Листопад","Грудень","Січ","Лют","Бер","Кві","Тра","Чер","Лип","Сер","Вер","Жов","Лис","Гру"],days:["Неділя","Понеділок","Вівторок","Середа","Четвер","П’ятниця","Субота","Нд","Пн","Вт","Ср","Чт","Пт","Сб","Нед","Пон","Вiв","Сер","Чет","Пят","Суб"],time:{days:"ДНІ",hours:"ГОД",minutes:"ХВИЛ",seconds:"СЕК"}},buttons:{ok:"ОК",cancel:"Відміна",done:"Готово",today:"Сьогодні",now:"Зараз",clear:"Очистити",help:"Допомога",yes:"Так",no:"Ні",random:"Випадково",save:"Зберегти",reset:"Скинути"}},"es-MX":{calendar:{months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre","Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],days:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Do","Lu","Ma","Mi","Ju","Vi","Sa","Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],time:{days:"DÍAS",hours:"HORAS",minutes:"MINS",seconds:"SEGS",month:"MES",day:"DÍA",year:"AÑO"}},buttons:{ok:"Aceptar",cancel:"Cancelar",done:"Hecho",today:"Hoy",now:"Ahora",clear:"Limpiar",help:"Ayuda",yes:"Si",no:"No",random:"Aleatorio",save:"Salvar",reset:"Reiniciar"}},"fr-FR":{calendar:{months:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre","Janv","Févr","Mars","Avr","Mai","Juin","Juil","Août","Sept","Oct","Nov","Déc"],days:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","De","Du","Ma","Me","Je","Ve","Sa","Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],time:{days:"JOURS",hours:"HEURES",minutes:"MINS",seconds:"SECS",month:"MOIS",day:"JOUR",year:"ANNEE"}},buttons:{ok:"OK",cancel:"Annulé",done:"Fait",today:"Aujourd'hui",now:"Maintenant",clear:"Effacé",help:"Aide",yes:"Oui",no:"Non",random:"Aléatoire",save:"Sauvegarder",reset:"Réinitialiser"}},"it-IT":{calendar:{months:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre","Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"],days:["Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato","Do","Lu","Ma","Me","Gi","Ve","Sa","Dom","Lun","Mar","Mer","Gio","Ven","Sab"],time:{days:"GIORNI",hours:"ORE",minutes:"MIN",seconds:"SEC",month:"MESE",day:"GIORNO",year:"ANNO"}},buttons:{ok:"OK",cancel:"Annulla",done:"Fatto",today:"Oggi",now:"Adesso",clear:"Cancella",help:"Aiuto",yes:"Sì",no:"No",random:"Random",save:"Salvare",reset:"Reset"}}};Metro.locales=Locales;var hotkeys={specialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},textAcceptingInputTypes:["text","password","number","email","url","range","date","month","week","time","datetime","datetime-local","search","color","tel"],textInputTypes:/textarea|input|select/i,options:{filterInputAcceptingElements:METRO_HOTKEYS_FILTER_INPUT_ACCEPTING_ELEMENTS,filterTextInputs:METRO_HOTKEYS_FILTER_TEXT_INPUTS,filterContentEditable:METRO_HOTKEYS_FILTER_CONTENT_EDITABLE},keyHandler:function(handleObj){if("string"==typeof handleObj.data&&(handleObj.data={keys:handleObj.data}),handleObj.data&&handleObj.data.keys&&"string"==typeof handleObj.data.keys){var origHandler=handleObj.handler,keys=handleObj.data.keys.toLowerCase().split(" ");handleObj.handler=function(event){if(this===event.target||!(hotkeys.options.filterInputAcceptingElements&&hotkeys.textInputTypes.test(event.target.nodeName)||hotkeys.options.filterContentEditable&&$(event.target).attr("contenteditable")||hotkeys.options.filterTextInputs&&-1<$.inArray(event.target.type,hotkeys.textAcceptingInputTypes))){var special="keypress"!==event.type&&hotkeys.specialKeys[event.which],character=String.fromCharCode(event.which).toLowerCase(),modif="",possible={};$.each(["alt","ctrl","shift"],function(index,specialKey){event[specialKey+"Key"]&&special!==specialKey&&(modif+=specialKey+"+")}),event.metaKey&&!event.ctrlKey&&"meta"!==special&&(modif+="meta+"),event.metaKey&&"meta"!==special&&-1<modif.indexOf("alt+ctrl+shift+")&&(modif=modif.replace("alt+ctrl+shift+","hyper+")),special?possible[modif+special]=!0:(possible[modif+character]=!0,possible[modif+hotkeys.shiftNums[character]]=!0,"shift+"===modif&&(possible[hotkeys.shiftNums[character]]=!0));for(var i=0,l=keys.length;i<l;i++)if(possible[keys[i]])return origHandler.apply(this,arguments)}}}}};$.each(["keydown","keyup","keypress"],function(){$.event.special[this]={add:hotkeys.keyHandler}});var hexcase=0;function rstr_md5(s){return binl2rstr(binl_md5(rstr2binl(s),8*s.length))}function rstr2hex(input){for(var x,hex_tab=hexcase?"0123456789ABCDEF":"0123456789abcdef",output="",i=0;i<input.length;i++)x=input.charCodeAt(i),output+=hex_tab.charAt(x>>>4&15)+hex_tab.charAt(15&x);return output}function str2rstr_utf8(input){for(var x,y,output="",i=-1;++i<input.length;)x=input.charCodeAt(i),y=i+1<input.length?input.charCodeAt(i+1):0,55296<=x&&x<=56319&&56320<=y&&y<=57343&&(x=65536+((1023&x)<<10)+(1023&y),i++),x<=127?output+=String.fromCharCode(x):x<=2047?output+=String.fromCharCode(192|x>>>6&31,128|63&x):x<=65535?output+=String.fromCharCode(224|x>>>12&15,128|x>>>6&63,128|63&x):x<=2097151&&(output+=String.fromCharCode(240|x>>>18&7,128|x>>>12&63,128|x>>>6&63,128|63&x));return output}function rstr2binl(input){var i,output=new Array(input.length>>2);for(i=0;i<output.length;i++)output[i]=0;for(i=0;i<8*input.length;i+=8)output[i>>5]|=(255&input.charCodeAt(i/8))<<i%32;return output}function binl2rstr(input){for(var output="",i=0;i<32*input.length;i+=8)output+=String.fromCharCode(input[i>>5]>>>i%32&255);return output}function binl_md5(x,len){x[len>>5]|=128<<len%32,x[14+(len+64>>>9<<4)]=len;for(var a=1732584193,b=-271733879,c=-1732584194,d=271733878,i=0;i<x.length;i+=16){var olda=a,oldb=b,oldc=c,oldd=d;b=md5_ii(b=md5_ii(b=md5_ii(b=md5_ii(b=md5_hh(b=md5_hh(b=md5_hh(b=md5_hh(b=md5_gg(b=md5_gg(b=md5_gg(b=md5_gg(b=md5_ff(b=md5_ff(b=md5_ff(b=md5_ff(b,c=md5_ff(c,d=md5_ff(d,a=md5_ff(a,b,c,d,x[i],7,-680876936),b,c,x[i+1],12,-389564586),a,b,x[i+2],17,606105819),d,a,x[i+3],22,-1044525330),c=md5_ff(c,d=md5_ff(d,a=md5_ff(a,b,c,d,x[i+4],7,-176418897),b,c,x[i+5],12,1200080426),a,b,x[i+6],17,-1473231341),d,a,x[i+7],22,-45705983),c=md5_ff(c,d=md5_ff(d,a=md5_ff(a,b,c,d,x[i+8],7,1770035416),b,c,x[i+9],12,-1958414417),a,b,x[i+10],17,-42063),d,a,x[i+11],22,-1990404162),c=md5_ff(c,d=md5_ff(d,a=md5_ff(a,b,c,d,x[i+12],7,1804603682),b,c,x[i+13],12,-40341101),a,b,x[i+14],17,-1502002290),d,a,x[i+15],22,1236535329),c=md5_gg(c,d=md5_gg(d,a=md5_gg(a,b,c,d,x[i+1],5,-165796510),b,c,x[i+6],9,-1069501632),a,b,x[i+11],14,643717713),d,a,x[i],20,-373897302),c=md5_gg(c,d=md5_gg(d,a=md5_gg(a,b,c,d,x[i+5],5,-701558691),b,c,x[i+10],9,38016083),a,b,x[i+15],14,-660478335),d,a,x[i+4],20,-405537848),c=md5_gg(c,d=md5_gg(d,a=md5_gg(a,b,c,d,x[i+9],5,568446438),b,c,x[i+14],9,-1019803690),a,b,x[i+3],14,-187363961),d,a,x[i+8],20,1163531501),c=md5_gg(c,d=md5_gg(d,a=md5_gg(a,b,c,d,x[i+13],5,-1444681467),b,c,x[i+2],9,-51403784),a,b,x[i+7],14,1735328473),d,a,x[i+12],20,-1926607734),c=md5_hh(c,d=md5_hh(d,a=md5_hh(a,b,c,d,x[i+5],4,-378558),b,c,x[i+8],11,-2022574463),a,b,x[i+11],16,1839030562),d,a,x[i+14],23,-35309556),c=md5_hh(c,d=md5_hh(d,a=md5_hh(a,b,c,d,x[i+1],4,-1530992060),b,c,x[i+4],11,1272893353),a,b,x[i+7],16,-155497632),d,a,x[i+10],23,-1094730640),c=md5_hh(c,d=md5_hh(d,a=md5_hh(a,b,c,d,x[i+13],4,681279174),b,c,x[i],11,-358537222),a,b,x[i+3],16,-722521979),d,a,x[i+6],23,76029189),c=md5_hh(c,d=md5_hh(d,a=md5_hh(a,b,c,d,x[i+9],4,-640364487),b,c,x[i+12],11,-421815835),a,b,x[i+15],16,530742520),d,a,x[i+2],23,-995338651),c=md5_ii(c,d=md5_ii(d,a=md5_ii(a,b,c,d,x[i],6,-198630844),b,c,x[i+7],10,1126891415),a,b,x[i+14],15,-1416354905),d,a,x[i+5],21,-57434055),c=md5_ii(c,d=md5_ii(d,a=md5_ii(a,b,c,d,x[i+12],6,1700485571),b,c,x[i+3],10,-1894986606),a,b,x[i+10],15,-1051523),d,a,x[i+1],21,-2054922799),c=md5_ii(c,d=md5_ii(d,a=md5_ii(a,b,c,d,x[i+8],6,1873313359),b,c,x[i+15],10,-30611744),a,b,x[i+6],15,-1560198380),d,a,x[i+13],21,1309151649),c=md5_ii(c,d=md5_ii(d,a=md5_ii(a,b,c,d,x[i+4],6,-145523070),b,c,x[i+11],10,-1120210379),a,b,x[i+2],15,718787259),d,a,x[i+9],21,-343485551),a=safe_add(a,olda),b=safe_add(b,oldb),c=safe_add(c,oldc),d=safe_add(d,oldd)}return[a,b,c,d]}function md5_cmn(q,a,b,x,s,t){return safe_add((num=safe_add(safe_add(a,q),safe_add(x,t)))<<(cnt=s)|num>>>32-cnt,b);var num,cnt}function md5_ff(a,b,c,d,x,s,t){return md5_cmn(b&c|~b&d,a,b,x,s,t)}function md5_gg(a,b,c,d,x,s,t){return md5_cmn(b&d|c&~d,a,b,x,s,t)}function md5_hh(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t)}function md5_ii(a,b,c,d,x,s,t){return md5_cmn(c^(b|~d),a,b,x,s,t)}function safe_add(x,y){var lsw=(65535&x)+(65535&y);return(x>>16)+(y>>16)+(lsw>>16)<<16|65535&lsw}var nullLowestDeltaTimeout,lowestDelta,toFix=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],toBind="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],slice=Array.prototype.slice;if($.event.fixHooks)for(var i=toFix.length;i;)$.event.fixHooks[toFix[--i]]=$.event.mouseHooks;function mousewheel_handler(event){var absDelta,orgEvent=event||window.event,args=slice.call(arguments,1),delta=0,deltaX=0,deltaY=0,offsetX=0,offsetY=0;if((event=$.event.fix(orgEvent)).type="mousewheel","detail"in orgEvent&&(deltaY=-1*orgEvent.detail),"wheelDelta"in orgEvent&&(deltaY=orgEvent.wheelDelta),"wheelDeltaY"in orgEvent&&(deltaY=orgEvent.wheelDeltaY),"wheelDeltaX"in orgEvent&&(deltaX=-1*orgEvent.wheelDeltaX),"axis"in orgEvent&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS&&(deltaX=-1*deltaY,deltaY=0),delta=0===deltaY?deltaX:deltaY,"deltaY"in orgEvent&&(delta=deltaY=-1*orgEvent.deltaY),"deltaX"in orgEvent&&(deltaX=orgEvent.deltaX,0===deltaY&&(delta=-1*deltaX)),0!==deltaY||0!==deltaX){if(1===orgEvent.deltaMode){var lineHeight=$.data(this,"mousewheel-line-height");delta*=lineHeight,deltaY*=lineHeight,deltaX*=lineHeight}else if(2===orgEvent.deltaMode){var pageHeight=$.data(this,"mousewheel-page-height");delta*=pageHeight,deltaY*=pageHeight,deltaX*=pageHeight}if(absDelta=Math.max(Math.abs(deltaY),Math.abs(deltaX)),(!lowestDelta||absDelta<lowestDelta)&&shouldAdjustOldDeltas(orgEvent,lowestDelta=absDelta)&&(lowestDelta/=40),shouldAdjustOldDeltas(orgEvent,absDelta)&&(delta/=40,deltaX/=40,deltaY/=40),delta=Math[1<=delta?"floor":"ceil"](delta/lowestDelta),deltaX=Math[1<=deltaX?"floor":"ceil"](deltaX/lowestDelta),deltaY=Math[1<=deltaY?"floor":"ceil"](deltaY/lowestDelta),$.event.special.mousewheel.settings.normalizeOffset&&this.getBoundingClientRect){var boundingRect=this.getBoundingClientRect();offsetX=event.clientX-boundingRect.left,offsetY=event.clientY-boundingRect.top}return event.deltaX=deltaX,event.deltaY=deltaY,event.deltaFactor=lowestDelta,event.offsetX=offsetX,event.offsetY=offsetY,event.deltaMode=0,args.unshift(event,delta,deltaX,deltaY),nullLowestDeltaTimeout&&clearTimeout(nullLowestDeltaTimeout),nullLowestDeltaTimeout=setTimeout(nullLowestDelta,200),($.event.dispatch||$.event.handle).apply(this,args)}}function nullLowestDelta(){lowestDelta=null}function shouldAdjustOldDeltas(orgEvent,absDelta){return $.event.special.mousewheel.settings.adjustOldDeltas&&"mousewheel"===orgEvent.type&&absDelta%120==0}$.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var i=toBind.length;i;)this.addEventListener(toBind[--i],mousewheel_handler,!1);else this.onmousewheel=mousewheel_handler;$.data(this,"mousewheel-line-height",$.event.special.mousewheel.getLineHeight(this)),$.data(this,"mousewheel-page-height",$.event.special.mousewheel.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var i=toBind.length;i;)this.removeEventListener(toBind[--i],mousewheel_handler,!1);else this.onmousewheel=null;$.removeData(this,"mousewheel-line-height"),$.removeData(this,"mousewheel-page-height")},getLineHeight:function(elem){var $elem=$(elem),$parent=$elem["offsetParent"in $.fn?"offsetParent":"parent"]();return $parent.length||($parent=$("body")),parseInt($parent.css("fontSize"),10)||parseInt($elem.css("fontSize"),10)||16},getPageHeight:function(elem){return $(elem).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}},$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel")},unmousewheel:function(fn){return this.unbind("mousewheel",fn)}});var dispatch=$.event.dispatch||$.event.handle,special=jQuery.event.special,uid1="D"+ +new Date,uid2="D"+(+new Date+1);special.scrollstart={setup:function(data){var timer,_data=$.extend({latency:special.scrollstop.latency},data),handler=function(evt){timer?(clearTimeout(timer),timer=null):(evt.type="scrollstart",dispatch.apply(this,arguments)),timer=setTimeout(function(){timer=null},_data.latency)};$(this).on("scroll",handler).data(uid1,handler)},teardown:function(){$(this).off("scroll",$(this).data(uid1))}},special.scrollstop={latency:250,setup:function(data){var timer,_data=$.extend({latency:special.scrollstop.latency},data),handler=function(evt){var _self=this,_args=arguments;timer&&(clearTimeout(timer),timer=null),timer=setTimeout(function(){timer=null,evt.type="scrollstop",dispatch.apply(_self,_args)},_data.latency)};$(this).on("scroll",handler).data(uid2,handler)},teardown:function(){$(this).off("scroll",$(this).data(uid2))}};var Storage=function(type){return new Storage.init(type)};Storage.prototype={setKey:function(key){this.key=key},getKey:function(){return this.key},setItem:function(key,value){this.storage.setItem(this.key+":"+key,JSON.stringify(value))},getItem:function(key,default_value,reviver){var result,value;value=this.storage.getItem(this.key+":"+key);try{result=JSON.parse(value,reviver)}catch(e){result=null}return Utils.nvl(result,default_value)},getItemPart:function(key,sub_key,default_value,reviver){var i,val=this.getItem(key,default_value,reviver);for(sub_key=sub_key.split("->"),i=0;i<sub_key.length;i++)val=val[sub_key[i]];return val},delItem:function(key){this.storage.removeItem(this.key+":"+key)},size:function(unit){var divider;switch(unit){case"m":case"M":divider=1048576;break;case"k":case"K":divider=1024;break;default:divider=1}return JSON.stringify(this.storage).length/divider}},Storage.init=function(type){return this.key="",this.storage=type||window.localStorage,this},Storage.init.prototype=Storage.prototype,Metro.storage=Storage(window.localStorage),Metro.session=Storage(window.sessionStorage);Metro.template=function(html,options){for(var result,match,re=/<%(.+?)%>/g,reExp=/(^( )?(var|if|for|else|switch|case|break|{|}|;))(.*)?/g,code="with(obj) { var r=[];\n",cursor=0,add=function(line,js){return code+=js?line.match(reExp)?line+"\n":"r.push("+line+");\n":""!==line?'r.push("'+line.replace(/"/g,'\\"')+'");\n':"",add};match=re.exec(html);)add(html.slice(cursor,match.index))(match[1],!0),cursor=match.index+match[0].length;add(html.substr(cursor,html.length-cursor)),code=(code+'return r.join(""); }').replace(/[\r\t\n]/g," ");try{result=new Function("obj",code).apply(options,[options])}catch(err){console.error("'"+err.message+"'"," in \n\nCode:\n",code,"\n")}return result};var Utils={isUrl:function(val){return/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@\-\/]))?/.test(val)},isTag:function(val){return/^<\/?[\w\s="/.':;#-\/\?]+>/gi.test(val)},isColor:function(val){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(val)},isEmbedObject:function(val){var result=!1;return $.each(["iframe","object","embed","video"],function(i,v){"string"==typeof val&&val.toLowerCase()===v?result=!0:void 0!==val.nodeType&&val.tagName.toLowerCase()===v&&(result=!0)}),result},isVideoUrl:function(val){return/youtu\.be|youtube|vimeo/gi.test(val)},isDate:function(val,format){return!("object"!=typeof val||!Utils.isFunc(val.getMonth))||"Invalid Date"!==(Utils.isValue(format)?String(val).toDate(format):String(new Date(val)))},isDateObject:function(v){return"object"==typeof v&&void 0!==v.getMonth},isInt:function(n){return Number(n)===n&&n%1==0},isFloat:function(n){return Number(n)===n&&n%1!=0},isTouchDevice:function(){return"ontouchstart"in window||0<navigator.MaxTouchPoints||0<navigator.msMaxTouchPoints},isFunc:function(f){return Utils.isType(f,"function")},isObject:function(o){return Utils.isType(o,"object")},isArray:function(a){return Array.isArray(a)},isType:function(o,t){if(null==o)return!1;if(typeof o===t)return o;if(Utils.isTag(o)||Utils.isUrl(o))return!1;if(typeof window[o]===t)return window[o];if("string"==typeof o&&-1===o.indexOf("."))return!1;if("string"==typeof o&&-1!==o.indexOf(" "))return!1;if("string"==typeof o&&-1!==o.indexOf("("))return!1;if("string"==typeof o&&-1!==o.indexOf("["))return!1;if("number"==typeof o&&"number"!==t.toLowerCase())return!1;var i,ns=o.split("."),context=window;for(i=0;i<ns.length;i++)context=context[ns[i]];return typeof context===t&&context},isMetroObject:function(el,type){var $el=$(el),el_obj=$el.data(type);return 0===$el.length?(console.log(type+" "+el+" not found!"),!1):void 0!==el_obj||(console.log("Element not contain role "+type+'! Please add attribute data-role="'+type+'" to element '+el),!1)},isJQueryObject:function(el){return"function"==typeof jQuery&&el instanceof jQuery},embedObject:function(val){return"string"!=typeof val&&(val=Utils.isJQueryObject(val)?val.html():val.innerHTML),"<div class='embed-container'>"+val+"</div>"},embedUrl:function(val){return-1!==val.indexOf("youtu.be")&&(val="https://www.youtube.com/embed/"+val.split("/").pop()),"<div class='embed-container'><iframe src='"+val+"'></iframe></div>"},secondsToTime:function(secs){var divisor_for_minutes=secs%3600,divisor_for_seconds=divisor_for_minutes%60;return{h:Math.floor(secs/3600),m:Math.floor(divisor_for_minutes/60),s:Math.ceil(divisor_for_seconds)}},hex2rgba:function(hex,alpha){var c;if(alpha=isNaN(alpha)?1:alpha,/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex))return 3===(c=hex.substring(1).split("")).length&&(c=[c[0],c[0],c[1],c[1],c[2],c[2]]),"rgba("+[(c="0x"+c.join(""))>>16&255,c>>8&255,255&c].join(",")+","+alpha+")";throw new Error("Hex2rgba error. Bad Hex value")},random:function(from,to){return Math.floor(Math.random()*(to-from+1)+from)},uniqueId:function(){var d=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),("x"===c?r:3&r|8).toString(16)})},elementId:function(prefix){return prefix+"-"+(new Date).getTime()+Utils.random(1,1e3)},secondsToFormattedString:function(time){var sec_num=parseInt(time,10),hours=Math.floor(sec_num/3600),minutes=Math.floor((sec_num-3600*hours)/60),seconds=sec_num-3600*hours-60*minutes;return hours<10&&(hours="0"+hours),minutes<10&&(minutes="0"+minutes),seconds<10&&(seconds="0"+seconds),[hours,minutes,seconds].join(":")},callback:function(f,args,context){return Utils.exec(f,args,context)},func:function(f){return new Function("a",f)},exec:function(f,args,context){var result;if(null==f)return!1;var func=Utils.isFunc(f);!1===func&&(func=Utils.func(f));try{result=func.apply(context,args)}catch(err){if(!(result=null)===METRO_THROWS)throw err}return result},isOutsider:function(el){var rect,clone=(el=Utils.isJQueryObject(el)?el:$(el)).clone();return clone.removeAttr("data-role").css({visibility:"hidden",position:"absolute",display:"block"}),el.parent().append(clone),rect=clone[0].getBoundingClientRect(),clone.remove(),0<=rect.top&&0<=rect.left&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth)},inViewport:function(el){var rect=Utils.rect(el);return 0<=rect.top&&0<=rect.left&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth)},rect:function(el){return"function"==typeof jQuery&&el instanceof jQuery&&(el=el[0]),el.getBoundingClientRect()},getCursorPosition:function(el,e){var a=Utils.rect(el);return{x:Utils.pageXY(e).x-a.left-window.pageXOffset,y:Utils.pageXY(e).y-a.top-window.pageYOffset}},getCursorPositionX:function(el,e){return Utils.getCursorPosition(el,e).x},getCursorPositionY:function(el,e){return Utils.getCursorPosition(el,e).y},objectLength:function(obj){return Object.keys(obj).length},percent:function(total,part,round_value){if(0===total)return 0;var result=100*part/total;return!0===round_value?Math.round(result):Math.round(100*result)/100},camelCase:function(str){return str.replace(/-([a-z])/g,function(g){return g[1].toUpperCase()})},dashedName:function(str){return str.replace(/([A-Z])/g,function(u){return"-"+u.toLowerCase()})},objectShift:function(obj){var min=0;return $.each(obj,function(i){0===min?min=i:i<min&&(min=i)}),delete obj[min],obj},objectDelete:function(obj,key){void 0!==obj[key]&&delete obj[key]},arrayDeleteByMultipleKeys:function(arr,keys){return keys.forEach(function(ind){delete arr[ind]}),arr.filter(function(item){return void 0!==item})},arrayDelete:function(arr,val){-1<arr.indexOf(val)&&arr.splice(arr.indexOf(val),1)},arrayDeleteByKey:function(arr,key){arr.splice(key,1)},nvl:function(data,other){return null==data?other:data},objectClone:function(obj){var copy={};for(var key in obj)obj.hasOwnProperty(key)&&(copy[key]=obj[key]);return copy},github:function(repo,callback){var that=this;$.ajax({url:"https://api.github.com/repos/"+repo,dataType:"jsonp"}).done(function(data){that.callback(callback,[data.data])})},detectIE:function(){var ua=window.navigator.userAgent,msie=ua.indexOf("MSIE ");if(0<msie)return parseInt(ua.substring(msie+5,ua.indexOf(".",msie)),10);if(0<ua.indexOf("Trident/")){var rv=ua.indexOf("rv:");return parseInt(ua.substring(rv+3,ua.indexOf(".",rv)),10)}var edge=ua.indexOf("Edge/");return 0<edge&&parseInt(ua.substring(edge+5,ua.indexOf(".",edge)),10)},detectChrome:function(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)},md5:function(s){return function(s){return rstr2hex(rstr_md5(str2rstr_utf8(s)))}(s)},encodeURI:function(str){return encodeURI(str).replace(/%5B/g,"[").replace(/%5D/g,"]")},pageHeight:function(){var body=document.body,html=document.documentElement;return Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight)},cleanPreCode:function(selector){Array.prototype.slice.call(document.querySelectorAll(selector),0).forEach(function(el){var txt=el.textContent.replace(/^[\r\n]+/,"").replace(/\s+$/g,"");if(/^\S/gm.test(txt))el.textContent=txt;else{for(var mat,str,len,re=/^[\t ]+/gm,min=1e3;mat=re.exec(txt);)(len=mat[0].length)<min&&(min=len,str=mat[0]);1e3!==min&&(el.textContent=txt.replace(new RegExp("^"+str,"gm"),""))}})},coords:function(el){Utils.isJQueryObject(el)&&(el=el[0]);var box=el.getBoundingClientRect();return{top:box.top+window.pageYOffset,left:box.left+window.pageXOffset}},positionXY:function(e,t){switch(t){case"client":return Utils.clientXY(e);case"screen":return Utils.screenXY(e);case"page":return Utils.pageXY(e);default:return{x:0,y:0}}},clientXY:function(e){return{x:e.changedTouches?e.changedTouches[0].clientX:e.clientX,y:e.changedTouches?e.changedTouches[0].clientY:e.clientY}},screenXY:function(e){return{x:e.changedTouches?e.changedTouches[0].screenX:e.screenX,y:e.changedTouches?e.changedTouches[0].screenY:e.screenY}},pageXY:function(e){return{x:e.changedTouches?e.changedTouches[0].pageX:e.pageX,y:e.changedTouches?e.changedTouches[0].pageY:e.pageY}},isRightMouse:function(e){return"which"in e?3===e.which:"button"in e?2===e.button:void 0},hiddenElementSize:function(el,includeMargin){var clone=$(el).clone();clone.removeAttr("data-role").css({visibility:"hidden",position:"absolute",display:"block"}),$("body").append(clone),void 0===includeMargin&&(includeMargin=!1);var width=clone.outerWidth(includeMargin),height=clone.outerHeight(includeMargin);return clone.remove(),{width:width,height:height}},getStyle:function(el,pseudo){return!0===Utils.isJQueryObject(el)&&(el=el[0]),window.getComputedStyle(el,pseudo)},getStyleOne:function(el,property){return Utils.getStyle(el).getPropertyValue(property)},getTransformMatrix:function(el,returnArray){var a=Utils.getStyleOne(el,"transform").replace("matrix(","").slice(0,-1).split(",");return!0!==returnArray?{a:a[0],b:a[1],c:a[2],d:a[3],tx:a[4],ty:a[5]}:a},computedRgbToHex:function(rgb){var i,a=rgb.replace(/[^\d,]/g,"").split(","),result="#";for(i=0;i<3;i++){var h=parseInt(a[i]).toString(16);result+=1===h.length?"0"+h:h}return result},computedRgbToRgba:function(rgb,alpha){var a=rgb.replace(/[^\d,]/g,"").split(",");return void 0===alpha&&(alpha=1),a.push(alpha),"rgba("+a.join(",")+")"},computedRgbToArray:function(rgb){return rgb.replace(/[^\d,]/g,"").split(",")},hexColorToArray:function(hex){var c;return/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)?(3===(c=hex.substring(1).split("")).length&&(c=[c[0],c[0],c[1],c[1],c[2],c[2]]),[(c="0x"+c.join(""))>>16&255,c>>8&255,255&c]):[0,0,0]},hexColorToRgbA:function(hex,alpha){var c;return/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)?(3===(c=hex.substring(1).split("")).length&&(c=[c[0],c[0],c[1],c[1],c[2],c[2]]),"rgba("+[(c="0x"+c.join(""))>>16&255,c>>8&255,255&c,alpha||1].join(",")+")"):"rgba(0,0,0,1)"},getInlineStyles:function(el){var styles={};Utils.isJQueryObject(el)&&(el=el[0]);for(var i=0,l=el.style.length;i<l;i++){var s=el.style[i];styles[s]=el.style[s]}return styles},updateURIParameter:function(uri,key,value){var re=new RegExp("([?&])"+key+"=.*?(&|$)","i"),separator=-1!==uri.indexOf("?")?"&":"?";return uri.match(re)?uri.replace(re,"$1"+key+"="+value+"$2"):uri+separator+key+"="+value},getURIParameter:function(url,name){url||(url=window.location.href),name=name.replace(/[\[\]]/g,"\\$&");var results=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)").exec(url);return results?results[2]?decodeURIComponent(results[2].replace(/\+/g," ")):"":null},getLocales:function(){return Object.keys(Metro.locales)},addLocale:function(locale){Metro.locales=$.extend({},Metro.locales,locale)},strToArray:function(str,delimiter,type,format){return Utils.isValue(delimiter)||(delimiter=","),Utils.isValue(type)||(type="string"),(""+str).split(delimiter).map(function(s){var result;switch(type){case"int":case"integer":result=parseInt(s);break;case"number":case"float":result=parseFloat(s);break;case"date":result=Utils.isValue(format)?s.toDate(format):new Date(s);break;default:result=s.trim()}return result})},aspectRatioH:function(width,a){return"16/9"===a?9*width/16:"21/9"===a?9*width/21:"4/3"===a?3*width/4:void 0},aspectRatioW:function(height,a){return"16/9"===a?16*height/9:"21/9"===a?21*height/9:"4/3"===a?4*height/3:void 0},valueInObject:function(obj,value){return-1<Object.values(obj).indexOf(value)},keyInObject:function(obj,key){return-1<Object.keys(obj).indexOf(key)},inObject:function(obj,key,val){return void 0!==obj[key]&&obj[key]===val},newCssSheet:function(media){var style=document.createElement("style");return void 0!==media&&style.setAttribute("media",media),style.appendChild(document.createTextNode("")),document.head.appendChild(style),style.sheet},addCssRule:function(sheet,selector,rules,index){"insertRule"in sheet?sheet.insertRule(selector+"{"+rules+"}",index):"addRule"in sheet&&sheet.addRule(selector,rules,index)},media:function(query){return window.matchMedia(query).matches},mediaModes:function(){return METRO_MEDIA},mediaExist:function(media){return-1<METRO_MEDIA.indexOf(media)},inMedia:function(media){return-1<METRO_MEDIA.indexOf(media)&&METRO_MEDIA.indexOf(media)===METRO_MEDIA.length-1},isValue:function(val){return null!=val&&""!==val},isNull:function(val){return null==val},isNegative:function(val){return parseFloat(val)<0},isPositive:function(val){return 0<parseFloat(val)},isZero:function(val){return 0===parseFloat(val.toFixed(2))},between:function(val,bottom,top,equals){return!0===equals?bottom<=val&&val<=top:bottom<val&&val<top},parseMoney:function(val){return Number(parseFloat(val.replace(/[^0-9-.]/g,"")))},parseCard:function(val){return val.replace(/[^0-9]/g,"")},parsePhone:function(val){return Utils.parseCard(val)},isVisible:function(el){return Utils.isJQueryObject(el)&&(el=el[0]),"none"!==Utils.getStyleOne(el,"display")&&"hidden"!==Utils.getStyleOne(el,"visibility")&&null!==el.offsetParent},parseNumber:function(val,thousand,decimal){return val.replace(new RegExp("\\"+thousand,"g"),"").replace(new RegExp("\\"+decimal,"g"),".")},nearest:function(val,precision,down){return val/=precision,val=Math[!0===down?"floor":"ceil"](val)*precision},bool:function(value){switch(value){case!0:case"true":case 1:case"1":case"on":case"yes":return!0;default:return!1}},copy:function(el){var range,sel,body=document.body;if(Utils.isJQueryObject(el)&&(el=el[0]),document.createRange&&window.getSelection){range=document.createRange(),(sel=window.getSelection()).removeAllRanges();try{range.selectNodeContents(el),sel.addRange(range)}catch(e){range.selectNode(el),sel.addRange(range)}}else body.createTextRange&&((range=body.createTextRange()).moveToElementText(el),range.select());document.execCommand("Copy"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},isLocalhost:function(){return"localhost"===location.hostname||"127.0.0.1"===location.hostname||""===location.hostname},formData:function(form){if(!Utils.isNull(form)&&(Utils.isJQueryObject(form)&&(form=form[0]),form&&"FORM"===form.nodeName)){var i,j,q={};for(i=form.elements.length-1;0<=i;i-=1)if(""!==form.elements[i].name)switch(form.elements[i].nodeName){case"INPUT":switch(form.elements[i].type){case"text":case"hidden":case"password":case"button":case"reset":case"submit":q[form.elements[i].name]=form.elements[i].value;break;case"checkbox":case"radio":form.elements[i].checked&&(q[form.elements[i].name]=form.elements[i].value)}break;case"file":break;case"TEXTAREA":q[form.elements[i].name]=form.elements[i].value;break;case"SELECT":switch(form.elements[i].type){case"select-one":q[form.elements[i].name]=form.elements[i].value;break;case"select-multiple":for(q[form.elements[i].name]=[],j=form.elements[i].options.length-1;0<=j;j-=1)form.elements[i].options[j].selected&&q[form.elements[i].name].push(form.elements[i].options[j].value)}break;case"BUTTON":switch(form.elements[i].type){case"reset":case"submit":case"button":q[form.elements[i].name]=form.elements[i].value}}return q}}};Metro.utils=Utils;var Accordion={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this._setOptionsFromDOM(),this._create(),this},options:{showMarker:!0,material:!1,duration:METRO_ANIMATION_DURATION,oneFrame:!0,showActive:!0,activeFrameClass:"",activeHeadingClass:"",activeContentClass:"",onFrameOpen:Metro.noop,onFrameBeforeOpen:Metro.noop_true,onFrameClose:Metro.noop,onFrameBeforeClose:Metro.noop_true,onAccordionCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createStructure(),this._createEvents(),Utils.exec(o.onAccordionCreate,[element]),setImmediate(function(){element.fire("accordioncreate")})},_createStructure:function(){var frame_to_open,that=this,element=this.element,o=this.options,frames=element.children(".frame"),active=element.children(".frame.active");element.addClass("accordion"),!0===o.showMarker&&element.addClass("marker-on"),!0===o.material&&element.addClass("material"),frame_to_open=0===active.length?frames[0]:active[0],this._hideAll(),!0===o.showActive&&(!0===o.oneFrame?this._openFrame(frame_to_open):$.each(active,function(){that._openFrame(this)}))},_createEvents:function(){var that=this,element=this.element,o=this.options,active=element.children(".frame.active");element.on(Metro.events.click,".heading",function(){var heading=$(this),frame=heading.parent();if(heading.closest(".accordion")[0]!==element[0])return!1;frame.hasClass("active")?1===active.length&&o.oneFrame||that._closeFrame(frame):that._openFrame(frame)})},_openFrame:function(f){var element=this.element,o=this.options,frame=$(f);if(!1===Utils.exec(o.onFrameBeforeOpen,[frame],element[0]))return!1;!0===o.oneFrame&&this._closeAll(),frame.addClass("active "+o.activeFrameClass),frame.children(".heading").addClass(o.activeHeadingClass),frame.children(".content").addClass(o.activeContentClass).slideDown(o.duration),Utils.exec(o.onFrameOpen,[frame],element[0]),element.fire("frameopen",frame)},_closeFrame:function(f){var element=this.element,o=this.options,frame=$(f);frame.hasClass("active")&&!1!==Utils.exec(o.onFrameBeforeClose,[frame],element[0])&&(frame.removeClass("active "+o.activeFrameClass),frame.children(".heading").removeClass(o.activeHeadingClass),frame.children(".content").removeClass(o.activeContentClass).slideUp(o.duration),Utils.callback(o.onFrameClose,[frame],element[0]),element.fire("frameclose",frame))},_closeAll:function(){var that=this,element=this.element,frames=(this.options,element.children(".frame"));$.each(frames,function(){that._closeFrame(this)})},_hideAll:function(){var element=this.element,frames=(this.options,element.children(".frame"));$.each(frames,function(){$(this).children(".content").hide(0)})},_openAll:function(){var that=this,element=this.element,frames=(this.options,element.children(".frame"));$.each(frames,function(){that._openFrame(this)})},changeAttribute:function(attributeName){},destroy:function(){this.element.off(Metro.events.click,".heading")}};Metro.plugin("accordion",Accordion);var Activity={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this._setOptionsFromDOM(),this._create(),this},options:{type:"ring",style:"light",size:64,radius:20,onActivityCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var i,wrap,element=this.element,o=this.options;switch(element.html("").addClass(o.style+"-style").addClass("activity-"+o.type),o.type){case"metro":!function(){for(i=0;i<5;i++)$("<div/>").addClass("circle").appendTo(element)}();break;case"square":!function(){for(i=0;i<4;i++)$("<div/>").addClass("square").appendTo(element)}();break;case"cycle":$("<div/>").addClass("cycle").appendTo(element);break;case"simple":$('<svg class="circular"><circle class="path" cx="'+o.size/2+'" cy="'+o.size/2+'" r="'+o.radius+'" fill="none" stroke-width="2" stroke-miterlimit="10"/></svg>').appendTo(element);break;default:!function(){for(i=0;i<5;i++)wrap=$("<div/>").addClass("wrap").appendTo(element),$("<div/>").addClass("circle").appendTo(wrap)}()}Utils.exec(this.options.onActivityCreate,[this.element]),setImmediate(function(){element.fire("activitycreate")})},changeAttribute:function(attributeName){},destroy:function(){var element=this.element,o=this.options;element.html("").removeClass(o.style+"-style").removeClass("activity-"+o.type)}};Metro.plugin("activity",Activity);var AppBar={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this._setOptionsFromDOM(),this._create(),this},options:{expand:!(Metro.activity={open:function(options){var activity='<div data-role="activity" data-type="'+(options.type?options.type:"cycle")+'" data-style="'+(options.style?options.style:"color")+'"></div>',text=options.text?'<div class="text-center">'+options.text+"</div>":"";return Metro.dialog.create({content:activity+text,defaultAction:!1,clsContent:"d-flex flex-column flex-justify-center flex-align-center bg-transparent no-shadow w-auto",clsDialog:"no-border no-shadow bg-transparent global-dialog",autoHide:options.autoHide?options.autoHide:0,overlayClickClose:!0===options.overlayClickClose,overlayColor:options.overlayColor?options.overlayColor:"#000000",overlayAlpha:options.overlayAlpha?options.overlayAlpha:.5,clsOverlay:"global-overlay"})},close:function(a){Metro.dialog.close(a)}}),expandPoint:null,duration:100,onAppBarCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createStructure(),this._createEvents(),Utils.exec(o.onAppBarCreate,[element]),setImmediate(function(){element.fire("appbarcreate")})},_createStructure:function(){var hamburger,menu,element=this.element,o=this.options,id=Utils.elementId("app-bar");if(element.addClass("app-bar"),0===(hamburger=element.find(".hamburger")).length){hamburger=$("<button>").attr("type","button").addClass("hamburger menu-down");for(var i=0;i<3;i++)$("<span>").addClass("line").appendTo(hamburger);!0===Colors.isLight(Utils.computedRgbToHex(Utils.getStyleOne(element,"background-color")))&&hamburger.addClass("dark")}element.prepend(hamburger),0===(menu=element.find(".app-bar-menu")).length?hamburger.css("display","none"):Utils.addCssRule(Metro.sheet,".app-bar-menu li","list-style: none!important;"),!1==!!element.attr("id")&&element.attr("id",id),"block"===hamburger.css("display")?(menu.hide().addClass("collapsed"),hamburger.removeClass("hidden")):hamburger.addClass("hidden"),!0===o.expand?(element.addClass("app-bar-expand"),hamburger.addClass("hidden")):Utils.isValue(o.expandPoint)&&Utils.mediaExist(o.expandPoint)&&(element.addClass("app-bar-expand"),hamburger.addClass("hidden"))},_createEvents:function(){var that=this,element=this.element,o=this.options,menu=element.find(".app-bar-menu"),hamburger=element.find(".hamburger");element.on(Metro.events.click,".hamburger",function(){0!==menu.length&&(menu.hasClass("collapsed")?that.open():that.close())}),$(window).on(Metro.events.resize+"-"+element.attr("id"),function(){!0!==o.expand&&(Utils.isValue(o.expandPoint)&&Utils.mediaExist(o.expandPoint)?element.addClass("app-bar-expand"):element.removeClass("app-bar-expand")),0!==menu.length&&("block"!==hamburger.css("display")?(menu.show(),hamburger.addClass("hidden")):(hamburger.removeClass("hidden"),hamburger.hasClass("active")?menu.show().removeClass("collapsed"):menu.hide().addClass("collapsed")))})},close:function(){var element=this.element,o=this.options,menu=element.find(".app-bar-menu"),hamburger=element.find(".hamburger");menu.slideUp(o.duration,function(){menu.addClass("collapsed"),hamburger.removeClass("active")})},open:function(){var element=this.element,o=this.options,menu=element.find(".app-bar-menu"),hamburger=element.find(".hamburger");menu.slideDown(o.duration,function(){menu.removeClass("collapsed"),hamburger.addClass("active")})},changeAttribute:function(attributeName){},destroy:function(){var element=this.element;element.off(Metro.events.click,".hamburger"),$(window).off(Metro.events.resize+"-"+element.attr("id"))}};Metro.plugin("appbar",AppBar);var ButtonGroup={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.active=null,this._setOptionsFromDOM(),this._create(),this},options:{targets:"button",clsActive:"active",requiredButton:!1,mode:Metro.groupMode.ONE,onButtonClick:Metro.noop,onButtonsGroupCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createGroup(),this._createEvents(),Utils.exec(o.onButtonsGroupCreate,[element])},_createGroup:function(){var buttons,buttons_active,element=this.element,o=this.options,id=Utils.elementId("button-group");void 0===element.attr("id")&&element.attr("id",id),element.addClass("button-group"),buttons=element.find(o.targets),buttons_active=element.find("."+o.clsActive),o.mode===Metro.groupMode.ONE&&0===buttons_active.length&&!0===o.requiredButton&&$(buttons[0]).addClass(o.clsActive),o.mode===Metro.groupMode.ONE&&1<buttons_active.length&&(buttons.removeClass(o.clsActive),$(buttons[0]).addClass(o.clsActive)),element.find("."+o.clsActive).addClass("js-active")},_createEvents:function(){var element=this.element,o=this.options;element.on(Metro.events.click,o.targets,function(){var el=$(this);Utils.exec(o.onButtonClick,[el],this),o.mode===Metro.groupMode.ONE&&el.hasClass(o.clsActive)||(o.mode===Metro.groupMode.ONE?(element.find(o.targets).removeClass(o.clsActive).removeClass("js-active"),el.addClass(o.clsActive).addClass("js-active")):el.toggleClass(o.clsActive).toggleClass("js-active"))})},changeAttribute:function(attributeName){},destroy:function(){var element=this.element,o=this.options;element.off(Metro.events.click,o.targets),element.find(o.targets).removeClass(o.clsActive).removeClass("js-active")}};Metro.plugin("buttongroup",ButtonGroup);var BottomSheet={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.toggle=null,this._setOptionsFromDOM(),this._create(),this},options:{mode:"list",toggle:null,onOpen:Metro.noop,onClose:Metro.noop,onBottomSheetCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createStructure(),this._createEvents(),Utils.exec(o.onBottomSheetCreate,[element],element[0])},_createStructure:function(){var element=this.element,o=this.options;element.addClass("bottom-sheet").addClass(o.mode+"-list"),Utils.isValue(o.toggle)&&0<$(o.toggle).length&&(this.toggle=$(o.toggle))},_createEvents:function(){var that=this,element=this.element;this.options;Utils.isValue(this.toggle)&&this.toggle.on(Metro.events.click,function(){that.toggleView()}),element.on(Metro.events.click,"li",function(){that.close()})},isOpen:function(){return this.element.hasClass("opened")},open:function(mode){var element=this.element,o=this.options;Utils.isValue(mode)&&element.removeClass("list-style grid-style").addClass(mode+"-style"),this.element.addClass("opened"),Utils.exec(o.onOpen,[element],element[0])},close:function(){var element=this.element,o=this.options;element.removeClass("opened"),Utils.exec(o.onClose,[element],element[0])},toggle:function(mode){this.isOpen()?this.close():this.open(mode)},changeAttribute:function(attributeName){},destroy:function(){}};Metro.plugin("bottomsheet",BottomSheet);var Calendar={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.today=new Date,this.today.setHours(0,0,0,0),this.show=new Date,this.show.setHours(0,0,0,0),this.current={year:this.show.getFullYear(),month:this.show.getMonth(),day:this.show.getDate()},this.preset=[],this.selected=[],this.exclude=[],this.special=[],this.excludeDay=[],this.min=null,this.max=null,this.locale=null,this.minYear=this.current.year-this.options.yearsBefore,this.maxYear=this.current.year+this.options.yearsAfter,this.offset=(new Date).getTimezoneOffset()/60+1,this._setOptionsFromDOM(),this._create(),this},options:{dayBorder:!(Metro.bottomsheet={isBottomSheet:function(el){return Utils.isMetroObject(el,"bottomsheet")},open:function(el,as){if(!this.isBottomSheet(el))return!1;$(el).data("bottomsheet").open(as)},close:function(el){if(!this.isBottomSheet(el))return!1;$(el).data("bottomsheet").close()},toggle:function(el,as){if(!this.isBottomSheet(el))return!1;this.isOpen(el)?this.close(el):this.open(el,as)},isOpen:function(el){return!!this.isBottomSheet(el)&&$(el).data("bottomsheet").isOpen()}}),excludeDay:null,prevMonthIcon:"<span class='default-icon-chevron-left'></span>",nextMonthIcon:"<span class='default-icon-chevron-right'></span>",prevYearIcon:"<span class='default-icon-chevron-left'></span>",nextYearIcon:"<span class='default-icon-chevron-right'></span>",compact:!1,wide:!1,widePoint:null,pickerMode:!1,show:null,locale:METRO_LOCALE,weekStart:METRO_WEEK_START,outside:!0,buttons:"cancel, today, clear, done",yearsBefore:100,yearsAfter:100,headerFormat:"%A, %b %e",showHeader:!0,showFooter:!0,showTimeField:!0,showWeekNumber:!1,clsCalendar:"",clsCalendarHeader:"",clsCalendarContent:"",clsCalendarFooter:"",clsCalendarMonths:"",clsCalendarYears:"",clsToday:"",clsSelected:"",clsExcluded:"",clsCancelButton:"",clsTodayButton:"",clsClearButton:"",clsDoneButton:"",isDialog:!1,ripple:!1,rippleColor:"#cccccc",exclude:null,preset:null,minDate:null,maxDate:null,weekDayClick:!1,weekNumberClick:!1,multiSelect:!1,special:null,format:METRO_DATE_FORMAT,inputFormat:null,onCancel:Metro.noop,onToday:Metro.noop,onClear:Metro.noop,onDone:Metro.noop,onDayClick:Metro.noop,onDayDraw:Metro.noop,onWeekDayClick:Metro.noop,onWeekNumberClick:Metro.noop,onMonthChange:Metro.noop,onYearChange:Metro.noop,onCalendarCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;element.html("").addClass("calendar "+(!0===o.compact?"compact":"")).addClass(o.clsCalendar),!0===o.dayBorder&&element.addClass("day-border"),Utils.isValue(o.excludeDay)&&(this.excludeDay=(""+o.excludeDay).toArray(",","int")),Utils.isValue(o.preset)&&this._dates2array(o.preset,"selected"),Utils.isValue(o.exclude)&&this._dates2array(o.exclude,"exclude"),Utils.isValue(o.special)&&this._dates2array(o.special,"special"),!1!==o.buttons&&!1===Array.isArray(o.buttons)&&(o.buttons=o.buttons.split(",").map(function(item){return item.trim()})),null!==o.minDate&&Utils.isDate(o.minDate,o.inputFormat)&&(this.min=Utils.isValue(o.inputFormat)?o.minDate.toDate(o.inputFormat):new Date(o.minDate)),null!==o.maxDate&&Utils.isDate(o.maxDate,o.inputFormat)&&(this.max=Utils.isValue(o.inputFormat)?o.maxDate.toDate(o.inputFormat):new Date(o.maxDate)),null!==o.show&&Utils.isDate(o.show,o.inputFormat)&&(this.show=Utils.isValue(o.inputFormat)?o.show.toDate(o.inputFormat):new Date(o.show),this.show.setHours(0,0,0,0),this.current={year:this.show.getFullYear(),month:this.show.getMonth(),day:this.show.getDate()}),this.locale=void 0!==Metro.locales[o.locale]?Metro.locales[o.locale]:Metro.locales["en-US"],this._drawCalendar(),this._createEvents(),!0===o.wide?element.addClass("calendar-wide"):!Utils.isNull(o.widePoint)&&Utils.mediaExist(o.widePoint)&&element.addClass("calendar-wide"),!0===o.ripple&&!1!==Utils.isFunc(element.ripple)&&element.ripple({rippleTarget:".button, .prev-month, .next-month, .prev-year, .next-year, .day",rippleColor:this.options.rippleColor}),Utils.exec(this.options.onCalendarCreate,[this.element])},_dates2array:function(val,category){var dates,that=this,o=this.options;Utils.isNull(val)||(dates="string"==typeof val?Utils.strToArray(val):val,$.each(dates,function(){var _d;if(Utils.isDateObject(this))_d=this;else{if(_d=Utils.isValue(o.inputFormat)?this.toDate(o.inputFormat):new Date(this),!1===Utils.isDate(_d))return;_d.setHours(0,0,0,0)}that[category].push(_d.getTime())}))},_createEvents:function(){var that=this,element=this.element,o=this.options;$(window).on(Metro.events.resize,function(){!0!==o.wide&&(!Utils.isNull(o.widePoint)&&Utils.mediaExist(o.widePoint)?element.addClass("calendar-wide"):element.removeClass("calendar-wide"))}),element.on(Metro.events.click,".prev-month, .next-month, .prev-year, .next-year",function(e){var new_date,el=$(this);el.hasClass("prev-month")&&(new_date=new Date(that.current.year,that.current.month-1,1)).getFullYear()<that.minYear||el.hasClass("next-month")&&(new_date=new Date(that.current.year,that.current.month+1,1)).getFullYear()>that.maxYear||el.hasClass("prev-year")&&(new_date=new Date(that.current.year-1,that.current.month,1)).getFullYear()<that.minYear||el.hasClass("next-year")&&(new_date=new Date(that.current.year+1,that.current.month,1)).getFullYear()>that.maxYear||(that.current={year:new_date.getFullYear(),month:new_date.getMonth(),day:new_date.getDate()},setTimeout(function(){that._drawContent(),(el.hasClass("prev-month")||el.hasClass("next-month"))&&Utils.exec(o.onMonthChange,[that.current,element],element[0]),(el.hasClass("prev-year")||el.hasClass("next-year"))&&Utils.exec(o.onYearChange,[that.current,element],element[0])},o.ripple?300:1),e.preventDefault(),e.stopPropagation())}),element.on(Metro.events.click,".button.today",function(e){that.toDay(),Utils.exec(o.onToday,[that.today,element]),e.preventDefault(),e.stopPropagation()}),element.on(Metro.events.click,".button.clear",function(e){that.selected=[],that._drawContent(),Utils.exec(o.onClear,[element]),e.preventDefault(),e.stopPropagation()}),element.on(Metro.events.click,".button.cancel",function(e){that._drawContent(),Utils.exec(o.onCancel,[element]),e.preventDefault(),e.stopPropagation()}),element.on(Metro.events.click,".button.done",function(e){that._drawContent(),Utils.exec(o.onDone,[that.selected,element]),e.preventDefault(),e.stopPropagation()}),!0===o.weekDayClick&&element.on(Metro.events.click,".week-days .day",function(e){var day,index,days;index=(day=$(this)).index(),!0===o.multiSelect&&(days=!0===o.outside?element.find(".days-row .day:nth-child("+(index+1)+")"):element.find(".days-row .day:not(.outside):nth-child("+(index+1)+")"),$.each(days,function(){var d=$(this),dd=d.data("day");d.hasClass("disabled")||d.hasClass("excluded")||(that.selected.contains(dd)||that.selected.push(dd),d.addClass("selected").addClass(o.clsSelected))})),Utils.exec(o.onWeekDayClick,[that.selected,day],element[0]),e.preventDefault(),e.stopPropagation()}),o.weekNumberClick&&element.on(Metro.events.click,".days-row .week-number",function(e){var weekNumElement,weekNumber,days;weekNumber=(weekNumElement=$(this)).text(),!0===o.multiSelect&&(days=$(this).siblings(".day"),$.each(days,function(){var d=$(this),dd=d.data("day");d.hasClass("disabled")||d.hasClass("excluded")||(that.selected.contains(dd)||that.selected.push(dd),d.addClass("selected").addClass(o.clsSelected))})),Utils.exec(o.onWeekNumberClick,[that.selected,weekNumber,weekNumElement],element[0]),e.preventDefault(),e.stopPropagation()}),element.on(Metro.events.click,".days-row .day",function(e){var index,date,day=$(this);if(date=day.data("day"),index=that.selected.indexOf(date),day.hasClass("outside"))return date=new Date(date),that.current={year:date.getFullYear(),month:date.getMonth(),day:date.getDate()},void that._drawContent();day.hasClass("disabled")||(!0===o.pickerMode?(that.selected=[date],that.today=new Date(date),that.current.year=that.today.getFullYear(),that.current.month=that.today.getMonth(),that.current.day=that.today.getDate(),that._drawHeader(),that._drawContent()):-1===index?(!1===o.multiSelect&&(element.find(".days-row .day").removeClass("selected").removeClass(o.clsSelected),that.selected=[]),that.selected.push(date),day.addClass("selected").addClass(o.clsSelected)):(day.removeClass("selected").removeClass(o.clsSelected),Utils.arrayDelete(that.selected,date))),Utils.exec(o.onDayClick,[that.selected,day,element]),e.preventDefault(),e.stopPropagation()}),element.on(Metro.events.click,".curr-month",function(e){var target,list=element.find(".months-list");list.find(".active").removeClass("active"),list.scrollTop(0),element.find(".calendar-months").addClass("open"),target=list.find(".js-month-"+that.current.month).addClass("active"),setTimeout(function(){list.animate({scrollTop:target.position().top-(list.height()-target.height())/2},200)},300),e.preventDefault(),e.stopPropagation()}),element.on(Metro.events.click,".calendar-months li",function(e){that.current.month=$(this).index(),that._drawContent(),Utils.exec(o.onMonthChange,[that.current,element],element[0]),element.find(".calendar-months").removeClass("open"),e.preventDefault(),e.stopPropagation()}),element.on(Metro.events.click,".curr-year",function(e){var target,list=element.find(".years-list");list.find(".active").removeClass("active"),list.scrollTop(0),element.find(".calendar-years").addClass("open"),target=list.find(".js-year-"+that.current.year).addClass("active"),setTimeout(function(){list.animate({scrollTop:target.position().top-(list.height()-target.height())/2},200)},300),e.preventDefault(),e.stopPropagation()}),element.on(Metro.events.click,".calendar-years li",function(e){that.current.year=$(this).text(),that._drawContent(),Utils.exec(o.onYearChange,[that.current,element],element[0]),element.find(".calendar-years").removeClass("open"),e.preventDefault(),e.stopPropagation()}),element.on(Metro.events.click,function(e){var months=element.find(".calendar-months"),years=element.find(".calendar-years");months.hasClass("open")&&months.removeClass("open"),years.hasClass("open")&&years.removeClass("open"),e.preventDefault(),e.stopPropagation()})},_drawHeader:function(){var element=this.element,o=this.options,header=element.find(".calendar-header");0===header.length&&(header=$("<div>").addClass("calendar-header").addClass(o.clsCalendarHeader).appendTo(element)),header.html(""),$("<div>").addClass("header-year").html(this.today.getFullYear()).appendTo(header),$("<div>").addClass("header-day").html(this.today.format(o.headerFormat,o.locale)).appendTo(header),!1===o.showHeader&&header.hide()},_drawFooter:function(){var element=this.element,o=this.options,buttons_locale=this.locale.buttons,footer=element.find(".calendar-footer");!1!==o.buttons&&(0===footer.length&&(footer=$("<div>").addClass("calendar-footer").addClass(o.clsCalendarFooter).appendTo(element)),footer.html(""),$.each(o.buttons,function(){var button=$("<button>").attr("type","button").addClass("button "+this+" "+o["cls"+this.capitalize()+"Button"]).html(buttons_locale[this]).appendTo(footer);"cancel"!==this&&"done"!==this||button.addClass("js-dialog-close")}),!1===o.showFooter&&footer.hide())},_drawMonths:function(){var i,element=this.element,o=this.options,months=$("<div>").addClass("calendar-months").addClass(o.clsCalendarMonths).appendTo(element),list=$("<ul>").addClass("months-list").appendTo(months),calendar_locale=this.locale.calendar;for(i=0;i<12;i++)$("<li>").addClass("js-month-"+i).html(calendar_locale.months[i]).appendTo(list)},_drawYears:function(){var i,element=this.element,o=this.options,years=$("<div>").addClass("calendar-years").addClass(o.clsCalendarYears).appendTo(element),list=$("<ul>").addClass("years-list").appendTo(years);for(i=this.minYear;i<=this.maxYear;i++)$("<li>").addClass("js-year-"+i).html(i).appendTo(list)},_drawContent:function(){var toolbar,i,j,d,s,first_day,year,month,element=this.element,o=this.options,content=element.find(".calendar-content"),calendar_locale=this.locale.calendar,counter=0,first=new Date(this.current.year,this.current.month,1),prev_month_days=new Date(this.current.year,this.current.month,0).getDate();0===content.length&&(content=$("<div>").addClass("calendar-content").addClass(o.clsCalendarContent).appendTo(element)),content.html(""),toolbar=$("<div>").addClass("calendar-toolbar").appendTo(content),$("<span>").addClass("prev-month").html(o.prevMonthIcon).appendTo(toolbar),$("<span>").addClass("curr-month").html(calendar_locale.months[this.current.month]).appendTo(toolbar),$("<span>").addClass("next-month").html(o.nextMonthIcon).appendTo(toolbar),$("<span>").addClass("prev-year").html(o.prevYearIcon).appendTo(toolbar),$("<span>").addClass("curr-year").html(this.current.year).appendTo(toolbar),$("<span>").addClass("next-year").html(o.nextYearIcon).appendTo(toolbar);var week_days=$("<div>").addClass("week-days").appendTo(content),day_class="day";for(!0===o.showWeekNumber&&($("<span>").addClass("week-number").html("#").appendTo(week_days),day_class+=" and-week-number"),i=0;i<7;i++)0===o.weekStart?j=i:7===(j=i+1)&&(j=0),$("<span>").addClass(day_class).html(calendar_locale.days[j+7]).appendTo(week_days);var days=$("<div>").addClass("days").appendTo(content),days_row=$("<div>").addClass("days-row").appendTo(days);for(first_day=0===o.weekStart?first.getDay():0===first.getDay()?6:first.getDay()-1,year=this.current.month-1<0?(month=11,this.current.year-1):(month=this.current.month-1,this.current.year),!0===o.showWeekNumber&&$("<div>").addClass("week-number").html(new Date(year,month,prev_month_days-first_day+1).getWeek(o.weekStart)).appendTo(days_row),i=0;i<first_day;i++){var v=prev_month_days-first_day+i+1;d=$("<div>").addClass(day_class+" outside").appendTo(days_row),(s=new Date(year,month,v)).setHours(0,0,0,0),d.data("day",s.getTime()),!0===o.outside&&(d.html(v),0<this.excludeDay.length&&-1<this.excludeDay.indexOf(s.getDay())&&d.addClass("disabled excluded").addClass(o.clsExcluded),Utils.exec(o.onDayDraw,[s],d[0])),counter++}for(first.setHours(0,0,0,0);first.getMonth()===this.current.month;)(d=$("<div>").addClass(day_class).html(first.getDate()).appendTo(days_row)).data("day",first.getTime()),this.show.getTime()===first.getTime()&&d.addClass("showed"),this.today.getTime()===first.getTime()&&d.addClass("today").addClass(o.clsToday),0===this.special.length?(-1!==this.selected.indexOf(first.getTime())&&d.addClass("selected").addClass(o.clsSelected),-1!==this.exclude.indexOf(first.getTime())&&d.addClass("disabled excluded").addClass(o.clsExcluded),null!==this.min&&first.getTime()<this.min.getTime()&&d.addClass("disabled excluded").addClass(o.clsExcluded),null!==this.max&&first.getTime()>this.max.getTime()&&d.addClass("disabled excluded").addClass(o.clsExcluded),0<this.excludeDay.length&&-1<this.excludeDay.indexOf(first.getDay())&&d.addClass("disabled excluded").addClass(o.clsExcluded)):-1===this.special.indexOf(first.getTime())&&d.addClass("disabled excluded").addClass(o.clsExcluded),Utils.exec(o.onDayDraw,[first],d[0]),++counter%7==0&&(days_row=$("<div>").addClass("days-row").appendTo(days),!0===o.showWeekNumber&&$("<div>").addClass("week-number").html(new Date(first.getFullYear(),first.getMonth(),first.getDate()+1).getWeek(o.weekStart)).appendTo(days_row)),first.setDate(first.getDate()+1),first.setHours(0,0,0,0);if(first_day=0===o.weekStart?first.getDay():0===first.getDay()?6:first.getDay()-1,year=11<this.current.month+1?(month=0,this.current.year+1):(month=this.current.month+1,this.current.year),0<first_day)for(i=0;i<7-first_day;i++)d=$("<div>").addClass(day_class+" outside").appendTo(days_row),(s=new Date(year,month,i+1)).setHours(0,0,0,0),d.data("day",s.getTime()),!0===o.outside&&(d.html(i+1),0<this.excludeDay.length&&-1<this.excludeDay.indexOf(s.getDay())&&d.addClass("disabled excluded").addClass(o.clsExcluded),Utils.exec(o.onDayDraw,[s],d[0]))},_drawCalendar:function(){var that=this;setTimeout(function(){that.element.html(""),that._drawHeader(),that._drawContent(),that._drawFooter(),that._drawMonths(),that._drawYears()},0)},getPreset:function(){return this.preset},getSelected:function(){return this.selected},getExcluded:function(){return this.exclude},getToday:function(){return this.today},getCurrent:function(){return this.current},clearSelected:function(){this.selected=[],this._drawContent()},toDay:function(){this.today=new Date,this.today.setHours(0,0,0,0),this.current={year:this.today.getFullYear(),month:this.today.getMonth(),day:this.today.getDate()},this._drawHeader(),this._drawContent()},setExclude:function(exclude){var element=this.element,o=this.options;Utils.isNull(exclude)&&Utils.isNull(element.attr("data-exclude"))||(o.exclude=Utils.isNull(exclude)?element.attr("data-exclude"):exclude,this._dates2array(o.exclude,"exclude"),this._drawContent())},setPreset:function(preset){var element=this.element,o=this.options;Utils.isNull(preset)&&Utils.isNull(element.attr("data-preset"))||(o.preset=Utils.isNull(preset)?element.attr("data-preset"):preset,this._dates2array(o.preset,"selected"),this._drawContent())},setSpecial:function(special){var element=this.element,o=this.options;Utils.isNull(special)&&Utils.isNull(element.attr("data-special"))||(o.special=Utils.isNull(special)?element.attr("data-special"):special,this._dates2array(o.exclude,"special"),this._drawContent())},setShow:function(show){var element=this.element,o=this.options;Utils.isNull(show)&&Utils.isNull(element.attr("data-show"))||(o.show=Utils.isNull(show)?element.attr("data-show"):show,this.show=Utils.isDateObject(show)?show:Utils.isValue(o.inputFormat)?o.show.toDate(o.inputFormat):new Date(o.show),this.show.setHours(0,0,0,0),this.current={year:this.show.getFullYear(),month:this.show.getMonth(),day:this.show.getDate()},this._drawContent())},setMinDate:function(date){var element=this.element;this.options.minDate=null!==date?date:element.attr("data-min-date"),this._drawContent()},setMaxDate:function(date){var element=this.element;this.options.maxDate=null!==date?date:element.attr("data-max-date"),this._drawContent()},setToday:function(val){this.element;var o=this.options;Utils.isValue(val)||(val=new Date),this.today=Utils.isDateObject(val)?val:Utils.isValue(o.inputFormat)?val.toDate(o.inputFormat):new Date(val),this.today.setHours(0,0,0,0),this._drawHeader(),this._drawContent()},i18n:function(val){this.element;var o=this.options;return void 0===val?o.locale:void 0!==Metro.locales[val]&&(o.locale=val,this.locale=Metro.locales[o.locale],void this._drawCalendar())},changeAttrLocale:function(){var element=this.element;this.options;this.i18n(element.attr("data-locale"))},changeAttribute:function(attributeName){switch(attributeName){case"data-exclude":this.setExclude();break;case"data-preset":this.setPreset();break;case"data-special":this.setSpecial();break;case"data-show":this.setShow();break;case"data-min-date":this.setMinDate();break;case"data-max-date":this.setMaxDate();break;case"data-locale":this.changeAttrLocale()}},destroy:function(){var element=this.element,o=this.options;element.off(Metro.events.click,".prev-month, .next-month, .prev-year, .next-year"),element.off(Metro.events.click,".button.today"),element.off(Metro.events.click,".button.clear"),element.off(Metro.events.click,".button.cancel"),element.off(Metro.events.click,".button.done"),element.off(Metro.events.click,".week-days .day"),element.off(Metro.events.click,".days-row .day"),element.off(Metro.events.click,".curr-month"),element.off(Metro.events.click,".calendar-months li"),element.off(Metro.events.click,".curr-year"),element.off(Metro.events.click,".calendar-years li"),element.off(Metro.events.click),!0===o.ripple&&Metro.destroyPlugin(element,"ripple"),element.html("")}};$(document).on(Metro.events.click,function(e){$(".calendar .calendar-years").each(function(){$(this).removeClass("open")}),$(".calendar .calendar-months").each(function(){$(this).removeClass("open")})}),Metro.plugin("calendar",Calendar);var CalendarPicker={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.value=null,this.value_date=null,this.calendar=null,this.overlay=null,this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onCalendarPickerCreate,[this.element],this.elem),this},dependencies:["calendar"],options:{nullValue:!0,prepend:"",calendarWide:!1,calendarWidePoint:null,dialogMode:!1,dialogPoint:360,dialogOverlay:!0,overlayColor:"#000000",overlayAlpha:.5,locale:METRO_LOCALE,size:"100%",format:METRO_DATE_FORMAT,inputFormat:null,headerFormat:"%A, %b %e",clearButton:!1,calendarButtonIcon:"<span class='default-icon-calendar'></span>",clearButtonIcon:"<span class='default-icon-cross'></span>",copyInlineStyles:!1,clsPicker:"",clsInput:"",yearsBefore:100,yearsAfter:100,weekStart:METRO_WEEK_START,outside:!0,ripple:!1,rippleColor:"#cccccc",exclude:null,minDate:null,maxDate:null,special:null,showHeader:!0,clsCalendar:"",clsCalendarHeader:"",clsCalendarContent:"",clsCalendarMonths:"",clsCalendarYears:"",clsToday:"",clsSelected:"",clsExcluded:"",onDayClick:Metro.noop,onCalendarPickerCreate:Metro.noop,onCalendarShow:Metro.noop,onCalendarHide:Metro.noop,onChange:Metro.noop,onMonthChange:Metro.noop,onYearChange:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){this._createStructure(),this._createEvents()},_createStructure:function(){var that=this,element=this.element,o=this.options,prev=element.prev(),parent=element.parent(),container=$("<div>").addClass("input "+element[0].className+" calendar-picker"),buttons=$("<div>").addClass("button-group"),cal=$("<div>").addClass("drop-shadow"),curr=element.val().trim();(void 0===element.attr("type")&&element.attr("type","text"),Utils.isValue(curr)&&(this.value=!1===Utils.isValue(o.inputFormat)?new Date(curr):curr.toDate(o.inputFormat)),Utils.isValue(this.value)&&this.value.setHours(0,0,0,0),element.val(Utils.isValue(curr)||!0!==o.nullValue?this.value.format(o.format):""),0===prev.length?parent.prepend(container):container.insertAfter(prev),element.appendTo(container),buttons.appendTo(container),cal.appendTo(container),cal.calendar({wide:o.calendarWide,widePoint:o.calendarWidePoint,format:o.format,inputFormat:o.inputFormat,pickerMode:!0,show:o.value,locale:o.locale,weekStart:o.weekStart,outside:o.outside,buttons:!1,headerFormat:o.headerFormat,clsCalendar:o.clsCalendar,clsCalendarHeader:o.clsCalendarHeader,clsCalendarContent:o.clsCalendarContent,clsCalendarFooter:"d-none",clsCalendarMonths:o.clsCalendarMonths,clsCalendarYears:o.clsCalendarYears,clsToday:o.clsToday,clsSelected:o.clsSelected,clsExcluded:o.clsExcluded,ripple:o.ripple,rippleColor:o.rippleColor,exclude:o.exclude,minDate:o.minDate,maxDate:o.maxDate,yearsBefore:o.yearsBefore,yearsAfter:o.yearsAfter,special:o.special,showHeader:o.showHeader,showFooter:!1,onDayClick:function(sel,day,el){var date=new Date(sel[0]);date.setHours(0,0,0,0),that._removeOverlay(),that.value=date,element.val(date.format(o.format,o.locale)),element.trigger("change"),cal.removeClass("open open-up"),cal.hide(),Utils.exec(o.onChange,[that.value],element[0]),Utils.exec(o.onDayClick,[sel,day,el],element[0])},onMonthChange:o.onMonthChange,onYearChange:o.onYearChange}),this.calendar=cal,!0===o.clearButton&&$("<button>").addClass("button input-clear-button").attr("tabindex",-1).attr("type","button").html(o.clearButtonIcon).appendTo(buttons),$("<button>").addClass("button").attr("tabindex",-1).attr("type","button").html(o.calendarButtonIcon).appendTo(buttons),""!==o.prepend)&&$("<div>").html(o.prepend).addClass("prepend").addClass(o.clsPrepend).appendTo(container);"rtl"===element.attr("dir")&&container.addClass("rtl"),-1<String(o.size).indexOf("%")?container.css({width:o.size}):container.css({width:parseInt(o.size)+"px"}),element[0].className="",element.attr("readonly",!0),!0===o.copyInlineStyles&&$.each(Utils.getInlineStyles(element),function(key,value){container.css(key,value)}),container.addClass(o.clsPicker),element.addClass(o.clsInput),!0===o.dialogOverlay&&(this.overlay=that._overlay()),!0===o.dialogMode?container.addClass("dialog-mode"):Utils.media("(max-width: "+o.dialogPoint+"px)")&&container.addClass("dialog-mode"),element.is(":disabled")?this.disable():this.enable()},_createEvents:function(){var that=this,element=this.element,o=this.options,container=element.parent(),clear=container.find(".input-clear-button"),cal=this.calendar,cal_plugin=cal.data("calendar");$(window).on(Metro.events.resize,function(){!0!==o.dialogMode&&(Utils.media("(max-width: "+o.dialogPoint+"px)")?container.addClass("dialog-mode"):container.removeClass("dialog-mode"))}),0<clear.length&&clear.on(Metro.events.click,function(e){element.val("").trigger("change").blur(),that.value=null,e.preventDefault(),e.stopPropagation()}),container.on(Metro.events.click,"button, input",function(e){var value=Utils.isValue(that.value)?that.value:new Date;value.setHours(0,0,0,0),!1===cal.hasClass("open")&&!1===cal.hasClass("open-up")?($(".calendar-picker .calendar").removeClass("open open-up").hide(),cal_plugin.setPreset([value]),cal_plugin.setShow(value),cal_plugin.setToday(value),container.hasClass("dialog-mode")&&that.overlay.appendTo($("body")),cal.addClass("open"),!1===Utils.isOutsider(cal)&&cal.addClass("open-up"),Utils.exec(o.onCalendarShow,[element,cal],cal)):(that._removeOverlay(),cal.removeClass("open open-up"),Utils.exec(o.onCalendarHide,[element,cal],cal)),e.preventDefault(),e.stopPropagation()}),element.on(Metro.events.blur,function(){container.removeClass("focused")}),element.on(Metro.events.focus,function(){container.addClass("focused")}),element.on(Metro.events.change,function(){Utils.exec(o.onChange,[that.value],element[0])})},_overlay:function(){var o=this.options,overlay=$("<div>");return overlay.addClass("overlay for-calendar-picker").addClass(o.clsOverlay),"transparent"===o.overlayColor?overlay.addClass("transparent"):overlay.css({background:Utils.hex2rgba(o.overlayColor,o.overlayAlpha)}),overlay},_removeOverlay:function(){$("body").find(".overlay.for-calendar-picker").remove()},val:function(v){var element=this.element,o=this.options;if(Utils.isNull(v))return this.value;!0===Utils.isDate(v,o.inputFormat)&&(this.calendar.data("calendar").clearSelected(),this.value="string"==typeof v?v.toDate(o.inputFormat):v,element.val(this.value.format(o.format)),element.trigger("change"))},disable:function(){this.element.data("disabled",!0),this.element.parent().addClass("disabled")},enable:function(){this.element.data("disabled",!1),this.element.parent().removeClass("disabled")},toggleState:function(){this.elem.disabled?this.disable():this.enable()},i18n:function(val){var hidden,o=this.options,cal=this.calendar;return void 0===val?o.locale:void 0!==Metro.locales[val]&&((hidden=cal.is(":hidden"))&&cal.css({visibility:"hidden",display:"block"}),cal.data("calendar").i18n(val),void(hidden&&cal.css({visibility:"visible",display:"none"})))},changeAttribute:function(attributeName){var that=this,element=this.element,cal=(this.options,this.calendar.data("calendar"));switch(attributeName){case"value":that.val(element.attr("value"));break;case"disabled":this.toggleState();break;case"data-locale":that.i18n(element.attr("data-locale"));break;case"data-special":cal.setSpecial(element.attr("data-special"));break;case"data-exclude":cal.setExclude(element.attr("data-exclude"));break;case"data-min-date":cal.setMinDate(element.attr("data-min-date"));break;case"data-max-date":cal.setMaxDate(element.attr("data-max-date"))}}};Metro.plugin("calendarpicker",CalendarPicker),$(document).on(Metro.events.click,".overlay.for-calendar-picker",function(){$(this).remove()}),$(document).on(Metro.events.click,function(){$(".calendar-picker .calendar").removeClass("open open-up")});var Carousel={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.height=0,this.width=0,this.slides=[],this.current=null,this.currentIndex=null,this.dir=this.options.direction,this.interval=null,this.isAnimate=!1,this._setOptionsFromDOM(),this._create(),this},options:{autoStart:!1,width:"100%",height:"16/9",effect:"slide",effectFunc:"linear",direction:"left",duration:METRO_ANIMATION_DURATION,period:5e3,stopOnMouse:!0,controls:!0,bullets:!0,bulletsStyle:"square",bulletsSize:"default",controlsOnMouse:!1,controlsOutside:!1,bulletsPosition:"default",controlPrev:"&#x23F4",controlNext:"&#x23F5",clsCarousel:"",clsSlides:"",clsSlide:"",clsControls:"",clsControlNext:"",clsControlPrev:"",clsBullets:"",clsBullet:"",clsBulletOn:"",clsThumbOn:"",onStop:Metro.noop,onStart:Metro.noop,onPlay:Metro.noop,onSlideClick:Metro.noop,onBulletClick:Metro.noop,onThumbClick:Metro.noop,onMouseEnter:Metro.noop,onMouseLeave:Metro.noop,onNextClick:Metro.noop,onPrevClick:Metro.noop,onSlideShow:Metro.noop,onSlideHide:Metro.noop,onCarouselCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options,slides=element.find(".slide"),slides_container=element.find(".slides"),id=Utils.elementId("carousel");void 0===element.attr("id")&&element.attr("id",id),element.addClass("carousel").addClass(o.clsCarousel),!0===o.controlsOutside&&element.addClass("controls-outside"),0===slides_container.length&&(slides_container=$("<div>").addClass("slides").appendTo(element),slides.appendTo(slides_container)),slides.addClass(o.clsSlides),0!==slides.length&&(this._createSlides(),this._createControls(),this._createBullets(),this._createEvents(),this._resize(),!0===o.controlsOnMouse&&(element.find("[class*=carousel-switch]").hide(),element.find(".carousel-bullets").hide()),!0===o.autoStart?this._start():Utils.exec(o.onSlideShow,[this.slides[this.currentIndex][0],void 0],this.slides[this.currentIndex][0])),Utils.exec(this.options.onCarouselCreate,[this.element])},_start:function(){var that=this,element=this.element,o=this.options,period=o.period,current=this.slides[this.currentIndex];void 0!==current.data("period")&&(period=current.data("period")),this.slides.length<=1||(this.interval=setTimeout(function(){var t="left"===o.direction?"next":"prior";that._slideTo(t,!0)},period),Utils.exec(o.onStart,[element],element[0]))},_stop:function(){clearInterval(this.interval),this.interval=!1},_resize:function(){var height,element=this.element,o=this.options,width=element.outerWidth(),medias=[];-1<["16/9","21/9","4/3"].indexOf(o.height)?height=Utils.aspectRatioH(width,o.height):-1<String(o.height).indexOf("@")?(medias=Utils.strToArray(o.height.substr(1),"|"),$.each(medias,function(){var media=Utils.strToArray(this,",");window.matchMedia(media[0]).matches&&(height=-1<["16/9","21/9","4/3"].indexOf(media[1])?Utils.aspectRatioH(width,media[1]):parseInt(media[1]))})):height=parseInt(o.height),element.css({height:height})},_createSlides:function(){var that=this,element=this.element,o=this.options,slides=element.find(".slide");$.each(slides,function(i){var slide=$(this);if(void 0!==slide.data("cover")&&slide.css({backgroundImage:"url("+slide.data("cover")+")",backgroundSize:"cover",backgroundRepeat:"no-repeat"}),0!==i)switch(o.effect){case"switch":case"slide":slide.css("left","100%");break;case"slide-v":slide.css("top","100%");break;case"fade":slide.css("opacity","0")}slide.addClass(o.clsSlide),that.slides.push(slide)}),this.currentIndex=0,this.current=this.slides[this.currentIndex]},_createControls:function(){var next,prev,element=this.element,o=this.options;!1!==o.controls&&(next=$("<span/>").addClass("carousel-switch-next").addClass(o.clsControls).addClass(o.clsControlNext).html(">"),prev=$("<span/>").addClass("carousel-switch-prev").addClass(o.clsControls).addClass(o.clsControlPrev).html("<"),o.controlNext&&next.html(o.controlNext),o.controlPrev&&prev.html(o.controlPrev),next.appendTo(element),prev.appendTo(element))},_createBullets:function(){var bullets,i,element=this.element,o=this.options;if(!1!==o.bullets){for(bullets=$("<div>").addClass("carousel-bullets").addClass(o.bulletsSize+"-size").addClass("bullet-style-"+o.bulletsStyle).addClass(o.clsBullets),"default"===o.bulletsPosition||"center"===o.bulletsPosition?bullets.addClass("flex-justify-center"):"left"===o.bulletsPosition?bullets.addClass("flex-justify-start"):bullets.addClass("flex-justify-end"),i=0;i<this.slides.length;i++){var bullet=$("<span>").addClass("carousel-bullet").addClass(o.clsBullet).data("slide",i);0===i&&bullet.addClass("bullet-on").addClass(o.clsBulletOn),bullet.appendTo(bullets)}bullets.appendTo(element)}},_createEvents:function(){var that=this,element=this.element,o=this.options;element.on(Metro.events.click,".carousel-bullet",function(e){var bullet=$(this);!1===that.isAnimate&&(that._slideToSlide(bullet.data("slide")),Utils.exec(o.onBulletClick,[bullet,element,e]))}),element.on(Metro.events.click,".carousel-switch-next",function(e){!1===that.isAnimate&&(that._slideTo("next",!1),Utils.exec(o.onNextClick,[element,e]))}),element.on(Metro.events.click,".carousel-switch-prev",function(e){!1===that.isAnimate&&(that._slideTo("prev",!1),Utils.exec(o.onPrevClick,[element,e]))}),!0===o.stopOnMouse&&!0===o.autoStart&&(element.on(Metro.events.enter,function(e){!0===o.controlsOnMouse&&(element.find("[class*=carousel-switch]").fadeIn(),element.find(".carousel-bullets").fadeIn()),that._stop(),Utils.exec(o.onMouseEnter,[element,e])}),element.on(Metro.events.leave,function(e){!0===o.controlsOnMouse&&(element.find("[class*=carousel-switch]").fadeOut(),element.find(".carousel-bullets").fadeOut()),that._start(),Utils.exec(o.onMouseLeave,[element,e])})),!0===o.controlsOnMouse&&(element.on(Metro.events.enter,function(){element.find("[class*=carousel-switch]").fadeIn(),element.find(".carousel-bullets").fadeIn()}),element.on(Metro.events.leave,function(){element.find("[class*=carousel-switch]").fadeOut(),element.find(".carousel-bullets").fadeOut()})),element.on(Metro.events.click,".slide",function(e){var slide=$(this);Utils.exec(o.onSlideClick,[slide,element,e])}),$(window).on(Metro.events.resize+"-"+element.attr("id"),function(){that._resize()})},_slideToSlide:function(index){var current,next,to,element=this.element,o=this.options;void 0!==this.slides[index]&&this.currentIndex!==index&&(to=index>this.currentIndex?"next":"prev",current=this.slides[this.currentIndex],next=this.slides[index],this.currentIndex=index,this._effect(current,next,o.effect,to),element.find(".carousel-bullet").removeClass("bullet-on").removeClass(o.clsBulletOn),element.find(".carousel-bullet:nth-child("+(this.currentIndex+1)+")").addClass("bullet-on").addClass(o.clsBulletOn))},_slideTo:function(to,interval){var current,next,element=this.element,o=this.options;void 0===to&&(to="next"),current=this.slides[this.currentIndex],"next"===to?(this.currentIndex++,this.currentIndex>=this.slides.length&&(this.currentIndex=0)):(this.currentIndex--,this.currentIndex<0&&(this.currentIndex=this.slides.length-1)),next=this.slides[this.currentIndex],this._effect(current,next,o.effect,to,interval),element.find(".carousel-bullet").removeClass("bullet-on").removeClass(o.clsBulletOn),element.find(".carousel-bullet:nth-child("+(this.currentIndex+1)+")").addClass("bullet-on").addClass(o.clsBulletOn)},_effect:function(current,next,effect,to,interval){var func,that=this,o=(this.element,this.options),duration=o.duration,effectFunc=o.effectFunc,period=o.period;switch(void 0!==next.data("duration")&&(duration=next.data("duration")),void 0!==next.data("effectFunc")&&(effectFunc=next.data("effectFunc")),"switch"===effect&&(duration=0),current.stop(!0,!0),next.stop(!0,!0),this.isAnimate=!0,setTimeout(function(){that.isAnimate=!1},duration),"slide"===effect&&(func="next"===to?"slideLeft":"slideRight"),"slide-v"===effect&&(func="next"===to?"slideUp":"slideDown"),effect){case"slide":case"slide-v":Animation[func](current,next,duration,effectFunc);break;case"fade":Animation.fade(current,next,duration,effectFunc);break;default:Animation.switch(current,next)}setTimeout(function(){Utils.exec(o.onSlideShow,[next[0],current[0]],next[0])},duration),setTimeout(function(){Utils.exec(o.onSlideHide,[current[0],next[0]],current[0])},duration),!0===interval&&(void 0!==next.data("period")&&(period=next.data("period")),this.interval=setTimeout(function(){var t="left"===o.direction?"next":"prior";that._slideTo(t,!0)},period))},toSlide:function(index){this._slideToSlide(index)},next:function(){this._slideTo("next")},prev:function(){this._slideTo("prev")},stop:function(){clearInterval(this.interval),Utils.exec(this.options.onStop,[this.element])},play:function(){this._start(),Utils.exec(this.options.onPlay,[this.element])},changeAttribute:function(attributeName){},destroy:function(){var element=this.element,o=this.options;element.off(Metro.events.click,".carousel-bullet"),element.off(Metro.events.click,".carousel-switch-next"),element.off(Metro.events.click,".carousel-switch-prev"),!0===o.stopOnMouse&&!0===o.autoStart&&(element.off(Metro.events.enter),element.off(Metro.events.leave)),!0===o.controlsOnMouse&&(element.off(Metro.events.enter),element.off(Metro.events.leave)),element.off(Metro.events.click,".slide"),$(window).off(Metro.events.resize+"-"+element.attr("id")),element.removeClass("carousel").removeClass(o.clsCarousel),!0===o.controlsOutside&&element.removeClass("controls-outside")}};Metro.plugin("carousel",Carousel);var Charms={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.origin={background:""},this._setOptionsFromDOM(),this._create(),this},options:{position:"right",opacity:1,clsCharms:"",onCharmCreate:Metro.noop,onOpen:Metro.noop,onClose:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createStructure(),this._createEvents(),Utils.exec(o.onCharmCreate,[element])},_createStructure:function(){var element=this.element,o=this.options;element.addClass("charms").addClass(o.position+"-side").addClass(o.clsCharms),this.origin.background=element.css("background-color"),element.css({backgroundColor:Utils.computedRgbToRgba(Utils.getStyleOne(element,"background-color"),o.opacity)})},_createEvents:function(){var element=this.element;this.options;element.on(Metro.events.click,function(e){})},open:function(){var element=this.element,o=this.options;element.addClass("open"),Utils.exec(o.onOpen,[element])},close:function(){var element=this.element,o=this.options;element.removeClass("open"),Utils.exec(o.onClose,[element])},toggle:function(){var element=this.element,o=this.options;element.toggleClass("open"),!0===element.hasClass("open")?Utils.exec(o.onOpen,[element]):Utils.exec(o.onClose,[element])},opacity:function(v){var element=this.element,o=this.options;if(void 0===v)return o.opacity;var opacity=Math.abs(parseFloat(v));opacity<0||1<opacity||(o.opacity=opacity,element.css({backgroundColor:Utils.computedRgbToRgba(Utils.getStyleOne(element,"background-color"),opacity)}))},changeOpacity:function(){var element=this.element;this.opacity(element.attr("data-opacity"))},changeAttribute:function(attributeName){switch(attributeName){case"data-opacity":this.changeOpacity()}},destroy:function(){var element=this.element,o=this.options;element.off(Metro.events.click),element.removeClass("charms").removeClass(o.position+"-side").removeClass(o.clsCharms),element.css("background-color",this.origin.background)}};Metro.plugin("charms",Charms),Metro.charms={check:function(el){return!1!==Utils.isMetroObject(el,"charms")||(console.log("Element is not a charms component"),!1)},isOpen:function(el){if(!1!==this.check(el))return $(el).data("charms").hasClass("open")},open:function(el){!1!==this.check(el)&&$(el).data("charms").open()},close:function(el){!1!==this.check(el)&&$(el).data("charms").close()},toggle:function(el){!1!==this.check(el)&&$(el).data("charms").toggle()},closeAll:function(){$("[data-role*=charms]").each(function(){$(this).data("charms").close()})},opacity:function(el,opacity){!1!==this.check(el)&&$(el).data("charms").opacity(opacity)}};var defaultAvatar="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD//gA7Q1JFQVRPUjogZ2QtanBlZyB2MS4wICh1c2luZyBJSkcgSlBFRyB2NjIpLCBxdWFsaXR5ID0gOTAK/9sAQwADAgIDAgIDAwMDBAMDBAUIBQUEBAUKBwcGCAwKDAwLCgsLDQ4SEA0OEQ4LCxAWEBETFBUVFQwPFxgWFBgSFBUU/9sAQwEDBAQFBAUJBQUJFA0LDRQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQU/8AAEQgAUABQAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A+t+KKPxo/GgA70Yo/Gj8aADFH4VesdC1HUl3WtjcXCf344yV/PGKW+0HUtNXddWNzbp/fkjIX88YoAofhR+FH40fjQAfhR+FH40fjQAUUUUAFepeAPh5D9li1LVYhK8g3Q27j5VXszDuT6f5HA+FtOXVvEWn2rjMcko3j1UckfkDX0MBgYHAoARVCKFUBVHAA6ClZQwKkZBGCDS0UAec+Pvh3BJay6lpUQimjBeW3QYVx3Kjsfbv/PyqvpuvnvxfpqaT4l1C1QbY0lJUDsrfMB+RoAyKKKKACiiigDa8GXq6f4p02eQgIJQpJ7Bvlz+tfQP4V8yDg17P4A8cw65ZxWV5IE1KMbfmP+uA7j39R+NAHaUfhSUUAL+FeA+OL1NQ8WalNGQU83YCO+0Bf6V6b498cQ6BZyWlrIJNSkXaApz5QP8AEff0FeKk5OTyTQAUUUUAH40fjRU1naTX93DbQIXmlYIijuTQBc0Dw/eeI74W1mm49XkbhUHqTXsHhz4eaXoCpI8YvbscmaYZAP8Asr0H8/etHwv4cg8M6XHaxANIfmllxy7dz9PStigA/Gk/GlooA5bxJ8PdL19XkWMWd43PnwjGT/tL0P8AP3rx/X/D954cvjbXibT1SReVceoNfRFZHijw5B4m0uS1lAWQfNFLjlG7H6etAHz5+NH41NeWk1hdzW06FJonKMp7EGoaACvQfhBowudTudRkXK2y7I8j+Nup/Afzrz6vafhRaCDwmkgHM8zufwO3/wBloA7Kiij8KACkpaSgBaSj8KKAPJvi/owttTttRjXC3K7JMf3l6H8R/KvPq9p+K1qJ/CbyEcwTI4P1O3/2avFqAP/Z",Chat={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.input=null,this.classes="primary secondary success alert warning yellow info dark light".split(" "),this.lastMessage=null,this._setOptionsFromDOM(),this._create(),this},options:{timeFormat:"%d %b %l:%M %p",name:"John Doe",avatar:defaultAvatar,welcome:null,title:null,width:"100%",height:"auto",randomColor:!1,messages:null,sendButtonTitle:"Send",clsChat:"",clsName:"",clsTime:"",clsInput:"",clsSendButton:"",clsMessageLeft:"default",clsMessageRight:"default",onMessage:Metro.noop,onSend:Metro.noop,onChatCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createStructure(),this._createEvents(),Utils.exec(o.onChatCreate,[element])},_createStructure:function(){var messageInput,input,that=this,element=this.element,o=this.options,customButtons=[{html:o.sendButtonTitle,cls:o.clsSendButton+" js-chat-send-button",onclick:o.onSendButtonClick}];element.addClass("chat").addClass(o.clsChat),element.css({width:o.width,height:o.height}),Utils.isValue(o.title)&&$("<div>").addClass("title").html(o.title).appendTo(element),$("<div>").addClass("messages").appendTo(element),messageInput=$("<div>").addClass("message-input").appendTo(element),(input=$("<input type='text'>")).appendTo(messageInput),input.input({customButtons:customButtons,clsInput:o.clsInput}),o.welcome&&this.add({text:o.welcome,time:(new Date).format(o.timeFormat),position:"left",name:"Welcome",avatar:defaultAvatar}),Utils.isValue(o.messages)&&"string"==typeof o.messages&&(o.messages=Utils.isObject(o.messages)),!Utils.isNull(o.messages)&&"object"==typeof o.messages&&0<Utils.objectLength(o.messages)&&$.each(o.messages,function(){that.add(this)})},_createEvents:function(){var that=this,element=this.element,o=this.options,sendButton=element.find(".js-chat-send-button"),input=element.find("input[type=text]"),send=function(){var m,msg=""+input.val();if(""===msg.trim())return!1;m={id:Utils.elementId(""),name:o.name,avatar:o.avatar,text:msg,position:"right",time:(new Date).format(o.timeFormat)},that.add(m),Utils.exec(o.onSend,[m],element[0]),input.val("")};sendButton.on(Metro.events.click,function(){send()}),input.on(Metro.events.keyup,function(e){e.keyCode===Metro.keyCode.ENTER&&send()})},add:function(msg){var index,message,item,text,element=this.element,o=this.options,messages=element.find(".messages");return message=$("<div>").addClass("message").addClass(msg.position).appendTo(messages),$("<div>").addClass("message-sender").addClass(o.clsName).html(msg.name).appendTo(message),$("<div>").addClass("message-time").addClass(o.clsTime).html(new Date(msg.time).format(o.timeFormat)).appendTo(message),item=$("<div>").addClass("message-item").appendTo(message),$("<img>").attr("src",msg.avatar).addClass("message-avatar").appendTo(item),text=$("<div>").addClass("message-text").html(msg.text).appendTo(item),Utils.isValue(msg.id)&&message.attr("id",msg.id),!0===o.randomColor?(index=Utils.random(0,this.classes.length-1),text.addClass(this.classes[index])):("left"===msg.position&&Utils.isValue(o.clsMessageLeft)&&text.addClass(o.clsMessageLeft),"right"===msg.position&&Utils.isValue(o.clsMessageRight)&&text.addClass(o.clsMessageRight)),Utils.exec(o.onMessage,[msg],message[0]),setImmediate(function(){element.fire("onmessage",{message:msg,element:message[0]})}),messages.animate({scrollTop:messages[0].scrollHeight},1e3),this.lastMessage=msg,this},addMessages:function(messages){var that=this;this.element,this.options;return Utils.isValue(messages)&&"string"==typeof messages&&(messages=Utils.isObject(messages)),"object"==typeof messages&&0<Utils.objectLength(messages)&&$.each(messages,function(){that.add(this)}),this},delMessage:function(id){return this.element.find(".messages").find("#"+id).remove(),this},updMessage:function(msg){var message=this.element.find(".messages").find("#"+msg.id);return 0===message.length||(message.find(".message-text").html(msg.text),message.find(".message-time").html(msg.time)),this},clear:function(){this.element.find(".messages").html(""),this.lastMessage=null},changeAttribute:function(attributeName){},destroy:function(){}};Metro.plugin("chat",Chat);var Checkbox={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.origin={className:""},this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onCheckboxCreate,[this.element]),this},options:{style:1,caption:"",captionPosition:"right",indeterminate:!1,clsCheckbox:"",clsCheck:"",clsCaption:"",onCheckboxCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options,checkbox=$("<label>").addClass("checkbox "+element[0].className).addClass(2===o.style?"style2":""),check=$("<span>").addClass("check"),caption=$("<span>").addClass("caption").html(o.caption);void 0===element.attr("id")&&element.attr("id",Utils.elementId("checkbox")),checkbox.attr("for",element.attr("id")),element.attr("type","checkbox"),checkbox.insertBefore(element),element.appendTo(checkbox),check.appendTo(checkbox),caption.appendTo(checkbox),"left"===o.captionPosition&&checkbox.addClass("caption-left"),this.origin.className=element[0].className,element[0].className="",checkbox.addClass(o.clsCheckbox),caption.addClass(o.clsCaption),check.addClass(o.clsCheck),o.indeterminate&&(element[0].indeterminate=!0),element.is(":disabled")?this.disable():this.enable()},indeterminate:function(){this.element[0].indeterminate=!0},disable:function(){this.element.data("disabled",!0),this.element.parent().addClass("disabled")},enable:function(){this.element.data("disabled",!1),this.element.parent().removeClass("disabled")},toggleState:function(){this.elem.disabled?this.disable():this.enable()},changeAttribute:function(attributeName){var new_style,element=this.element,o=this.options,parent=element.parent();switch(attributeName){case"disabled":this.toggleState();break;case"data-indeterminate":element[0].indeterminate=!0===JSON.parse(element.attr("data-indeterminate"));break;case"data-style":new_style=parseInt(element.attr("data-style")),Utils.isInt(new_style)&&(o.style=new_style,parent.removeClass("style1 style2").addClass("style"+new_style))}},destroy:function(){var element=this.element,parent=element.parent();element[0].className=this.origin.className,element.insertBefore(parent),parent.remove()}};Metro.plugin("checkbox",Checkbox);var Clock={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this._clockInterval=null,this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onClockCreate,[this.element]),this},options:{showTime:!0,showDate:!0,timeFormat:"24",dateFormat:"american",divider:"&nbsp;&nbsp;",leadingZero:!0,dateDivider:"-",timeDivider:":",onClockCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var that=this;this._tick(),this._clockInterval=setInterval(function(){that._tick()},500)},_addLeadingZero:function(i){return i<10&&(i="0"+i),i},_tick:function(){var element=this.element,o=this.options,timestamp=new Date,result=(timestamp.getTime(),""),h=timestamp.getHours(),i=timestamp.getMinutes(),s=timestamp.getSeconds(),d=timestamp.getDate(),m=timestamp.getMonth()+1,y=timestamp.getFullYear(),a="";12===parseInt(o.timeFormat)&&(a=" AM",11<h&&(a=" PM"),12<h&&(h-=12),0===h&&(h=12)),i=this._addLeadingZero(i),s=this._addLeadingZero(s),o.leadingZero&&(h=this._addLeadingZero(h),m=this._addLeadingZero(m),d=this._addLeadingZero(d)),o.showDate&&("american"===o.dateFormat?(result+="<span class='date-month'>"+m+"</span>",result+="<span class='date-divider'>"+o.dateDivider+"</span>",result+="<span class='date-day'>"+d+"</span>"):(result+="<span class='date-day'>"+d+"</span>",result+="<span class='date-divider'>"+o.dateDivider+"</span>",result+="<span class='date-month'>"+m+"</span>"),result+="<span class='date-divider'>"+o.dateDivider+"</span>",result+="<span class='date-year'>"+y+"</span>",result+=o.divider),o.showTime&&(result+="<span class='clock-hour'>"+h+"</span>",result+="<span class='clock-divider'>"+o.timeDivider+"</span>",result+="<span class='clock-minute'>"+i+"</span>",result+="<span class='clock-divider'>"+o.timeDivider+"</span>",result+="<span class='clock-second'>"+s+"</span>",result+="<span class='clock-suffix'>"+a+"</span>"),element.html(result)},changeAttribute:function(attributeName){},destroy:function(){clearInterval(this._clockInterval),this._clockInterval=null,this.element.html("")}};Metro.plugin("clock",Clock);var Collapse={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.toggle=null,this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onCollapseCreate,[this.element]),this},options:{collapsed:!1,toggleElement:!1,duration:100,onExpand:Metro.noop,onCollapse:Metro.noop,onCollapseCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var toggle,that=this,element=this.element,o=this.options;toggle=!1!==o.toggleElement?$(o.toggleElement):0<element.siblings(".collapse-toggle").length?element.siblings(".collapse-toggle"):element.siblings("a:nth-child(1)"),!0!==o.collapsed&&!0!==element.attr("collapsed")||element.hide(0),toggle.on(Metro.events.click,function(e){"block"!==element.css("display")||element.hasClass("keep-open")?that._open(element):that._close(element),-1===["INPUT"].indexOf(e.target.tagName)&&e.preventDefault(),e.stopPropagation()}),this.toggle=toggle},_close:function(el,immediate){var elem=$(el),options=elem.data("collapse").options,func=immediate?"show":"slideUp",dur=immediate?0:options.duration;this.toggle.removeClass("active-toggle"),elem[func](dur,function(){el.trigger("onCollapse",null,el),el.data("collapsed",!0),el.addClass("collapsed"),Utils.exec(options.onCollapse,[el])})},_open:function(el,immediate){var elem=$(el),options=elem.data("collapse").options,func=immediate?"show":"slideDown",dur=immediate?0:options.duration;this.toggle.addClass("active-toggle"),elem[func](dur,function(){el.trigger("onExpand",null,el),el.data("collapsed",!1),el.removeClass("collapsed"),Utils.exec(options.onExpand,[el])})},collapse:function(immediate){this._close(this.element,immediate)},expand:function(immediate){this._open(this.element,immediate)},close:function(immediate){this._close(this.element,immediate)},open:function(immediate){this._open(this.element,immediate)},isCollapsed:function(){return this.element.data("collapsed")},toggleState:function(){var element=this.element;!0===element.attr("collapsed")||!0===element.data("collapsed")?this.collapse():this.expand()},changeAttribute:function(attributeName){switch(attributeName){case"collapsed":case"data-collapsed":this.toggleState()}},destroy:function(){this.toggle.off(Metro.events.click),this.element.show()}};Metro.plugin("collapse",Collapse);var Countdown={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.breakpoint=(new Date).getTime(),this.blinkInterval=null,this.tickInterval=null,this.zeroDaysFired=!1,this.zeroHoursFired=!1,this.zeroMinutesFired=!1,this.zeroSecondsFired=!1,this.fontSize=parseInt(Utils.getStyleOne(elem,"font-size")),this.current={d:0,h:0,m:0,s:0},this.locale=null,this.inactiveTab=!1,this._setOptionsFromDOM(),this._create(),this},options:{stopOnBlur:!0,animate:"none",animationFunc:"swing",inputFormat:null,locale:METRO_LOCALE,days:0,hours:0,minutes:0,seconds:0,date:null,start:!0,clsCountdown:"",clsPart:"",clsZero:"",clsAlarm:"",clsDays:"",clsHours:"",clsMinutes:"",clsSeconds:"",onAlarm:Metro.noop,onTick:Metro.noop,onZero:Metro.noop,onBlink:Metro.noop,onCountdownCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var o=this.options;this.locale=void 0!==Metro.locales[o.locale]?Metro.locales[o.locale]:Metro.locales["en-US"],this._build(),this._createEvents()},_setBreakpoint:function(){var o=this.options;this.breakpoint=(new Date).getTime(),Utils.isValue(o.date)&&Utils.isDate(o.date,o.inputFormat)&&(this.breakpoint=Utils.isValue(o.inputFormat)?o.date.toDate(o.inputFormat).getTime():new Date(o.date).getTime()),0<parseInt(o.days)&&(this.breakpoint+=864e5*parseInt(o.days)),0<parseInt(o.hours)&&(this.breakpoint+=36e5*parseInt(o.hours)),0<parseInt(o.minutes)&&(this.breakpoint+=6e4*parseInt(o.minutes)),0<parseInt(o.seconds)&&(this.breakpoint+=1e3*parseInt(o.seconds))},_build:function(){var delta_days,digit,that=this,element=this.element,o=this.options,now=(new Date).getTime();Utils.isValue(element.attr("id"))||element.attr("id",Utils.elementId("countdown")),element.addClass("countdown").addClass(o.clsCountdown),this._setBreakpoint(),delta_days=Math.round((that.breakpoint-now)/864e5),$.each(["days","hours","minutes","seconds"],function(){var part=$("<div>").addClass("part "+this).addClass(o.clsPart).attr("data-label",that.locale.calendar.time[this]).appendTo(element);if("days"===this&&part.addClass(o.clsDays),"hours"===this&&part.addClass(o.clsHours),"minutes"===this&&part.addClass(o.clsMinutes),"seconds"===this&&part.addClass(o.clsSeconds),$("<div>").addClass("digit").appendTo(part),$("<div>").addClass("digit").appendTo(part),"days"===this&&100<=delta_days)for(var i=0;i<String(Math.round(delta_days/100)).length;i++)$("<div>").addClass("digit").appendTo(part)}),(digit=element.find(".digit")).append($("<span class='digit-placeholder'>").html("0")),digit.append($("<span class='digit-value'>").html("0")),Utils.exec(o.onCountdownCreate,[element],element[0]),!0===o.start?this.start():this.tick()},_createEvents:function(){var that=this;this.element,this.options;document.addEventListener("visibilitychange",function(){document.hidden?that.pause():that.resume()})},blink:function(){var element=this.element,o=this.options;element.toggleClass("blink"),Utils.exec(o.onBlink,[this.current],element[0])},tick:function(){var left,d,h,m,s,element=this.element,o=this.options,now=(new Date).getTime(),days=element.find(".days"),hours=element.find(".hours"),minutes=element.find(".minutes"),seconds=element.find(".seconds");if((left=Math.floor((this.breakpoint-now)/1e3))<=-1)return this.stop(),element.addClass(o.clsAlarm),void Utils.exec(o.onAlarm,[now],element[0]);left-=86400*(d=Math.floor(left/86400)),this.current.d!==d&&(this.current.d=d,this.draw("days",d)),0===d&&!1===this.zeroDaysFired&&(this.zeroDaysFired=!0,days.addClass(o.clsZero),Utils.exec(o.onZero,["days",days],element[0])),left-=3600*(h=Math.floor(left/3600)),this.current.h!==h&&(this.current.h=h,this.draw("hours",h)),0===d&&0===h&&!1===this.zeroHoursFired&&(this.zeroHoursFired=!0,hours.addClass(o.clsZero),Utils.exec(o.onZero,["hours",hours],element[0])),left-=60*(m=Math.floor(left/60)),this.current.m!==m&&(this.current.m=m,this.draw("minutes",m)),0===d&&0===h&&0===m&&!1===this.zeroMinutesFired&&(this.zeroMinutesFired=!0,minutes.addClass(o.clsZero),Utils.exec(o.onZero,["minutes",minutes],element[0])),s=Math.floor(left/1),this.current.s!==s&&(this.current.s=s,this.draw("seconds",s)),0===d&&0===h&&0===m&&0===s&&!1===this.zeroSecondsFired&&(this.zeroSecondsFired=!0,seconds.addClass(o.clsZero),Utils.exec(o.onZero,["seconds",seconds],element[0])),Utils.exec(o.onTick,[{days:d,hours:h,minutes:m,seconds:s}],element[0])},draw:function(part,value){var digits_length,digit_value,digit_current,digit,len,i,that=this,element=this.element,o=this.options,removeOldDigit=function(_digit){document.hidden?_digit.remove():setTimeout(function(){_digit.remove()},500)},slideDigit=function(digit){var digit_copy,height=digit.height();(digit_copy=digit.clone().appendTo(digit.parent())).css({top:-1*height,opacity:.5}),digit.addClass("-old-digit").animate({top:height,opacity:0},900,o.animationFunc,removeOldDigit(digit)),digit_copy.html(digit_value).animate({top:0,opacity:1},900,o.animationFunc)},fadeDigit=function(digit){var digit_copy;(digit_copy=digit.clone().appendTo(digit.parent())).css({opacity:0}),digit.addClass("-old-digit").animate({opacity:0},900,o.animationFunc,removeOldDigit(digit)),digit_copy.html(digit_value).animate({opacity:1},900,o.animationFunc)},zoomDigit=function(digit){var digit_copy,height=digit.height(),width=digit.width(),fs=parseInt(Utils.getStyleOne(digit,"font-size"));0===fs&&fs<that.fontSize&&(fs=that.fontSize,digit.css({fontSize:that.fontSize})),(digit_copy=digit.clone().appendTo(digit.parent())).css({opacity:0,fontSize:0,top:height/2,left:width/2}),digit.addClass("-old-digit").animate({opacity:0,fontSize:0,top:height,left:width/2},900,o.animationFunc,removeOldDigit(digit)),digit_copy.html(digit_value).animate({opacity:1,fontSize:fs,top:0,left:0},900,o.animationFunc)};for(1===(value=""+value).length&&(value="0"+value),len=value.length,digits_length=element.find("."+part+" .digit").length,i=0;i<len;i++)if(digit=element.find("."+part+" .digit:eq("+(digits_length-1)+") .digit-value"),digit_value=Math.floor(parseInt(value)/Math.pow(10,i))%10,digit_current=parseInt(digit.text()),0===parseInt(digit_current)||digit_current!==digit_value){switch(String(o.animate).toLowerCase()){case"slide":slideDigit(digit);break;case"fade":fadeDigit(digit);break;case"zoom":zoomDigit(digit);break;default:digit.html(digit_value)}digits_length--}},start:function(){var that=this,element=this.element;!1!==element.data("paused")&&(clearInterval(this.blinkInterval),clearInterval(this.tickInterval),element.data("paused",!1),this._setBreakpoint(),this.tick(),this.blinkInterval=setInterval(function(){that.blink()},500),this.tickInterval=setInterval(function(){that.tick()},1e3))},stop:function(){var element=this.element;clearInterval(this.blinkInterval),clearInterval(this.tickInterval),element.data("paused",!0),element.find(".digit").html("0"),this.current={d:0,h:0,m:0,s:0}},pause:function(){clearInterval(this.blinkInterval),clearInterval(this.tickInterval),this.element.data("paused",!0)},resume:function(){var that=this;this.element.data("paused",!1),this.blinkInterval=setInterval(function(){that.blink()},500),this.tickInterval=setInterval(function(){that.tick()},1e3)},reset:function(){var that=this,element=this.element,o=this.options;clearInterval(this.blinkInterval),clearInterval(this.tickInterval),element.find(".part").removeClass(o.clsZero),element.find(".digit").html("0"),this._setBreakpoint(),element.data("paused",!1),this.tick(),this.blinkInterval=setInterval(function(){that.blink()},500),this.tickInterval=setInterval(function(){that.tick()},1e3)},togglePlay:function(){!0===this.element.attr("data-pause")?this.pause():this.start()},isPaused:function(){return this.element.data("paused")},getBreakpoint:function(asDate){return!0===asDate?new Date(this.breakpoint):this.breakpoint},getLeft:function(){var now=(new Date).getTime(),left_seconds=Math.floor(this.breakpoint-now);return{days:Math.round(left_seconds/864e5),hours:Math.round(left_seconds/36e5),minutes:Math.round(left_seconds/6e4),seconds:Math.round(left_seconds/1e3)}},i18n:function(val){var that=this,element=this.element,o=this.options;return void 0===val?o.locale:void 0!==Metro.locales[val]&&(o.locale=val,this.locale=Metro.locales[o.locale],void $.each(["days","hours","minutes","seconds"],function(){var cls=".part."+this;element.find(cls).attr("data-label",that.locale.calendar.time[this])}))},changeAttrLocale:function(){var locale=this.element.attr("data-locale");this.i18n(locale)},changeAttribute:function(attributeName){switch(attributeName){case"data-pause":this.togglePlay();break;case"data-locale":this.changeAttrLocale()}},destroy:function(){clearInterval(this.blinkInterval),clearInterval(this.tickInterval),this.element.html(""),this.element.removeClass("countdown").removeClass(this.options.clsCountdown)}};Metro.plugin("countdown",Countdown);var Counter={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.numbers=[],this.html=this.element.html(),this._setOptionsFromDOM(),this._create(),this},options:{delay:10,step:1,value:0,timeout:null,delimiter:",",onStart:Metro.noop,onStop:Metro.noop,onTick:Metro.noop,onCounterCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var that=this,element=this.element,o=this.options;this._calcArray(),Utils.exec(o.onCounterCreate,[element],this.elem),null!==o.timeout&&Utils.isInt(o.timeout)&&setTimeout(function(){that.start()},o.timeout)},_calcArray:function(){var i,o=this.options;for(i=0;i<=o.value;i+=o.step)this.numbers.push(i);this.numbers[this.numbers.length-1]!==o.value&&this.numbers.push(o.value)},start:function(){var that=this,element=this.element,o=this.options,tick=function(){if(0!==that.numbers.length){var n=that.numbers.shift();Utils.exec(o.onTick,[n,element],element[0]),element.html(Number(n).format(0,0,o.delimiter)),0<that.numbers.length?setTimeout(tick,o.delay):Utils.exec(o.onStop,[element],element[0])}else Utils.exec(o.onStop,[element],element[0])};Utils.exec(o.onStart,[element],element[0]),setTimeout(tick,o.delay)},reset:function(){this._calcArray(),this.element.html(this.html)},setValueAttribute:function(){this.options.value=this.element.attr("data-value"),this._calcArray()},changeAttribute:function(attributeName){switch(attributeName){case"data-value":this.setValueAttribute()}},destroy:function(){}};Metro.plugin("counter",Counter);var Cube={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.id=null,this.rules=null,this.interval=!1,this.ruleInterval=!1,this.running=!1,this.intervals=[],this._setOptionsFromDOM(),this._create(),this},default_rules:[{on:{top:[16],left:[4],right:[1]},off:{top:[13,4],left:[1,16],right:[13,4]}},{on:{top:[12,15],left:[3,8],right:[2,5]},off:{top:[9,6,3],left:[5,10,15],right:[14,11,8]}},{on:{top:[11],left:[7],right:[6]},off:{top:[1,2,5],left:[9,13,14],right:[15,12,16]}},{on:{top:[8,14],left:[2,12],right:[9,3]},off:{top:[16],left:[4],right:[1]}},{on:{top:[10,7],left:[6,11],right:[10,7]},off:{top:[12,15],left:[3,8],right:[2,5]}},{on:{top:[13,4],left:[1,16],right:[13,4]},off:{top:[11],left:[7],right:[6]}},{on:{top:[9,6,3],left:[5,10,15],right:[14,11,8]},off:{top:[8,14],left:[2,12],right:[9,3]}},{on:{top:[1,2,5],left:[9,13,14],right:[15,12,16]},off:{top:[10,7],left:[6,11],right:[10,7]}}],options:{rules:null,color:null,flashColor:null,flashInterval:1e3,numbers:!1,offBefore:!0,attenuation:.3,stopOnBlur:!1,cells:4,margin:8,showAxis:!1,axisStyle:"arrow",cellClick:!1,autoRestart:5e3,clsCube:"",clsCell:"",clsSide:"",clsSideLeft:"",clsSideRight:"",clsSideTop:"",clsSideLeftCell:"",clsSideRightCell:"",clsSideTopCell:"",clsAxis:"",clsAxisX:"",clsAxisY:"",clsAxisZ:"",custom:Metro.noop,onTick:Metro.noop,onCubeCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;null===o.rules?this.rules=this.default_rules:this._parseRules(o.rules),this._createCube(),this._createEvents(),Utils.exec(o.onCubeCreate,[element])},_parseRules:function(rules){if(null==rules)return!1;if(Utils.isObject(rules))return this.rules=Utils.isObject(rules),!0;try{return this.rules=JSON.parse(rules),!0}catch(err){return console.log("Unknown or empty rules for cell flashing!"),!1}},_createCube:function(){var element=this.element,o=this.options,id=Utils.elementId("cube"),cells_count=Math.pow(o.cells,2);element.addClass("cube").addClass(o.clsCube),void 0===element.attr("id")&&element.attr("id",id),this.id=element.attr("id"),this._createCssForFlashColor(),this._createCssForCellSize(),$.each(["left","right","top"],function(){var side,cell,i;for(side=$("<div>").addClass("side "+this+"-side").addClass(o.clsSide).appendTo(element),"left"===this&&side.addClass(o.clsSideLeft),"right"===this&&side.addClass(o.clsSideRight),"top"===this&&side.addClass(o.clsSideTop),i=0;i<cells_count;i++)(cell=$("<div>").addClass("cube-cell").addClass("cell-id-"+(i+1)).addClass(o.clsCell)).data("id",i+1).data("side",this),cell.appendTo(side),!0===o.numbers&&cell.html(i+1)});var cells=element.find(".cube-cell");null!==o.color&&(Utils.isColor(o.color)?cells.css({backgroundColor:o.color,borderColor:o.color}):cells.addClass(o.color));$.each(["x","y","z"],function(){var ax=$("<div>").addClass("axis "+o.axisStyle).addClass("axis-"+this).addClass(o.clsAxis);"x"===this&&ax.addClass(o.clsAxisX),"y"===this&&ax.addClass(o.clsAxisY),"z"===this&&ax.addClass(o.clsAxisZ),ax.appendTo(element)}),!1===o.showAxis&&element.find(".axis").hide(),this._run()},_run:function(){var that=this,element=this.element,o=this.options,interval=0;clearInterval(this.interval),element.find(".cube-cell").removeClass("light"),o.custom!==Metro.noop?Utils.exec(o.custom,[element]):(element.find(".cube-cell").removeClass("light"),that._start(),interval=Utils.isObject(this.rules)?Utils.objectLength(this.rules):0,this.interval=setInterval(function(){that._start()},interval*o.flashInterval))},_createCssForCellSize:function(){var width,cell_size,element=this.element,o=this.options,sheet=Metro.sheet;8===o.margin&&4===o.cells||(width=parseInt(Utils.getStyleOne(element,"width")),cell_size=Math.ceil((width/2-o.margin*o.cells*2)/o.cells),Utils.addCssRule(sheet,"#"+element.attr("id")+" .side .cube-cell","width: "+cell_size+"px!important; height: "+cell_size+"px!important; margin: "+o.margin+"px!important;"))},_createCssForFlashColor:function(){var rule1,rule2,i,element=this.element,o=this.options,sheet=Metro.sheet,rules1=[],rules2=[];if(null!==o.flashColor){for(rule1="0 0 10px "+Utils.hexColorToRgbA(o.flashColor,1),rule2="0 0 10px "+Utils.hexColorToRgbA(o.flashColor,o.attenuation),i=0;i<3;i++)rules1.push(rule1),rules2.push(rule2);Utils.addCssRule(sheet,"@keyframes pulsar-cell-"+element.attr("id"),"0%, 100% { box-shadow: "+rules1.join(",")+"} 50% { box-shadow: "+rules2.join(",")+" }"),Utils.addCssRule(sheet,"#"+element.attr("id")+" .side .cube-cell.light","animation: pulsar-cell-"+element.attr("id")+" 2.5s 0s ease-out infinite; background-color: "+o.flashColor+"!important; border-color: "+o.flashColor+"!important;")}},_createEvents:function(){var that=this,element=this.element,o=this.options;$(window).on(Metro.events.blur+"-"+element.attr("id"),function(){!0===o.stopOnBlur&&!0===that.running&&that._stop()}),$(window).on(Metro.events.focus+"-"+element.attr("id"),function(){!0===o.stopOnBlur&&!1===that.running&&that._start()}),element.on(Metro.events.click,".cube-cell",function(){!0===o.cellClick&&$(this).toggleClass("light")})},_start:function(){var that=this,element=this.element;this.options;element.find(".cube-cell").removeClass("light"),this.running=!0,$.each(this.rules,function(index,rule){that._execRule(index,rule)})},_stop:function(){this.running=!1,clearInterval(this.interval),$.each(this.intervals,function(){clearInterval(this)})},_tick:function(index,speed){var that=this,element=this.element,o=this.options;void 0===speed&&(speed=o.flashInterval*index);var interval=setTimeout(function(){Utils.exec(o.onTick,[index],element[0]),clearInterval(interval),Utils.arrayDelete(that.intervals,interval)},speed);this.intervals.push(interval)},_toggle:function(cell,func,time,speed){var that=this;void 0===speed&&(speed=this.options.flashInterval*time);var interval=setTimeout(function(){cell["on"===func?"addClass":"removeClass"]("light"),clearInterval(interval),Utils.arrayDelete(that.intervals,interval)},speed);this.intervals.push(interval)},start:function(){this._start()},stop:function(){this._stop()},toRule:function(index,speed){var that=this,element=this.element,o=this.options,rules=this.rules;if(null!=rules&&void 0!==rules[index]){clearInterval(this.ruleInterval),this.ruleInterval=!1,this.stop(),element.find(".cube-cell").removeClass("light");for(var i=0;i<=index;i++)this._execRule(i,rules[i],speed);Utils.isInt(o.autoRestart)&&0<o.autoRestart&&(this.ruleInterval=setTimeout(function(){that._run()},o.autoRestart))}},_execRule:function(index,rule,speed){var that=this,element=this.element;this.options;this._tick(index,speed),$.each(["left","right","top"],function(){var side_class="."+this+"-side",cells_on=void 0!==rule.on&&void 0!==rule.on[this]&&rule.on[this],cells_off=void 0!==rule.off&&void 0!==rule.off[this]&&rule.off[this];!1!==cells_on&&$.each(cells_on,function(){var cell=element.find(side_class+" .cell-id-"+this);that._toggle(cell,"on",index,speed)}),!1!==cells_off&&$.each(cells_off,function(){var cell=element.find(side_class+" .cell-id-"+this);that._toggle(cell,"off",index,speed)})})},rule:function(r){if(void 0===r)return this.rules;!0===this._parseRules(r)&&(this.options.rules=r,this.stop(),this.element.find(".cube-cell").removeClass("light"),this._run())},axis:function(show){var func=!0===show?"show":"hide";this.element.find(".axis")[func]()},changeRules:function(){var element=this.element,o=this.options,rules=element.attr("data-rules");!0===this._parseRules(rules)&&(this.stop(),element.find(".cube-cell").removeClass("light"),o.rules=rules,this._run())},changeAxisVisibility:function(){var element=this.element,func=(this.options,!0===JSON.parse(element.attr("data-show-axis"))?"show":"hide");element.find(".axis")[func]()},changeAxisStyle:function(){var element=this.element,style=(this.options,element.attr("data-axis-style"));element.find(".axis").removeClass("arrow line no-style").addClass(style)},changeAttribute:function(attributeName){switch(attributeName){case"data-rules":this.changeRules();break;case"data-show-axis":this.changeAxisVisibility();break;case"data-axis-style":this.changeAxisStyle()}},destroy:function(){var element=this.element,o=this.options;clearInterval(this.interval),this.interval=null,$(window).off(Metro.events.blur+"-"+element.attr("id")),$(window).off(Metro.events.focus+"-"+element.attr("id")),element.off(Metro.events.click,".cube-cell"),element.html(""),element.removeClass("cube").removeClass(o.clsCube)}};Metro.plugin("cube",Cube);var DatePicker={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.picker=null,this.isOpen=!1,this.value=new Date,this.locale=Metro.locales[METRO_LOCALE].calendar,this.offset=(new Date).getTimezoneOffset()/60+1,this._setOptionsFromDOM(),this._create(),this},options:{gmt:0,format:"%Y-%m-%d",locale:METRO_LOCALE,value:null,distance:3,month:!0,day:!0,year:!0,minYear:null,maxYear:null,scrollSpeed:1,copyInlineStyles:!0,clsPicker:"",clsPart:"",clsMonth:"",clsDay:"",clsYear:"",okButtonIcon:"<span class='default-icon-check'></span>",cancelButtonIcon:"<span class='default-icon-cross'></span>",onSet:Metro.noop,onOpen:Metro.noop,onClose:Metro.noop,onScroll:Metro.noop,onDatePickerCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;o.distance<1&&(o.distance=1),null!==o.value&&Utils.isDate(o.value)&&(this.value=new Date(o.value).addHours(this.offset)),void 0===Metro.locales[o.locale]&&(o.locale=METRO_LOCALE),this.locale=Metro.locales[o.locale].calendar,null===o.minYear&&(o.minYear=(new Date).getFullYear()-100),null===o.maxYear&&(o.maxYear=(new Date).getFullYear()+100),this._createStructure(),this._createEvents(),this._set(),Utils.exec(o.onDatePickerCreate,[element])},_createStructure:function(){var picker,month,day,year,i,j,dateWrapper,selectWrapper,selectBlock,actionBlock,element=this.element,o=this.options,prev=element.prev(),parent=element.parent(),id=Utils.elementId("date-picker");if(picker=$("<div>").attr("id",id).addClass("wheel-picker date-picker "+element[0].className).addClass(o.clsPicker),0===prev.length?parent.prepend(picker):picker.insertAfter(prev),element.appendTo(picker),dateWrapper=$("<div>").addClass("date-wrapper").appendTo(picker),!0===o.month&&(month=$("<div>").addClass("month").addClass(o.clsPart).addClass(o.clsMonth).appendTo(dateWrapper)),!0===o.day&&(day=$("<div>").addClass("day").addClass(o.clsPart).addClass(o.clsDay).appendTo(dateWrapper)),!0===o.year&&(year=$("<div>").addClass("year").addClass(o.clsPart).addClass(o.clsYear).appendTo(dateWrapper)),selectWrapper=$("<div>").addClass("select-wrapper").appendTo(picker),selectBlock=$("<div>").addClass("select-block").appendTo(selectWrapper),!0===o.month){for(month=$("<ul>").addClass("sel-month").appendTo(selectBlock),i=0;i<o.distance;i++)$("<li>").html("&nbsp;").data("value",-1).appendTo(month);for(i=0;i<12;i++)$("<li>").addClass("js-month-"+i+" js-month-real-"+this.locale.months[i].toLowerCase()).html(this.locale.months[i]).data("value",i).appendTo(month);for(i=0;i<o.distance;i++)$("<li>").html("&nbsp;").data("value",-1).appendTo(month)}if(!0===o.day){for(day=$("<ul>").addClass("sel-day").appendTo(selectBlock),i=0;i<o.distance;i++)$("<li>").html("&nbsp;").data("value",-1).appendTo(day);for(i=0;i<31;i++)$("<li>").addClass("js-day-"+i+" js-day-real-"+(i+1)).html(i+1).data("value",i+1).appendTo(day);for(i=0;i<o.distance;i++)$("<li>").html("&nbsp;").data("value",-1).appendTo(day)}if(!0===o.year){for(year=$("<ul>").addClass("sel-year").appendTo(selectBlock),i=0;i<o.distance;i++)$("<li>").html("&nbsp;").data("value",-1).appendTo(year);for(i=o.minYear,j=0;i<=o.maxYear;i++,j++)$("<li>").addClass("js-year-"+j+" js-year-real-"+i).html(i).data("value",i).appendTo(year);for(i=0;i<o.distance;i++)$("<li>").html("&nbsp;").data("value",-1).appendTo(year)}if(selectBlock.height(40*(2*o.distance+1)),actionBlock=$("<div>").addClass("action-block").appendTo(selectWrapper),$("<button>").attr("type","button").addClass("button action-ok").html(o.okButtonIcon).appendTo(actionBlock),$("<button>").attr("type","button").addClass("button action-cancel").html(o.cancelButtonIcon).appendTo(actionBlock),!(element[0].className="")===o.copyInlineStyles)for(i=0;i<element[0].style.length;i++)picker.css(element[0].style[i],element.css(element[0].style[i]));this.picker=picker},_createEvents:function(){var that=this,o=this.options,picker=this.picker;picker.on(Metro.events.start,".select-block ul",function(e){if(!e.changedTouches){var target=this,pageY=Utils.pageXY(e).y;$(document).on(Metro.events.move+"-picker",function(e){target.scrollTop-=o.scrollSpeed*(pageY>Utils.pageXY(e).y?-1:1),pageY=Utils.pageXY(e).y}),$(document).on(Metro.events.stop+"-picker",function(){$(document).off(Metro.events.move+"-picker"),$(document).off(Metro.events.stop+"-picker")})}}),picker.on(Metro.events.click,function(e){!1===that.isOpen&&that.open(),e.stopPropagation()}),picker.on(Metro.events.click,".action-ok",function(e){var m,d,y,sm=picker.find(".sel-month li.active"),sd=picker.find(".sel-day li.active"),sy=picker.find(".sel-year li.active");m=0===sm.length?that.value.getMonth():sm.data("value"),d=0===sd.length?that.value.getDate():sd.data("value"),y=0===sy.length?that.value.getFullYear():sy.data("value"),that.value=new Date(y,m,d),that._correct(),that._set(),that.close(),e.stopPropagation()}),picker.on(Metro.events.click,".action-cancel",function(e){that.close(),e.stopPropagation()}),this._addScrollEvents()},_addScrollEvents:function(){var picker=this.picker,o=this.options;$.each(["month","day","year"],function(){var list_name=this,list=picker.find(".sel-"+list_name);0!==list.length&&(list.on(Metro.events.scrollStart,function(){list.find(".active").removeClass("active")}),list.on(Metro.events.scrollStop,{latency:50},function(){var target=Math.round(Math.ceil(list.scrollTop())/40),target_element=list.find(".js-"+list_name+"-"+target),scroll_to=target_element.position().top-40*o.distance+list.scrollTop()-1;list.animate({scrollTop:scroll_to},100,function(){target_element.addClass("active"),Utils.exec(o.onScroll,[target_element,list,picker],list[0])})}))})},_removeScrollEvents:function(){var picker=this.picker;$.each(["month","day","year"],function(){picker.find(".sel-"+this).off("scrollstart scrollstop")})},_correct:function(){var m=this.value.getMonth(),d=this.value.getDate(),y=this.value.getFullYear();this.value=new Date(y,m,d)},_set:function(){var element=this.element,o=this.options,picker=this.picker,m=this.locale.months[this.value.getMonth()],d=this.value.getDate(),y=this.value.getFullYear();!0===o.month&&picker.find(".month").html(m),!0===o.day&&picker.find(".day").html(d),!0===o.year&&picker.find(".year").html(y),element.val(this.value.format(o.format,o.locale)).trigger("change"),Utils.exec(o.onSet,[this.value,element.val(),element,picker],element[0])},open:function(){var m_list,d_list,y_list,select_wrapper_in_viewport,select_wrapper_rect,element=this.element,o=this.options,picker=this.picker,m=this.value.getMonth(),d=this.value.getDate()-1,y=this.value.getFullYear(),select_wrapper=picker.find(".select-wrapper");select_wrapper.parent().removeClass("for-top for-bottom"),select_wrapper.show(),picker.find("li").removeClass("active"),select_wrapper_in_viewport=Utils.inViewport(select_wrapper),select_wrapper_rect=Utils.rect(select_wrapper),!select_wrapper_in_viewport&&0<select_wrapper_rect.top&&select_wrapper.parent().addClass("for-bottom"),!select_wrapper_in_viewport&&select_wrapper_rect.top<0&&select_wrapper.parent().addClass("for-top"),!0===o.month&&(m_list=picker.find(".sel-month")).scrollTop(0).animate({scrollTop:m_list.find("li.js-month-"+m).addClass("active").position().top-40*o.distance},100),!0===o.day&&(d_list=picker.find(".sel-day")).scrollTop(0).animate({scrollTop:d_list.find("li.js-day-"+d).addClass("active").position().top-40*o.distance},100),!0===o.year&&(y_list=picker.find(".sel-year")).scrollTop(0).animate({scrollTop:y_list.find("li.js-year-real-"+y).addClass("active").position().top-40*o.distance},100),this.isOpen=!0,Utils.exec(o.onOpen,[this.value,element,picker],element[0])},close:function(){var picker=this.picker,o=this.options,element=this.element;picker.find(".select-wrapper").hide(),this.isOpen=!1,Utils.exec(o.onClose,[this.value,element,picker],element[0])},val:function(t){return void 0===t?this.element.val():!1!==Utils.isDate(t)&&(this.value=new Date(t).addHours(this.offset),void this._set())},date:function(t){if(void 0===t)return this.value;try{this.value=new Date(t.format("%Y-%m-%d")),this._set()}catch(e){return!1}},changeValueAttribute:function(){this.val(this.element.attr("data-value"))},changeAttribute:function(attributeName){switch(attributeName){case"data-value":this.changeValueAttribute()}},destroy:function(){var element=this.element,picker=this.picker,parent=element.parent();this._removeScrollEvents(),picker.off(Metro.events.start,".select-block ul"),picker.off(Metro.events.click),picker.off(Metro.events.click,".action-ok"),picker.off(Metro.events.click,".action-cancel"),element.insertBefore(parent),parent.remove()}};Metro.plugin("datepicker",DatePicker),$(document).on(Metro.events.click,function(){$.each($(".date-picker"),function(){$(this).find("input").data("datepicker").close()})});var Dialog={_counter:0,init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.interval=null,this.overlay=null,this._setOptionsFromDOM(),this._create(),this},options:{closeButton:!1,leaveOverlayOnClose:!1,toTop:!1,toBottom:!1,locale:METRO_LOCALE,title:"",content:"",actions:{},actionsAlign:"right",defaultAction:!0,overlay:!0,overlayColor:"#000000",overlayAlpha:.5,overlayClickClose:!1,width:"480",height:"auto",shadow:!0,closeAction:!0,clsDialog:"",clsTitle:"",clsContent:"",clsAction:"",clsDefaultAction:"",clsOverlay:"",autoHide:0,removeOnClose:!1,show:!1,onShow:Metro.noop,onHide:Metro.noop,onOpen:Metro.noop,onClose:Metro.noop,onDialogCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var o=this.options;this.locale=void 0!==Metro.locales[o.locale]?Metro.locales[o.locale]:Metro.locales["en-US"],this._build()},_build:function(){var overlay,that=this,element=this.element,o=this.options,body=$("body");if(element.addClass("dialog"),!0===o.shadow&&element.addClass("shadow-on"),void 0===element.attr("id")&&element.attr("id",Utils.elementId("dialog")),""!==o.title&&this.setTitle(o.title),""!==o.content&&this.setContent(o.content),!0===o.defaultAction||!1!==o.actions&&"object"==typeof o.actions&&0<Utils.objectLength(o.actions)){var button,buttons=element.find(".dialog-actions");0===buttons.length&&(buttons=$("<div>").addClass("dialog-actions").addClass("text-"+o.actionsAlign).appendTo(element)),!0===o.defaultAction&&0===Utils.objectLength(o.actions)&&0===element.find(".dialog-actions > *").length&&(button=$("<button>").addClass("button js-dialog-close").addClass(o.clsDefaultAction).html(this.locale.buttons.ok)).appendTo(buttons),$.each(o.actions,function(){var item=this;button=$("<button>").addClass("button").addClass(item.cls).html(item.caption),void 0!==item.onclick&&button.on(Metro.events.click,function(){Utils.exec(item.onclick,[element])}),button.appendTo(buttons)})}!0===o.overlay&&(overlay=this._overlay(),this.overlay=overlay),!0===o.closeAction&&element.on(Metro.events.click,".js-dialog-close",function(){that.close()});var closer=element.find("closer");0===closer.length&&(closer=$("<span>").addClass("button square closer js-dialog-close")).appendTo(element),!0!==o.closeButton&&closer.hide(),element.css({width:o.width,height:o.height,visibility:"hidden",top:"100%",left:($(window).width()-element.outerWidth())/2}),element.addClass(o.clsDialog),element.find(".dialog-title").addClass(o.clsTitle),element.find(".dialog-content").addClass(o.clsContent),element.find(".dialog-actions").addClass(o.clsAction),element.appendTo(body),o.show&&this.open(),$(window).on(Metro.events.resize+"_"+element.attr("id"),function(){that.setPosition()}),Utils.exec(this.options.onDialogCreate,[this.element])},_overlay:function(){this.element;var o=this.options,overlay=$("<div>");return overlay.addClass("overlay").addClass(o.clsOverlay),"transparent"===o.overlayColor?overlay.addClass("transparent"):overlay.css({background:Utils.hex2rgba(o.overlayColor,o.overlayAlpha)}),overlay},hide:function(callback){var that=this,element=this.element,o=this.options,timeout=0;o.onHide!==Metro.noop&&(timeout=300),setTimeout(function(){element.css({visibility:"hidden",top:"100%"}),Utils.exec(o.onHide,[that],element[0]),Utils.callback(callback)},timeout)},show:function(callback){var element=this.element,o=this.options;this.setPosition(),element.css({visibility:"visible"}),Utils.exec(o.onShow,[this],element[0]),Utils.callback(callback)},setPosition:function(){var top,bottom,element=this.element,o=this.options;!0!==o.toTop&&!0!==o.toBottom?((top=($(window).height()-element.outerHeight())/2)<0&&(top=0),bottom="auto"):(!0===o.toTop&&(top=0,bottom="auto"),!0!==o.toTop&&!0===o.toBottom&&(bottom=0,top="auto")),element.css({top:top,bottom:bottom,left:($(window).width()-element.outerWidth())/2})},setContent:function(c){var element=this.element,content=(this.options,element.find(".dialog-content"));0===content.length&&(content=$("<div>").addClass("dialog-content")).appendTo(element),!Utils.isJQueryObject(c)&&Utils.isFunc(c)&&(c=Utils.exec(c)),Utils.isJQueryObject(c)?c.appendTo(content):content.html(c)},setTitle:function(t){var element=this.element,title=(this.options,element.find(".dialog-title"));0===title.length&&(title=$("<div>").addClass("dialog-title")).appendTo(element),title.html(t)},close:function(){var element=this.element,o=this.options;Utils.bool(o.leaveOverlayOnClose)||$("body").find(".overlay").remove(),this.hide(function(){element.data("open",!1),Utils.exec(o.onClose,[element],element[0]),!0===o.removeOnClose&&element.remove()})},open:function(){var that=this,element=this.element,o=this.options;!0===o.overlay&&0===$(".overlay").length&&(this.overlay.appendTo($("body")),!0===o.overlayClickClose&&this.overlay.on(Metro.events.click,function(){that.close()})),this.show(function(){Utils.exec(o.onOpen,[element],element[0]),element.data("open",!0),0<parseInt(o.autoHide)&&setTimeout(function(){that.close()},parseInt(o.autoHide))})},toggle:function(){this.element.data("open")?this.close():this.open()},isOpen:function(){return!0===this.element.data("open")},changeAttribute:function(attributeName){}};Metro.plugin("dialog",Dialog);var Donut={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.value=0,this.animation_change_interval=null,this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onDonutCreate,[this.element]),this},options:{size:100,radius:50,hole:.8,value:0,background:"#ffffff",color:"",stroke:"#d1d8e7",fill:"#49649f",fontSize:24,total:100,cap:"%",showText:!0,showValue:!(Metro.dialog={isDialog:function(el){return Utils.isMetroObject(el,"dialog")},open:function(el,content,title){if(!this.isDialog(el))return!1;var dialog=$(el).data("dialog");void 0!==title&&dialog.setTitle(title),void 0!==content&&dialog.setContent(content),dialog.open()},close:function(el){if(!this.isDialog(el))return!1;$(el).data("dialog").close()},toggle:function(el){if(!this.isDialog(el))return!1;$(el).data("dialog").toggle()},isOpen:function(el){return!!this.isDialog(el)&&$(el).data("dialog").isOpen()},remove:function(el){if(!this.isDialog(el))return!1;var dialog=$(el).data("dialog");dialog.options.removeOnClose=!0,dialog.close()},create:function(options){var dlg;dlg=$("<div>").appendTo($("body"));var dlg_options=$.extend({},{show:!0,closeAction:!0,removeOnClose:!0},void 0!==options?options:{});return dlg.dialog(dlg_options)}}),animate:0,onChange:Metro.noop,onDonutCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options,html="",r=o.radius*(1-(1-o.hole)/2),width=o.radius*(1-o.hole),circumference=2*Math.PI*r,transform=(o.value,o.total,"rotate(-90 "+o.radius+","+o.radius+")"),fontSize=r*o.hole*.6;element.addClass("donut"),element.css({width:o.size,height:o.size,background:o.background}),html+="<svg>",html+="   <circle class='donut-back' r='"+r+"px' cx='"+o.radius+"px' cy='"+o.radius+"px' transform='"+transform+"' fill='none' stroke='"+o.stroke+"' stroke-width='"+width+"'/>",html+="   <circle class='donut-fill' r='"+r+"px' cx='"+o.radius+"px' cy='"+o.radius+"px' transform='"+transform+"' fill='none' stroke='"+o.fill+"' stroke-width='"+width+"'/>",!0===o.showText&&(html+="   <text   class='donut-title' x='"+o.radius+"px' y='"+o.radius+"px' dy='"+fontSize/3+"px' text-anchor='middle' fill='"+(""!==o.color?o.color:o.fill)+"' font-size='"+fontSize+"px'>0"+o.cap+"</text>"),html+="</svg>",element.html(html),this.val(o.value)},_setValue:function(v){var element=this.element,o=this.options,fill=element.find(".donut-fill"),title=element.find(".donut-title"),r=o.radius*(1-(1-o.hole)/2),circumference=2*Math.PI*r,title_value=(o.showValue?v:Utils.percent(o.total,v,!0))+o.cap,fill_value=v*circumference/o.total+" "+circumference;fill.attr("stroke-dasharray",fill_value),title.html(title_value)},val:function(v){var that=this,element=this.element,o=this.options;if(void 0===v)return this.value;if(parseInt(v)<0||parseInt(v)>o.total)return!1;if(0<o.animate&&!document.hidden){var inc=v>that.value,i=that.value+(inc?-1:1);clearInterval(that.animation_change_interval),this.animation_change_interval=setInterval(function(){inc?(that._setValue(++i),v<=i&&clearInterval(that.animation_change_interval)):(that._setValue(--i),i<=v&&clearInterval(that.animation_change_interval))},o.animate)}else clearInterval(that.animation_change_interval),this._setValue(v);this.value=v,Utils.exec(o.onChange,[this.value,element])},changeValue:function(){this.val(this.element.attr("data-value"))},changeAttribute:function(attributeName){switch(attributeName){case"data-value":this.changeValue()}},destroy:function(){this.element.removeClass("donut").html("")}};Metro.plugin("donut",Donut);var Draggable={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.drag=!1,this.move=!1,this.backup={cursor:"default",zIndex:"0"},this.dragArea=null,this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onDraggableCreate,[this.element]),this},options:{dragElement:"self",dragArea:"parent",onCanDrag:Metro.noop_true,onDragStart:Metro.noop,onDragStop:Metro.noop,onDragMove:Metro.noop,onDraggableCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var that=this,element=this.element,elem=this.elem,o=this.options,offset=element.offset(),position={x:0,y:0},dragElement="self"!==o.dragElement?element.find(o.dragElement):element;dragElement[0].ondragstart=function(){return!1},element.css("position","absolute"),"document"!==o.dragArea&&"window"!==o.dragArea||(o.dragArea="body"),setImmediate(function(){that.dragArea="parent"===o.dragArea?element.parent():$(o.dragArea),"parent"!==o.dragArea&&(element.appendTo(that.dragArea),element.css({top:offset.top,left:offset.left}))}),dragElement.on(Metro.events.startAll,function(e){var coord="parent"!==o.dragArea?element.offset():element.position(),shiftX=Utils.pageXY(e).x-coord.left,shiftY=Utils.pageXY(e).y-coord.top,moveElement=function(e){var top=Utils.pageXY(e).y-shiftY,left=Utils.pageXY(e).x-shiftX;top<0&&(top=0),left<0&&(left=0),top>that.dragArea.outerHeight()-element.outerHeight()&&(top=that.dragArea.outerHeight()-element.outerHeight()),left>that.dragArea.outerWidth()-element.outerWidth()&&(left=that.dragArea.outerWidth()-element.outerWidth()),position.y=top,position.x=left,element.css({left:left,top:top})};!1!==element.data("canDrag")&&!0===Utils.exec(o.onCanDrag,[element])&&(!1===isTouch&&1!==e.which||(that.drag=!0,that.backup.cursor=element.css("cursor"),that.backup.zIndex=element.css("z-index"),element.addClass("draggable"),moveElement(e),Utils.exec(o.onDragStart,[position,element]),$(document).on(Metro.events.moveAll,function(e){moveElement(e),Utils.exec(o.onDragMove,[position],elem)}),$(document).on(Metro.events.stopAll,function(e){element.css({cursor:that.backup.cursor,zIndex:that.backup.zIndex}).removeClass("draggable"),that.drag&&($(document).off(Metro.events.moveAll),$(document).off(Metro.events.stopAll)),that.drag=!1,that.move=!1,Utils.exec(o.onDragStop,[position],elem)})))})},off:function(){this.element.data("canDrag",!1)},on:function(){this.element.data("canDrag",!0)},changeAttribute:function(attributeName){}};Metro.plugin("draggable",Draggable);var Dropdown={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this._toggle=null,this.displayOrigin=null,this._setOptionsFromDOM(),this._create(),this},options:{dropFilter:null,effect:"slide",toggleElement:null,noClose:!1,duration:100,onDrop:Metro.noop,onUp:Metro.noop,onDropdownCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var that=this;this._createStructure(),this._createEvents(),Utils.exec(this.options.onDropdownCreate,[this.element]),this.element.hasClass("open")&&setTimeout(function(){that.open(!0)},500)},_createStructure:function(){var toggle,element=this.element,o=this.options;toggle=null!==o.toggleElement?$(o.toggleElement):0<element.siblings(".dropdown-toggle").length?element.siblings(".dropdown-toggle"):element.prev(),this.displayOrigin=Utils.getStyleOne(element,"display"),element.hasClass("v-menu")&&element.addClass("for-dropdown"),element.css("display","none"),this._toggle=toggle},_createEvents:function(){var that=this,element=this.element,o=this.options,toggle=this._toggle,parent=element.parent();toggle.on(Metro.events.click,function(e){if(parent.siblings(parent[0].tagName).removeClass("active-container"),$(".active-container").removeClass("active-container"),"none"===element.css("display")||element.hasClass("keep-open")){if($("[data-role=dropdown]").each(function(i,el){element.parents("[data-role=dropdown]").is(el)||$(el).hasClass("keep-open")||"none"===$(el).css("display")||(Utils.isValue(o.dropFilter)?0<$(el).closest(o.dropFilter).length&&that._close(el):that._close(el))}),element.hasClass("horizontal")){element.css({visibility:"hidden",display:"block"});var children_width=0;$.each(element.children("li"),function(){children_width+=$(this).outerWidth(!0)}),element.css({visibility:"visible",display:"none"}),element.css("width",children_width)}that._open(element),parent.addClass("active-container")}else that._close(element);e.preventDefault(),e.stopPropagation()}),!0===o.noClose&&element.addClass("keep-open").on(Metro.events.click,function(e){e.stopPropagation()}),$(element).find("li.disabled a").on(Metro.events.click,function(e){e.preventDefault()})},_close:function(el,immediate){!1===Utils.isJQueryObject(el)&&(el=$(el));var dropdown=el.data("dropdown"),toggle=dropdown._toggle,options=dropdown.options,func="slide"===options.effect?"slideUp":"fadeOut";toggle.removeClass("active-toggle").removeClass("active-control"),dropdown.element.parent().removeClass("active-container"),immediate&&(func="hide"),el[func](immediate?0:options.duration,function(){el.trigger("onClose",null,el)}),Utils.exec(options.onUp,[el])},_open:function(el,immediate){!1===Utils.isJQueryObject(el)&&(el=$(el));var dropdown=el.data("dropdown"),toggle=dropdown._toggle,options=dropdown.options,func="slide"===options.effect?"slideDown":"fadeIn";toggle.addClass("active-toggle").addClass("active-control"),immediate&&(func="show"),el[func](immediate?0:options.duration,function(){el.trigger("onOpen",null,el)}),Utils.exec(options.onDrop,[el])},close:function(immediate){this._close(this.element,immediate)},open:function(immediate){this._open(this.element,immediate)},changeAttribute:function(attributeName){},destroy:function(){this._toggle.off(Metro.events.click)}};$(document).on(Metro.events.click,function(e){$("[data-role*=dropdown]").each(function(){var el=$(this);"block"!==el.css("display")||el.hasClass("keep-open")||el.hasClass("stay-open")||el.data("dropdown").close()})}),Metro.plugin("dropdown",Dropdown);var File={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onFileCreate,[this.element],elem),this},options:{mode:"input",buttonTitle:"Choose file(s)",filesTitle:"file(s) selected",dropTitle:"<strong>Choose a file</strong> or drop it here",dropIcon:"<span class='default-icon-upload'></span>",prepend:"",clsComponent:"",clsPrepend:"",clsButton:"",clsCaption:"",copyInlineStyles:!0,onSelect:Metro.noop,onFileCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){this._createStructure(),this._createEvents()},_createStructure:function(){var icon,button,element=this.element,o=this.options,container=$("<label>").addClass(("input"===o.mode?" file ":" drop-zone ")+element[0].className).addClass(o.clsComponent),caption=$("<span>").addClass("caption").addClass(o.clsCaption),files=$("<span>").addClass("files").addClass(o.clsCaption);(container.insertBefore(element),element.appendTo(container),"input"===o.mode)?(caption.insertBefore(element),(button=$("<button>").addClass("button").attr("tabindex",-1).attr("type","button").html(o.buttonTitle)).appendTo(container),button.addClass(o.clsButton),"rtl"===element.attr("dir")&&container.addClass("rtl"),""!==o.prepend&&$("<div>").html(o.prepend).addClass("prepend").addClass(o.clsPrepend).appendTo(container)):(icon=$(o.dropIcon).addClass("icon").appendTo(container),caption.html(o.dropTitle).insertAfter(icon),files.html("0 "+o.filesTitle).insertAfter(caption));if(!(element[0].className="")===o.copyInlineStyles)for(var i=0,l=element[0].style.length;i<l;i++)container.css(element[0].style[i],element.css(element[0].style[i]));element.is(":disabled")?this.disable():this.enable()},_createEvents:function(){var element=this.element,o=this.options,container=element.closest("label"),caption=container.find(".caption"),files=container.find(".files");container.on(Metro.events.click,"button",function(){element.trigger("click")}),element.on(Metro.events.change,function(){var entry,file_names=[];0!==this.files.length&&(Array.from(this.files).forEach(function(file){file_names.push(file.name)}),"input"===o.mode?(entry=file_names.join(", "),caption.html(entry),caption.attr("title",entry)):files.html(element[0].files.length+" "+o.filesTitle),Utils.exec(o.onSelect,[this.files,element],element[0]))}),element.on(Metro.events.focus,function(){container.addClass("focused")}),element.on(Metro.events.blur,function(){container.removeClass("focused")}),"input"!==o.mode&&(container.on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault()}),container.on("dragenter dragover",function(){container.addClass("drop-on")}),container.on("dragleave",function(){container.removeClass("drop-on")}),container.on("drop",function(e){element[0].files=e.originalEvent.dataTransfer.files,files.html(element[0].files.length+" "+o.filesTitle),container.removeClass("drop-on"),element.trigger("change")}))},disable:function(){this.element.data("disabled",!0),this.element.parent().addClass("disabled")},enable:function(){this.element.data("disabled",!1),this.element.parent().removeClass("disabled")},toggleState:function(){this.elem.disabled?this.disable():this.enable()},toggleDir:function(){"rtl"===this.element.attr("dir")?this.element.parent().addClass("rtl"):this.element.parent().removeClass("rtl")},changeAttribute:function(attributeName){switch(attributeName){case"disabled":this.toggleState();break;case"dir":this.toggleDir()}},destroy:function(){var element=this.element,parent=element.parent();element.off(Metro.events.change),parent.off(Metro.events.click,"button"),element.insertBefore(parent),parent.remove()}};Metro.plugin("file",File);var Gravatar={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onGravatarCreate,[this.element]),this},options:{email:"",size:80,default:"404",onGravatarCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){this.get()},getImage:function(email,size,def,is_jquery_object){var image=$("<img>");return image.attr("src",this.getImageSrc(email,size)),!0===is_jquery_object?image:image[0]},getImageSrc:function(email,size,def){return void 0===email||""===email.trim()?"":(size=size||80,def=Utils.encodeURI(def)||"404","//www.gravatar.com/avatar/"+Utils.md5(email.toLowerCase().trim())+"?size="+size+"&d="+def)},get:function(){var element=this.element,o=this.options,img="IMG"===element[0].tagName?element:element.find("img");if(0!==img.length)return img.attr("src",this.getImageSrc(o.email,o.size,o.default)),this},resize:function(new_size){this.options.size=void 0!==new_size?new_size:this.element.attr("data-size"),this.get()},email:function(new_email){this.options.email=void 0!==new_email?new_email:this.element.attr("data-email"),this.get()},changeAttribute:function(attributeName){switch(attributeName){case"data-size":this.resize();break;case"data-email":this.email()}},destroy:function(){var element=this.element;"img"!==element[0].tagName.toLowerCase()&&element.html("")}};Metro.plugin("gravatar",Gravatar);var Hint={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.hint=null,this.hint_size={width:0,height:0},this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onHintCreate,[this.element]),this},options:{hintHide:5e3,clsHint:"",hintText:"",hintPosition:Metro.position.TOP,hintOffset:4,onHintCreate:Metro.noop,onHintShow:Metro.noop,onHintHide:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var that=this,element=this.element,o=this.options;element.on(Metro.events.enter+"-hint",function(){that.createHint(),0<o.hintHide&&setTimeout(function(){that.removeHint()},o.hintHide)}),element.on(Metro.events.leave+"-hint",function(){that.removeHint()}),$(window).on(Metro.events.scroll+"-hint",function(){null!==that.hint&&that.setPosition()})},createHint:function(){var elem=this.elem,element=this.element,o=this.options,hint=$("<div>").addClass("hint").addClass(o.clsHint).html(o.hintText);if(this.hint=hint,this.hint_size=Utils.hiddenElementSize(hint),$(".hint:not(.permanent-hint)").remove(),"TD"===elem.tagName||"TH"===elem.tagName){var wrp=$("<div/>").css("display","inline-block").html(element.html());element.html(wrp),element=wrp}this.setPosition(),hint.appendTo($("body")),Utils.exec(o.onHintShow,[hint,element])},setPosition:function(){var hint=this.hint,hint_size=this.hint_size,o=this.options,element=this.element;o.hintPosition===Metro.position.BOTTOM?(hint.addClass("bottom"),hint.css({top:element.offset().top-$(window).scrollTop()+element.outerHeight()+o.hintOffset,left:element.offset().left+element.outerWidth()/2-hint_size.width/2-$(window).scrollLeft()})):o.hintPosition===Metro.position.RIGHT?(hint.addClass("right"),hint.css({top:element.offset().top+element.outerHeight()/2-hint_size.height/2-$(window).scrollTop(),left:element.offset().left+element.outerWidth()-$(window).scrollLeft()+o.hintOffset})):o.hintPosition===Metro.position.LEFT?(hint.addClass("left"),hint.css({top:element.offset().top+element.outerHeight()/2-hint_size.height/2-$(window).scrollTop(),left:element.offset().left-hint_size.width-$(window).scrollLeft()-o.hintOffset})):(hint.addClass("top"),hint.css({top:element.offset().top-$(window).scrollTop()-hint_size.height-o.hintOffset,left:element.offset().left+element.outerWidth()/2-hint_size.width/2-$(window).scrollLeft()}))},removeHint:function(){var that=this,hint=this.hint,element=this.element,options=this.options,timeout=options.onHintHide===Metro.noop?0:300;null!==hint&&(Utils.exec(options.onHintHide,[hint,element]),setTimeout(function(){hint.hide(0,function(){hint.remove(),that.hint=null})},timeout))},changeText:function(){this.options.hintText=this.element.attr("data-hint-text")},changeAttribute:function(attributeName){switch(attributeName){case"data-hint-text":this.changeText()}},destroy:function(){this.elem;var element=this.element;this.options;this.removeHint(),element.off(Metro.events.enter+"-hint"),element.off(Metro.events.leave+"-hint"),$(window).off(Metro.events.scroll+"-hint")}};Metro.plugin("hint",Hint);var HtmlContainer={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this._setOptionsFromDOM(),this._create(),this},options:{htmlSource:null,insertMode:"replace",onLoad:Metro.noop,onFail:Metro.noop,onDone:Metro.noop,onHtmlContainerCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;Utils.isValue(o.htmlSource)&&this._load(),Utils.exec(o.onHtmlContainerCreate,[element],element[0])},_load:function(){var xhttp,html,element=this.element,elem=this.elem,o=this.options;html=o.htmlSource,(xhttp=new XMLHttpRequest).onreadystatechange=function(){if(4===this.readyState){if(404===this.status&&(elem.innerHTML="Page not found.",Utils.exec(o.onFail,[this],elem)),200===this.status){switch(o.insertMode.toLowerCase()){case"prepend":element.prepend(this.responseText);break;case"append":element.append(this.responseText);break;default:element.html(this.responseText)}Utils.exec(o.onLoad,[this.responseText],elem)}Utils.exec(o.onDone,[this],elem)}},xhttp.open("GET",html,!0),xhttp.send()},changeAttribute:function(attributeName){var attr,element=this.element,o=this.options;switch(attributeName){case"data-html-source":!function(){var html=element.attr("data-html-source");Utils.isNull(html)||(""===html.trim()&&element.html(""),o.htmlSource=html,this._load())}();break;case"data-insert-mode":attr=element.attr("data-insert-mode"),Utils.isValue(attr)&&(o.insertMode=attr)}},destroy:function(){}};Metro.plugin("htmlcontainer",HtmlContainer);var ImageMagnifier={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.zoomElement=null,this._setOptionsFromDOM(),this._create(),this},options:{width:"100%",height:"auto",lensSize:100,lensType:"square",magnifierZoom:2,magnifierMode:"glass",magnifierZoomElement:null,clsMagnifier:"",clsLens:"",clsZoom:"",onMagnifierMove:Metro.noop,onImageMagnifierCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createStructure(),this._createEvents(),Utils.exec(o.onCreate,[element])},_createStructure:function(){var magnifier,element_width,element_height,element=this.element,o=this.options,image=element.find("img");if(0===image.length)throw new Error("Image not defined");switch(Utils.isValue(element.attr("id"))||element.attr("id",Utils.elementId("image-magnifier")),element.addClass("image-magnifier").css({width:o.width}).addClass(o.clsMagnifier),element_width=element.width(),o.height){case"16/9":case"21/9":case"4/3":element_height=Utils.aspectRatioH(element_width,o.height);break;case"auto":element_height=Utils.aspectRatioH(element_width,"16/9");break;default:element_height=o.height}element.css({height:element_height});var x=element_width/2-o.lensSize/2,y=element_height/2-o.lensSize/2;if("glass"===o.magnifierMode)(magnifier=$("<div>").addClass("image-magnifier-glass").appendTo(element)).css({width:o.lensSize,height:o.lensSize,borderRadius:"circle"!==o.lensType?0:"50%",top:y,left:x,backgroundImage:"url("+image[0].src+")",backgroundRepeat:"no-repeat",backgroundPosition:"-"+(x*o.magnifierZoom-o.lensSize/4+4)+"px -"+(y*o.magnifierZoom-o.lensSize/4+4)+"px",backgroundSize:image[0].width*o.magnifierZoom+"px "+image[0].height*o.magnifierZoom+"px"}).addClass(o.clsLens);else{(magnifier=$("<div>").addClass("image-magnifier-glass").appendTo(element)).css({width:o.lensSize,height:o.lensSize,borderRadius:0,borderWidth:1,top:y,left:x}).addClass(o.clsLens),Utils.isValue(o.magnifierZoomElement)&&0!==$(o.magnifierZoomElement).length?this.zoomElement=$(o.magnifierZoomElement):this.zoomElement=$("<div>").insertAfter(element);var zoom_element_width=magnifier[0].offsetWidth*o.magnifierZoom,zoom_element_height=magnifier[0].offsetHeight*o.magnifierZoom,cx=zoom_element_width/o.lensSize,cy=zoom_element_height/o.lensSize;this.zoomElement.css({width:zoom_element_width,height:zoom_element_height,backgroundImage:"url("+image[0].src+")",backgroundRepeat:"no-repeat",backgroundPosition:"-"+x*cx+"px -"+y*cy+"px",backgroundSize:image[0].width*cx+"px "+image[0].height*cy+"px"}).addClass(o.clsZoom)}},_createEvents:function(){var cx,cy,element=this.element,o=this.options,glass=element.find(".image-magnifier-glass"),glass_size=glass[0].offsetWidth/2,image=element.find("img")[0],zoomElement=this.zoomElement;"glass"!==o.magnifierMode&&(cx=zoomElement[0].offsetWidth/glass_size/2,cy=zoomElement[0].offsetHeight/glass_size/2,zoomElement.css({backgroundSize:image.width*cx+"px "+image.height*cy+"px"}));var lens_move=function(pos){var x,y,zoom=parseInt(o.magnifierZoom);"glass"===o.magnifierMode?(x=pos.x,y=pos.y,x>image.width-glass_size/zoom&&(x=image.width-glass_size/zoom),x<glass_size/zoom&&(x=glass_size/zoom),y>image.height-glass_size/zoom&&(y=image.height-glass_size/zoom),y<glass_size/zoom&&(y=glass_size/zoom),glass.css({top:y-glass_size,left:x-glass_size,backgroundPosition:"-"+(x*zoom-glass_size+4)+"px -"+(y*zoom-glass_size+4)+"px"})):(x=pos.x-glass_size,y=pos.y-glass_size,x>image.width-2*glass_size&&(x=image.width-2*glass_size),x<0&&(x=0),y>image.height-2*glass_size&&(y=image.height-2*glass_size),y<0&&(y=0),glass.css({top:y,left:x}),zoomElement.css({backgroundPosition:"-"+x*cx+"px -"+y*cy+"px"}))};element.on(Metro.events.move,function(e){var pos=Utils.getCursorPosition(image,e);lens_move(pos),Utils.exec(o.onMagnifierMove,[pos,glass,zoomElement],element[0]),e.preventDefault()}),element.on(Metro.events.leave,function(){var x=element.width()/2-o.lensSize/2,y=element.height()/2-o.lensSize/2;glass.animate({top:y,left:x}),lens_move({x:x+o.lensSize/2,y:y+o.lensSize/2})})},changeAttribute:function(attributeName){},destroy:function(){}};Metro.plugin("imagemagnifier",ImageMagnifier);var InfoBox={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.overlay=null,this._setOptionsFromDOM(),this._create(),this},options:{type:"",width:480,height:"auto",overlay:!0,overlayColor:"#000000",overlayAlpha:.5,autoHide:0,removeOnClose:!1,closeButton:!0,clsBox:"",clsBoxContent:"",clsOverlay:"",onOpen:Metro.noop,onClose:Metro.noop,onInfoBoxCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createStructure(),this._createEvents(),Utils.exec(o.onInfoBoxCreate,[element],element[0])},_overlay:function(){this.element;var o=this.options,overlay=$("<div>");return overlay.addClass("overlay").addClass(o.clsOverlay),"transparent"===o.overlayColor?overlay.addClass("transparent"):overlay.css({background:Utils.hex2rgba(o.overlayColor,o.overlayAlpha)}),overlay},_createStructure:function(){var closer,content,element=this.element,o=this.options;!0===o.overlay&&(this.overlay=this._overlay()),void 0===element.attr("id")&&element.attr("id",Utils.elementId("infobox")),element.addClass("info-box").addClass(o.type).addClass(o.clsBox),0===(closer=element.find("closer")).length&&(closer=$("<span>").addClass("button square closer")).appendTo(element),!0!==o.closeButton&&closer.hide(),0<(content=element.find(".info-box-content")).length&&content.addClass(o.clsBoxContent),element.css({width:o.width,height:o.height,visibility:"hidden",top:"100%",left:($(window).width()-element.outerWidth())/2}),element.appendTo($("body"))},_createEvents:function(){var that=this,element=this.element;this.options;element.on(Metro.events.click,".closer",function(){that.close()}),element.on(Metro.events.click,".js-dialog-close",function(){that.close()}),$(window).on(Metro.events.resize+"_"+element.attr("id"),function(){that.reposition()})},_setPosition:function(){var element=this.element;element.css({top:($(window).height()-element.outerHeight())/2,left:($(window).width()-element.outerWidth())/2})},reposition:function(){this._setPosition()},setContent:function(c){var element=this.element,content=(this.options,element.find(".info-box-content"));0!==content.length&&(content.html(c),this.reposition())},setType:function(t){var element=this.element;this.options;element.removeClass("success info alert warning").addClass(t)},open:function(){var that=this,element=this.element,o=this.options;!0===o.overlay&&this.overlay.appendTo($("body")),this._setPosition(),element.css({visibility:"visible"}),Utils.exec(o.onOpen,[element],element[0]),element.data("open",!0),0<parseInt(o.autoHide)&&setTimeout(function(){that.close()},parseInt(o.autoHide))},close:function(){var element=this.element,o=this.options;!0===o.overlay&&$("body").find(".overlay").remove(),element.css({visibility:"hidden",top:"100%"}),Utils.exec(o.onClose,[element],element[0]),element.data("open",!1),!0===o.removeOnClose&&(this.destroy(),element.remove())},isOpen:function(){return!0===this.element.data("open")},changeAttribute:function(attributeName){},destroy:function(){var element=this.element;this.options;element.off(Metro.events.click,".closer"),element.off(Metro.events.click,".js-dialog-close"),$(window).off(Metro.events.resize+"_"+element.attr("id"))}};Metro.plugin("infobox",InfoBox);var Input={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.history=[],this.historyIndex=-1,this.autocomplete=[],this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onInputCreate,[this.element],this.elem),this},options:{autocomplete:null,autocompleteDivider:",",autocompleteListHeight:200,history:!(Metro.infobox={isInfoBox:function(el){return Utils.isMetroObject(el,"dialog")},open:function(el,c,t){if(!this.isInfoBox(el))return!1;var ib=$(el).data("infobox");void 0!==c&&ib.setContent(c),void 0!==t&&ib.setType(t),ib.open()},close:function(el){if(!this.isInfoBox(el))return!1;$(el).data("infobox").close()},setContent:function(el,c){if(!this.isInfoBox(el))return!1;void 0===c&&(c="");var ib=$(el).data("infobox");ib.setContent(c),ib.reposition()},setType:function(el,t){if(!this.isInfoBox(el))return!1;var ib=$(el).data("infobox");ib.setType(t),ib.reposition()},isOpen:function(el){return!!this.isInfoBox(el)&&$(el).data("infobox").isOpen()},create:function(c,t,o,open){var el,ib,box_type;box_type=void 0!==t?t:"",el=$("<div>").appendTo($("body")),$("<div>").addClass("info-box-content").appendTo(el);var ib_options=$.extend({},{removeOnClose:!0,type:box_type},void 0!==o?o:{});return el.infobox(ib_options),(ib=el.data("infobox")).setContent(c),!1!==open&&ib.open(),el}}),historyPreset:"",historyDivider:"|",preventSubmit:!1,defaultValue:"",size:"default",prepend:"",append:"",copyInlineStyles:!0,searchButton:!1,clearButton:!0,revealButton:!0,clearButtonIcon:"<span class='default-icon-cross'></span>",revealButtonIcon:"<span class='default-icon-eye'></span>",searchButtonIcon:"<span class='default-icon-search'></span>",customButtons:[],searchButtonClick:"submit",clsComponent:"",clsInput:"",clsPrepend:"",clsAppend:"",clsClearButton:"",clsRevealButton:"",clsCustomButton:"",clsSearchButton:"",onHistoryChange:Metro.noop,onHistoryUp:Metro.noop,onHistoryDown:Metro.noop,onClearClick:Metro.noop,onRevealClick:Metro.noop,onSearchButtonClick:Metro.noop,onEnterClick:Metro.noop,onInputCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){this._createStructure(),this._createEvents()},_createStructure:function(){var that=this,element=this.element,o=this.options,prev=element.prev(),parent=element.parent(),container=$("<div>").addClass("input "+element[0].className),buttons=$("<div>").addClass("button-group");(Utils.isValue(o.historyPreset)&&($.each(Utils.strToArray(o.historyPreset,o.historyDivider),function(){that.history.push(this)}),that.historyIndex=that.history.length-1),void 0===element.attr("type")&&element.attr("type","text"),0===prev.length?parent.prepend(container):container.insertAfter(prev),element.appendTo(container),buttons.appendTo(container),Utils.isValue(element.val().trim())||element.val(o.defaultValue),!0===o.clearButton&&$("<button>").addClass("button input-clear-button").addClass(o.clsClearButton).attr("tabindex",-1).attr("type","button").html(o.clearButtonIcon).appendTo(buttons),"password"===element.attr("type")&&!0===o.revealButton&&$("<button>").addClass("button input-reveal-button").addClass(o.clsRevealButton).attr("tabindex",-1).attr("type","button").html(o.revealButtonIcon).appendTo(buttons),!0===o.searchButton&&$("<button>").addClass("button input-search-button").addClass(o.clsSearchButton).attr("tabindex",-1).attr("type","submit"===o.searchButtonClick?"submit":"button").html(o.searchButtonIcon).appendTo(buttons),""!==o.prepend)&&$("<div>").html(o.prepend).addClass("prepend").addClass(o.clsPrepend).appendTo(container);""!==o.append&&$("<div>").html(o.append).addClass("append").addClass(o.clsAppend).appendTo(container);if("string"==typeof o.customButtons&&(o.customButtons=Utils.isObject(o.customButtons)),"object"==typeof o.customButtons&&0<Utils.objectLength(o.customButtons)&&$.each(o.customButtons,function(){var customButton=$("<button>");customButton.addClass("button input-custom-button").addClass(o.clsCustomButton).addClass(this.cls).attr("tabindex",-1).attr("type","button").html(this.html),customButton.data("action",this.onclick),customButton.appendTo(buttons)}),"rtl"===element.attr("dir")&&container.addClass("rtl").attr("dir","rtl"),!(element[0].className="")===o.copyInlineStyles)for(var i=0,l=element[0].style.length;i<l;i++)container.css(element[0].style[i],element.css(element[0].style[i]));if(container.addClass(o.clsComponent),element.addClass(o.clsInput),"default"!==o.size&&container.css({width:o.size}),!Utils.isNull(o.autocomplete)){var autocomplete_obj=Utils.isObject(o.autocomplete);!1!==autocomplete_obj?that.autocomplete=autocomplete_obj:this.autocomplete=Utils.strToArray(o.autocomplete,o.autocompleteDivider),$("<div>").addClass("autocomplete-list").css({maxHeight:o.autocompleteListHeight,display:"none"}).appendTo(container)}element.is(":disabled")?this.disable():this.enable()},_createEvents:function(){var that=this,element=this.element,o=this.options,container=element.closest(".input"),autocompleteList=container.find(".autocomplete-list");container.on(Metro.events.click,".input-clear-button",function(){var curr=element.val();element.val(Utils.isValue(o.defaultValue)?o.defaultValue:"").trigger("change").trigger("keyup").focus(),0<autocompleteList.length&&autocompleteList.css({display:"none"}),Utils.exec(o.onClearClick,[curr,element.val()],element[0])}),container.on(Metro.events.start,".input-reveal-button",function(){element.attr("type","text"),Utils.exec(o.onRevealClick,[element.val()],element[0])}),container.on(Metro.events.start,".input-search-button",function(){"submit"!==o.searchButtonClick?Utils.exec(o.onSearchButtonClick,[element.val(),$(this)],element[0]):this.form.submit()}),container.on(Metro.events.stop,".input-reveal-button",function(){element.attr("type","password").focus()}),container.on(Metro.events.stop,".input-custom-button",function(){var button=$(this),action=button.data("action");Utils.exec(action,[element.val(),button],this)}),element.on(Metro.events.keyup,function(e){var val=element.val().trim();o.history&&e.keyCode===Metro.keyCode.ENTER&&""!==val&&(element.val(""),that.history.push(val),that.historyIndex=that.history.length-1,Utils.exec(o.onHistoryChange,[val,that.history,that.historyIndex],element[0]),!0===o.preventSubmit&&e.preventDefault()),o.history&&e.keyCode===Metro.keyCode.UP_ARROW&&(that.historyIndex--,0<=that.historyIndex?(element.val(""),element.val(that.history[that.historyIndex]),Utils.exec(o.onHistoryDown,[element.val(),that.history,that.historyIndex],element[0])):that.historyIndex=0,e.preventDefault()),o.history&&e.keyCode===Metro.keyCode.DOWN_ARROW&&(that.historyIndex++,that.historyIndex<that.history.length?(element.val(""),element.val(that.history[that.historyIndex]),Utils.exec(o.onHistoryUp,[element.val(),that.history,that.historyIndex],element[0])):that.historyIndex=that.history.length-1,e.preventDefault())}),element.on(Metro.events.keydown,function(e){e.keyCode===Metro.keyCode.ENTER&&Utils.exec(o.onEnterClick,[element.val()],element[0])}),element.on(Metro.events.blur,function(){container.removeClass("focused")}),element.on(Metro.events.focus,function(){container.addClass("focused")}),element.on(Metro.events.input,function(){var items,val=this.value.toLowerCase();0!==autocompleteList.length&&(autocompleteList.html(""),items=that.autocomplete.filter(function(item){return-1<item.toLowerCase().indexOf(val)}),autocompleteList.css({display:0<items.length?"block":"none"}),$.each(items,function(i,v){var html,index=v.toLowerCase().indexOf(val),item=$("<div>").addClass("item").attr("data-autocomplete-value",v);html=0===index?"<strong>"+v.substr(0,val.length)+"</strong>"+v.substr(val.length):v.substr(0,index)+"<strong>"+v.substr(index,val.length)+"</strong>"+v.substr(index+val.length),item.html(html).appendTo(autocompleteList)}))}),container.on(Metro.events.click,".autocomplete-list .item",function(){element.val($(this).attr("data-autocomplete-value")),autocompleteList.css({display:"none"}),element.trigger("change")})},getHistory:function(){return this.history},getHistoryIndex:function(){return this.historyIndex},setHistoryIndex:function(val){this.historyIndex=val>=this.history.length?this.history.length-1:val},setHistory:function(history,append){var that=this,o=this.options;Utils.isNull(history)||(Array.isArray(history)||(history=Utils.strToArray(history,o.historyDivider)),!0===append?$.each(history,function(){that.history.push(this)}):this.history=history,this.historyIndex=this.history.length-1)},clear:function(){this.element.val("")},toDefault:function(){this.element.val(Utils.isValue(this.options.defaultValue)?this.options.defaultValue:"")},disable:function(){this.element.data("disabled",!0),this.element.parent().addClass("disabled")},enable:function(){this.element.data("disabled",!1),this.element.parent().removeClass("disabled")},toggleState:function(){this.elem.disabled?this.disable():this.enable()},changeAttribute:function(attributeName){switch(attributeName){case"disabled":this.toggleState()}},destroy:function(){var element=this.element,parent=element.parent(),clearBtn=parent.find(".input-clear-button"),revealBtn=parent.find(".input-reveal-button"),customBtn=parent.find(".input-custom-button");0<clearBtn.length&&clearBtn.off(Metro.events.click),0<revealBtn.length&&(revealBtn.off(Metro.events.start),revealBtn.off(Metro.events.stop)),0<customBtn.length&&clearBtn.off(Metro.events.click),element.off(Metro.events.blur),element.off(Metro.events.focus),element.insertBefore(parent),parent.remove()}};Metro.plugin("input",Input),$(document).on(Metro.events.click,function(e){$(".input .autocomplete-list").hide()});var MaterialInput={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.history=[],this.historyIndex=-1,this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onInputCreate,[this.element],this.elem),this},options:{label:"",informer:"",icon:"",permanentLabel:!1,clsComponent:"",clsInput:"",clsLabel:"",clsInformer:"",clsIcon:"",clsLine:"",onInputCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){this._createStructure(),this._createEvents()},_createStructure:function(){var element=this.element,o=this.options,container=$("<div>").addClass("input-material "+element[0].className);element[0].className="",element.attr("autocomplete","nope"),void 0===element.attr("type")&&element.attr("type","text"),container.insertBefore(element),element.appendTo(container),Utils.isValue(o.label)&&$("<span>").html(o.label).addClass("label").addClass(o.clsLabel).insertAfter(element),Utils.isValue(o.informer)&&$("<span>").html(o.informer).addClass("informer").addClass(o.clsInformer).insertAfter(element),Utils.isValue(o.icon)&&(container.addClass("with-icon"),$("<span>").html(o.icon).addClass("icon").addClass(o.clsIcon).insertAfter(element)),container.append($("<hr>").addClass(o.clsLine)),!0===o.permanentLabel&&container.addClass("permanent-label"),container.addClass(o.clsComponent),element.addClass(o.clsInput),element.is(":disabled")?this.disable():this.enable()},_createEvents:function(){},clear:function(){this.element.val("")},disable:function(){this.element.data("disabled",!0),this.element.parent().addClass("disabled")},enable:function(){this.element.data("disabled",!1),this.element.parent().removeClass("disabled")},toggleState:function(){this.elem.disabled?this.disable():this.enable()},changeAttribute:function(attributeName){switch(attributeName){case"disabled":this.toggleState()}},destroy:function(){var element=this.element,parent=element.parent();element.insertBefore(parent),parent.remove()}};Metro.plugin("materialinput",MaterialInput);var Keypad={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.value="",this.positions=["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"],this.keypad=null,this._setOptionsFromDOM(),this.keys=Utils.strToArray(this.options.keys,","),this.keys_to_work=this.keys,this._create(),this},options:{keySize:32,keys:"1, 2, 3, 4, 5, 6, 7, 8, 9, 0",copyInlineStyles:!1,target:null,length:0,shuffle:!1,shuffleCount:3,position:Metro.position.BOTTOM_LEFT,dynamicPosition:!1,serviceButtons:!0,showValue:!0,open:!1,sizeAsKeys:!1,clsKeypad:"",clsInput:"",clsKeys:"",clsKey:"",clsServiceKey:"",clsBackspace:"",clsClear:"",onChange:Metro.noop,onClear:Metro.noop,onBackspace:Metro.noop,onShuffle:Metro.noop,onKey:Metro.noop,onKeypadCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){this._createKeypad(),!0===this.options.shuffle&&this.shuffle(),this._createKeys(),this._createEvents(),Utils.exec(this.options.onKeypadCreate,[this.element])},_createKeypad:function(){var keypad,keys,element=this.element,o=this.options,prev=element.prev(),parent=element.parent();if((keypad=parent.hasClass("input")?parent:$("<div>").addClass("input").addClass(element[0].className)).addClass("keypad"),"static"!==keypad.css("position")&&""!==keypad.css("position")||keypad.css({position:"relative"}),void 0===element.attr("type")&&element.attr("type","text"),0===prev.length?parent.prepend(keypad):keypad.insertAfter(prev),element.attr("readonly",!0),element.appendTo(keypad),(keys=$("<div>").addClass("keys").addClass(o.clsKeys)).appendTo(keypad),this._setKeysPosition(),!0===o.open&&keys.addClass("open keep-open"),!(element[0].className="")===o.copyInlineStyles)for(var i=0,l=element[0].style.length;i<l;i++)keypad.css(element[0].style[i],element.css(element[0].style[i]));element.addClass(o.clsInput),keypad.addClass(o.clsKeypad),element.on(Metro.events.blur,function(){keypad.removeClass("focused")}),element.on(Metro.events.focus,function(){keypad.addClass("focused")}),!0===o.disabled||element.is(":disabled")?this.disable():this.enable(),this.keypad=keypad},_setKeysPosition:function(){var element=this.element,o=this.options;element.parent().find(".keys").removeClass(this.positions.join(" ")).addClass(o.position)},_createKeys:function(){var key,element=this.element,o=this.options,keypad=element.parent(),factor=Math.round(Math.sqrt(this.keys.length+2)),width=factor*o.keySize+4*factor,keys=keypad.find(".keys");if(keys.html(""),$.each(this.keys_to_work,function(){(key=$("<span>").addClass("key").addClass(o.clsKey).html(this)).data("key",this),key.css({width:o.keySize,height:o.keySize,lineHeight:o.keySize-4+"px"}).appendTo(keys)}),!0===o.serviceButtons){$.each(["&larr;","&times;"],function(){key=$("<span>").addClass("key service-key").addClass(o.clsKey).addClass(o.clsServiceKey).html(this),"&larr;"===this&&key.addClass(o.clsBackspace),"&times;"===this&&key.addClass(o.clsClear),key.data("key",this),key.css({width:o.keySize,height:o.keySize,lineHeight:o.keySize-4+"px"}).appendTo(keys)})}keys.width(width),!0===o.sizeAsKeys&&-1!==["top-left","top","top-right","bottom-left","bottom","bottom-right"].indexOf(o.position)&&keypad.outerWidth(keys.outerWidth())},_createEvents:function(){var that=this,element=this.element,o=this.options,keypad=element.parent(),keys=keypad.find(".keys");keypad.on(Metro.events.click,".keys",function(e){e.preventDefault(),e.stopPropagation()}),keypad.on(Metro.events.click,function(e){!0!==o.open&&(!0===keys.hasClass("open")?keys.removeClass("open"):keys.addClass("open"),e.preventDefault(),e.stopPropagation())}),keypad.on(Metro.events.click,".key",function(e){var key=$(this);if("&larr;"!==key.data("key")&&"&times;"!==key.data("key")){if(0<o.length&&String(that.value).length===o.length)return!1;that.value=that.value+""+key.data("key"),!0===o.shuffle&&(that.shuffle(),that._createKeys()),!0===o.dynamicPosition&&(o.position=that.positions[Utils.random(0,that.positions.length-1)],that._setKeysPosition()),Utils.exec(o.onKey,[key.data("key"),that.value,element])}else"&times;"===key.data("key")&&(that.value="",Utils.exec(o.onClear,[element])),"&larr;"===key.data("key")&&(that.value=that.value.substring(0,that.value.length-1),Utils.exec(o.onBackspace,[that.value,element]));!0===o.showValue&&("INPUT"===element[0].tagName?element.val(that.value):element.text(that.value)),element.trigger("change"),Utils.exec(o.onChange,[that.value,element]),e.preventDefault(),e.stopPropagation()}),null!==o.target&&element.on(Metro.events.change,function(){var t=$(o.target);0!==t.length&&("INPUT"===t[0].tagName?t.val(that.value):t.text(that.value))})},shuffle:function(){for(var i=0;i<this.options.shuffleCount;i++)this.keys_to_work=this.keys_to_work.shuffle();Utils.exec(this.options.onShuffle,[this.keys_to_work,this.keys,this.element])},shuffleKeys:function(count){void 0===count&&(count=this.options.shuffleCount);for(var i=0;i<count;i++)this.keys_to_work=this.keys_to_work.shuffle();this._createKeys()},val:function(v){if(void 0===v)return this.value;this.value=v,"INPUT"===this.element[0].tagName?this.element.val(v):this.element.text(v)},open:function(){this.element.parent().find(".keys").addClass("open")},close:function(){this.element.parent().find(".keys").removeClass("open")},disable:function(){this.element.data("disabled",!0),this.element.parent().addClass("disabled")},enable:function(){this.element.data("disabled",!1),this.element.parent().removeClass("disabled")},toggleState:function(){this.elem.disabled?this.disable():this.enable()},setPosition:function(pos){var new_position=void 0!==pos?pos:this.element.attr("data-position");-1!==this.positions.indexOf(new_position)&&(this.options.position=new_position,this._setKeysPosition())},changeAttribute:function(attributeName){switch(attributeName){case"disabled":this.toggleState();break;case"data-position":this.setPosition()}},destroy:function(){var element=this.element,keypad=this.keypad;keypad.off(Metro.events.click,".keys"),keypad.off(Metro.events.click),keypad.off(Metro.events.click,".key"),element.off(Metro.events.change),element.insertBefore(keypad),keypad.remove()}};Metro.plugin("keypad",Keypad),$(document).on(Metro.events.click,function(){var keypads=$(".keypad .keys");$.each(keypads,function(){$(this).hasClass("keep-open")||$(this).removeClass("open")})});var List={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.currentPage=1,this.pagesCount=1,this.filterString="",this.data=null,this.activity=null,this.busy=!1,this.filters=[],this.wrapperInfo=null,this.wrapperSearch=null,this.wrapperRows=null,this.wrapperPagination=null,this.filterIndex=null,this.filtersIndexes=[],this.sort={dir:"asc",colIndex:0},this.header=null,this.items=[],this._setOptionsFromDOM(),this._create(),this},options:{thousandSeparator:",",decimalSeparator:",",sortTarget:"li",sortClass:null,sortDir:"asc",sortInitial:!1,filterClass:null,filter:null,filterString:"",filters:null,source:null,showItemsSteps:!1,showSearch:!1,showListInfo:!1,showPagination:!1,showAllPages:!1,showActivity:!0,muteList:!0,items:-1,itemsSteps:"all, 10,25,50,100",itemsAllTitle:"Show all",listItemsCountTitle:"Show entries:",listSearchTitle:"Search:",listInfoTitle:"Showing $1 to $2 of $3 entries",paginationPrevTitle:"Prev",paginationNextTitle:"Next",activityType:"cycle",activityStyle:"color",activityTimeout:100,searchWrapper:null,rowsWrapper:null,infoWrapper:null,paginationWrapper:null,clsComponent:"",clsList:"",clsListItem:"",clsListTop:"",clsItemsCount:"",clsSearch:"",clsListBottom:"",clsListInfo:"",clsListPagination:"",clsPagination:"",onDraw:Metro.noop,onDrawItem:Metro.noop,onSortStart:Metro.noop,onSortStop:Metro.noop,onSortItemSwitch:Metro.noop,onSearch:Metro.noop,onRowsCountChange:Metro.noop,onDataLoad:Metro.noop,onDataLoaded:Metro.noop,onFilterItemAccepted:Metro.noop,onFilterItemDeclined:Metro.noop,onListCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var that=this,element=this.element,o=this.options;null!==o.source?(Utils.exec(o.onDataLoad,[o.source],element[0]),$.get(o.source,function(data){that._build(data),Utils.exec(o.onDataLoaded,[o.source,data],element[0])}).fail(function(jqXHR,textStatus,errorThrown){console.log(textStatus),console.log(jqXHR),console.log(errorThrown)})):that._build()},_build:function(data){var element=this.element,o=this.options;Utils.isValue(data)?this._createItemsFromJSON(data):this._createItemsFromHTML(),this._createStructure(),this._createEvents(),Utils.exec(o.onListCreate,[element],element[0])},_createItemsFromHTML:function(){var that=this,element=this.element,o=this.options;this.items=[],$.each(element.children(o.sortTarget),function(){that.items.push(this)})},_createItemsFromJSON:function(source){var that=this;this.items=[],Utils.isValue(source.header)&&(that.header=source.header),Utils.isValue(source.data)&&$.each(source.data,function(){var li=document.createElement("li"),inner=Utils.isValue(that.header.template)?that.header.template:"";$.each(this,function(k,v){inner=inner.replace("$"+k,v)}),li.innerHTML=inner,that.items.push(li)})},_createTopBlock:function(){var search_block,rows_block,rows_select,that=this,element=this.element,o=this.options,top_block=$("<div>").addClass("list-top").addClass(o.clsListTop).insertBefore(element);return search_block=Utils.isValue(this.wrapperSearch)?this.wrapperSearch:$("<div>").addClass("list-search-block").addClass(o.clsSearch).appendTo(top_block),$("<input>").attr("type","text").appendTo(search_block).input({prepend:o.listSearchTitle}),!0!==o.showSearch&&search_block.hide(),rows_block=Utils.isValue(this.wrapperRows)?this.wrapperRows:$("<div>").addClass("list-rows-block").addClass(o.clsItemsCount).appendTo(top_block),rows_select=$("<select>").appendTo(rows_block),$.each(Utils.strToArray(o.itemsSteps),function(){var option=$("<option>").attr("value","all"===this?-1:this).text("all"===this?o.itemsAllTitle:this).appendTo(rows_select);parseInt(this)===parseInt(o.items)&&option.attr("selected","selected")}),rows_select.select({filter:!1,prepend:o.listItemsCountTitle,onChange:function(val){parseInt(val)!==parseInt(o.items)&&(o.items=parseInt(val),that.currentPage=1,that._draw(),Utils.exec(o.onRowsCountChange,[val],element[0]))}}),!0!==o.showItemsSteps&&rows_block.hide(),top_block},_createBottomBlock:function(){var info,pagination,element=this.element,o=this.options,bottom_block=$("<div>").addClass("list-bottom").addClass(o.clsListBottom).insertAfter(element);return info=$("<div>").addClass("list-info").addClass(o.clsListInfo).appendTo(bottom_block),!0!==o.showListInfo&&info.hide(),pagination=$("<div>").addClass("list-pagination").addClass(o.clsListPagination).appendTo(bottom_block),!0!==o.showPagination&&pagination.hide(),bottom_block},_createStructure:function(){var list_component,filter_func,that=this,element=this.element,o=this.options,w_search=$(o.searchWrapper),w_info=$(o.infoWrapper),w_rows=$(o.rowsWrapper),w_paging=$(o.paginationWrapper);0<w_search.length&&(this.wrapperSearch=w_search),0<w_info.length&&(this.wrapperInfo=w_info),0<w_rows.length&&(this.wrapperRows=w_rows),0<w_paging.length&&(this.wrapperPagination=w_paging),element.parent().hasClass("list-component")?list_component=element.parent():(list_component=$("<div>").addClass("list-component").insertBefore(element),element.appendTo(list_component)),list_component.addClass(o.clsComponent),this.activity=$("<div>").addClass("list-progress").appendTo(list_component),$("<div>").activity({type:o.activityType,style:o.activityStyle}).appendTo(this.activity),!0!==o.showActivity&&this.activity.css({visibility:"hidden"}),element.addClass(o.clsList),this._createTopBlock(),this._createBottomBlock(),Utils.isValue(o.filterString)&&(this.filterString=o.filterString),Utils.isValue(o.filter)&&(!1===(filter_func=Utils.isFunc(o.filter))&&(filter_func=Utils.func(o.filter)),that.filterIndex=that.addFilter(filter_func)),Utils.isValue(o.filters)&&$.each(Utils.strToArray(o.filters),function(){!1!==(filter_func=Utils.isFunc(this))&&that.filtersIndexes.push(that.addFilter(filter_func))}),this.currentPage=1,this.sorting(o.sortClass,o.sortDir,!0)},_createEvents:function(){var customSearch,that=this,component=this.element.parent();function pageLinkClick(l){var link=$(l),item=link.parent();item.hasClass("active")||(item.hasClass("service")?"prev"===link.data("page")?(that.currentPage--,0===that.currentPage&&(that.currentPage=1)):(that.currentPage++,that.currentPage>that.pagesCount&&(that.currentPage=that.pagesCount)):that.currentPage=link.data("page"),that._draw())}component.find(".list-search-block input").on(Metro.events.inputchange,function(){that.filterString=this.value.trim().toLowerCase(),":"!==that.filterString[that.filterString.length-1]&&(that.currentPage=1,that._draw())}),Utils.isValue(this.wrapperSearch)&&0<(customSearch=this.wrapperSearch.find("input")).length&&customSearch.on(Metro.events.inputchange,function(){that.filterString=this.value.trim().toLowerCase(),":"!==that.filterString[that.filterString.length-1]&&(that.currentPage=1,that._draw())}),component.on(Metro.events.click,".pagination .page-link",function(){pageLinkClick(this)}),Utils.isValue(this.wrapperPagination)&&this.wrapperPagination.on(Metro.events.click,".pagination .page-link",function(){pageLinkClick(this)})},_info:function(start,stop,length){var text,element=this.element,o=this.options,component=element.parent(),info=Utils.isValue(this.wrapperInfo)?this.wrapperInfo:component.find(".list-info");0!==info.length&&(length<stop&&(stop=length),0===this.items.length&&(start=stop=length=0),text=(text=(text=(text=o.listInfoTitle).replace("$1",start)).replace("$2",stop)).replace("$3",length),info.html(text))},_paging:function(length){var i,prev,next,pagination,element=this.element,o=this.options,component=element.parent(),pagination_wrapper=Utils.isValue(this.wrapperPagination)?this.wrapperPagination:component.find(".list-pagination");if(pagination_wrapper.html(""),pagination=$("<ul>").addClass("pagination").addClass(o.clsPagination).appendTo(pagination_wrapper),0!==this.items.length){this.pagesCount=Math.ceil(length/o.items);var add_item=function(item_title,item_type,data){var li,a;return li=$("<li>").addClass("page-item").addClass(item_type),(a=$("<a>").addClass("page-link").html(item_title)).data("page",data),a.appendTo(li),li};if(prev=add_item(o.paginationPrevTitle,"service prev-page","prev"),pagination.append(prev),pagination.append(add_item(1,1===this.currentPage?"active":"",1)),!0===o.showAllPages||this.pagesCount<=7)for(i=2;i<this.pagesCount;i++)pagination.append(add_item(i,i===this.currentPage?"active":"",i));else if(this.currentPage<5){for(i=2;i<=5;i++)pagination.append(add_item(i,i===this.currentPage?"active":"",i));5<this.pagesCount&&pagination.append(add_item("...","no-link",null))}else if(this.currentPage<=this.pagesCount&&this.currentPage>this.pagesCount-5+1)for(5<this.pagesCount&&pagination.append(add_item("...","no-link",null)),i=this.pagesCount-5+1;i<this.pagesCount;i++)pagination.append(add_item(i,i===this.currentPage?"active":"",i));else pagination.append(add_item("...","no-link",null)),pagination.append(add_item(this.currentPage-1,"",this.currentPage-1)),pagination.append(add_item(this.currentPage,"active",this.currentPage)),pagination.append(add_item(this.currentPage+1,"",this.currentPage+1)),pagination.append(add_item("...","no-link",null));(1<this.pagesCount||this.currentPage<this.pagesCount)&&pagination.append(add_item(this.pagesCount,this.currentPage===this.pagesCount?"active":"",this.pagesCount)),next=add_item(o.paginationNextTitle,"service next-page","next"),pagination.append(next),1===this.currentPage&&prev.addClass("disabled"),this.currentPage===this.pagesCount&&next.addClass("disabled")}},_filter:function(){var items,i,data,inset,c1,result,that=this,element=this.element,o=this.options;return Utils.isValue(this.filterString)||0<this.filters.length?(items=this.items.filter(function(item){if(data="",Utils.isValue(o.filterClass)){if(0<(inset=item.getElementsByClassName(o.filterClass)).length)for(i=0;i<inset.length;i++)data+=inset[i].textContent}else data=item.textContent;if(c1=data.replace(/[\n\r]+|[\s]{2,}/g," ").trim().toLowerCase(),!0===(result=!Utils.isValue(that.filterString)||-1<c1.indexOf(that.filterString))&&0<that.filters.length)for(i=0;i<that.filters.length;i++)if(!0!==Utils.exec(that.filters[i],[item])){result=!1;break}return result?Utils.exec(o.onFilterItemAccepted,[item],element[0]):Utils.exec(o.onFilterItemDeclined,[item],element[0]),result}),Utils.exec(o.onSearch,[that.filterString,items],element[0])):items=this.items,items},_draw:function(cb){var i,items,element=this.element,o=this.options,start=-1===o.items?0:o.items*(this.currentPage-1),stop=-1===o.items?this.items.length-1:start+o.items-1;for(items=this._filter(),element.children(o.sortTarget).remove(),i=start;i<=stop;i++)Utils.isValue(items[i])&&$(items[i]).addClass(o.clsListItem).appendTo(element),Utils.exec(o.onDrawItem,[items[i]],element[0]);this._info(start+1,stop+1,items.length),this._paging(items.length),this.activity.hide(),Utils.exec(o.onDraw,[element],element[0]),void 0!==cb&&Utils.exec(cb,[element],element[0])},_getItemContent:function(item){var i,inset,data,format,o=this.options,$item=$(item),formatMask=Utils.isValue($item.data("formatMask"))?$item.data("formatMask"):null;if(Utils.isValue(o.sortClass)){if(data="",0<(inset=$(item).find("."+o.sortClass)).length)for(i=0;i<inset.length;i++)data+=inset[i].textContent;format=0<inset.length?inset[0].getAttribute("data-format"):""}else data=item.textContent,format=item.getAttribute("data-format");if(data=(""+data).toLowerCase().replace(/[\n\r]+|[\s]{2,}/g," ").trim(),Utils.isValue(format))switch(-1===["number","int","integer","float","money"].indexOf(format)||","===o.thousandSeparator&&"."===o.decimalSeparator||(data=Utils.parseNumber(data,o.thousandSeparator,o.decimalSeparator)),format){case"date":data=Utils.isValue(formatMask)?data.toDate(formatMask):new Date(data);break;case"number":data=Number(data);break;case"int":case"integer":data=parseInt(data);break;case"float":data=parseFloat(data);break;case"money":data=Utils.parseMoney(data);break;case"card":data=Utils.parseCard(data);break;case"phone":data=Utils.parsePhone(data)}return data},deleteItem:function(value){var i,item,deleteIndexes=[],is_func=Utils.isFunc(value);for(i=0;i<this.items.length;i++)item=this.items[i],is_func?Utils.exec(value,[item])&&deleteIndexes.push(i):item.textContent.contains(value)&&deleteIndexes.push(i);return this.items=Utils.arrayDeleteByMultipleKeys(this.items,deleteIndexes),this},draw:function(){return this._draw()},sorting:function(source,dir,redraw){var that=this,element=this.element,o=this.options;return Utils.isValue(source)&&(o.sortClass=source),Utils.isValue(dir)&&-1<["asc","desc"].indexOf(dir)&&(o.sortDir=dir),Utils.exec(o.onSortStart,[this.items],element[0]),this.items.sort(function(a,b){var c1=that._getItemContent(a),c2=that._getItemContent(b),result=0;return c1<c2&&(result="asc"===o.sortDir?-1:1),c2<c1&&(result="asc"===o.sortDir?1:-1),0!==result&&Utils.exec(o.onSortItemSwitch,[a,b,result],element[0]),result}),Utils.exec(o.onSortStop,[this.items],element[0]),!0===redraw&&this._draw(),this},filter:function(val){this.filterString=val.trim().toLowerCase(),this.currentPage=1,this._draw()},loadData:function(source){var that=this,element=this.element,o=this.options;!0===Utils.isValue(source)&&(o.source=source,Utils.exec(o.onDataLoad,[o.source],element[0]),$.get(o.source,function(data){var filter_func;Utils.exec(o.onDataLoaded,[o.source,data],element[0]),that._createItemsFromJSON(data),element.html(""),Utils.isValue(o.filterString)&&(that.filterString=o.filterString),Utils.isValue(o.filter)&&(!1===(filter_func=Utils.isFunc(o.filter))&&(filter_func=Utils.func(o.filter)),that.filterIndex=that.addFilter(filter_func)),Utils.isValue(o.filters)&&$.each(Utils.strToArray(o.filters),function(){!1!==(filter_func=Utils.isFunc(this))&&that.filtersIndexes.push(that.addFilter(filter_func))}),that.currentPage=1,that.sorting(o.sortClass,o.sortDir,!0)}).fail(function(jqXHR,textStatus,errorThrown){console.log(textStatus),console.log(jqXHR),console.log(errorThrown)}))},next:function(){0!==this.items.length&&(this.currentPage++,this.currentPage>this.pagesCount?this.currentPage=this.pagesCount:this._draw())},prev:function(){0!==this.items.length&&(this.currentPage--,0!==this.currentPage?this._draw():this.currentPage=1)},first:function(){0!==this.items.length&&(this.currentPage=1,this._draw())},last:function(){0!==this.items.length&&(this.currentPage=this.pagesCount,this._draw())},page:function(num){num<=0&&(num=1),num>this.pagesCount&&(num=this.pagesCount),this.currentPage=num,this._draw()},addFilter:function(f,redraw){var func=Utils.isFunc(f);if(!1!==func)return this.filters.push(func),!0===redraw&&(this.currentPage=1,this.draw()),this.filters.length-1},removeFilter:function(key,redraw){return Utils.arrayDeleteByKey(this.filters,key),!0===redraw&&(this.currentPage=1,this.draw()),this},removeFilters:function(redraw){this.filters=[],!0===redraw&&(this.currentPage=1,this.draw())},getFilters:function(){return this.filters},getFilterIndex:function(){return this.filterIndex},getFiltersIndexes:function(){return this.filtersIndexes},changeAttribute:function(attributeName){var filter,dir,that=this,element=this.element,o=this.options;switch(attributeName){case"data-sort-dir":dir=element.attr("data-sort-dir"),Utils.isValue(dir)&&(o.sortDir=dir,that.sorting(o.sortClass,o.sortDir,!0));break;case"data-sort-source":!function(){var target=element.attr("data-sort-source");Utils.isValue(target)&&(o.sortClass=target,that.sorting(o.sortClass,o.sortDir,!0))}();break;case"data-filter-string":filter=element.attr("data-filter-string"),Utils.isValue(target)&&(o.filterString=filter,that.filter(o.filterString))}},destroy:function(){}};Metro.plugin("list",List);var Listview={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this._setOptionsFromDOM(),this._create(),this},options:{selectable:!1,checkStyle:1,effect:"slide",duration:100,view:Metro.listView.LIST,selectCurrent:!0,structure:{},onNodeInsert:Metro.noop,onNodeDelete:Metro.noop,onNodeClean:Metro.noop,onCollapseNode:Metro.noop,onExpandNode:Metro.noop,onGroupNodeClick:Metro.noop,onNodeClick:Metro.noop,onListviewCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createView(),this._createEvents(),Utils.exec(o.onListviewCreate,[element])},_createIcon:function(data){var icon,src;return src=Utils.isTag(data)?$(data):$("<img>").attr("src",data),(icon=$("<span>").addClass("icon")).html(src),icon},_createCaption:function(data){return $("<div>").addClass("caption").html(data)},_createContent:function(data){return $("<div>").addClass("content").html(data)},_createToggle:function(){return $("<span>").addClass("node-toggle")},_createNode:function(data){var node,o=this.options;if(node=$("<li>"),void 0!==data.caption||void 0!==data.content){var d=$("<div>").addClass("data");node.prepend(d),void 0!==data.caption&&d.append(this._createCaption(data.caption)),void 0!==data.content&&d.append(this._createContent(data.content))}return void 0!==data.icon&&node.prepend(this._createIcon(data.icon)),0<Utils.objectLength(o.structure)&&$.each(o.structure,function(key,val){void 0!==data[key]&&$("<div>").addClass("node-data item-data-"+key).addClass(data[val]).html(data[key]).appendTo(node)}),node},_createView:function(){var that=this,element=this.element,o=this.options,nodes=element.find("li"),struct_length=Utils.objectLength(o.structure);element.addClass("listview"),element.find("ul").addClass("listview"),$.each(nodes,function(){var node=$(this);if(void 0!==node.data("caption")||void 0!==node.data("content")){var data=$("<div>").addClass("data");node.prepend(data),void 0!==node.data("caption")&&data.append(that._createCaption(node.data("caption"))),void 0!==node.data("content")&&data.append(that._createContent(node.data("content")))}if(void 0!==node.data("icon")&&node.prepend(that._createIcon(node.data("icon"))),0<node.children("ul").length?(node.addClass("node-group"),node.append(that._createToggle()),!0!==node.data("collapsed")&&node.addClass("expanded")):node.addClass("node"),node.hasClass("node")){var cb=$("<input type='checkbox' data-role='checkbox' data-style='"+o.checkStyle+"'>");cb.data("node",node),node.prepend(cb)}0<struct_length&&$.each(o.structure,function(key){void 0!==node.data(key)&&$("<div>").addClass("node-data item-data-"+key).addClass(node.data(key)).html(node.data(key)).appendTo(node)})}),this.toggleSelectable(),this.view(o.view)},_createEvents:function(){var that=this,element=this.element,o=this.options;element.on(Metro.events.click,".node",function(){var node=$(this);element.find(".node").removeClass("current"),node.toggleClass("current"),!0===o.selectCurrent&&(element.find(".node").removeClass("current-select"),node.toggleClass("current-select")),Utils.exec(o.onNodeClick,[node,element])}),element.on(Metro.events.click,".node-toggle",function(){var node=$(this).closest("li");that.toggleNode(node)}),element.on(Metro.events.click,".node-group > .data > .caption",function(){var node=$(this).closest("li");element.find(".node-group").removeClass("current-group"),node.addClass("current-group"),Utils.exec(o.onGroupNodeClick,[node,element])}),element.on(Metro.events.dblclick,".node-group > .data > .caption",function(){var node=$(this).closest("li");that.toggleNode(node)})},view:function(v){var element=this.element,o=this.options;if(void 0===v)return o.view;o.view=v,$.each(Metro.listView,function(i,v){element.removeClass("view-"+v),element.find("ul").removeClass("view-"+v)}),element.addClass("view-"+o.view),element.find("ul").addClass("view-"+o.view)},toggleNode:function(node){var func,element=this.element,o=this.options;node.hasClass("node-group")&&(node.toggleClass("expanded"),"slide"===o.effect?(func=!0!==node.hasClass("expanded")?"slideUp":"slideDown",Utils.exec(o.onCollapseNode,[node,element])):(func=!0!==node.hasClass("expanded")?"fadeOut":"fadeIn",Utils.exec(o.onExpandNode,[node,element])),node.children("ul")[func](o.duration))},toggleSelectable:function(){var element=this.element,func=!0===this.options.selectable?"addClass":"removeClass";element[func]("selectable"),element.find("ul")[func]("selectable")},add:function(node,data){var target,new_node,element=this.element,o=this.options;if(null===node)target=element;else{if(!node.hasClass("node-group"))return;0===(target=node.children("ul")).length&&(target=$("<ul>").addClass("listview").addClass("view-"+o.view).appendTo(node),this._createToggle().appendTo(node),node.addClass("expanded"))}(new_node=this._createNode(data)).addClass("node").appendTo(target);var cb=$("<input type='checkbox'>");return cb.data("node",new_node),new_node.prepend(cb),cb.checkbox(),Utils.exec(o.onNodeInsert,[new_node,element]),new_node},addGroup:function(data){var node,element=this.element,o=this.options;return delete data.icon,(node=this._createNode(data)).addClass("node-group").appendTo(element),node.append(this._createToggle()),node.addClass("expanded"),node.append($("<ul>").addClass("listview").addClass("view-"+o.view)),Utils.exec(o.onNodeInsert,[node,element]),node},insertBefore:function(node,data){var element=this.element,o=this.options;if(node.length){var new_node=this._createNode(data);return new_node.addClass("node").insertBefore(node),Utils.exec(o.onNodeInsert,[new_node,element]),new_node}},insertAfter:function(node,data){var element=this.element,o=this.options;if(node.length){var new_node=this._createNode(data);return new_node.addClass("node").insertAfter(node),Utils.exec(o.onNodeInsert,[new_node,element]),new_node}},del:function(node){var element=this.element,o=this.options;if(node.length){var parent_list=node.closest("ul"),parent_node=parent_list.closest("li");node.remove(),0!==parent_list.children().length||parent_list.is(element)||(parent_list.remove(),parent_node.removeClass("expanded"),parent_node.children(".node-toggle").remove()),Utils.exec(o.onNodeDelete,[node,element])}},clean:function(node){var element=this.element,o=this.options;node.length&&(node.children("ul").remove(),node.removeClass("expanded"),node.children(".node-toggle").remove(),Utils.exec(o.onNodeClean,[node,element]))},getSelected:function(){var element=this.element,nodes=[];return $.each(element.find(":checked"),function(){var check=$(this);nodes.push(check.closest(".node")[0])}),nodes},clearSelected:function(){this.element.find(":checked").prop("checked",!1),this.element.trigger("change")},selectAll:function(mode){this.element.find(".node > .checkbox input").prop("checked",!1!==mode),this.element.trigger("change")},changeAttribute:function(attributeName){var new_view,that=this,element=this.element,o=this.options;switch(attributeName){case"data-view":new_view="view-"+element.attr("data-view"),that.view(new_view);break;case"data-selectable":o.selectable=!0===JSON.parse(element.attr("data-selectable")),that.toggleSelectable()}}};Metro.plugin("listview",Listview);var Master={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.pages=[],this.currentIndex=0,this.isAnimate=!1,this._setOptionsFromDOM(),this._create(),this},options:{effect:"slide",effectFunc:"linear",duration:METRO_ANIMATION_DURATION,controlPrev:"<span class='default-icon-left-arrow'></span>",controlNext:"<span class='default-icon-right-arrow'></span>",controlTitle:"Master, page $1 of $2",backgroundImage:"",clsMaster:"",clsControls:"",clsControlPrev:"",clsControlNext:"",clsControlTitle:"",clsPages:"",clsPage:"",onBeforePage:Metro.noop_true,onBeforeNext:Metro.noop_true,onBeforePrev:Metro.noop_true,onMasterCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;element.addClass("master").addClass(o.clsMaster),element.css({backgroundImage:"url("+o.backgroundImage+")"}),this._createControls(),this._createPages(),this._createEvents(),Utils.exec(this.options.onMasterCreate,[this.element])},_createControls:function(){var controls,title,element=this.element,o=this.options,pages=element.find(".page");title=String(o.controlTitle).replace("$1","1"),title=String(title).replace("$2",pages.length),$.each(["top","bottom"],function(){controls=$("<div>").addClass("controls controls-"+this).addClass(o.clsControls).appendTo(element),$("<span>").addClass("prev").addClass(o.clsControlPrev).html(o.controlPrev).appendTo(controls),$("<span>").addClass("next").addClass(o.clsControlNext).html(o.controlNext).appendTo(controls),$("<span>").addClass("title").addClass(o.clsControlTitle).html(title).appendTo(controls)}),this._enableControl("prev",!1)},_enableControl:function(type,state){var control=this.element.find(".controls ."+type);!0===state?control.removeClass("disabled"):control.addClass("disabled")},_setTitle:function(){var title=this.element.find(".controls .title"),title_str=this.options.controlTitle.replace("$1",this.currentIndex+1);title_str=title_str.replace("$2",String(this.pages.length)),title.html(title_str)},_createPages:function(){var that=this,element=this.element,o=this.options,pages=element.find(".pages"),page=element.find(".page");0===pages.length&&(pages=$("<div>").addClass("pages").appendTo(element)),pages.addClass(o.clsPages),$.each(page,function(){var p=$(this);void 0!==p.data("cover")?element.css({backgroundImage:"url("+p.data("cover")+")"}):element.css({backgroundImage:"url("+o.backgroundImage+")"}),p.css({left:"100%"}),p.addClass(o.clsPage).hide(0),that.pages.push(p)}),page.appendTo(pages),void(this.currentIndex=0)!==this.pages[this.currentIndex]&&(void 0!==this.pages[this.currentIndex].data("cover")&&element.css({backgroundImage:"url("+this.pages[this.currentIndex].data("cover")+")"}),this.pages[this.currentIndex].css("left","0").show(0),setTimeout(function(){pages.css({height:that.pages[0].outerHeight(!0)+2})},0))},_createEvents:function(){var that=this,element=this.element,o=this.options;element.on(Metro.events.click,".controls .prev",function(){!0!==that.isAnimate&&!0===Utils.exec(o.onBeforePrev,[that.currentIndex,that.pages[that.currentIndex],element])&&!0===Utils.exec(o.onBeforePage,["prev",that.currentIndex,that.pages[that.currentIndex],element])&&that.prev()}),element.on(Metro.events.click,".controls .next",function(){!0!==that.isAnimate&&!0===Utils.exec(o.onBeforeNext,[that.currentIndex,that.pages[that.currentIndex],element])&&!0===Utils.exec(o.onBeforePage,["next",that.currentIndex,that.pages[that.currentIndex],element])&&that.next()}),$(window).on(Metro.events.resize+"-master"+element.attr("id"),function(){element.find(".pages").height(that.pages[that.currentIndex].outerHeight(!0)+2)})},_slideToPage:function(index){var current,next,to;void 0!==this.pages[index]&&this.currentIndex!==index&&(to=index>this.currentIndex?"next":"prev",current=this.pages[this.currentIndex],next=this.pages[index],this.currentIndex=index,this._effect(current,next,to))},_slideTo:function(to){var current,next;if(void 0!==to){if(current=this.pages[this.currentIndex],"next"===to){if(this.currentIndex+1>=this.pages.length)return;this.currentIndex++}else{if(this.currentIndex-1<0)return;this.currentIndex--}next=this.pages[this.currentIndex],this._effect(current,next,to)}},_effect:function(current,next,to){var that=this,element=this.element,o=this.options,out=element.width(),pages=element.find(".pages");function finish(){void 0!==next.data("cover")?element.css({backgroundImage:"url("+next.data("cover")+")"}):element.css({backgroundImage:"url("+o.backgroundImage+")"}),pages.css("overflow","initial"),that.isAnimate=!1}switch(this._setTitle(),this.currentIndex===this.pages.length-1?this._enableControl("next",!1):this._enableControl("next",!0),0===this.currentIndex?this._enableControl("prev",!1):this._enableControl("prev",!0),this.isAnimate=!0,setTimeout(function(){pages.animate({height:next.outerHeight(!0)+2})},0),pages.css("overflow","hidden"),o.effect){case"fade":current.fadeOut(o.duration),next.hide(0).css("left",0).fadeIn(o.duration,function(){finish()});break;case"switch":current.hide(0),next.hide(0).css("left",0).show(0,function(){finish()});break;default:current.stop(!0,!0).animate({left:"next"===to?-out:out},o.duration,o.effectFunc,function(){current.hide(0)}),next.stop(!0,!0).css({left:"next"===to?out:-out}).show(0).animate({left:0},o.duration,o.effectFunc,function(){finish()})}},toPage:function(index){this._slideToPage(index)},next:function(){this._slideTo("next")},prev:function(){this._slideTo("prev")},changeEffect:function(){this.options.effect=this.element.attr("data-effect")},changeEffectFunc:function(){this.options.effectFunc=this.element.attr("data-effect-func")},changeEffectDuration:function(){this.options.duration=this.element.attr("data-duration")},changeAttribute:function(attributeName){switch(attributeName){case"data-effect":this.changeEffect();break;case"data-effect-func":this.changeEffectFunc();break;case"data-duration":this.changeEffectDuration()}}};Metro.plugin("master",Master);var Audio={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.preloader=null,this.player=null,this.audio=elem,this.stream=null,this.volume=null,this.volumeBackup=0,this.muted=!1,this._setOptionsFromDOM(),this._create(),this},options:{playlist:null,src:null,volume:.5,loop:!1,autoplay:!1,showLoop:!0,showPlay:!0,showStop:!0,showMute:!0,showFull:!0,showStream:!0,showVolume:!0,showInfo:!0,showPlaylist:!0,showNext:!0,showPrev:!0,showFirst:!0,showLast:!0,showForward:!0,showBackward:!0,showShuffle:!0,showRandom:!0,loopIcon:"<span class='default-icon-loop'></span>",stopIcon:"<span class='default-icon-stop'></span>",playIcon:"<span class='default-icon-play'></span>",pauseIcon:"<span class='default-icon-pause'></span>",muteIcon:"<span class='default-icon-mute'></span>",volumeLowIcon:"<span class='default-icon-low-volume'></span>",volumeMediumIcon:"<span class='default-icon-medium-volume'></span>",volumeHighIcon:"<span class='default-icon-high-volume'></span>",playlistIcon:"<span class='default-icon-playlist'></span>",nextIcon:"<span class='default-icon-next'></span>",prevIcon:"<span class='default-icon-prev'></span>",firstIcon:"<span class='default-icon-first'></span>",lastIcon:"<span class='default-icon-last'></span>",forwardIcon:"<span class='default-icon-forward'></span>",backwardIcon:"<span class='default-icon-backward'></span>",shuffleIcon:"<span class='default-icon-shuffle'></span>",randomIcon:"<span class='default-icon-random'></span>",onPlay:Metro.noop,onPause:Metro.noop,onStop:Metro.noop,onEnd:Metro.noop,onMetadata:Metro.noop,onTime:Metro.noop,onAudioCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this.audio;this._createPlayer(),this._createControls(),this._createEvents(),!0===o.autoplay&&this.play(),Utils.exec(o.onAudioCreate,[element,this.player],element[0])},_createPlayer:function(){var element=this.element,o=this.options,audio=this.audio,prev=element.prev(),parent=element.parent(),player=$("<div>").addClass("media-player audio-player "+element[0].className);0===prev.length?parent.prepend(player):player.insertAfter(prev),element.appendTo(player),$.each(["muted","autoplay","controls","height","width","loop","poster","preload"],function(){element.removeAttr(this)}),element.attr("preload","auto"),audio.volume=o.volume,null!==o.src&&this._setSource(o.src),element[0].className="",this.player=player},_setSource:function(src){var element=this.element;element.find("source").remove(),element.removeAttr("src"),Array.isArray(src)?$.each(src,function(){void 0!==this.src&&$("<source>").attr("src",this.src).attr("type",void 0!==this.type?this.type:"").appendTo(element)}):element.attr("src",src)},_createControls:function(){var loop,that=this,element=this.element,o=this.options,audio=this.elem,controls=(this.player,$("<div>").addClass("controls").addClass(o.clsControls).insertAfter(element)),stream=$("<div>").addClass("stream").appendTo(controls),streamSlider=$("<input>").addClass("stream-slider ultra-thin cycle-marker").appendTo(stream),preloader=$("<div>").addClass("load-audio").appendTo(stream),volume=$("<div>").addClass("volume").appendTo(controls),volumeSlider=$("<input>").addClass("volume-slider ultra-thin cycle-marker").appendTo(volume),infoBox=$("<div>").addClass("info-box").appendTo(controls);!0!==o.showInfo&&infoBox.hide(),preloader.activity({type:"metro",style:"color"}),preloader.hide(0),this.preloader=preloader,streamSlider.slider({clsMarker:"bg-red",clsHint:"bg-cyan fg-white",clsComplete:"bg-cyan",hint:!0,onStart:function(){audio.paused||audio.pause()},onStop:function(val){0<audio.seekable.length&&(audio.currentTime=(that.duration*val/100).toFixed(0)),audio.paused&&0<audio.currentTime&&audio.play()}}),this.stream=streamSlider,!0!==o.showStream&&stream.hide(),volumeSlider.slider({clsMarker:"bg-red",clsHint:"bg-cyan fg-white",hint:!0,value:100*o.volume,onChangeValue:function(val){audio.volume=val/100}}),this.volume=volumeSlider,!0!==o.showVolume&&volume.hide(),!0===o.showLoop&&(loop=$("<button>").attr("type","button").addClass("button square loop").html(o.loopIcon).appendTo(controls)),!0===o.showPlay&&$("<button>").attr("type","button").addClass("button square play").html(o.playIcon).appendTo(controls),!0===o.showStop&&$("<button>").attr("type","button").addClass("button square stop").html(o.stopIcon).appendTo(controls),!0===o.showMute&&$("<button>").attr("type","button").addClass("button square mute").html(o.muteIcon).appendTo(controls),!0===o.loop&&(loop.addClass("active"),element.attr("loop","loop")),this._setVolume(),o.muted&&(that.volumeBackup=audio.volume,that.volume.data("slider").val(0),audio.volume=0),infoBox.html("00:00 / 00:00")},_createEvents:function(){var that=this,element=this.element,o=this.options,audio=this.elem,player=this.player;element.on("loadstart",function(){that.preloader.fadeIn()}),element.on("loadedmetadata",function(){that.duration=audio.duration.toFixed(0),that._setInfo(0,that.duration),Utils.exec(o.onMetadata,[audio,player],element[0])}),element.on("canplay",function(){that._setBuffer(),that.preloader.fadeOut()}),element.on("progress",function(){that._setBuffer()}),element.on("timeupdate",function(){var position=Math.round(100*audio.currentTime/that.duration);that._setInfo(audio.currentTime,that.duration),that.stream.data("slider").val(position),Utils.exec(o.onTime,[audio.currentTime,that.duration,audio,player],element[0])}),element.on("waiting",function(){that.preloader.fadeIn()}),element.on("loadeddata",function(){}),element.on("play",function(){player.find(".play").html(o.pauseIcon),Utils.exec(o.onPlay,[audio,player],element[0])}),element.on("pause",function(){player.find(".play").html(o.playIcon),Utils.exec(o.onPause,[audio,player],element[0])}),element.on("stop",function(){that.stream.data("slider").val(0),Utils.exec(o.onStop,[audio,player],element[0])}),element.on("ended",function(){that.stream.data("slider").val(0),Utils.exec(o.onEnd,[audio,player],element[0])}),element.on("volumechange",function(){that._setVolume()}),player.on(Metro.events.click,".play",function(){audio.paused?that.play():that.pause()}),player.on(Metro.events.click,".stop",function(){that.stop()}),player.on(Metro.events.click,".mute",function(){that._toggleMute()}),player.on(Metro.events.click,".loop",function(){that._toggleLoop()})},_toggleLoop:function(){var loop=this.player.find(".loop");0!==loop.length&&(loop.toggleClass("active"),loop.hasClass("active")?this.element.attr("loop","loop"):this.element.removeAttr("loop"))},_toggleMute:function(){this.muted=!this.muted,!1===this.muted?(this.audio.volume=this.volumeBackup,this.volume.data("slider").val(100*this.volumeBackup)):(this.volumeBackup=this.audio.volume,this.volume.data("slider").val(0),this.audio.volume=0)},_setInfo:function(a,b){this.player.find(".info-box").html(Utils.secondsToFormattedString(Math.round(a))+" / "+Utils.secondsToFormattedString(Math.round(b)))},_setBuffer:function(){var buffer=this.audio.buffered.length?Math.round(Math.floor(this.audio.buffered.end(0))/Math.floor(this.audio.duration)*100):0;this.stream.data("slider").buff(buffer)},_setVolume:function(){var audio=this.audio,player=this.player,o=this.options,volumeButton=player.find(".mute"),volume=100*audio.volume;1<volume&&volume<30?volumeButton.html(o.volumeLowIcon):30<=volume&&volume<60?volumeButton.html(o.volumeMediumIcon):60<=volume&&volume<=100?volumeButton.html(o.volumeHighIcon):volumeButton.html(o.muteIcon)},play:function(src){void 0!==src&&this._setSource(src),void 0===this.element.attr("src")&&0===this.element.find("source").length||this.audio.play()},pause:function(){this.audio.pause()},resume:function(){this.audio.paused&&this.play()},stop:function(){this.audio.pause(),this.audio.currentTime=0,this.stream.data("slider").val(0)},volume:function(v){if(void 0===v)return this.audio.volume;1<v&&(v/=100),this.audio.volume=v,this.volume.data("slider").val(100*v)},loop:function(){this._toggleLoop()},mute:function(){this._toggleMute()},changeSource:function(){var src=JSON.parse(this.element.attr("data-src"));this.play(src)},changeVolume:function(){var volume=this.element.attr("data-volume");this.volume(volume)},changeAttribute:function(attributeName){switch(attributeName){case"data-src":this.changeSource();break;case"data-volume":this.changeVolume()}},destroy:function(){var element=this.element,player=this.player;element.off("loadstart"),element.off("loadedmetadata"),element.off("canplay"),element.off("progress"),element.off("timeupdate"),element.off("waiting"),element.off("loadeddata"),element.off("play"),element.off("pause"),element.off("stop"),element.off("ended"),element.off("volumechange"),player.off(Metro.events.click,".play"),player.off(Metro.events.click,".stop"),player.off(Metro.events.click,".mute"),player.off(Metro.events.click,".loop"),Metro.destroyPlugin(this.stream,"slider"),Metro.destroyPlugin(this.volume,"slider"),element.insertBefore(player),player.html("").remove()}};Metro.plugin("audio",Audio);var Video={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.fullscreen=!1,this.preloader=null,this.player=null,this.video=elem,this.stream=null,this.volume=null,this.volumeBackup=0,this.muted=!1,this.fullScreenInterval=!1,this.isPlaying=!1,this._setOptionsFromDOM(),this._create(),this},options:{src:null,poster:"",logo:"",logoHeight:32,logoWidth:"auto",logoTarget:"",volume:.5,loop:!1,autoplay:!1,fullScreenMode:Metro.fullScreenMode.DESKTOP,aspectRatio:Metro.aspectRatio.HD,controlsHide:3e3,showLoop:!0,showPlay:!0,showStop:!0,showMute:!0,showFull:!0,showStream:!0,showVolume:!0,showInfo:!0,loopIcon:"<span class='default-icon-loop'></span>",stopIcon:"<span class='default-icon-stop'></span>",playIcon:"<span class='default-icon-play'></span>",pauseIcon:"<span class='default-icon-pause'></span>",muteIcon:"<span class='default-icon-mute'></span>",volumeLowIcon:"<span class='default-icon-low-volume'></span>",volumeMediumIcon:"<span class='default-icon-medium-volume'></span>",volumeHighIcon:"<span class='default-icon-high-volume'></span>",screenMoreIcon:"<span class='default-icon-enlarge'></span>",screenLessIcon:"<span class='default-icon-shrink'></span>",onPlay:Metro.noop,onPause:Metro.noop,onStop:Metro.noop,onEnd:Metro.noop,onMetadata:Metro.noop,onTime:Metro.noop,onVideoCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this.video;!1===Metro.fullScreenEnabled&&(o.fullScreenMode=Metro.fullScreenMode.WINDOW),this._createPlayer(),this._createControls(),this._createEvents(),this._setAspectRatio(),!0===o.autoplay&&this.play(),Utils.exec(o.onVideoCreate,[element,this.player],element[0])},_createPlayer:function(){var element=this.element,o=this.options,video=this.video,prev=element.prev(),parent=element.parent(),player=$("<div>").addClass("media-player video-player "+element[0].className),preloader=$("<div>").addClass("preloader").appendTo(player),logo=$("<a>").attr("href",o.logoTarget).addClass("logo").appendTo(player);0===prev.length?parent.prepend(player):player.insertAfter(prev),element.appendTo(player),$.each(["muted","autoplay","controls","height","width","loop","poster","preload"],function(){element.removeAttr(this)}),element.attr("preload","auto"),""!==o.poster&&element.attr("poster",o.poster),video.volume=o.volume,preloader.activity({type:"cycle",style:"color"}),preloader.hide(0),this.preloader=preloader,""!==o.logo&&$("<img>").css({height:o.logoHeight,width:o.logoWidth}).attr("src",o.logo).appendTo(logo),null!==o.src&&this._setSource(o.src),element[0].className="",this.player=player},_setSource:function(src){var element=this.element;element.find("source").remove(),element.removeAttr("src"),Array.isArray(src)?$.each(src,function(){void 0!==this.src&&$("<source>").attr("src",this.src).attr("type",void 0!==this.type?this.type:"").appendTo(element)}):element.attr("src",src)},_createControls:function(){var loop,that=this,element=this.element,o=this.options,video=this.elem,controls=(this.player,$("<div>").addClass("controls").addClass(o.clsControls).insertAfter(element)),stream=$("<div>").addClass("stream").appendTo(controls),streamSlider=$("<input>").addClass("stream-slider ultra-thin cycle-marker").appendTo(stream),volume=$("<div>").addClass("volume").appendTo(controls),volumeSlider=$("<input>").addClass("volume-slider ultra-thin cycle-marker").appendTo(volume),infoBox=$("<div>").addClass("info-box").appendTo(controls);!0!==o.showInfo&&infoBox.hide(),streamSlider.slider({clsMarker:"bg-red",clsHint:"bg-cyan fg-white",clsComplete:"bg-cyan",hint:!0,onStart:function(){video.paused||video.pause()},onStop:function(val){0<video.seekable.length&&(video.currentTime=(that.duration*val/100).toFixed(0)),video.paused&&0<video.currentTime&&video.play()}}),this.stream=streamSlider,!0!==o.showStream&&stream.hide(),volumeSlider.slider({clsMarker:"bg-red",clsHint:"bg-cyan fg-white",hint:!0,value:100*o.volume,onChangeValue:function(val){video.volume=val/100}}),this.volume=volumeSlider,!0!==o.showVolume&&volume.hide(),!0===o.showLoop&&(loop=$("<button>").attr("type","button").addClass("button square loop").html(o.loopIcon).appendTo(controls)),!0===o.showPlay&&$("<button>").attr("type","button").addClass("button square play").html(o.playIcon).appendTo(controls),!0===o.showStop&&$("<button>").attr("type","button").addClass("button square stop").html(o.stopIcon).appendTo(controls),!0===o.showMute&&$("<button>").attr("type","button").addClass("button square mute").html(o.muteIcon).appendTo(controls),!0===o.showFull&&$("<button>").attr("type","button").addClass("button square full").html(o.screenMoreIcon).appendTo(controls),!0===o.loop&&(loop.addClass("active"),element.attr("loop","loop")),this._setVolume(),o.muted&&(that.volumeBackup=video.volume,that.volume.data("slider").val(0),video.volume=0),infoBox.html("00:00 / 00:00")},_createEvents:function(){var that=this,element=this.element,o=this.options,video=this.elem,player=this.player;element.on("loadstart",function(){that.preloader.fadeIn()}),element.on("loadedmetadata",function(){that.duration=video.duration.toFixed(0),that._setInfo(0,that.duration),Utils.exec(o.onMetadata,[video,player],element[0])}),element.on("canplay",function(){that._setBuffer(),that.preloader.fadeOut()}),element.on("progress",function(){that._setBuffer()}),element.on("timeupdate",function(){var position=Math.round(100*video.currentTime/that.duration);that._setInfo(video.currentTime,that.duration),that.stream.data("slider").val(position),Utils.exec(o.onTime,[video.currentTime,that.duration,video,player],element[0])}),element.on("waiting",function(){that.preloader.fadeIn()}),element.on("loadeddata",function(){}),element.on("play",function(){player.find(".play").html(o.pauseIcon),Utils.exec(o.onPlay,[video,player],element[0]),that._onMouse()}),element.on("pause",function(){player.find(".play").html(o.playIcon),Utils.exec(o.onPause,[video,player],element[0]),that._offMouse()}),element.on("stop",function(){that.stream.data("slider").val(0),Utils.exec(o.onStop,[video,player],element[0]),that._offMouse()}),element.on("ended",function(){that.stream.data("slider").val(0),Utils.exec(o.onEnd,[video,player],element[0]),that._offMouse()}),element.on("volumechange",function(){that._setVolume()}),player.on(Metro.events.click,".play",function(e){video.paused?that.play():that.pause()}),player.on(Metro.events.click,".stop",function(e){that.stop()}),player.on(Metro.events.click,".mute",function(e){that._toggleMute()}),player.on(Metro.events.click,".loop",function(){that._toggleLoop()}),player.on(Metro.events.click,".full",function(e){that.fullscreen=!that.fullscreen,player.find(".full").html(!0===that.fullscreen?o.screenLessIcon:o.screenMoreIcon),o.fullScreenMode===Metro.fullScreenMode.WINDOW?!0===that.fullscreen?player.addClass("full-screen"):player.removeClass("full-screen"):!0===that.fullscreen?(Metro.requestFullScreen(video),!1===that.fullScreenInterval&&(that.fullScreenInterval=setInterval(function(){!1===Metro.inFullScreen()&&(that.fullscreen=!1,clearInterval(that.fullScreenInterval),that.fullScreenInterval=!1,player.find(".full").html(o.screenMoreIcon))},1e3))):Metro.exitFullScreen()}),$(window).on(Metro.events.keyup+"_video",function(e){that.fullscreen&&27===e.keyCode&&(player.find(".full").click(),console.log("esc"))}),$(window).resize(function(){that._setAspectRatio()})},_onMouse:function(){var that=this,player=this.player,o=this.options;0<o.controlsHide&&(player.on(Metro.events.enter,function(){player.find(".controls").fadeIn()}),player.on(Metro.events.leave,function(){setTimeout(function(){that.isPlaying&&player.find(".controls").fadeOut()},o.controlsHide)}))},_offMouse:function(){this.player.off(Metro.events.enter),this.player.off(Metro.events.leave),this.player.find(".controls").fadeIn()},_toggleLoop:function(){var loop=this.player.find(".loop");0!==loop.length&&(loop.toggleClass("active"),loop.hasClass("active")?this.element.attr("loop","loop"):this.element.removeAttr("loop"))},_toggleMute:function(){this.muted=!this.muted,!1===this.muted?(this.video.volume=this.volumeBackup,this.volume.data("slider").val(100*this.volumeBackup)):(this.volumeBackup=this.video.volume,this.volume.data("slider").val(0),this.video.volume=0)},_setInfo:function(a,b){this.player.find(".info-box").html(Utils.secondsToFormattedString(Math.round(a))+" / "+Utils.secondsToFormattedString(Math.round(b)))},_setBuffer:function(){var buffer=this.video.buffered.length?Math.round(Math.floor(this.video.buffered.end(0))/Math.floor(this.video.duration)*100):0;this.stream.data("slider").buff(buffer)},_setVolume:function(){var video=this.video,player=this.player,o=this.options,volumeButton=player.find(".mute"),volume=100*video.volume;1<volume&&volume<30?volumeButton.html(o.volumeLowIcon):30<=volume&&volume<60?volumeButton.html(o.volumeMediumIcon):60<=volume&&volume<=100?volumeButton.html(o.volumeHighIcon):volumeButton.html(o.muteIcon)},_setAspectRatio:function(){var height,player=this.player,o=this.options,width=player.outerWidth();switch(o.aspectRatio){case Metro.aspectRatio.SD:height=Utils.aspectRatioH(width,"4/3");break;case Metro.aspectRatio.CINEMA:height=Utils.aspectRatioH(width,"21/9");break;default:height=Utils.aspectRatioH(width,"16/9")}player.outerHeight(height)},aspectRatio:function(ratio){this.options.aspectRatio=ratio,this._setAspectRatio()},play:function(src){void 0!==src&&this._setSource(src),void 0===this.element.attr("src")&&0===this.element.find("source").length||(this.isPlaying=!0,this.video.play())},pause:function(){this.isPlaying=!1,this.video.pause()},resume:function(){this.video.paused&&this.play()},stop:function(){this.isPlaying=!1,this.video.pause(),this.video.currentTime=0,this.stream.data("slider").val(0),this._offMouse()},volume:function(v){if(void 0===v)return this.video.volume;1<v&&(v/=100),this.video.volume=v,this.volume.data("slider").val(100*v)},loop:function(){this._toggleLoop()},mute:function(){this._toggleMute()},changeAspectRatio:function(){this.options.aspectRatio=this.element.attr("data-aspect-ratio"),this._setAspectRatio()},changeSource:function(){var src=JSON.parse(this.element.attr("data-src"));this.play(src)},changeVolume:function(){var volume=this.element.attr("data-volume");this.volume(volume)},changeAttribute:function(attributeName){switch(attributeName){case"data-aspect-ratio":this.changeAspectRatio();break;case"data-src":this.changeSource();break;case"data-volume":this.changeVolume()}}};Metro.plugin("video",Video);var NavigationView={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.pane=null,this.content=null,this.paneToggle=null,this._setOptionsFromDOM(),this._create(),this},options:{compact:"md",expanded:"lg",toggle:null,activeState:!1,onMenuItemClick:Metro.noop,onNavViewCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createView(),this._createEvents(),Utils.exec(o.onNavViewCreate,[element])},_calcMenuHeight:function(){var pane,menu,element=this.element,elements_height=0;0!==(pane=element.children(".navview-pane")).length&&0!==(menu=pane.children(".navview-menu")).length&&($.each(menu.prevAll(),function(){elements_height+=$(this).outerHeight(!0)}),$.each(menu.nextAll(),function(){elements_height+=$(this).outerHeight(!0)}),menu.css({height:"calc(100% - "+(elements_height+20)+"px)"}))},_createView:function(){var pane,content,toggle,that=this,element=this.element,o=this.options;element.addClass("navview").addClass(!1!==o.compact?"compact-"+o.compact:"").addClass(!1!==o.expanded?"expanded-"+o.expanded:""),pane=element.children(".navview-pane"),content=element.children(".navview-content"),toggle=$(o.toggle),this._calcMenuHeight(),this.pane=0<pane.length?pane:null,this.content=0<content.length?content:null,this.paneToggle=0<toggle.length?toggle:null,setTimeout(function(){48===that.pane.width()?element.addClass("js-compact"):element.removeClass("js-compact")},200)},_createEvents:function(){var that=this,element=this.element,o=this.options;element.on(Metro.events.click,".pull-button, .holder",function(){that.pullClick(this)}),element.on(Metro.events.click,".navview-menu li",function(){!0===o.activeState&&(element.find(".navview-menu li").removeClass("active"),$(this).toggleClass("active"))}),element.on(Metro.events.click,".navview-menu li > a",function(e){Utils.exec(o.onMenuItemClick,null,this)}),null!==this.paneToggle&&this.paneToggle.on(Metro.events.click,function(){that.pane.toggleClass("open")}),$(window).on(Metro.events.resize+"-navview",function(){element.removeClass("expand"),that.pane.removeClass("open"),$(this).width()<=Metro.media_sizes[String(o.compact).toUpperCase()]&&element.removeClass("compacted"),that._calcMenuHeight(),element.removeClass("js-compact"),setTimeout(function(){48===that.pane.width()&&element.addClass("js-compact")},200)})},pullClick:function(el){var input,that=this,element=this.element,pane_compact=this.pane.width()<280,target=$(el);return target&&target.hasClass("holder")&&(input=target.parent().find("input"),setTimeout(function(){input.focus()},200)),that.pane.hasClass("open")?that.close():!pane_compact&&!element.hasClass("expand")||element.hasClass("compacted")?!element.hasClass("compacted")&&pane_compact||element.toggleClass("compacted"):element.toggleClass("expand"),setTimeout(function(){48===that.pane.width()?element.addClass("js-compact"):element.removeClass("js-compact")},200),!0},open:function(){this.pane.addClass("open")},close:function(){this.pane.removeClass("open")},toggle:function(){var pane=this.pane;pane.hasClass("open")?pane.removeClass("open"):pane.addClass("open")},changeAttribute:function(attributeName){}};Metro.plugin("navview",NavigationView);var Notify={options:{container:null,width:220,timeout:METRO_TIMEOUT,duration:METRO_ANIMATION_DURATION,distance:"100vh",animation:"swing",onClick:Metro.noop,onClose:Metro.noop,onShow:Metro.noop,onAppend:Metro.noop,onNotifyCreate:Metro.noop},notifies:[],setup:function(options){var container,body=$("body");return this.options=$.extend({},this.options,options),null===this.options.container&&(container=$("<div>").addClass("notify-container"),body.prepend(container),this.options.container=container),this},reset:function(){var reset_options={width:220,timeout:METRO_TIMEOUT,duration:METRO_ANIMATION_DURATION,distance:"100vh",animation:"swing"};this.options=$.extend({},this.options,reset_options)},create:function(message,title,options){var notify,t,that=this,o=this.options;if(Utils.isNull(options)&&(options={}),!Utils.isValue(message))return!1;(notify=$("<div>").addClass("notify")).css({width:o.width}),title&&(t=$("<div>").addClass("notify-title").html(title),notify.prepend(t)),$("<div>").addClass("notify-message").html(message).appendTo(notify),void 0!==options&&(void 0!==options.cls&&notify.addClass(options.cls),void 0!==options.width&&notify.css({width:options.width})),notify.on(Metro.events.click,function(){Utils.exec(Utils.isValue(options.onClick)?options.onClick:o.onClick,null,this),that.kill($(this),Utils.isValue(options.onClose)?options.onClose:o.onClose)}),notify.hide(function(){notify.appendTo(o.container),Utils.exec(Utils.isValue(options.onAppend)?options.onAppend:o.onAppend,null,notify[0]),notify.css({marginTop:Utils.isValue(options.distance)?options.distance:o.distance}).fadeIn(100,function(){var duration=Utils.isValue(options.duration)?options.duration:o.duration,animation=Utils.isValue(options.animation)?options.animation:o.animation;notify.animate({marginTop:".25rem"},duration,animation,function(){Utils.exec(o.onNotifyCreate,null,this),void 0!==options&&!0===options.keepOpen||setTimeout(function(){that.kill(notify,Utils.isValue(options.onClose)?options.onClose:o.onClose)},o.timeout),Utils.exec(Utils.isValue(options.onShow)?options.onShow:o.onShow,null,notify[0])})})})},kill:function(notify,callback){notify.off(Metro.events.click),notify.fadeOut("slow",function(){Utils.exec(Utils.isValue(callback)?callback:this.options.onClose,null,notify[0]),notify.remove()})},killAll:function(){var that=this,notifies=$(".notify");$.each(notifies,function(){that.kill($(this))})}};Metro.notify=Notify.setup();var Panel={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this._setOptionsFromDOM(),this._create(),this},dependencies:["draggable","collapse"],options:{titleCaption:"",titleIcon:"",collapsible:!1,collapsed:!1,collapseDuration:METRO_ANIMATION_DURATION,width:"auto",height:"auto",draggable:!1,customButtons:null,clsCustomButton:"",clsPanel:"",clsTitle:"",clsTitleCaption:"",clsTitleIcon:"",clsContent:"",clsCollapseToggle:"",onCollapse:Metro.noop,onExpand:Metro.noop,onDragStart:Metro.noop,onDragStop:Metro.noop,onDragMove:Metro.noop,onPanelCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var title,buttons,dragElement,element=this.element,o=this.options,prev=element.prev(),parent=element.parent(),panel=$("<div>").addClass("panel").addClass(o.clsPanel),id=Utils.uniqueId(),original_classes=element[0].className;if(0===prev.length?parent.prepend(panel):panel.insertAfter(prev),panel.attr("id",id).addClass(original_classes),element[0].className="",element.addClass("panel-content").addClass(o.clsContent).appendTo(panel),""!==o.titleCaption||""!==o.titleIcon||!0===o.collapsible){if(title=$("<div>").addClass("panel-title").addClass(o.clsTitle),""!==o.titleCaption&&$("<span>").addClass("caption").addClass(o.clsTitleCaption).html(o.titleCaption).appendTo(title),""!==o.titleIcon&&$(o.titleIcon).addClass("icon").addClass(o.clsTitleIcon).appendTo(title),!0===o.collapsible){var collapseToggle=$("<span>").addClass("dropdown-toggle marker-center active-toggle").addClass(o.clsCollapseToggle).appendTo(title);element.collapse({toggleElement:collapseToggle,duration:o.collapseDuration,onCollapse:o.onCollapse,onExpand:o.onExpand}),!0===o.collapsed&&this.collapse()}title.appendTo(panel)}if(title&&Utils.isValue(o.customButtons)){var customButtons=[];!1!==Utils.isObject(o.customButtons)&&(o.customButtons=Utils.isObject(o.customButtons)),"string"==typeof o.customButtons&&-1<o.customButtons.indexOf("{")?customButtons=JSON.parse(o.customButtons):"object"==typeof o.customButtons&&0<Utils.objectLength(o.customButtons)?customButtons=o.customButtons:console.log("Unknown format for custom buttons"),buttons=$("<div>").addClass("custom-buttons").appendTo(title),$.each(customButtons,function(){var customButton=$("<span>");customButton.addClass("button btn-custom").addClass(o.clsCustomButton).addClass(this.cls).attr("tabindex",-1).html(this.html),customButton.data("action",this.onclick),buttons.prepend(customButton)}),title.on(Metro.events.click,".btn-custom",function(e){if(!Utils.isRightMouse(e)){var button=$(this),action=button.data("action");Utils.exec(action,[button],this)}})}!0===o.draggable&&(dragElement=title?title.find(".caption, .icon"):panel,panel.draggable({dragElement:dragElement,onDragStart:o.onDragStart,onDragStop:o.onDragStop,onDragMove:o.onDragMove}));"auto"!==o.width&&0<=parseInt(o.width)&&panel.outerWidth(parseInt(o.width)),"auto"!==o.height&&0<=parseInt(o.height)&&(panel.outerHeight(parseInt(o.height)),element.css({overflow:"auto"})),this.panel=panel,Utils.exec(o.onPanelCreate,[this.element])},collapse:function(){var element=this.element;!1!==Utils.isMetroObject(element,"collapse")&&element.data("collapse").collapse()},expand:function(){var element=this.element;!1!==Utils.isMetroObject(element,"collapse")&&element.data("collapse").expand()},changeAttribute:function(attributeName){attributeName}};Metro.plugin("panel",Panel);var Popover={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.popover=null,this.popovered=!1,this.size={width:0,height:0},this._setOptionsFromDOM(),this._create(),this},options:{popoverText:"",popoverHide:3e3,popoverTimeout:10,popoverOffset:10,popoverTrigger:Metro.popoverEvents.HOVER,popoverPosition:Metro.position.TOP,hideOnLeave:!1,closeButton:!0,clsPopover:"",clsPopoverContent:"",onPopoverShow:Metro.noop,onPopoverHide:Metro.noop,onPopoverCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){this._createEvents()},_createEvents:function(){var event,that=this,element=this.element,o=this.options;switch(o.popoverTrigger){case Metro.popoverEvents.CLICK:event=Metro.events.click;break;case Metro.popoverEvents.FOCUS:event=Metro.events.focus;break;default:event=Metro.events.enter}element.on(event,function(){null===that.popover&&!0!==that.popovered&&setTimeout(function(){that.createPopover(),Utils.exec(o.onPopoverShow,[that.popover],element[0]),0<o.popoverHide&&setTimeout(function(){that.removePopover()},o.popoverHide)},o.popoverTimeout)}),!0===o.hideOnLeave&&element.on(Metro.events.leave,function(){that.removePopover()}),$(window).on(Metro.events.scroll,function(){null!==that.popover&&that.setPosition()})},setPosition:function(){var popover=this.popover,size=this.size,o=this.options,element=this.element;o.popoverPosition===Metro.position.BOTTOM?(popover.addClass("bottom"),popover.css({top:element.offset().top-$(window).scrollTop()+element.outerHeight()+o.popoverOffset,left:element.offset().left+element.outerWidth()/2-size.width/2-$(window).scrollLeft()})):o.popoverPosition===Metro.position.RIGHT?(popover.addClass("right"),popover.css({top:element.offset().top+element.outerHeight()/2-size.height/2-$(window).scrollTop(),left:element.offset().left+element.outerWidth()-$(window).scrollLeft()+o.popoverOffset})):o.popoverPosition===Metro.position.LEFT?(popover.addClass("left"),popover.css({top:element.offset().top+element.outerHeight()/2-size.height/2-$(window).scrollTop(),left:element.offset().left-size.width-$(window).scrollLeft()-o.popoverOffset})):(popover.addClass("top"),popover.css({top:element.offset().top-$(window).scrollTop()-size.height-o.popoverOffset,left:element.offset().left+element.outerWidth()/2-size.width/2-$(window).scrollLeft()}))},createPopover:function(){var popover,neb_pos,that=this,elem=this.elem,element=this.element,o=this.options,id=Utils.elementId("popover");if(!this.popovered){switch((popover=$("<div>").addClass("popover neb").addClass(o.clsPopover)).attr("id",id),$("<div>").addClass("popover-content").addClass(o.clsPopoverContent).html(o.popoverText).appendTo(popover),0===o.popoverHide&&!0===o.closeButton&&$("<button>").addClass("button square small popover-close-button bg-white").html("&times;").appendTo(popover).on(Metro.events.click,function(){that.removePopover()}),o.popoverPosition){case Metro.position.TOP:neb_pos="neb-s";break;case Metro.position.BOTTOM:neb_pos="neb-n";break;case Metro.position.RIGHT:neb_pos="neb-w";break;case Metro.position.LEFT:neb_pos="neb-e"}if(popover.addClass(neb_pos),!0!==o.closeButton&&popover.on(Metro.events.click,function(){that.removePopover()}),this.popover=popover,this.size=Utils.hiddenElementSize(popover),"TD"===elem.tagName||"TH"===elem.tagName){var wrp=$("<div/>").css("display","inline-block").html(element.html());element.html(wrp),element=wrp}this.setPosition(),popover.appendTo($("body")),this.popovered=!0,Utils.exec(o.onPopoverCreate,[popover],element[0])}},removePopover:function(){var that=this,timeout=this.options.onPopoverHide===Metro.noop?0:300,popover=this.popover;this.popovered&&(Utils.exec(this.options.onPopoverHide,[popover],this.elem),setTimeout(function(){popover.hide(0,function(){popover.remove(),that.popover=null,that.popovered=!1})},timeout))},show:function(){var that=this,element=this.element,o=this.options;!0!==this.popovered&&setTimeout(function(){that.createPopover(),Utils.exec(o.onPopoverShow,[that.popover],element[0]),0<o.popoverHide&&setTimeout(function(){that.removePopover()},o.popoverHide)},o.popoverTimeout)},hide:function(){this.removePopover()},changeAttribute:function(attributeName){var that=this,element=this.element,o=this.options;switch(attributeName){case"data-popover-text":o.popoverText=element.attr("data-popover-text"),that.popover&&(that.popover.find(".popover-content").html(o.popoverText),that.setPosition());break;case"data-popover-position":o.popoverPosition=element.attr("data-popover-position"),that.setPosition()}}};Metro.plugin("popover",Popover);var Progress={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.value=0,this.buffer=0,this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onProgressCreate,[this.element]),this},options:{value:0,buffer:0,type:"bar",small:!1,clsBack:"",clsBar:"",clsBuffer:"",onValueChange:Metro.noop,onBufferChange:Metro.noop,onComplete:Metro.noop,onBuffered:Metro.noop,onProgressCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;switch(element.html("").addClass("progress"),o.type){case"buffer":$("<div>").addClass("bar").appendTo(element),$("<div>").addClass("buffer").appendTo(element);break;case"load":element.addClass("with-load"),$("<div>").addClass("bar").appendTo(element),$("<div>").addClass("buffer").appendTo(element),$("<div>").addClass("load").appendTo(element);break;case"line":element.addClass("line");break;default:$("<div>").addClass("bar").appendTo(element)}!0===o.small&&element.addClass("small"),element.addClass(o.clsBack),element.find(".bar").addClass(o.clsBar),element.find(".buffer").addClass(o.clsBuffer),this.val(o.value),this.buff(o.buffer)},val:function(v){var element=this.element,o=this.options;if(void 0===v)return this.value;var bar=element.find(".bar");if(0===bar.length)return!1;this.value=parseInt(v,10),bar.css("width",this.value+"%"),element.trigger("valuechange",[this.value]),Utils.exec(o.onValueChange,[this.value,element]),100===this.value&&Utils.exec(o.onComplete,[this.value,element])},buff:function(v){var element=this.element,o=this.options;if(void 0===v)return this.buffer;var bar=element.find(".buffer");if(0===bar.length)return!1;this.buffer=parseInt(v,10),bar.css("width",this.buffer+"%"),element.trigger("bufferchange",[this.buffer]),Utils.exec(o.onBufferChange,[this.buffer,element]),100===this.buffer&&Utils.exec(o.onBuffered,[this.buffer,element])},changeValue:function(){this.val(this.element.attr("data-value"))},changeBuffer:function(){this.buff(this.element.attr("data-buffer"))},changeAttribute:function(attributeName){switch(attributeName){case"data-value":this.changeValue();break;case"data-buffer":this.changeBuffer()}}};Metro.plugin("progress",Progress);var Radio={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.origin={className:""},this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onRadioCreate,[this.element]),this},options:{style:1,caption:"",captionPosition:"right",clsRadio:"",clsCheck:"",clsCaption:"",onRadioCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options,radio=$("<label>").addClass("radio "+element[0].className).addClass(2===o.style?"style2":""),check=$("<span>").addClass("check"),caption=$("<span>").addClass("caption").html(o.caption);element.attr("type","radio"),radio.insertBefore(element),element.appendTo(radio),check.appendTo(radio),caption.appendTo(radio),"left"===o.captionPosition&&radio.addClass("caption-left"),this.origin.className=element[0].className,element[0].className="",radio.addClass(o.clsRadio),caption.addClass(o.clsCaption),check.addClass(o.clsCheck),element.is(":disabled")?this.disable():this.enable()},disable:function(){this.element.data("disabled",!0),this.element.parent().addClass("disabled")},enable:function(){this.element.data("disabled",!1),this.element.parent().removeClass("disabled")},toggleState:function(){this.elem.disabled?this.disable():this.enable()},changeAttribute:function(attributeName){var new_style,element=this.element,o=this.options,parent=element.parent();switch(attributeName){case"disabled":this.toggleState();break;case"data-style":new_style=parseInt(element.attr("data-style")),Utils.isInt(new_style)&&(o.style=new_style,parent.removeClass("style1 style2").addClass("style"+new_style))}},destroy:function(){var element=this.element,parent=element.parent();element[0].className=this.origin.className,element.insertBefore(parent),parent.remove()}};Metro.plugin("radio",Radio);var Rating={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.value=0,this.originValue=0,this.values=[],this.rate=0,this.rating=null,this._setOptionsFromDOM(),this._create(),this},options:{static:!1,title:null,value:0,values:null,message:"",stars:5,starColor:null,staredColor:null,roundFunc:"round",half:!0,clsRating:"",clsTitle:"",clsStars:"",clsResult:"",onStarClick:Metro.noop,onRatingCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var i,element=this.element,o=this.options;if(isNaN(o.value)?o.value=0:o.value=parseFloat(o.value).toFixed(1),null!==o.values)Array.isArray(o.values)?this.values=o.values:"string"==typeof o.values&&(this.values=Utils.strToArray(o.values));else for(i=1;i<=o.stars;i++)this.values.push(i);this.originValue=o.value,this.value=0<o.value?Math[o.roundFunc](o.value):0,null!==o.starColor&&(Utils.isColor(o.starColor)||(o.starColor=Colors.color(o.starColor))),null!==o.staredColor&&(Utils.isColor(o.staredColor)||(o.staredColor=Colors.color(o.staredColor))),this._createRating(),this._createEvents(),Utils.exec(o.onRatingCreate,[element])},_createRating:function(){var i,stars,li,element=this.element,o=this.options,id=Utils.elementId("rating"),rating=$("<div>").addClass("rating "+String(element[0].className).replace("d-block","d-flex")).addClass(o.clsRating),sheet=Metro.sheet,value=o.static?Math.floor(this.originValue):this.value;for(element.val(this.value),rating.attr("id",id),rating.insertBefore(element),element.appendTo(rating),stars=$("<ul>").addClass("stars").addClass(o.clsStars).appendTo(rating),i=1;i<=o.stars;i++)li=$("<li>").data("value",this.values[i-1]).appendTo(stars),i<=value&&li.addClass("on");if($("<span>").addClass("result").addClass(o.clsResult).appendTo(rating).html(o.message),null!==o.starColor&&Utils.addCssRule(sheet,"#"+id+" .stars:hover li","color: "+o.starColor+";"),null!==o.staredColor&&(Utils.addCssRule(sheet,"#"+id+" .stars li.on","color: "+o.staredColor+";"),Utils.addCssRule(sheet,"#"+id+" .stars li.half::after","color: "+o.staredColor+";")),null!==o.title){var title=$("<span>").addClass("title").addClass(o.clsTitle).html(o.title);rating.prepend(title)}if(!0===o.static&&(rating.addClass("static"),!0===o.half)){var dec=Math.round(this.originValue%1*10);0<dec&&dec<=9&&rating.find(".stars li.on").last().next("li").addClass("half half-"+10*dec)}if(!(element[0].className="")===o.copyInlineStyles)for(i=0;i<element[0].style.length;i++)rating.css(element[0].style[i],element.css(element[0].style[i]));element.is(":disabled")?this.disable():this.enable(),this.rating=rating},_createEvents:function(){var element=this.element,o=this.options;this.rating.on(Metro.events.click,".stars li",function(){if(!0!==o.static){var star=$(this),value=star.data("value");star.addClass("scale"),setTimeout(function(){star.removeClass("scale")},300),element.val(value).trigger("change"),star.addClass("on"),star.prevAll().addClass("on"),star.nextAll().removeClass("on"),Utils.exec(o.onStarClick,[value,star,element])}})},val:function(v){var that=this,element=this.element,o=this.options,rating=this.rating;if(void 0===v)return this.value;this.value=0<v?Math[o.roundFunc](v):0,element.val(this.value).trigger("change");var stars=rating.find(".stars li").removeClass("on");return $.each(stars,function(){var star=$(this);star.data("value")<=that.value&&star.addClass("on")}),this},msg:function(m){var rating=this.rating;if(void 0!==m)return rating.find(".result").html(m),this},static:function(mode){var o=this.options,rating=this.rating;!0===(o.static=mode)?rating.addClass("static"):rating.removeClass("static")},changeAttributeValue:function(a){var element=this.element,value="value"===a?element.val():element.attr("data-value");this.val(value)},changeAttributeMessage:function(){var message=this.element.attr("data-message");this.msg(message)},changeAttributeStatic:function(){var element=this.element,isStatic=!0===JSON.parse(element.attr("data-static"));this.static(isStatic)},disable:function(){this.element.data("disabled",!0),this.element.parent().addClass("disabled")},enable:function(){this.element.data("disabled",!1),this.element.parent().removeClass("disabled")},toggleState:function(){this.elem.disabled?this.disable():this.enable()},changeAttribute:function(attributeName){switch(attributeName){case"value":case"data-value":this.changeAttributeValue(attributeName);break;case"disabled":this.toggleState();break;case"data-message":this.changeAttributeMessage();break;case"data-static":this.changeAttributeStatic()}}};Metro.plugin("rating",Rating);var Resizable={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.resizer=null,this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onResizableCreate,[this.element]),this},options:{canResize:!0,resizeElement:".resize-element",minWidth:0,minHeight:0,maxWidth:0,maxHeight:0,preserveRatio:!1,onResizeStart:Metro.noop,onResizeStop:Metro.noop,onResize:Metro.noop,onResizableCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){this._createStructure(),this._createEvents()},_createStructure:function(){var element=this.element,o=this.options;Utils.isValue(o.resizeElement)&&0<element.find(o.resizeElement).length?this.resizer=element.find(o.resizeElement):this.resizer=$("<span>").addClass("resize-element").appendTo(element)},_createEvents:function(){var element=this.element,o=this.options;this.resizer.on(Metro.events.start+"-resize-element",function(e){if(!1!==o.canResize){var startXY=Utils.pageXY(e),startWidth=parseInt(element.outerWidth()),startHeight=parseInt(element.outerHeight()),size={width:startWidth,height:startHeight};Utils.exec(o.onResizeStart,[element,size]),$(document).on(Metro.events.move+"-resize-element",function(e){var moveXY=Utils.pageXY(e),size={width:startWidth+moveXY.x-startXY.x,height:startHeight+moveXY.y-startXY.y};return 0<o.maxWidth&&size.width>o.maxWidth||(0<o.minWidth&&size.width<o.minWidth||(0<o.maxHeight&&size.height>o.maxHeight||(0<o.minHeight&&size.height<o.minHeight||(element.css(size),void Utils.exec(o.onResize,[element,size])))))}),$(document).on(Metro.events.stop+"-resize-element",function(){$(document).off(Metro.events.move+"-resize-element"),$(document).off(Metro.events.stop+"-resize-element");var size={width:parseInt(element.outerWidth()),height:parseInt(element.outerHeight())};Utils.exec(o.onResizeStop,[element,size])}),e.preventDefault(),e.stopPropagation()}})},off:function(){this.element.data("canResize",!1)},on:function(){this.element.data("canResize",!0)},changeAttribute:function(attributeName){var element=this.element,o=this.options;switch(attributeName){case"data-can-resize":o.canResize=!0===JSON.parse(element.attr("data-can-resize"))}}};Metro.plugin("resizable",Resizable);var RibbonMenu={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this._setOptionsFromDOM(),this._create(),this},dependencies:["buttongroup"],options:{onStatic:Metro.noop,onBeforeTab:Metro.noop_true,onTab:Metro.noop,onRibbonMenuCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createStructure(),this._createEvents(),Utils.exec(o.onRibbonMenuCreate,[element])},_createStructure:function(){var element=this.element;element.addClass("ribbon-menu");var tabs=element.find(".tabs-holder li:not(.static)"),active_tab=element.find(".tabs-holder li.active");0<active_tab.length?this.open($(active_tab[0])):0<tabs.length&&this.open($(tabs[0]));var fluentGroups=element.find(".ribbon-toggle-group");$.each(fluentGroups,function(){var g=$(this);g.buttongroup({clsActive:"active"});var gw=0,btns=g.find(".ribbon-icon-button");$.each(btns,function(){var w=$(this).outerWidth(!0);gw<w&&(gw=w)}),g.css("width",gw*Math.ceil(btns.length/3)+4)})},_createEvents:function(){var that=this,element=this.element,o=this.options;element.on(Metro.events.click,".tabs-holder li a",function(e){var link=$(this),tab=$(this).parent("li");tab.hasClass("static")?o.onStatic===Metro.noop&&void 0!==link.attr("href")?document.location.href=link.attr("href"):Utils.exec(o.onStatic,[tab,element]):!0===Utils.exec(o.onBeforeTab,[tab,element])&&that.open(tab),e.preventDefault()})},open:function(tab){var element=this.element,o=this.options,tabs=element.find(".tabs-holder li"),sections=element.find(".content-holder .section"),target=tab.children("a").attr("href"),target_section="#"!==target?element.find(target):null;tabs.removeClass("active"),tab.addClass("active"),sections.removeClass("active"),target_section&&target_section.addClass("active"),Utils.exec(o.onTab,[tab,element])},changeAttribute:function(attributeName){}};Metro.plugin("ribbonmenu",RibbonMenu);var Ripple={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onRippleCreate,[this.element]),this},options:{rippleColor:"#fff",rippleAlpha:.4,rippleTarget:"default",onRippleCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options,target="default"===o.rippleTarget?null:o.rippleTarget;element.on(Metro.events.click,target,function(e){var el=$(this);"static"===el.css("position")&&el.css("position","relative"),el.css({overflow:"hidden"}),$(".ripple").remove();var size=Math.max(el.outerWidth(),el.outerHeight()),ripple=$("<span class='ripple'></span>").css({width:size,height:size});el.prepend(ripple);var x=e.pageX-el.offset().left-ripple.width()/2,y=e.pageY-el.offset().top-ripple.height()/2;ripple.css({background:Utils.hex2rgba(o.rippleColor,o.rippleAlpha),width:size,height:size,top:y+"px",left:x+"px"}).addClass("rippleEffect"),setTimeout(function(){null,$(".ripple").remove()},400)})},changeAttribute:function(attributeName){}};Metro.plugin("ripple",Ripple);var Select={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.list=null,this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onSelectCreate,[this.element]),this},options:{duration:100,prepend:"",append:"",placeholder:"",filterPlaceholder:"",filter:!0,copyInlineStyles:!0,dropHeight:200,clsSelect:"",clsSelectInput:"",clsPrepend:"",clsAppend:"",clsOption:"",clsOptionActive:"",clsOptionGroup:"",clsDropList:"",clsSelectedItem:"",clsSelectedItemRemover:"",onChange:Metro.noop,onUp:Metro.noop,onDrop:Metro.noop,onItemSelect:Metro.noop,onItemDeselect:Metro.noop,onSelectCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){this._createSelect(),this._createEvents()},_addOption:function(item,parent){var l,a,tag,option=$(item),element=this.element,o=this.options,multiple=element[0].multiple,input=element.siblings(".select-input"),html=Utils.isValue(option.attr("data-template"))?option.attr("data-template").replace("$1",item.text):item.text;l=$("<li>").addClass(o.clsOption).data("option",item).attr("data-text",item.text).attr("data-value",Utils.isValue(item.value)?item.value:"").appendTo(parent),a=$("<a>").html(html).appendTo(l).addClass(item.className),option.is(":selected")&&(multiple?(l.addClass("d-none"),(tag=$("<div>").addClass("selected-item").addClass(o.clsSelectedItem).html("<span class='title'>"+html+"</span>").appendTo(input)).data("option",l),$("<span>").addClass("remover").addClass(o.clsSelectedItemRemover).html("&times;").appendTo(tag)):(element.val(item.value),input.html(html),element.trigger("change"),l.addClass("active"))),a.appendTo(l),l.appendTo(parent)},_addOptionGroup:function(item,parent){var that=this,group=$(item);$("<li>").html(item.label).addClass("group-title").appendTo(parent),$.each(group.children(),function(){that._addOption(this,parent)})},_createOptions:function(){var that=this,element=this.element,list=element.parent().find("ul").html("");$.each(element.children(),function(){"OPTION"===this.tagName?that._addOption(this,list):"OPTGROUP"===this.tagName&&that._addOptionGroup(this,list)})},_createSelect:function(){var input,drop_container,list,filter_input,element=this.element,o=this.options,prev=element.prev(),parent=element.parent(),container=$("<label>").addClass("select "+element[0].className).addClass(o.clsSelect),multiple=element[0].multiple,select_id=Utils.elementId("select"),buttons=$("<div>").addClass("button-group");(container.attr("id",select_id).addClass("dropdown-toggle"),multiple&&container.addClass("multiple"),0===prev.length?parent.prepend(container):container.insertAfter(prev),element.appendTo(container),buttons.appendTo(container),input=$("<div>").addClass("select-input").addClass(o.clsSelectInput).attr("name","__"+select_id+"__"),drop_container=$("<div>").addClass("drop-container"),list=$("<ul>").addClass("d-menu").addClass(o.clsDropList).css({"max-height":o.dropHeight}),filter_input=$("<input type='text' data-role='input'>").attr("placeholder",o.filterPlaceholder),container.append(input),container.append(drop_container),drop_container.append(filter_input),!0!==o.filter&&filter_input.hide(),drop_container.append(list),this._createOptions(),drop_container.dropdown({dropFilter:".select",duration:o.duration,toggleElement:"#"+select_id,onDrop:function(){var dropped,target;dropped=$(".select .drop-container"),$.each(dropped,function(){var drop=$(this);drop.is(drop_container)||drop.data("dropdown").close()}),filter_input.val("").trigger(Metro.events.keyup).focus(),void 0!==(target=0<list.find("li.active").length?$(list.find("li.active")[0]):void 0)&&(list.scrollTop(0),setTimeout(function(){list.animate({scrollTop:target.position().top-(list.height()-target.height())/2},100)},200)),Utils.exec(o.onDrop,[list,element],list[0])},onUp:function(){Utils.exec(o.onUp,[list,element],list[0])}}),this.list=list,""!==o.prepend)&&$("<div>").html(o.prepend).addClass("prepend").addClass(o.clsPrepend).appendTo(container);""!==o.append&&$("<div>").html(o.append).addClass("append").addClass(o.clsAppend).appendTo(container);if(!0===o.copyInlineStyles)for(var i=0,l=element[0].style.length;i<l;i++)container.css(element[0].style[i],element.css(element[0].style[i]));"rtl"===element.attr("dir")&&container.addClass("rtl").attr("dir","rtl"),element.is(":disabled")?this.disable():this.enable()},_createEvents:function(){var that=this,element=this.element,o=this.options,container=element.closest(".select"),drop_container=container.find(".drop-container"),input=element.siblings(".select-input"),filter_input=drop_container.find("input"),list=drop_container.find("ul");container.on(Metro.events.click,function(e){$(".focused").removeClass("focused"),container.addClass("focused"),e.preventDefault(),e.stopPropagation()}),input.on(Metro.events.click,function(e){$(".focused").removeClass("focused"),container.addClass("focused")}),list.on(Metro.events.click,"li",function(e){if($(this).hasClass("group-title"))return e.preventDefault(),void e.stopPropagation();var selected_item,leaf=$(this),val=leaf.data("value"),html=(leaf.data("text"),leaf.children("a").html()),option=leaf.data("option"),options=element.find("option");element[0].multiple?(leaf.addClass("d-none"),(selected_item=$("<div>").addClass("selected-item").addClass(o.clsSelectedItem).html("<span class='title'>"+html+"</span>").appendTo(input)).data("option",leaf),$("<span>").addClass("remover").addClass(o.clsSelectedItemRemover).html("&times;").appendTo(selected_item)):(list.find("li.active").removeClass("active").removeClass(o.clsOptionActive),leaf.addClass("active").addClass(o.clsOptionActive),input.html(html),drop_container.data("dropdown").close()),$.each(options,function(){this===option&&(this.selected=!0)}),element.trigger("change"),Utils.exec(o.onItemSelect,[val,option,leaf],element[0]),Utils.exec(o.onChange,[that.getSelected()],element[0])}),input.on("click",".selected-item .remover",function(e){var item=$(this).closest(".selected-item"),leaf=item.data("option"),option=leaf.data("option");leaf.removeClass("d-none"),$.each(element.find("option"),function(){this===option&&(this.selected=!1)}),item.remove(),element.trigger("change"),Utils.exec(o.onItemDeselect,[option],element[0]),Utils.exec(o.onChange,[that.getSelected()],element[0]),e.preventDefault(),e.stopPropagation()}),filter_input.on(Metro.events.keyup,function(){var i,filter=this.value.toUpperCase(),li=list.find("li");for(i=0;i<li.length;i++)$(li[i]).hasClass("group-title")||(-1<li[i].getElementsByTagName("a")[0].innerHTML.toUpperCase().indexOf(filter)?li[i].style.display="":li[i].style.display="none")}),drop_container.on(Metro.events.click,function(e){e.preventDefault(),e.stopPropagation()})},disable:function(){this.element.data("disabled",!0),this.element.closest(".select").addClass("disabled")},enable:function(){this.element.data("disabled",!1),this.element.closest(".select").removeClass("disabled")},toggleState:function(){this.elem.disabled?this.disable():this.enable()},reset:function(to_default){var element=this.element,o=this.options,options=element.find("option"),select=element.closest(".select");$.each(options,function(){this.selected=!Utils.isNull(to_default)&&this.defaultSelected}),this.list.find("li").remove(),select.find(".select-input").html(""),this._createOptions(),element.trigger("change"),Utils.exec(o.onChange,[this.getSelected()],element[0])},getSelected:function(){var element=this.element,result=[];return element.find("option:selected").each(function(){result.push(this.value)}),result},val:function(val){var option,i,html,list_item,tag,element=this.element,o=this.options,input=element.siblings(".select-input"),options=element.find("option"),list_items=this.list.find("li"),result=[],multiple=void 0!==element.attr("multiple");if(Utils.isNull(val))return $.each(options,function(){this.selected&&result.push(this.value)}),multiple?result:result[0];$.each(options,function(){this.selected=!1}),list_items.removeClass("active"),input.html(""),!1===Array.isArray(val)&&(val=[val]),$.each(val,function(){for(i=0;i<options.length;i++)if(option=options[i],html=Utils.isValue(option.getAttribute("data-template"))?option.getAttribute("data-template").replace("$1",option.text):option.text,""+option.value==""+this){option.selected=!0;break}for(i=0;i<list_items.length;i++)if(list_item=$(list_items[i]),""+list_item.attr("data-value")==""+this){multiple?(list_item.addClass("d-none"),(tag=$("<div>").addClass("selected-item").addClass(o.clsSelectedItem).html("<span class='title'>"+html+"</span>").appendTo(input)).data("option",list_item),$("<span>").addClass("remover").addClass(o.clsSelectedItemRemover).html("&times;").appendTo(tag)):(list_item.addClass("active"),input.html(html));break}}),element.trigger("change"),Utils.exec(o.onChange,[this.getSelected()],element[0])},data:function(op){var option_group,element=this.element;element.html(""),"string"==typeof op?element.html(op):Utils.isObject(op)&&$.each(op,function(key,val){Utils.isObject(val)?(option_group=$("<optgroup>").attr("label",key).appendTo(element),$.each(val,function(key2,val2){$("<option>").attr("value",key2).text(val2).appendTo(option_group)})):$("<option>").attr("value",key).text(val).appendTo(element)}),this._createOptions()},changeAttribute:function(attributeName){switch(attributeName){case"disabled":this.toggleState()}},destroy:function(){var element=this.element,container=element.closest(".select"),drop_container=container.find(".drop-container"),input=element.siblings(".select-input"),filter_input=drop_container.find("input"),list=drop_container.find("ul");container.off(Metro.events.click),container.off(Metro.events.click,".input-clear-button"),input.off(Metro.events.click),filter_input.off(Metro.events.blur),filter_input.off(Metro.events.focus),list.off(Metro.events.click,"li"),filter_input.off(Metro.events.keyup),drop_container.off(Metro.events.click),Metro.destroyPlugin(drop_container,"dropdown"),element.insertBefore(container),container.remove()}};$(document).on(Metro.events.click,function(){var selects=$(".select .drop-container");$.each(selects,function(){$(this).data("dropdown").close()}),$(".select").removeClass("focused")}),Metro.plugin("select",Select);var Sidebar={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.toggle_element=null,this._setOptionsFromDOM(),this._create(),this},options:{shadow:!0,position:"left",size:290,shift:null,staticShift:null,toggle:null,duration:METRO_ANIMATION_DURATION,static:null,menuItemClick:!0,onOpen:Metro.noop,onClose:Metro.noop,onToggle:Metro.noop,onStaticSet:Metro.noop,onStaticLoss:Metro.noop,onSidebarCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createStructure(),this._createEvents(),$(window).resize(),this._checkStatic(),Utils.exec(o.onSidebarCreate,[element],element[0])},_createStructure:function(){var element=this.element,o=this.options,header=element.find(".sidebar-header"),sheet=Metro.sheet;element.addClass("sidebar").addClass("on-"+o.position),290!==o.size&&(Utils.addCssRule(sheet,".sidebar","width: "+o.size+"px;"),"left"===o.position?Utils.addCssRule(sheet,".sidebar.on-left","left: "+-o.size+"px;"):Utils.addCssRule(sheet,".sidebar.on-right","right: "+-o.size+"px;")),!0===o.shadow&&element.addClass("sidebar-shadow"),void 0===element.attr("id")&&element.attr("id",Utils.elementId("sidebar")),null!==o.toggle&&0<$(o.toggle).length&&(this.toggle_element=$(o.toggle)),0<header.length&&void 0!==header.data("image")&&header.css({backgroundImage:"url("+header.data("image")+")"}),null!==o.static&&null!==o.staticShift&&("left"===o.position?Utils.addCssRule(sheet,"@media screen and "+Metro.media_queries[o.static.toUpperCase()],o.staticShift+"{margin-left: "+o.size+"px; width: calc(100% - "+o.size+"px);}"):Utils.addCssRule(sheet,"@media screen and "+Metro.media_queries[o.static.toUpperCase()],o.staticShift+"{margin-right: "+o.size+"px; width: calc(100% - "+o.size+"px);}"))},_createEvents:function(){var that=this,element=this.element,o=this.options,toggle=this.toggle_element;null!==toggle&&toggle.on(Metro.events.click,function(e){that.toggle()}),null!==o.static&&-1<["fs","sm","md","lg","xl","xxl"].indexOf(o.static)&&$(window).on(Metro.events.resize+"_"+element.attr("id"),function(){that._checkStatic()}),!0===o.menuItemClick&&element.on(Metro.events.click,".sidebar-menu li > a",function(){that.close()}),element.on(Metro.events.click,".sidebar-menu .js-sidebar-close",function(){that.close()})},_checkStatic:function(){var element=this.element,o=this.options;Utils.mediaExist(o.static)&&!element.hasClass("static")&&(element.addClass("static"),element.data("opened",!1).removeClass("open"),null!==o.shift&&$.each(o.shift.split(","),function(){$(this).css({left:0},o.duration)}),Utils.exec(o.onStaticSet,[element],element[0])),Utils.mediaExist(o.static)||(element.removeClass("static"),Utils.exec(o.onStaticLoss,[element],element[0]))},isOpen:function(){return!0===this.element.data("opened")},open:function(){var element=this.element,o=this.options;element.hasClass("static")||(element.data("opened",!0).addClass("open"),null!==o.shift&&$(o.shift).animate({left:element.outerWidth()},o.duration),Utils.exec(o.onOpen,[element],element[0]))},close:function(){var element=this.element,o=this.options;element.hasClass("static")||(element.data("opened",!1).removeClass("open"),null!==o.shift&&$(o.shift).animate({left:0},o.duration),Utils.exec(o.onClose,[element],element[0]))},toggle:function(){this.isOpen()?this.close():this.open(),Utils.exec(this.options.onToggle,[this.element],this.element[0])},changeAttribute:function(attributeName){},destroy:function(){}};Metro.plugin("sidebar",Sidebar);var Slider={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.slider=null,this.value=0,this.percent=0,this.pixel=0,this.buffer=0,this.keyInterval=!1,this._setOptionsFromDOM(),this._create(),this},options:{min:0,max:100,accuracy:0,showMinMax:!(Metro.sidebar={isSidebar:function(el){return Utils.isMetroObject(el,"sidebar")},open:function(el){this.isSidebar(el)&&$(el).data("sidebar").open()},close:function(el){this.isSidebar(el)&&$(el).data("sidebar").close()},toggle:function(el){this.isSidebar(el)&&$(el).data("sidebar").toggle()},isOpen:function(el){if(this.isSidebar(el))return $(el).data("sidebar").isOpen()}}),minMaxPosition:Metro.position.TOP,value:0,buffer:0,hint:!1,hintAlways:!1,hintPosition:Metro.position.TOP,hintMask:"$1",vertical:!1,target:null,returnType:"value",size:0,clsSlider:"",clsBackside:"",clsComplete:"",clsBuffer:"",clsMarker:"",clsHint:"",clsMinMax:"",clsMin:"",clsMax:"",onStart:Metro.noop,onStop:Metro.noop,onMove:Metro.noop,onClick:Metro.noop,onChange:Metro.noop,onChangeValue:Metro.noop,onChangeBuffer:Metro.noop,onFocus:Metro.noop,onBlur:Metro.noop,onSliderCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createSlider(),this._createEvents(),this.buff(o.buffer),this.val(o.value),Utils.exec(o.onSliderCreate,[element])},_createSlider:function(){var i,element=this.element,o=this.options,prev=element.prev(),parent=element.parent(),slider=$("<div>").addClass("slider "+element[0].className).addClass(o.clsSlider),backside=$("<div>").addClass("backside").addClass(o.clsBackside),complete=$("<div>").addClass("complete").addClass(o.clsComplete),buffer=$("<div>").addClass("buffer").addClass(o.clsBuffer),marker=$("<button>").attr("type","button").addClass("marker").addClass(o.clsMarker),hint=$("<div>").addClass("hint").addClass(o.hintPosition+"-side").addClass(o.clsHint),id=Utils.uniqueId();if(slider.attr("id",id),0<o.size&&(!0===o.vertical?slider.outerHeight(o.size):slider.outerWidth(o.size)),!0===o.vertical&&slider.addClass("vertical-slider"),0===prev.length?parent.prepend(slider):slider.insertAfter(prev),!0===o.hintAlways&&hint.css({display:"block"}).addClass("permanent-hint"),element.appendTo(slider),backside.appendTo(slider),complete.appendTo(slider),buffer.appendTo(slider),marker.appendTo(slider),hint.appendTo(marker),!0===o.showMinMax){var min_max_wrapper=$("<div>").addClass("slider-min-max clear").addClass(o.clsMinMax);$("<span>").addClass("place-left").addClass(o.clsMin).html(o.min).appendTo(min_max_wrapper),$("<span>").addClass("place-right").addClass(o.clsMax).html(o.max).appendTo(min_max_wrapper),o.minMaxPosition===Metro.position.TOP?min_max_wrapper.insertBefore(slider):min_max_wrapper.insertAfter(slider)}if(!(element[0].className="")===o.copyInlineStyles)for(i=0;i<element[0].style.length;i++)slider.css(element[0].style[i],element.css(element[0].style[i]));element.is(":disabled")?this.disable():this.enable(),this.slider=slider},_createEvents:function(){var that=this,slider=this.slider,o=this.options,marker=slider.find(".marker"),hint=slider.find(".hint");marker.on(Metro.events.start,function(){$(document).on(Metro.events.move,function(e){!0===o.hint&&!0!==o.hintAlways&&hint.fadeIn(),that._move(e),Utils.exec(o.onMove,[that.value,that.percent,slider])}),$(document).on(Metro.events.stop,function(){$(document).off(Metro.events.move),$(document).off(Metro.events.stop),!0!==o.hintAlways&&hint.fadeOut(),Utils.exec(o.onStop,[that.value,that.percent,slider])}),Utils.exec(o.onStart,[that.value,that.percent,slider])}),marker.on(Metro.events.focus,function(){Utils.exec(o.onFocus,[that.value,that.percent,slider])}),marker.on(Metro.events.blur,function(){Utils.exec(o.onBlur,[that.value,that.percent,slider])}),marker.on(Metro.events.keydown,function(e){var key=e.keyCode?e.keyCode:e.which;if(-1!==[37,38,39,40].indexOf(key)){var step=0===o.accuracy?1:o.accuracy;that.keyInterval||(that.keyInterval=setInterval(function(){var val=that.value;37!==e.keyCode&&40!==e.keyCode||(val-step<o.min?val=o.min:val-=step),38!==e.keyCode&&39!==e.keyCode||(val+step>o.max?val=o.max:val+=step),that.value=that._correct(val),that.percent=that._convert(that.value,"val2prc"),that.pixel=that._convert(that.percent,"prc2pix"),that._redraw()},100),e.preventDefault())}}),marker.on(Metro.events.keyup,function(){clearInterval(that.keyInterval),that.keyInterval=!1}),slider.on(Metro.events.click,function(e){that._move(e),Utils.exec(o.onClick,[that.value,that.percent,slider]),Utils.exec(o.onStop,[that.value,that.percent,slider])}),$(window).resize(function(){that.val(that.value),that.buff(that.buffer)})},_convert:function(v,how){var slider=this.slider,o=this.options,length=(!0===o.vertical?slider.outerHeight():slider.outerWidth())-slider.find(".marker").outerWidth();switch(how){case"pix2prc":return Math.round(100*v/length);case"pix2val":return Math.round(this._convert(v,"pix2prc")*((o.max-o.min)/100)+o.min);case"val2prc":return Math.round((v-o.min)/((o.max-o.min)/100));case"prc2pix":return Math.round(v/(100/length));case"val2pix":return Math.round(this._convert(this._convert(v,"val2prc"),"prc2pix"))}return 0},_correct:function(value){var accuracy=this.options.accuracy,min=this.options.min,max=this.options.max;return 0===accuracy||isNaN(accuracy)||((value=Math.floor(value/accuracy)*accuracy+Math.round(value%accuracy/accuracy)*accuracy)<min&&(value=min),max<value&&(value=max)),value},_move:function(e){var cPos,cPix,slider=this.slider,o=this.options,offset=slider.offset(),marker_size=slider.find(".marker").outerWidth(),length=!0===o.vertical?slider.outerHeight():slider.outerWidth(),cStop=length-marker_size;cPos=!0===o.vertical?Utils.pageXY(e).y-offset.top:Utils.pageXY(e).x-offset.left,(cPix=!0===o.vertical?length-cPos-marker_size/2:cPos-marker_size/2)<0||cStop<cPix||(this.value=this._correct(this._convert(cPix,"pix2val")),this.percent=this._convert(this.value,"val2prc"),this.pixel=this._convert(this.percent,"prc2pix"),this._redraw())},_hint:function(){var value,o=this.options,hint=this.slider.find(".hint");value=o.hintMask.replace("$1",this.value).replace("$2",this.percent),hint.text(value)},_value:function(){var element=this.element,o=this.options,slider=this.slider,value="value"===o.returnType?this.value:this.percent;if("INPUT"===element[0].tagName&&element.val(value),element.trigger("change"),null!==o.target){var target=$(o.target);0!==target.length&&$.each(target,function(){var t=$(this);"INPUT"===this.tagName?t.val(value):t.text(value)})}Utils.exec(o.onChangeValue,[value,this.percent,slider],element[0]),Utils.exec(o.onChange,[value,this.percent,this.buffer],element[0])},_marker:function(){var slider=this.slider,o=this.options,marker=slider.find(".marker"),complete=slider.find(".complete"),length=!0===o.vertical?slider.outerHeight():slider.outerWidth(),marker_size=parseInt(Utils.getStyleOne(marker,"width")),slider_visible=Utils.isVisible(slider);slider_visible&&marker.css({"margin-top":0,"margin-left":0}),!0===o.vertical?(slider_visible?marker.css("top",length-this.pixel):(marker.css("top",this.percent+"%"),marker.css("margin-top",0===this.percent?0:-1*marker_size/2)),complete.css("height",this.percent+"%")):(slider_visible?marker.css("left",this.pixel):(marker.css("left",this.percent+"%"),marker.css("margin-left",0===this.percent?0:-1*marker_size/2)),complete.css("width",this.percent+"%"))},_redraw:function(){this._marker(),this._value(),this._hint()},_buffer:function(){var element=this.element,o=this.options,buffer=this.slider.find(".buffer");!0===o.vertical?buffer.css("height",this.buffer+"%"):buffer.css("width",this.buffer+"%"),Utils.exec(o.onChangeBuffer,[this.buffer,this.slider],element[0]),Utils.exec(o.onChange,[element.val(),this.percent,this.buffer],element[0])},val:function(v){var o=this.options;if(void 0===v||isNaN(v))return this.value;v<o.min&&(v=o.min),v>o.max&&(v=o.max),this.value=this._correct(v),this.percent=this._convert(this.value,"val2prc"),this.pixel=this._convert(this.percent,"prc2pix"),this._redraw()},buff:function(v){var buffer=this.slider.find(".buffer");return void 0===v||isNaN(v)?this.buffer:0!==buffer.length&&(100<(v=parseInt(v))&&(v=100),v<0&&(v=0),this.buffer=v,void this._buffer())},changeValue:function(){var element=this.element,o=this.options,val=element.attr("data-value");val<o.min&&(val=o.min),val>o.max&&(val=o.max),this.val(val)},changeBuffer:function(){var element=this.element,val=parseInt(element.attr("data-buffer"));val<0&&(val=0),100<val&&(val=100),this.buff(val)},disable:function(){this.element.data("disabled",!0),this.element.parent().addClass("disabled")},enable:function(){this.element.data("disabled",!1),this.element.parent().removeClass("disabled")},toggleState:function(){this.elem.disabled?this.disable():this.enable()},changeAttribute:function(attributeName){switch(attributeName){case"data-value":this.changeValue();break;case"data-buffer":this.changeBuffer();break;case"disabled":this.toggleState()}}};Metro.plugin("slider",Slider);var Sorter={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.initial=[],this._setOptionsFromDOM(),this._create(),this},options:{thousandSeparator:",",decimalSeparator:",",sortTarget:null,sortSource:null,sortDir:"asc",sortStart:!0,saveInitial:!0,onSortStart:Metro.noop,onSortStop:Metro.noop,onSortItemSwitch:Metro.noop,onSorterCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createStructure(),Utils.exec(o.onSorterCreate,[element])},_createStructure:function(){var element=this.element,o=this.options;null===o.sortTarget&&(o.sortTarget=element.children()[0].tagName),this.initial=element.find(o.sortTarget).get(),!0===o.sortStart&&this.sort(o.sortDir)},_getItemContent:function(item){var data,inset,i,format,o=this.options;if(Utils.isValue(o.sortSource)){if(data="",0<(inset=item.getElementsByClassName(o.sortSource)).length)for(i=0;i<inset.length;i++)data+=inset[i].textContent;format=inset[0].dataset.format}else data=item.textContent,format=item.dataset.format;if(data=(""+data).toLowerCase().replace(/[\n\r]+|[\s]{2,}/g," ").trim(),Utils.isValue(format))switch(-1===["number","int","float","money"].indexOf(format)||","===o.thousandSeparator&&"."===o.decimalSeparator||(data=Utils.parseNumber(data,o.thousandSeparator,o.decimalSeparator)),format){case"date":data=Utils.isDate(data)?new Date(data):"";break;case"number":data=Number(data);break;case"int":data=parseInt(data);break;case"float":data=parseFloat(data);break;case"money":data=Utils.parseMoney(data);break;case"card":data=Utils.parseCard(data);break;case"phone":data=Utils.parsePhone(data)}return data},sort:function(dir){var items,prev,that=this,element=this.element,o=this.options,id=Utils.uniqueId();void 0!==dir&&(o.sortDir=dir),0!==(items=element.find(o.sortTarget).get()).length&&(prev=$("<div>").attr("id",id).insertBefore($(element.find(o.sortTarget)[0])),Utils.exec(o.onSortStart,[element],element[0]),items.sort(function(a,b){var c1=that._getItemContent(a),c2=that._getItemContent(b),result=0;return c1<c2?-1:c2<c1?1:(0!==result&&Utils.exec(o.onSortItemSwitch,[a,b],element[0]),result)}),"desc"===o.sortDir&&items.reverse(),element.find(o.sortTarget).remove(),$.each(items,function(){var $this=$(this);$this.insertAfter(prev),prev=$this}),$("#"+id).remove(),Utils.exec(o.onSortStop,[element],element[0]))},reset:function(){var items,prev,element=this.element,o=this.options,id=Utils.uniqueId();0!==(items=this.initial).length&&(prev=$("<div>").attr("id",id).insertBefore($(element.find(o.sortTarget)[0])),element.find(o.sortTarget).remove(),$.each(items,function(){var $this=$(this);$this.insertAfter(prev),prev=$this}),$("#"+id).remove())},changeAttribute:function(attributeName){var content,dir,that=this,element=this.element,o=this.options;switch(attributeName){case"data-sort-dir":""!==(dir=element.attr("data-sort-dir").trim())&&(o.sortDir=dir,that.sort());break;case"data-sort-content":""!==(content=element.attr("data-sort-content").trim())&&(o.sortContent=content,that.sort())}},destroy:function(){}};Metro.plugin("sorter",Sorter);var Spinner={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.repeat_timer=!1,this._setOptionsFromDOM(),this._create(),this},options:{step:1,plusIcon:"<span class='default-icon-plus'></span>",minusIcon:"<span class='default-icon-minus'></span>",buttonsPosition:"default",defaultValue:0,minValue:null,maxValue:null,fixed:0,repeatThreshold:1e3,hideCursor:!(Metro.sorter={create:function(el,op){return $(el).sorter(op)},isSorter:function(el){return Utils.isMetroObject(el,"sorter")},sort:function(el,dir){if(!this.isSorter(el))return!1;void 0===dir&&(dir="asc"),$(el).data("sorter").sort(dir)},reset:function(el){if(!this.isSorter(el))return!1;$(el).data("sorter").reset()}}),clsSpinner:"",clsSpinnerInput:"",clsSpinnerButton:"",clsSpinnerButtonPlus:"",clsSpinnerButtonMinus:"",onBeforeChange:Metro.noop_true,onChange:Metro.noop,onPlusClick:Metro.noop,onMinusClick:Metro.noop,onArrowUp:Metro.noop,onArrowDown:Metro.noop,onButtonClick:Metro.noop,onArrowClick:Metro.noop,onSpinnerCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createStructure(),this._createEvents(),Utils.exec(o.onCreate,[element])},_createStructure:function(){var element=this.element,o=this.options,spinner=$("<div>").addClass("spinner").addClass("buttons-"+o.buttonsPosition).addClass(element[0].className).addClass(o.clsSpinner),button_plus=$("<button>").attr("type","button").addClass("button spinner-button spinner-button-plus").addClass(o.clsSpinnerButton+" "+o.clsSpinnerButtonPlus).html(o.plusIcon),button_minus=$("<button>").attr("type","button").addClass("button spinner-button spinner-button-minus").addClass(o.clsSpinnerButton+" "+o.clsSpinnerButtonMinus).html(o.minusIcon),init_value=element.val().trim();Utils.isValue(init_value)||element.val(0),element[0].className="",spinner.insertBefore(element),element.appendTo(spinner).addClass(o.clsSpinnerInput),element.addClass("original-input"),button_plus.appendTo(spinner),button_minus.appendTo(spinner),!0===o.hideCursor&&spinner.addClass("hide-cursor"),!0===o.disabled||element.is(":disabled")?this.disable():this.enable()},_createEvents:function(){var that=this,element=this.element,o=this.options,spinner=element.closest(".spinner"),spinner_buttons=spinner.find(".spinner-button"),spinnerButtonClick=function(plus,threshold){var curr=element.val(),val=Number(element.val()),step=Number(o.step);plus?val+=step:val-=step,that._setValue(val.toFixed(o.fixed),!0),Utils.exec(plus?o.onPlusClick:o.onMinusClick,[curr,val,element.val()],element[0]),Utils.exec(plus?o.onArrowUp:o.onArrowDown,[curr,val,element.val()],element[0]),Utils.exec(o.onButtonClick,[curr,val,element.val(),plus?"plus":"minus"],element[0]),Utils.exec(o.onArrowClick,[curr,val,element.val(),plus?"plus":"minus"],element[0]),setTimeout(function(){that.repeat_timer&&spinnerButtonClick(plus,100)},threshold)};spinner.on(Metro.events.click,function(e){$(".focused").removeClass("focused"),spinner.addClass("focused"),e.preventDefault(),e.stopPropagation()}),spinner_buttons.on(Metro.events.start,function(e){e.preventDefault(),that.repeat_timer=!0,spinnerButtonClick($(this).hasClass("spinner-button-plus"),o.repeatThreshold)}),spinner_buttons.on(Metro.events.stop,function(){that.repeat_timer=!1}),element.on(Metro.events.keydown,function(e){e.keyCode!==Metro.keyCode.UP_ARROW&&e.keyCode!==Metro.keyCode.DOWN_ARROW||(that.repeat_timer=!0,spinnerButtonClick(e.keyCode===Metro.keyCode.UP_ARROW,o.repeatThreshold))}),spinner.on(Metro.events.keyup,function(){that.repeat_timer=!1})},_setValue:function(val,trigger_change){var element=this.element,o=this.options;!0===Utils.exec(o.onBeforeChange,[val],element[0])&&(Utils.isValue(o.maxValue)&&val>Number(o.maxValue)&&(val=Number(o.maxValue)),Utils.isValue(o.minValue)&&val<Number(o.minValue)&&(val=Number(o.minValue)),element.val(val),Utils.exec(o.onChange,[val],element[0]),!0===trigger_change&&element.trigger("change"))},val:function(val){var element=this.element,o=this.options;if(!Utils.isValue(val))return element.val();this._setValue(val.toFixed(o.fixed),!0)},toDefault:function(){var element=this.element,o=this.options,val=Utils.isValue(o.defaultValue)?Number(o.defaultValue):0;this._setValue(val.toFixed(o.fixed),!0),Utils.exec(o.onChange,[val],element[0])},disable:function(){this.element.data("disabled",!0),this.element.parent().addClass("disabled")},enable:function(){this.element.data("disabled",!1),this.element.parent().removeClass("disabled")},toggleState:function(){this.elem.disabled?this.disable():this.enable()},changeAttribute:function(attributeName){var val,that=this,element=this.element;switch(attributeName){case"disabled":this.toggleState();break;case"value":val=element.attr("value").trim(),Utils.isValue(val)&&that._setValue(Number(val),!1)}},destroy:function(){var element=this.element,spinner=element.closest(".spinner");spinner.off(Metro.events.click,".spinner-button"),element.insertBefore(spinner),spinner.remove()}};Metro.plugin("spinner",Spinner),$(document).on(Metro.events.click,function(){$(".spinner").removeClass("focused")});var Splitter={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.storage=Utils.isValue(Metro.storage)?Metro.storage:null,this.storageKey="SPLITTER:",this._setOptionsFromDOM(),this._create(),this},options:{splitMode:"horizontal",splitSizes:null,gutterSize:4,minSizes:null,children:"*",gutterClick:"expand",saveState:!1,onResizeStart:Metro.noop,onResizeStop:Metro.noop,onResizeSplit:Metro.noop,onSplitterCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createStructure(),this._createEvents(),Utils.exec(o.onCreate,[element])},_createStructure:function(){var i,gutters,element=this.element,o=this.options,children=element.children(o.children).addClass("split-block"),children_sizes=[],resizeProp="horizontal"===o.splitMode?"width":"height";for(Utils.isValue(element.attr("id"))||element.attr("id",Utils.elementId("splitter")),element.addClass("splitter"),"vertical"===o.splitMode.toLowerCase()&&element.addClass("vertical"),i=0;i<children.length-1;i++)$("<div>").addClass("gutter").css(resizeProp,o.gutterSize).insertAfter($(children[i]));if(gutters=element.children(".gutter"),Utils.isValue(o.splitSizes))for(children_sizes=Utils.strToArray(o.splitSizes),i=0;i<children_sizes.length;i++)$(children[i]).css({flexBasis:"calc("+children_sizes[i]+"% - "+gutters.length*o.gutterSize+"px)"});else children.css({flexBasis:"calc("+100/children.length+"% - "+gutters.length*o.gutterSize+"px)"});if(Utils.isValue(o.minSizes))if(String(o.minSizes).contains(","))for(children_sizes=Utils.strToArray(o.minSizes),i=0;i<children_sizes.length;i++)$(children[i]).data("min-size",children_sizes[i]),children[i].style.setProperty("min-"+resizeProp,String(children_sizes[i]).contains("%")?children_sizes[i]:String(children_sizes[i]).replace("px","")+"px","important");else $.each(children,function(){this.style.setProperty("min-"+resizeProp,String(o.minSizes).contains("%")?o.minSizes:String(o.minSizes).replace("px","")+"px","important")});o.saveState&&null!==this.storage&&this._getSize()},_createEvents:function(){var that=this,element=this.element,o=this.options,gutters=element.children(".gutter");gutters.on(Metro.events.start,function(e){var w="horizontal"===o.splitMode?element.width():element.height(),gutter=$(this),prev_block=gutter.prev(".split-block"),next_block=gutter.next(".split-block"),prev_block_size=100*("horizontal"===o.splitMode?prev_block.outerWidth(!0):prev_block.outerHeight(!0))/w,next_block_size=100*("horizontal"===o.splitMode?next_block.outerWidth(!0):next_block.outerHeight(!0))/w,start_pos=Utils.getCursorPosition(element,e);gutter.addClass("active"),prev_block.addClass("stop-select stop-pointer"),next_block.addClass("stop-select stop-pointer"),Utils.exec(o.onResizeStart,[start_pos,gutter,prev_block,next_block],element),$(window).on(Metro.events.move+"-"+element.attr("id"),function(e){var new_pos,pos=Utils.getCursorPosition(element,e);new_pos="horizontal"===o.splitMode?100*pos.x/w-100*start_pos.x/w:100*pos.y/w-100*start_pos.y/w,prev_block.css("flex-basis","calc("+(prev_block_size+new_pos)+"% - "+gutters.length*o.gutterSize+"px)"),next_block.css("flex-basis","calc("+(next_block_size-new_pos)+"% - "+gutters.length*o.gutterSize+"px)"),Utils.exec(o.onResizeSplit,[pos,gutter,prev_block,next_block],element)}),$(window).on(Metro.events.stop+"-"+element.attr("id"),function(e){prev_block.removeClass("stop-select stop-pointer"),next_block.removeClass("stop-select stop-pointer"),that._saveSize(),gutter.removeClass("active"),$(window).off(Metro.events.move+"-"+element.attr("id")),$(window).off(Metro.events.stop+"-"+element.attr("id")),Utils.exec(o.onResizeStop,[Utils.getCursorPosition(element,e),gutter,prev_block,next_block],element)})})},_saveSize:function(){var element=this.element,o=this.options,storage=this.storage,itemsSize=[];!0===o.saveState&&null!==storage&&($.each(element.children(".split-block"),function(){var item=$(this);itemsSize.push(item.css("flex-basis"))}),storage.setItem(this.storageKey+element.attr("id"),itemsSize))},_getSize:function(){var element=this.element,o=this.options,storage=this.storage,itemsSize=[];!0===o.saveState&&null!==storage&&(itemsSize=storage.getItem(this.storageKey+element.attr("id")),$.each(element.children(".split-block"),function(i,v){var item=$(v);Utils.isValue(itemsSize)&&Utils.isValue(itemsSize[i])&&item.css("flex-basis",itemsSize[i])}))},changeAttribute:function(attributeName){},destroy:function(){}};Metro.plugin("splitter",Splitter);var Stepper={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.current=0,this._setOptionsFromDOM(),this._create(),this},options:{view:Metro.stepperView.SQUARE,steps:3,step:1,stepClick:!1,clsStepper:"",clsStep:"",clsComplete:"",clsCurrent:"",onStep:Metro.noop,onStepClick:Metro.noop,onStepperCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;o.step<=0&&(o.step=1),this._createStepper(),this._createEvents(),Utils.exec(o.onStepperCreate,[element])},_createStepper:function(){var i,element=this.element,o=this.options;for(element.addClass("stepper").addClass(o.view).addClass(o.clsStepper),i=1;i<=o.steps;i++)$("<span>").addClass("step").addClass(o.clsStep).data("step",i).html("<span>"+i+"</span>").appendTo(element);this.current=1,this.toStep(o.step)},_createEvents:function(){var that=this,element=this.element,o=this.options;element.on(Metro.events.click,".step",function(){var step=$(this).data("step");!0===o.stepClick&&(that.toStep(step),Utils.exec(o.onStepClick,[step,element]))})},next:function(){var element=this.element,steps=(this.options,element.find(".step"));this.current+1>steps.length||(this.current++,this.toStep(this.current))},prev:function(){this.element,this.options;this.current-1!=0&&(this.current--,this.toStep(this.current))},last:function(){var element=this.element;this.options;this.toStep(element.find(".step").length)},first:function(){this.toStep(1)},toStep:function(step){var element=this.element,o=this.options,target=$(element.find(".step").get(step-1));0!==target.length&&(this.current=step,element.find(".step").removeClass("complete current").removeClass(o.clsCurrent).removeClass(o.clsComplete),target.addClass("current").addClass(o.clsCurrent),target.prevAll().addClass("complete").addClass(o.clsComplete),Utils.exec(o.onStep,[this.current,element]))},changeAttribute:function(attributeName){}};Metro.plugin("stepper",Stepper);var Streamer={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.data=null,this._setOptionsFromDOM(),this._create(),this},options:{duration:METRO_ANIMATION_DURATION,defaultClosedIcon:"",defaultOpenIcon:"",changeUri:!0,encodeLink:!0,closed:!1,chromeNotice:!1,startFrom:null,slideToStart:!0,startSlideSleep:1e3,source:null,data:null,eventClick:"select",selectGlobal:!0,streamSelect:!1,excludeSelectElement:null,excludeClickElement:null,excludeElement:null,excludeSelectClass:"",excludeClickClass:"",excludeClass:"",onStreamClick:Metro.noop,onStreamSelect:Metro.noop,onEventClick:Metro.noop,onEventSelect:Metro.noop,onStreamerCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var that=this,element=this.element,o=this.options;if(element.addClass("streamer"),void 0===element.attr("id")&&element.attr("id",Utils.elementId("streamer")),null===o.source&&null===o.data)return!1;$("<div>").addClass("streams").appendTo(element),$("<div>").addClass("events-area").appendTo(element),null!==o.source?$.get(o.source,function(data){that.data=data,that.build()}):(this.data=o.data,this.build()),this._createEvents(),!0===o.chromeNotice&&!0===Utils.detectChrome()&&!1===Utils.isTouchDevice()&&$("<p>").addClass("text-small text-muted").html("*) In Chrome browser please press and hold Shift and turn the mouse wheel.").insertAfter(element)},build:function(){var that=this,element=this.element,o=this.options,data=this.data,streams=element.find(".streams").html(""),events_area=element.find(".events-area").html(""),timeline=$("<ul>").addClass("streamer-timeline").html("").appendTo(events_area),streamer_events=$("<div>").addClass("streamer-events").appendTo(events_area),event_group_main=$("<div>").addClass("event-group").appendTo(streamer_events),StreamerIDS=Utils.getURIParameter(null,"StreamerIDS");null!==StreamerIDS&&!0===o.encodeLink&&(StreamerIDS=atob(StreamerIDS));var StreamerIDS_i=StreamerIDS?StreamerIDS.split("|")[0]:null,StreamerIDS_a=StreamerIDS?StreamerIDS.split("|")[1].split(","):[];if(void 0!==data.actions){var actions=$("<div>").addClass("streamer-actions").appendTo(streams);$.each(data.actions,function(){var item=this,button=$("<button>").addClass("streamer-action").addClass(item.cls).html(item.html);void 0!==item.onclick&&button.on(Metro.events.click,function(){Utils.exec(item.onclick,[element])}),button.appendTo(actions)})}timeline.html(""),void 0===data.timeline&&(data.timeline={start:"09:00",stop:"18:00",step:20});var start=new Date,stop=new Date,start_time_array=data.timeline.start?data.timeline.start.split(":"):[9,0],stop_time_array=data.timeline.stop?data.timeline.stop.split(":"):[18,0],step=data.timeline.step?60*parseInt(data.timeline.step):1200;start.setHours(start_time_array[0]),start.setMinutes(start_time_array[1]),start.setSeconds(0),stop.setHours(stop_time_array[0]),stop.setMinutes(stop_time_array[1]),stop.setSeconds(0);for(var i=start.getTime()/1e3;i<=stop.getTime()/1e3;i+=step){var t=new Date(1e3*i),h=t.getHours(),m=t.getMinutes(),v=(h<10?"0"+h:h)+":"+(m<10?"0"+m:m);$("<li>").data("time",v).addClass("js-time-point-"+v.replace(":","-")).html("<em>"+v+"</em>").appendTo(timeline)}void 0!==data.streams&&$.each(data.streams,function(stream_index){var stream=$("<div>").addClass("stream").addClass(this.cls).appendTo(streams);stream.addClass(this.cls).data("one",!1).data("data",this.data),$("<div>").addClass("stream-title").html(this.title).appendTo(stream),$("<div>").addClass("stream-secondary").html(this.secondary).appendTo(stream),$(this.icon).addClass("stream-icon").appendTo(stream);var bg=Utils.computedRgbToHex(Utils.getStyleOne(stream,"background-color")),fg=Utils.computedRgbToHex(Utils.getStyleOne(stream,"color")),stream_events=$("<div>").addClass("stream-events").data("background-color",bg).data("text-color",fg).appendTo(event_group_main);if(void 0!==this.events){$.each(this.events,function(event_index){var _icon,sid=stream_index+":"+event_index,custom_html=void 0!==this.custom?this.custom:"",custom_html_open=void 0!==this.custom_open?this.custom_open:"",custom_html_close=void 0!==this.custom_close?this.custom_close:"",event=$("<div>").data("origin",this).data("sid",sid).data("data",this.data).data("time",this.time).data("target",this.target).addClass("stream-event").addClass("size-"+this.size+"x").addClass(this.cls).appendTo(stream_events),left=timeline.find(".js-time-point-"+this.time.replace(":","-"))[0].offsetLeft-stream.outerWidth();event.css({position:"absolute",left:left});var slide=$("<div>").addClass("stream-event-slide").appendTo(event),slide_logo=$("<div>").addClass("slide-logo").appendTo(slide),slide_data=$("<div>").addClass("slide-data").appendTo(slide);void 0!==this.icon&&(Utils.isTag(this.icon)?$(this.icon).addClass("icon").appendTo(slide_logo):$("<img>").addClass("icon").attr("src",this.icon).appendTo(slide_logo)),$("<span>").addClass("time").css({backgroundColor:bg,color:fg}).html(this.time).appendTo(slide_logo),$("<div>").addClass("title").html(this.title).appendTo(slide_data),$("<div>").addClass("subtitle").html(this.subtitle).appendTo(slide_data),$("<div>").addClass("desc").html(this.desc).appendTo(slide_data),(!1===o.closed&&element.attr("id")===StreamerIDS_i&&-1!==StreamerIDS_a.indexOf(sid)||!0===this.selected||1===parseInt(this.selected))&&event.addClass("selected"),!0===o.closed||!0===this.closed||1===parseInt(this.closed)?(_icon=void 0!==this.closedIcon?Utils.isTag(this.closedIcon)?this.closedIcon:"<span>"+this.closedIcon+"</span>":Utils.isTag(o.defaultClosedIcon)?o.defaultClosedIcon:"<span>"+o.defaultClosedIcon+"</span>",$(_icon).addClass("state-icon").addClass(this.clsClosedIcon).appendTo(slide),event.data("closed",!0).data("target",this.target),event.append(custom_html_open)):(_icon=void 0!==this.openIcon?Utils.isTag(this.openIcon)?this.openIcon:"<span>"+this.openIcon+"</span>":Utils.isTag(o.defaultOpenIcon)?o.defaultOpenIcon:"<span>"+o.defaultOpenIcon+"</span>",$(_icon).addClass("state-icon").addClass(this.clsOpenIcon).appendTo(slide),event.data("closed",!1),event.append(custom_html_close)),event.append(custom_html)});var last_child=stream_events.find(".stream-event:last-child");0<last_child.length&&stream_events.outerWidth(last_child[0].offsetLeft+last_child.outerWidth())}}),void 0!==data.global&&$.each(["before","after"],function(){void 0!==data.global[this]&&$.each(data.global[this],function(){var group=$("<div>").addClass("event-group").addClass("size-"+this.size+"x"),events=$("<div>").addClass("stream-events global-stream").appendTo(group),event=$("<div>").addClass("stream-event").appendTo(events);event.addClass("global-event").addClass(this.cls).data("time",this.time).data("origin",this).data("data",this.data),$("<div>").addClass("event-title").html(this.title).appendTo(event),$("<div>").addClass("event-subtitle").html(this.subtitle).appendTo(event),$("<div>").addClass("event-html").html(this.html).appendTo(event);var left,t=timeline.find(".js-time-point-"+this.time.replace(":","-"));0<t.length&&(left=t[0].offsetLeft-streams.find(".stream").outerWidth()),group.css({position:"absolute",left:left,height:"100%"}).appendTo(streamer_events)})}),element.data("stream",-1),null!==o.startFrom&&!0===o.slideToStart&&setTimeout(function(){that.slideTo(o.startFrom)},o.startSlideSleep),Utils.exec(o.onStreamerCreate,[element])},_createEvents:function(){var that=this,element=this.element,o=this.options;element.on(Metro.events.click,".stream-event",function(e){var event=$(this);if(!(""!==o.excludeClass&&event.hasClass(o.excludeClass)||null!==o.excludeElement&&$(e.target).is(o.excludeElement)))if(!1===o.closed&&!0!==event.data("closed")&&"select"===o.eventClick)""!==o.excludeSelectClass&&event.hasClass(o.excludeSelectClass)||null!==o.excludeSelectElement&&$(e.target).is(o.excludeSelectElement)||(event.hasClass("global-event")?!0===o.selectGlobal&&event.toggleClass("selected"):event.toggleClass("selected"),!0===o.changeUri&&that._changeURI(),Utils.exec(o.onEventSelect,[event,event.hasClass("selected")]));else if(""!==o.excludeClickClass&&event.hasClass(o.excludeClickClass));else if(null!==o.excludeClickElement&&$(e.target).is(o.excludeClickElement));else if(Utils.exec(o.onEventClick,[event]),!0===o.closed||!0===event.data("closed")){var target=event.data("target");target&&(window.location.href=target)}}),element.on(Metro.events.click,".stream",function(e){var stream=$(this),index=stream.index();!1!==o.streamSelect&&(console.log(index,element.data("stream")),element.data("stream")===index?(element.find(".stream-event").removeClass("disabled"),element.data("stream",-1)):(element.data("stream",index),element.find(".stream-event").addClass("disabled"),that.enableStream(stream),Utils.exec(o.onStreamSelect,[stream])),Utils.exec(o.onStreamClick,[stream]))}),!0!==Utils.isTouchDevice()&&element.on(Metro.events.mousewheel,".events-area",function(e){var acrollable=$(this);if(void 0!==e.deltaY&&void 0!==e.deltaFactor&&1<e.deltaFactor){var scroll=acrollable.scrollLeft()-30*e.deltaY;acrollable.scrollLeft(scroll),e.preventDefault()}}),!0===Utils.isTouchDevice()&&element.on(Metro.events.click,".stream",function(){var stream=$(this);stream.toggleClass("focused"),$.each(element.find(".stream"),function(){$(this).is(stream)||$(this).removeClass("focused")})})},_changeURI:function(){this.element,this.options,this.data;var link=this.getLink();history.pushState({},document.title,link)},slideTo:function(time){var target,element=this.element,o=this.options;this.data;target=$(void 0===time?element.find(".streamer-timeline li")[0]:element.find(".streamer-timeline .js-time-point-"+time.replace(":","-"))[0]),element.find(".events-area").animate({scrollLeft:target[0].offsetLeft-element.find(".streams .stream").outerWidth()},o.duration)},enableStream:function(stream){var element=this.element,index=(this.options,this.data,stream.index()-1);stream.removeClass("disabled").data("streamDisabled",!1),element.find(".stream-events").eq(index).find(".stream-event").removeClass("disabled")},disableStream:function(stream){var element=this.element,index=(this.options,this.data,stream.index()-1);stream.addClass("disabled").data("streamDisabled",!0),element.find(".stream-events").eq(index).find(".stream-event").addClass("disabled")},toggleStream:function(stream){!0===stream.data("streamDisabled")?this.enableStream(stream):this.disableStream(stream)},getLink:function(){var link,element=this.element,o=this.options,events=(this.data,element.find(".stream-event")),a=[],origin=window.location.href;return $.each(events,function(){var event=$(this);void 0!==event.data("sid")&&event.hasClass("selected")&&a.push(event.data("sid"))}),link=element.attr("id")+"|"+a.join(","),!0===o.encodeLink&&(link=btoa(link)),Utils.updateURIParameter(origin,"StreamerIDS",link)},getTimes:function(){var element=this.element,times=(this.options,this.data,element.find(".streamer-timeline > li")),result=[];return $.each(times,function(){result.push($(this).data("time"))}),result},getEvents:function(event_type,include_global){var items,element=this.element,events=(this.options,this.data,[]);switch(event_type){case"selected":items=element.find(".stream-event.selected");break;case"non-selected":items=element.find(".stream-event:not(.selected)");break;default:items=element.find(".stream-event")}return $.each(items,function(){var origin,item=$(this);!0!==include_global&&item.parent().hasClass("global-stream")||(origin=item.data("origin"),events.push(origin))}),events},source:function(s){if(void 0===s)return this.options.source;this.options.source=s,this.changeSource()},data:function(s){if(void 0===s)return this.options.source;this.options.data=s,this.changeData()},getStreamerData:function(){return this.data},toggleEvent:function(event){this.element;var o=this.options;this.data;(event=$(event)).hasClass("global-event")&&!0!==o.selectGlobal||(event.hasClass("selected")?this.selectEvent(event,!1):this.selectEvent(event,!0))},selectEvent:function(event,state){this.element;var o=this.options;this.data;void 0===state&&(state=!0),(event=$(event)).hasClass("global-event")&&!0!==o.selectGlobal||(!0===state?event.addClass("selected"):event.removeClass("selected"),!0===o.changeUri&&this._changeURI(),Utils.exec(o.onEventSelect,[event,state]))},changeSource:function(){var that=this,element=this.element,o=this.options,new_source=(this.data,element.attr("data-source"));""!==String(new_source).trim()&&(o.source=new_source,$.get(o.source,function(data){that.data=data,that.build()}),element.trigger("sourcechanged"))},changeData:function(){var element=this.element,o=this.options,new_data=(this.data,element.attr("data-data"));""!==String(new_data).trim()&&(o.data=new_data,this.data=JSON.parse(o.data),this.build(),element.trigger("datachanged"))},changeStreamSelectOption:function(){var element=this.element,o=this.options;this.data;o.streamSelect="true"===element.attr("data-stream-select").toLowerCase()},changeAttribute:function(attributeName){switch(attributeName){case"data-source":this.changeSource();break;case"data-data":this.changeData();break;case"data-stream-select":this.changeStreamSelectOption()}}};Metro.plugin("streamer",Streamer);var Switch={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onSwitchCreate,[this.element]),this},options:{material:!1,caption:"",captionPosition:"right",clsSwitch:"",clsCheck:"",clsCaption:"",onSwitchCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options,container=$("<label>").addClass((!0===o.material?" switch-material ":" switch ")+element[0].className),check=$("<span>").addClass("check"),caption=$("<span>").addClass("caption").html(o.caption);element.attr("type","checkbox"),container.insertBefore(element),element.appendTo(container),check.appendTo(container),caption.appendTo(container),"left"===o.captionPosition&&container.addClass("caption-left"),element[0].className="",container.addClass(o.clsSwitch),caption.addClass(o.clsCaption),check.addClass(o.clsCheck),element.is(":disabled")?this.disable():this.enable()},disable:function(){this.element.data("disabled",!0),this.element.parent().addClass("disabled")},enable:function(){this.element.data("disabled",!1),this.element.parent().removeClass("disabled")},toggleState:function(){this.elem.disabled?this.disable():this.enable()},changeAttribute:function(attributeName){switch(attributeName){case"disabled":this.toggleState()}}};Metro.plugin("switch",Switch);var SwipeConst={LEFT:"left",RIGHT:"right",UP:"up",DOWN:"down",IN:"in",OUT:"out",NONE:"none",AUTO:"auto",SWIPE:"swipe",PINCH:"pinch",TAP:"tap",DOUBLE_TAP:"doubletap",LONG_TAP:"longtap",HOLD:"hold",HORIZONTAL:"horizontal",VERTICAL:"vertical",ALL_FINGERS:"all",DOUBLE_TAP_THRESHOLD:10,PHASE_START:"start",PHASE_MOVE:"move",PHASE_END:"end",PHASE_CANCEL:"cancel",SUPPORTS_TOUCH:"ontouchstart"in window,SUPPORTS_POINTER_IE10:window.navigator.msPointerEnabled&&!window.navigator.pointerEnabled&&!("ontouchstart"in window),SUPPORTS_POINTER:(window.navigator.pointerEnabled||window.navigator.msPointerEnabled)&&!("ontouchstart"in window),IN_TOUCH:"intouch"},Swipe={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.useTouchEvents=SwipeConst.SUPPORTS_TOUCH||SwipeConst.SUPPORTS_POINTER||!this.options.fallbackToMouseEvents,this.START_EV=this.useTouchEvents?SwipeConst.SUPPORTS_POINTER?SwipeConst.SUPPORTS_POINTER_IE10?"MSPointerDown":"pointerdown":"touchstart":"mousedown",this.MOVE_EV=this.useTouchEvents?SwipeConst.SUPPORTS_POINTER?SwipeConst.SUPPORTS_POINTER_IE10?"MSPointerMove":"pointermove":"touchmove":"mousemove",this.END_EV=this.useTouchEvents?SwipeConst.SUPPORTS_POINTER?SwipeConst.SUPPORTS_POINTER_IE10?"MSPointerUp":"pointerup":"touchend":"mouseup",this.LEAVE_EV=this.useTouchEvents?SwipeConst.SUPPORTS_POINTER?"mouseleave":null:"mouseleave",this.CANCEL_EV=SwipeConst.SUPPORTS_POINTER?SwipeConst.SUPPORTS_POINTER_IE10?"MSPointerCancel":"pointercancel":"touchcancel",this.distance=0,this.direction=null,this.currentDirection=null,this.duration=0,this.startTouchesDistance=0,this.endTouchesDistance=0,this.pinchZoom=1,this.pinchDistance=0,this.pinchDirection=0,this.maximumsMap=null,this.phase="start",this.fingerCount=0,this.fingerData={},this.startTime=0,this.endTime=0,this.previousTouchEndTime=0,this.fingerCountAtRelease=0,this.doubleTapStartTime=0,this.singleTapTimeout=null,this.holdTimeout=null,this._setOptionsFromDOM(),this._create(),this},options:{fingers:1,threshold:75,cancelThreshold:null,pinchThreshold:20,maxTimeThreshold:null,fingerReleaseThreshold:250,longTapThreshold:500,doubleTapThreshold:200,swipe:null,swipeLeft:null,swipeRight:null,swipeUp:null,swipeDown:null,swipeStatus:null,pinchIn:null,pinchOut:null,pinchStatus:null,tap:null,doubleTap:null,longTap:null,hold:null,triggerOnTouchEnd:!0,triggerOnTouchLeave:!1,allowPageScroll:"auto",fallbackToMouseEvents:!0,excludedElements:".no-swipe",preventDefaultEvents:!0,onSwipeCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;void 0!==o.allowPageScroll||void 0===o.swipe&&void 0===o.swipeStatus||(o.allowPageScroll=SwipeConst.NONE);try{element.bind(this.START_EV,$.proxy(this.touchStart,this)),element.bind(this.CANCEL_EV,$.proxy(this.touchCancel,this))}catch(e){$.error("Events not supported "+this.START_EV+","+this.CANCEL_EV+" on Swipe")}Utils.exec(o.onSwipeCreate,[element])},touchStart:function(e){var element=this.element,options=this.options;if(!(this.getTouchInProgress()||0<$(e.target).closest(options.excludedElements,element).length)){var ret,event=e.originalEvent?e.originalEvent:e,touches=event.touches,evt=touches?touches[0]:event;return this.phase=SwipeConst.PHASE_START,touches?this.fingerCount=touches.length:!1!==options.preventDefaultEvents&&e.preventDefault(),this.distance=0,this.direction=null,this.currentDirection=null,this.pinchDirection=null,this.duration=0,this.startTouchesDistance=0,this.endTouchesDistance=0,this.pinchZoom=1,this.pinchDistance=0,this.maximumsMap=this.createMaximumsData(),this.cancelMultiFingerRelease(),this.createFingerData(0,evt),!touches||this.fingerCount===options.fingers||options.fingers===SwipeConst.ALL_FINGERS||this.hasPinches()?(this.startTime=this.getTimeStamp(),2===this.fingerCount&&(this.createFingerData(1,touches[1]),this.startTouchesDistance=this.endTouchesDistance=this.calculateTouchesDistance(this.fingerData[0].start,this.fingerData[1].start)),(options.swipeStatus||options.pinchStatus)&&(ret=this.triggerHandler(event,this.phase))):ret=!1,!1===ret?(this.phase=SwipeConst.PHASE_CANCEL,this.triggerHandler(event,this.phase),ret):(options.hold&&(this.holdTimeout=setTimeout($.proxy(function(){element.trigger("hold",[event.target]),options.hold&&(ret=options.hold.call(element,event,event.target))},this),options.longTapThreshold)),this.setTouchInProgress(!0),null)}},touchMove:function(e){var event=e.originalEvent?e.originalEvent:e;if(this.phase!==SwipeConst.PHASE_END&&this.phase!==SwipeConst.PHASE_CANCEL&&!this.inMultiFingerRelease()){var ret,touches=event.touches,evt=touches?touches[0]:event,currentFinger=this.updateFingerData(evt);if(this.endTime=this.getTimeStamp(),touches&&(this.fingerCount=touches.length),this.options.hold&&clearTimeout(this.holdTimeout),this.phase=SwipeConst.PHASE_MOVE,2===this.fingerCount&&(0===this.startTouchesDistance?(this.createFingerData(1,touches[1]),this.startTouchesDistance=this.endTouchesDistance=this.calculateTouchesDistance(this.fingerData[0].start,this.fingerData[1].start)):(this.updateFingerData(touches[1]),this.endTouchesDistance=this.calculateTouchesDistance(this.fingerData[0].end,this.fingerData[1].end),this.pinchDirection=this.calculatePinchDirection(this.fingerData[0].end,this.fingerData[1].end)),this.pinchZoom=this.calculatePinchZoom(this.startTouchesDistance,this.endTouchesDistance),this.pinchDistance=Math.abs(this.startTouchesDistance-this.endTouchesDistance)),this.fingerCount===this.options.fingers||this.options.fingers===SwipeConst.ALL_FINGERS||!touches||this.hasPinches()){if(this.direction=this.calculateDirection(currentFinger.start,currentFinger.end),this.currentDirection=this.calculateDirection(currentFinger.last,currentFinger.end),this.validateDefaultEvent(e,this.currentDirection),this.distance=this.calculateDistance(currentFinger.start,currentFinger.end),this.duration=this.calculateDuration(),this.setMaxDistance(this.direction,this.distance),ret=this.triggerHandler(event,this.phase),!this.options.triggerOnTouchEnd||this.options.triggerOnTouchLeave){var inBounds=!0;if(this.options.triggerOnTouchLeave){var bounds=this.getBounds(this);inBounds=this.isInBounds(currentFinger.end,bounds)}!this.options.triggerOnTouchEnd&&inBounds?this.phase=this.getNextPhase(SwipeConst.PHASE_MOVE):this.options.triggerOnTouchLeave&&!inBounds&&(this.phase=this.getNextPhase(SwipeConst.PHASE_END)),this.phase!==SwipeConst.PHASE_CANCEL&&this.phase!==SwipeConst.PHASE_END||this.triggerHandler(event,this.phase)}}else this.phase=SwipeConst.PHASE_CANCEL,this.triggerHandler(event,this.phase);!1===ret&&(this.phase=SwipeConst.PHASE_CANCEL,this.triggerHandler(event,this.phase))}},touchEnd:function(e){var event=e.originalEvent?e.originalEvent:e,touches=event.touches;if(touches){if(touches.length&&!this.inMultiFingerRelease())return this.startMultiFingerRelease(event),!0;if(touches.length&&this.inMultiFingerRelease())return!0}return this.inMultiFingerRelease()&&(this.fingerCount=this.fingerCountAtRelease),this.endTime=this.getTimeStamp(),this.duration=this.calculateDuration(),this.didSwipeBackToCancel()||!this.validateSwipeDistance()?(this.phase=SwipeConst.PHASE_CANCEL,this.triggerHandler(event,this.phase)):this.options.triggerOnTouchEnd||!1===this.options.triggerOnTouchEnd&&this.phase===SwipeConst.PHASE_MOVE?(!1!==this.options.preventDefaultEvents&&e.preventDefault(),this.phase=SwipeConst.PHASE_END,this.triggerHandler(event,this.phase)):!this.options.triggerOnTouchEnd&&this.hasTap()?(this.phase=SwipeConst.PHASE_END,this.triggerHandlerForGesture(event,this.phase,SwipeConst.TAP)):this.phase===SwipeConst.PHASE_MOVE&&(this.phase=SwipeConst.PHASE_CANCEL,this.triggerHandler(event,this.phase)),this.setTouchInProgress(!1),null},touchCancel:function(){this.fingerCount=0,this.endTime=0,this.startTime=0,this.startTouchesDistance=0,this.endTouchesDistance=0,this.pinchZoom=1,this.cancelMultiFingerRelease(),this.setTouchInProgress(!1)},touchLeave:function(e){var event=e.originalEvent?e.originalEvent:e;this.options.triggerOnTouchLeave&&(this.phase=this.getNextPhase(SwipeConst.PHASE_END),this.triggerHandler(event,this.phase))},getNextPhase:function(currentPhase){var options=this.options,nextPhase=currentPhase,validTime=this.validateSwipeTime(),validDistance=this.validateSwipeDistance(),didCancel=this.didSwipeBackToCancel();return!validTime||didCancel?nextPhase=SwipeConst.PHASE_CANCEL:!validDistance||currentPhase!==SwipeConst.PHASE_MOVE||options.triggerOnTouchEnd&&!options.triggerOnTouchLeave?!validDistance&&currentPhase===SwipeConst.PHASE_END&&options.triggerOnTouchLeave&&(nextPhase=SwipeConst.PHASE_CANCEL):nextPhase=SwipeConst.PHASE_END,nextPhase},triggerHandler:function(event,phase){var ret,touches=event.touches;return(this.didSwipe()||this.hasSwipes())&&(ret=this.triggerHandlerForGesture(event,phase,SwipeConst.SWIPE)),(this.didPinch()||this.hasPinches())&&!1!==ret&&(ret=this.triggerHandlerForGesture(event,phase,SwipeConst.PINCH)),this.didDoubleTap()&&!1!==ret?ret=this.triggerHandlerForGesture(event,phase,SwipeConst.DOUBLE_TAP):this.didLongTap()&&!1!==ret?ret=this.triggerHandlerForGesture(event,phase,SwipeConst.LONG_TAP):this.didTap()&&!1!==ret&&(ret=this.triggerHandlerForGesture(event,phase,SwipeConst.TAP)),phase===SwipeConst.PHASE_CANCEL&&this.touchCancel(event),phase===SwipeConst.PHASE_END&&(touches&&touches.length||this.touchCancel(event)),ret},triggerHandlerForGesture:function(event,phase,gesture){var ret,element=this.element,options=this.options;if(gesture===SwipeConst.SWIPE){if(element.trigger("swipeStatus",[phase,this.direction||null,this.distance||0,this.duration||0,this.fingerCount,this.fingerData,this.currentDirection]),options.swipeStatus&&!1===(ret=options.swipeStatus.call(element,event,phase,this.direction||null,this.distance||0,this.duration||0,this.fingerCount,this.fingerData,this.currentDirection)))return!1;if(phase===SwipeConst.PHASE_END&&this.validateSwipe()){if(clearTimeout(this.singleTapTimeout),clearTimeout(this.holdTimeout),element.trigger("swipe",[this.direction,this.distance,this.duration,this.fingerCount,this.fingerData,this.currentDirection]),options.swipe&&!1===(ret=options.swipe.call(element,event,this.direction,this.distance,this.duration,this.fingerCount,this.fingerData,this.currentDirection)))return!1;switch(this.direction){case SwipeConst.LEFT:element.trigger("swipeLeft",[this.direction,this.distance,this.duration,this.fingerCount,this.fingerData,this.currentDirection]),options.swipeLeft&&(ret=options.swipeLeft.call(element,event,this.direction,this.distance,this.duration,this.fingerCount,this.fingerData,this.currentDirection));break;case SwipeConst.RIGHT:element.trigger("swipeRight",[this.direction,this.distance,this.duration,this.fingerCount,this.fingerData,this.currentDirection]),options.swipeRight&&(ret=options.swipeRight.call(element,event,this.direction,this.distance,this.duration,this.fingerCount,this.fingerData,this.currentDirection));break;case SwipeConst.UP:element.trigger("swipeUp",[this.direction,this.distance,this.duration,this.fingerCount,this.fingerData,this.currentDirection]),options.swipeUp&&(ret=options.swipeUp.call(element,event,this.direction,this.distance,this.duration,this.fingerCount,this.fingerData,this.currentDirection));break;case SwipeConst.DOWN:element.trigger("swipeDown",[this.direction,this.distance,this.duration,this.fingerCount,this.fingerData,this.currentDirection]),options.swipeDown&&(ret=options.swipeDown.call(element,event,this.direction,this.distance,this.duration,this.fingerCount,this.fingerData,this.currentDirection))}}}if(gesture===SwipeConst.PINCH){if(element.trigger("pinchStatus",[phase,this.pinchDirection||null,this.pinchDistance||0,this.duration||0,this.fingerCount,this.pinchZoom,this.fingerData]),options.pinchStatus&&!1===(ret=options.pinchStatus.call(element,event,phase,this.pinchDirection||null,this.pinchDistance||0,this.duration||0,this.fingerCount,this.pinchZoom,this.fingerData)))return!1;if(phase===SwipeConst.PHASE_END&&this.validatePinch())switch(this.pinchDirection){case SwipeConst.IN:element.trigger("pinchIn",[this.pinchDirection||null,this.pinchDistance||0,this.duration||0,this.fingerCount,this.pinchZoom,this.fingerData]),options.pinchIn&&(ret=options.pinchIn.call(element,event,this.pinchDirection||null,this.pinchDistance||0,this.duration||0,this.fingerCount,this.pinchZoom,this.fingerData));break;case SwipeConst.OUT:element.trigger("pinchOut",[this.pinchDirection||null,this.pinchDistance||0,this.duration||0,this.fingerCount,this.pinchZoom,this.fingerData]),options.pinchOut&&(ret=options.pinchOut.call(element,event,this.pinchDirection||null,this.pinchDistance||0,this.duration||0,this.fingerCount,this.pinchZoom,this.fingerData))}}return gesture===SwipeConst.TAP?phase!==SwipeConst.PHASE_CANCEL&&phase!==SwipeConst.PHASE_END||(clearTimeout(this.singleTapTimeout),clearTimeout(this.holdTimeout),this.hasDoubleTap()&&!this.inDoubleTap()?(this.doubleTapStartTime=this.getTimeStamp(),this.singleTapTimeout=setTimeout($.proxy(function(){this.doubleTapStartTime=null,element.trigger("tap",[event.target]),options.tap&&(ret=options.tap.call(element,event,event.target))},this),options.doubleTapThreshold)):(this.doubleTapStartTime=null,element.trigger("tap",[event.target]),options.tap&&(ret=options.tap.call(element,event,event.target)))):gesture===SwipeConst.DOUBLE_TAP?phase!==SwipeConst.PHASE_CANCEL&&phase!==SwipeConst.PHASE_END||(clearTimeout(this.singleTapTimeout),clearTimeout(this.holdTimeout),this.doubleTapStartTime=null,element.trigger("doubletap",[event.target]),options.doubleTap&&(ret=options.doubleTap.call(element,event,event.target))):gesture===SwipeConst.LONG_TAP&&(phase!==SwipeConst.PHASE_CANCEL&&phase!==SwipeConst.PHASE_END||(clearTimeout(this.singleTapTimeout),this.doubleTapStartTime=null,element.trigger("longtap",[event.target]),options.longTap&&(ret=options.longTap.call(element,event,event.target)))),ret},validateSwipeDistance:function(){var valid=!0;return null!==this.options.threshold&&(valid=this.distance>=this.options.threshold),valid},didSwipeBackToCancel:function(){var options=this.options,cancelled=!1;return null!==options.cancelThreshold&&null!==this.direction&&(cancelled=this.getMaxDistance(this.direction)-this.distance>=options.cancelThreshold),cancelled},validatePinchDistance:function(){return null===this.options.pinchThreshold||this.pinchDistance>=this.options.pinchThreshold},validateSwipeTime:function(){var options=this.options;return!options.maxTimeThreshold||duration<options.maxTimeThreshold},validateDefaultEvent:function(e,direction){var options=this.options;if(!1!==options.preventDefaultEvents)if(options.allowPageScroll===SwipeConst.NONE)e.preventDefault();else{var auto=options.allowPageScroll===SwipeConst.AUTO;switch(direction){case SwipeConst.LEFT:(options.swipeLeft&&auto||!auto&&options.allowPageScroll.toLowerCase()!==SwipeConst.HORIZONTAL)&&e.preventDefault();break;case SwipeConst.RIGHT:(options.swipeRight&&auto||!auto&&options.allowPageScroll.toLowerCase()!==SwipeConst.HORIZONTAL)&&e.preventDefault();break;case SwipeConst.UP:(options.swipeUp&&auto||!auto&&options.allowPageScroll.toLowerCase()!==SwipeConst.VERTICAL)&&e.preventDefault();break;case SwipeConst.DOWN:(options.swipeDown&&auto||!auto&&options.allowPageScroll.toLowerCase()!==SwipeConst.VERTICAL)&&e.preventDefault()}}},validatePinch:function(){var hasCorrectFingerCount=this.validateFingers(),hasEndPoint=this.validateEndPoint(),hasCorrectDistance=this.validatePinchDistance();return hasCorrectFingerCount&&hasEndPoint&&hasCorrectDistance},hasPinches:function(){return!!(this.options.pinchStatus||this.options.pinchIn||this.options.pinchOut)},didPinch:function(){return!(!this.validatePinch()||!this.hasPinches())},validateSwipe:function(){var hasValidTime=this.validateSwipeTime(),hasValidDistance=this.validateSwipeDistance(),hasCorrectFingerCount=this.validateFingers(),hasEndPoint=this.validateEndPoint();return!this.didSwipeBackToCancel()&&hasEndPoint&&hasCorrectFingerCount&&hasValidDistance&&hasValidTime},hasSwipes:function(){return!!(this.options.swipe||this.options.swipeStatus||this.options.swipeLeft||this.options.swipeRight||this.options.swipeUp||this.options.swipeDown)},didSwipe:function(){return!(!this.validateSwipe()||!this.hasSwipes())},validateFingers:function(){return this.fingerCount===this.options.fingers||this.options.fingers===SwipeConst.ALL_FINGERS||!SwipeConst.SUPPORTS_TOUCH},validateEndPoint:function(){return 0!==this.fingerData[0].end.x},hasTap:function(){return!!this.options.tap},hasDoubleTap:function(){return!!this.options.doubleTap},hasLongTap:function(){return!!this.options.longTap},validateDoubleTap:function(){if(null==this.doubleTapStartTime)return!1;var now=this.getTimeStamp();return this.hasDoubleTap()&&now-this.doubleTapStartTime<=this.options.doubleTapThreshold},inDoubleTap:function(){return this.validateDoubleTap()},validateTap:function(){return(1===this.fingerCount||!SwipeConst.SUPPORTS_TOUCH)&&(isNaN(this.distance)||this.distance<this.options.threshold)},validateLongTap:function(){var options=this.options;return this.duration>options.longTapThreshold&&this.distance<SwipeConst.DOUBLE_TAP_THRESHOLD},didTap:function(){return!(!this.validateTap()||!this.hasTap())},didDoubleTap:function(){return!(!this.validateDoubleTap()||!this.hasDoubleTap())},didLongTap:function(){return!(!this.validateLongTap()||!this.hasLongTap())},startMultiFingerRelease:function(event){this.previousTouchEndTime=this.getTimeStamp(),this.fingerCountAtRelease=event.touches.length+1},cancelMultiFingerRelease:function(){this.previousTouchEndTime=0,this.fingerCountAtRelease=0},inMultiFingerRelease:function(){var withinThreshold=!1;this.previousTouchEndTime&&(this.getTimeStamp()-this.previousTouchEndTime<=this.options.fingerReleaseThreshold&&(withinThreshold=!0));return withinThreshold},getTouchInProgress:function(){return!0===this.element.data("intouch")},setTouchInProgress:function(val){var element=this.element;element&&(!0===val?(element.bind(this.MOVE_EV,$.proxy(this.touchMove,this)),element.bind(this.END_EV,$.proxy(this.touchEnd,this)),this.LEAVE_EV&&element.bind(this.LEAVE_EV,$.proxy(this.touchLeave,this))):(element.unbind(this.MOVE_EV,this.touchMove,!1),element.unbind(this.END_EV,this.touchEnd,!1),this.LEAVE_EV&&element.unbind(this.LEAVE_EV,this.touchLeave,!1)),element.data("intouch",!0===val))},createFingerData:function(id,evt){var f={start:{x:0,y:0},last:{x:0,y:0},end:{x:0,y:0}};return f.start.x=f.last.x=f.end.x=evt.pageX||evt.clientX,f.start.y=f.last.y=f.end.y=evt.pageY||evt.clientY,this.fingerData[id]=f},updateFingerData:function(evt){var id=void 0!==evt.identifier?evt.identifier:0,f=this.getFingerData(id);return null===f&&(f=this.createFingerData(id,evt)),f.last.x=f.end.x,f.last.y=f.end.y,f.end.x=evt.pageX||evt.clientX,f.end.y=evt.pageY||evt.clientY,f},getFingerData:function(id){return this.fingerData[id]||null},setMaxDistance:function(direction,distance){direction!==SwipeConst.NONE&&(distance=Math.max(distance,this.getMaxDistance(direction)),this.maximumsMap[direction].distance=distance)},getMaxDistance:function(direction){return this.maximumsMap[direction]?this.maximumsMap[direction].distance:void 0},createMaximumsData:function(){var maxData={};return maxData[SwipeConst.LEFT]=this.createMaximumVO(SwipeConst.LEFT),maxData[SwipeConst.RIGHT]=this.createMaximumVO(SwipeConst.RIGHT),maxData[SwipeConst.UP]=this.createMaximumVO(SwipeConst.UP),maxData[SwipeConst.DOWN]=this.createMaximumVO(SwipeConst.DOWN),maxData},createMaximumVO:function(dir){return{direction:dir,distance:0}},calculateDuration:function(){return this.endTime-this.startTime},calculateTouchesDistance:function(startPoint,endPoint){var diffX=Math.abs(startPoint.x-endPoint.x),diffY=Math.abs(startPoint.y-endPoint.y);return Math.round(Math.sqrt(diffX*diffX+diffY*diffY))},calculatePinchZoom:function(startDistance,endDistance){return(endDistance/startDistance*100).toFixed(2)},calculatePinchDirection:function(){return this.pinchZoom<1?SwipeConst.OUT:SwipeConst.IN},calculateDistance:function(startPoint,endPoint){return Math.round(Math.sqrt(Math.pow(endPoint.x-startPoint.x,2)+Math.pow(endPoint.y-startPoint.y,2)))},calculateAngle:function(startPoint,endPoint){var x=startPoint.x-endPoint.x,y=endPoint.y-startPoint.y,r=Math.atan2(y,x),angle=Math.round(180*r/Math.PI);return angle<0&&(angle=360-Math.abs(angle)),angle},calculateDirection:function(startPoint,endPoint){if(this.comparePoints(startPoint,endPoint))return SwipeConst.NONE;var angle=this.calculateAngle(startPoint,endPoint);return angle<=45&&0<=angle?SwipeConst.LEFT:angle<=360&&315<=angle?SwipeConst.LEFT:135<=angle&&angle<=225?SwipeConst.RIGHT:45<angle&&angle<135?SwipeConst.DOWN:SwipeConst.UP},getTimeStamp:function(){return(new Date).getTime()},getBounds:function(el){var offset=(el=$(el)).offset();return{left:offset.left,right:offset.left+el.outerWidth(),top:offset.top,bottom:offset.top+el.outerHeight()}},isInBounds:function(point,bounds){return point.x>bounds.left&&point.x<bounds.right&&point.y>bounds.top&&point.y<bounds.bottom},comparePoints:function(pointA,pointB){return pointA.x===pointB.x&&pointA.y===pointB.y},removeListeners:function(){var element=this.element;element.unbind(this.START_EV,this.touchStart,this),element.unbind(this.CANCEL_EV,this.touchCancel,this),element.unbind(this.MOVE_EV,this.touchMove,this),element.unbind(this.END_EV,this.touchEnd,this),this.LEAVE_EV&&element.unbind(this.LEAVE_EV,this.touchLeave,this),this.setTouchInProgress(!1)},enable:function(){return this.disable(),this.element.bind(this.START_EV,this.touchStart),this.element.bind(this.CANCEL_EV,this.touchCancel),this.element},disable:function(){return this.removeListeners(),this.element},changeAttribute:function(attributeName){},destroy:function(){this.removeListeners()}};Metro.swipe=SwipeConst,Metro.plugin("swipe",Swipe);var Table={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.currentPage=1,this.pagesCount=1,this.searchString="",this.data=null,this.activity=null,this.busy=!1,this.filters=[],this.wrapperInfo=null,this.wrapperSearch=null,this.wrapperRows=null,this.wrapperPagination=null,this.filterIndex=null,this.filtersIndexes=[],this.component=null,this.inspector=null,this.view={},this.viewDefault={},this.locale=Metro.locales["en-US"],this.input_interval=null,this.searchFields=[],this.sort={dir:"asc",colIndex:0},this.service=[],this.heads=[],this.items=[],this.foots=[],this.filteredItems=[],this.index={},this._setOptionsFromDOM(),this._create(),this},options:{locale:METRO_LOCALE,horizontalScroll:!1,horizontalScrollStop:null,check:!1,checkType:"checkbox",checkStyle:1,checkColIndex:0,checkName:null,checkStoreKey:"TABLE:$1:KEYS",rownum:!1,rownumTitle:"#",filters:null,filtersOperator:"and",source:null,searchMinLength:1,searchThreshold:500,searchFields:null,showRowsSteps:!0,showSearch:!0,showTableInfo:!0,showPagination:!0,paginationShortMode:!0,showActivity:!0,muteTable:!0,rows:10,rowsSteps:"10,25,50,100",staticView:!1,viewSaveMode:"client",viewSavePath:"TABLE:$1:OPTIONS",sortDir:"asc",decimalSeparator:".",thousandSeparator:",",tableRowsCountTitle:"Show entries:",tableSearchTitle:"Search:",tableInfoTitle:"Showing $1 to $2 of $3 entries",paginationPrevTitle:"Prev",paginationNextTitle:"Next",allRecordsTitle:"All",inspectorTitle:"Inspector",activityType:"cycle",activityStyle:"color",activityTimeout:100,searchWrapper:null,rowsWrapper:null,infoWrapper:null,paginationWrapper:null,cellWrapper:!0,clsComponent:"",clsTableContainer:"",clsTable:"",clsHead:"",clsHeadRow:"",clsHeadCell:"",clsBody:"",clsBodyRow:"",clsBodyCell:"",clsCellWrapper:"",clsFooter:"",clsFooterRow:"",clsFooterCell:"",clsTableTop:"",clsRowsCount:"",clsSearch:"",clsTableBottom:"",clsTableInfo:"",clsTablePagination:"",clsPagination:"",clsEvenRow:"",clsOddRow:"",clsRow:"",onDraw:Metro.noop,onDrawRow:Metro.noop,onDrawCell:Metro.noop,onAppendRow:Metro.noop,onAppendCell:Metro.noop,onSortStart:Metro.noop,onSortStop:Metro.noop,onSortItemSwitch:Metro.noop,onSearch:Metro.noop,onRowsCountChange:Metro.noop,onDataLoad:Metro.noop,onDataLoadError:Metro.noop,onDataLoaded:Metro.noop,onFilterRowAccepted:Metro.noop,onFilterRowDeclined:Metro.noop,onCheckClick:Metro.noop,onCheckClickAll:Metro.noop,onCheckDraw:Metro.noop,onViewSave:Metro.noop,onViewGet:Metro.noop,onViewCreated:Metro.noop,onTableCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var that=this,element=this.element,o=this.options,id=Utils.elementId("table");Utils.isValue(element.attr("id"))||element.attr("id",id),Utils.isValue(Metro.locales[o.locale])&&(this.locale=Metro.locales[o.locale]),Utils.isValue(o.searchFields)&&(this.searchFields=Utils.strToArray(o.searchFields)),null!==o.source?(Utils.exec(o.onDataLoad,[o.source],element[0]),$.get(o.source,function(data){if("object"!=typeof data)throw new Error("Data for table is not a object");that._build(data),Utils.exec(o.onDataLoaded,[o.source,data],element[0])}).fail(function(jqXHR,textStatus,errorThrown){Utils.exec(o.onDataLoadError,[o.source,jqXHR,textStatus,errorThrown],element[0])})):that._build()},_createIndex:function(){var that=this,colIndex=this.options.checkColIndex;setImmediate(function(){that.items.forEach(function(v,i){that.index[v[colIndex]]=i})})},_build:function(data){var view,that=this,element=this.element,o=this.options,id=element.attr("id");o.rows=parseInt(o.rows),this.items=[],this.heads=[],this.foots=[],Utils.isValue(data)?this._createItemsFromJSON(data):this._createItemsFromHTML(),this._createIndex(),this.view=this._createView(),this.viewDefault=Utils.objectClone(this.view),"client"===o.viewSaveMode.toLowerCase()?(view=Metro.storage.getItem(o.viewSavePath.replace("$1",id)),Utils.isValue(view)&&Utils.objectLength(view)===Utils.objectLength(this.view)&&(this.view=view,Utils.exec(o.onViewGet,[view],element[0])),this._final()):$.get(o.viewSavePath,{id:id},function(view){Utils.isValue(view)&&Utils.objectLength(view)===Utils.objectLength(that.view)&&(that.view=view,Utils.exec(o.onViewGet,[view],element[0])),that._final()}).fail(function(jqXHR,textStatus){that._final(),console.log("Warning! View "+textStatus+" for table "+element.attr("id")+" ")})},_final:function(){var element=this.element,o=this.options,id=element.attr("id");Metro.storage.delItem(o.checkStoreKey.replace("$1",id)),this._service(),this._createStructure(),this._createInspector(),this._createEvents(),Utils.exec(o.onTableCreate,[element],element[0])},_service:function(){var o=this.options;this.service=[{title:o.rownumTitle,format:void 0,name:void 0,sortable:!1,sortDir:void 0,clsColumn:"rownum-cell "+(!0!==o.rownum?"d-none":""),cls:"rownum-cell "+(!0!==o.rownum?"d-none":""),colspan:void 0,type:"rownum"},{title:"checkbox"===o.checkType?"<input type='checkbox' data-role='checkbox' class='table-service-check-all' data-style='"+o.checkStyle+"'>":"",format:void 0,name:void 0,sortable:!1,sortDir:void 0,clsColumn:"check-cell "+(!0!==o.check?"d-none":""),cls:"check-cell "+(!0!==o.check?"d-none":""),colspan:void 0,type:"rowcheck"}]},_createView:function(){var view,o=this.options;return view={},$.each(this.heads,function(i){Utils.isValue(this.cls)&&(this.cls=this.cls.replace("hidden","")),Utils.isValue(this.clsColumn)&&(this.clsColumn=this.clsColumn.replace("hidden","")),view[i]={index:i,"index-view":i,show:!Utils.isValue(this.show)||this.show,size:Utils.isValue(this.size)?this.size:""}}),Utils.exec(o.onViewCreated,[view],view),view},_createInspectorItems:function(table){var j,row,that=this,o=this.options,tds=[],cells=this.heads;for(table.html(""),j=0;j<cells.length;j++)tds[j]=null;for($.each(cells,function(i){(row=$("<tr>")).data("index",i),row.data("index-view",i),$("<td>").html("<input type='checkbox' data-style='"+o.checkStyle+"' data-role='checkbox' name='column_show_check[]' value='"+i+"' "+(Utils.bool(that.view[i].show)?"checked":"")+">").appendTo(row),$("<td>").html(this.title).appendTo(row),$("<td>").html("<input type='number' data-role='spinner' name='column_size' value='"+that.view[i].size+"' data-index='"+i+"'>").appendTo(row),$("<td>").html("<button class='button square js-table-inspector-field-up' type='button'><span class='mif-arrow-up'></span></button><button class='button square js-table-inspector-field-down' type='button'><span class='mif-arrow-down'></span></button>").appendTo(row),tds[that.view[i]["index-view"]]=row}),j=0;j<cells.length;j++)tds[j].appendTo(table)},_createInspector:function(){var inspector,table_wrap,table,tbody,actions,o=this.options;(inspector=$("<div data-role='draggable' data-drag-element='.table-inspector-header' data-drag-area='body'>").addClass("table-inspector")).attr("for",this.element.attr("id")),$("<div class='table-inspector-header'>"+o.inspectorTitle+"</div>").appendTo(inspector),table_wrap=$("<div>").addClass("table-wrap").appendTo(inspector),table=$("<table>").addClass("table subcompact"),tbody=$("<tbody>").appendTo(table),table.appendTo(table_wrap),this._createInspectorItems(tbody),actions=$("<div class='table-inspector-actions'>").appendTo(inspector),$("<button class='button primary js-table-inspector-save' type='button'>").html(this.locale.buttons.save).appendTo(actions),$("<button class='button secondary js-table-inspector-reset ml-2 mr-2' type='button'>").html(this.locale.buttons.reset).appendTo(actions),$("<button class='button link js-table-inspector-cancel place-right' type='button'>").html(this.locale.buttons.cancel).appendTo(actions),inspector.data("open",!1),this.inspector=inspector,$("body").append(inspector),this._createInspectorEvents()},_resetInspector:function(){var table=this.inspector.find("table tbody");this._createInspectorItems(table),this._createInspectorEvents()},_createHeadsFormHTML:function(){var that=this,head=this.element.find("thead");0<head.length&&$.each(head.find("tr > *"),function(){var dir,head_item,item_class,item=$(this);dir=Utils.isValue(item.data("sort-dir"))?item.data("sort-dir"):item.hasClass("sort-asc")?"asc":item.hasClass("sort-desc")?"desc":void 0,item_class=(item_class=(item_class=(item_class=item[0].className.replace("sortable-column","")).replace("sort-asc","")).replace("sort-desc","")).replace("hidden",""),head_item={type:"data",title:item.html(),name:Utils.isValue(item.data("name"))?item.data("name"):item.text().replace(" ","_"),sortable:item.hasClass("sortable-column")||Utils.isValue(item.data("sortable"))&&JSON.parse(!0===item.data("sortable")),sortDir:dir,format:Utils.isValue(item.data("format"))?item.data("format"):"string",clsColumn:Utils.isValue(item.data("cls-column"))?item.data("cls-column"):"",cls:item_class,colspan:item.attr("colspan"),size:Utils.isValue(item.data("size"))?item.data("size"):"",show:!(item.hasClass("hidden")||Utils.isValue(item.data("show"))&&!1===JSON.parse(item.data("show"))),required:!!Utils.isValue(item.data("required"))&&!0===JSON.parse(item.data("required")),field:Utils.isValue(item.data("field"))?item.data("field"):"input",fieldType:Utils.isValue(item.data("field-type"))?item.data("field-type"):"text",validator:Utils.isValue(item.data("validator"))?item.data("validator"):null},that.heads.push(head_item)})},_createFootsFromHTML:function(){var that=this,foot=this.element.find("tfoot");0<foot.length&&$.each(foot.find("tr > *"),function(){var foot_item,item=$(this);foot_item={title:item.html(),name:!!Utils.isValue(item.data("name"))&&item.data("name"),cls:item[0].className,colspan:item.attr("colspan")},that.foots.push(foot_item)})},_createItemsFromHTML:function(){var that=this,body=this.element.find("tbody");0<body.length&&$.each(body.find("tr"),function(){var row=$(this),tr=[];$.each(row.children("td"),function(){var td=$(this);tr.push(td.html())}),that.items.push(tr)}),this._createHeadsFormHTML(),this._createFootsFromHTML()},_createItemsFromJSON:function(source){var that=this;"string"==typeof source&&(source=JSON.parse(source)),void 0!==source.header?that.heads=source.header:this._createHeadsFormHTML(),void 0!==source.data&&$.each(source.data,function(){var tr=[];$.each(this,function(){tr.push(this)}),that.items.push(tr)}),void 0!==source.footer?this.foots=source.footer:this._createFootsFromHTML()},_createTableHeader:function(){var tr,th,j,cells,element=this.element,o=this.options,head=$("<thead>").html(""),tds=[],view=o.staticView?this._createView():this.view;if(element.find("thead").remove(),head.addClass(o.clsHead),0===this.heads.length)return head;for(tr=$("<tr>").addClass(o.clsHeadRow).appendTo(head),$.each(this.service,function(){var classes=[];th=$("<th>").appendTo(tr),Utils.isValue(this.title)&&th.html(this.title),Utils.isValue(this.size)&&th.css({width:this.size}),Utils.isValue(this.cls)&&classes.push(this.cls),classes.push(o.clsHeadCell),th.addClass(classes.join(" "))}),cells=this.heads,j=0;j<cells.length;j++)tds[j]=null;for($.each(cells,function(cell_index){var classes=[];(th=$("<th>")).data("index",cell_index),Utils.isValue(this.title)&&th.html(this.title),Utils.isValue(this.format)&&th.attr("data-format",this.format),Utils.isValue(this.name)&&th.attr("data-name",this.name),Utils.isValue(this.colspan)&&th.attr("colspan",this.colspan),Utils.isValue(view[cell_index].size)&&th.css({width:view[cell_index].size}),!0===this.sortable&&(classes.push("sortable-column"),Utils.isValue(this.sortDir)&&classes.push("sort-"+this.sortDir)),Utils.isValue(this.cls)&&classes.push(this.cls),!1===Utils.bool(view[cell_index].show)&&classes.push("hidden"),classes.push(o.clsHeadCell),Utils.bool(view[cell_index].show)&&Utils.arrayDelete(classes,"hidden"),th.addClass(classes.join(" ")),tds[view[cell_index]["index-view"]]=th}),j=0;j<cells.length;j++)tds[j].appendTo(tr);element.prepend(head)},_createTableBody:function(){var head,element=this.element;head=element.find("thead"),element.find("tbody").remove(),$("<tbody>").addClass(this.options.clsBody).insertAfter(head)},_createTableFooter:function(){var tr,th,element=this.element,o=this.options,foot=$("<tfoot>").addClass(o.clsFooter);element.find("tfoot").remove(),0!==this.foots.length&&(tr=$("<tr>").addClass(o.clsHeadRow).appendTo(foot),$.each(this.foots,function(){th=$("<th>").appendTo(tr),void 0!==this.title&&th.html(this.title),void 0!==this.name&&th.addClass("foot-column-name-"+this.name),void 0!==this.cls&&th.addClass(this.cls),Utils.isValue(this.colspan)&&th.attr("colspan",this.colspan),th.appendTo(tr)})),element.append(foot)},_createTopBlock:function(){var search_block,rows_block,rows_select,that=this,element=this.element,o=this.options,top_block=$("<div>").addClass("table-top").addClass(o.clsTableTop).insertBefore(element.parent());return(search_block=Utils.isValue(this.wrapperSearch)?this.wrapperSearch:$("<div>").addClass("table-search-block").addClass(o.clsSearch).appendTo(top_block)).addClass(o.clsSearch),$("<input>").attr("type","text").appendTo(search_block).input({prepend:o.tableSearchTitle}),!0!==o.showSearch&&search_block.hide(),(rows_block=Utils.isValue(this.wrapperRows)?this.wrapperRows:$("<div>").addClass("table-rows-block").appendTo(top_block)).addClass(o.clsRowsCount),rows_select=$("<select>").appendTo(rows_block),$.each(Utils.strToArray(o.rowsSteps),function(){var val=parseInt(this),option=$("<option>").attr("value",val).text(-1===val?o.allRecordsTitle:val).appendTo(rows_select);val===parseInt(o.rows)&&option.attr("selected","selected")}),rows_select.select({filter:!1,prepend:o.tableRowsCountTitle,onChange:function(val){(val=parseInt(val))!==parseInt(o.rows)&&(o.rows=val,that.currentPage=1,that._draw(),Utils.exec(o.onRowsCountChange,[val],element[0]))}}),!0!==o.showRowsSteps&&rows_block.hide(),top_block},_createBottomBlock:function(){var info,pagination,element=this.element,o=this.options,bottom_block=$("<div>").addClass("table-bottom").addClass(o.clsTableBottom).insertAfter(element.parent());return(info=Utils.isValue(this.wrapperInfo)?this.wrapperInfo:$("<div>").addClass("table-info").appendTo(bottom_block)).addClass(o.clsTableInfo),!0!==o.showTableInfo&&info.hide(),(pagination=Utils.isValue(this.wrapperPagination)?this.wrapperPagination:$("<div>").addClass("table-pagination").appendTo(bottom_block)).addClass(o.clsTablePagination),!0!==o.showPagination&&pagination.hide(),bottom_block},_createStructure:function(){var table_container,table_component,columns,that=this,element=this.element,o=this.options,w_search=$(o.searchWrapper),w_info=$(o.infoWrapper),w_rows=$(o.rowsWrapper),w_paging=$(o.paginationWrapper);0<w_search.length&&(this.wrapperSearch=w_search),0<w_info.length&&(this.wrapperInfo=w_info),0<w_rows.length&&(this.wrapperRows=w_rows),0<w_paging.length&&(this.wrapperPagination=w_paging),(table_component=$("<div>").addClass("table-component")).insertBefore(element),table_container=$("<div>").addClass("table-container").addClass(o.clsTableContainer).appendTo(table_component),element.appendTo(table_container),!0===o.horizontalScroll&&table_container.addClass("horizontal-scroll"),!Utils.isNull(o.horizontalScrollStop)&&Utils.mediaExist(o.horizontalScrollStop)&&table_container.removeClass("horizontal-scroll"),table_component.addClass(o.clsComponent),this.activity=$("<div>").addClass("table-progress").appendTo(table_component),$("<div>").activity({type:o.activityType,style:o.activityStyle}).appendTo(this.activity),!0!==o.showActivity&&this.activity.css({visibility:"hidden"}),element.html("").addClass(o.clsTable),this._createTableHeader(),this._createTableBody(),this._createTableFooter(),this._createTopBlock(),this._createBottomBlock();var filter_func,need_sort=!1;0<this.heads.length&&$.each(this.heads,function(i){!need_sort&&-1<["asc","desc"].indexOf(this.sortDir)&&(need_sort=!0,that.sort.colIndex=i,that.sort.dir=this.sortDir)}),need_sort&&(columns=element.find("thead th"),this._resetSortClass(columns),$(columns.get(this.sort.colIndex+that.service.length)).addClass("sort-"+this.sort.dir),this.sorting()),Utils.isValue(o.filters)&&$.each(Utils.strToArray(o.filters),function(){!1!==(filter_func=Utils.isFunc(this))&&that.filtersIndexes.push(that.addFilter(filter_func))}),this.currentPage=1,this.component=table_component,this._draw()},_resetSortClass:function(el){$(el).removeClass("sort-asc sort-desc")},_createEvents:function(){var customSearch,that=this,element=this.element,o=this.options,component=element.closest(".table-component"),table_container=component.find(".table-container"),search=component.find(".table-search-block input"),id=element.attr("id");$(window).on(Metro.events.resize+"-"+id,function(){!0===o.horizontalScroll&&(!Utils.isNull(o.horizontalScrollStop)&&Utils.mediaExist(o.horizontalScrollStop)?table_container.removeClass("horizontal-scroll"):table_container.addClass("horizontal-scroll"))}),element.on(Metro.events.click,".sortable-column",function(){if(!0===o.muteTable&&element.addClass("disabled"),that.busy)return!1;that.busy=!0;var col=$(this);that.activity.show(o.activityTimeout,function(){that.currentPage=1,that.sort.colIndex=col.data("index"),col.hasClass("sort-asc")||col.hasClass("sort-desc")?col.hasClass("sort-asc")?that.sort.dir="desc":that.sort.dir="asc":that.sort.dir=o.sortDir,that._resetSortClass(element.find(".sortable-column")),col.addClass("sort-"+that.sort.dir),that.sorting(),that._draw(function(){!(that.busy=!1)===o.muteTable&&element.removeClass("disabled")})})}),element.on(Metro.events.click,".table-service-check input",function(){var check=$(this),status=check.is(":checked"),val=""+check.val(),store_key=o.checkStoreKey.replace("$1",id),storage=Metro.storage,data=storage.getItem(store_key);"radio"===check.attr("type")&&(data=[]),status?Utils.isValue(data)?-1===Array(data).indexOf(val)&&data.push(val):data=[val]:Utils.isValue(data)?Utils.arrayDelete(data,val):data=[],storage.setItem(store_key,data),Utils.exec(o.onCheckClick,[status],this)}),element.on(Metro.events.click,".table-service-check-all input",function(){var status=$(this).is(":checked"),store_key=o.checkStoreKey.replace("$1",id),data=[];status?$.each(that.filteredItems,function(){-1===data.indexOf(this[o.checkColIndex])&&data.push(""+this[o.checkColIndex])}):data=[],Metro.storage.setItem(store_key,data),that._draw(),Utils.exec(o.onCheckClickAll,[status],this)});var _search=function(){that.searchString=this.value.trim().toLowerCase(),clearInterval(that.input_interval),that.input_interval=!1,that.input_interval||(that.input_interval=setTimeout(function(){that.currentPage=1,that._draw(),clearInterval(that.input_interval),that.input_interval=!1},o.searchThreshold))};function pageLinkClick(l){var link=$(l),item=link.parent();0!==that.filteredItems.length&&(item.hasClass("active")||(item.hasClass("service")?"prev"===link.data("page")?(that.currentPage--,0===that.currentPage&&(that.currentPage=1)):(that.currentPage++,that.currentPage>that.pagesCount&&(that.currentPage=that.pagesCount)):that.currentPage=link.data("page"),that._draw()))}search.on(Metro.events.inputchange,_search),Utils.isValue(this.wrapperSearch)&&0<(customSearch=this.wrapperSearch.find("input")).length&&customSearch.on(Metro.events.inputchange,_search),component.on(Metro.events.click,".pagination .page-link",function(){pageLinkClick(this)}),Utils.isValue(this.wrapperPagination)&&this.wrapperPagination.on(Metro.events.click,".pagination .page-link",function(){pageLinkClick(this)}),this._createInspectorEvents(),element.on(Metro.events.click,".js-table-crud-button",function(){})},_createInspectorEvents:function(){var that=this,inspector=this.inspector;this._removeInspectorEvents(),inspector.on(Metro.events.click,".js-table-inspector-field-up",function(){var index_view,tr=$(this).closest("tr"),tr_prev=tr.prev("tr"),index=tr.data("index");0!==tr_prev.length&&(tr.insertBefore(tr_prev),tr.addClass("flash"),setTimeout(function(){tr.removeClass("flash")},1e3),index_view=tr.index(),tr.data("index-view",index_view),that.view[index]["index-view"]=index_view,$.each(tr.nextAll(),function(){var t=$(this);index_view++,t.data("index-view",index_view),that.view[t.data("index")]["index-view"]=index_view}),that._createTableHeader(),that._draw())}),inspector.on(Metro.events.click,".js-table-inspector-field-down",function(){var index_view,tr=$(this).closest("tr"),tr_next=tr.next("tr"),index=tr.data("index");0!==tr_next.length&&(tr.insertAfter(tr_next),tr.addClass("flash"),setTimeout(function(){tr.removeClass("flash")},1e3),index_view=tr.index(),tr.data("index-view",index_view),that.view[index]["index-view"]=index_view,$.each(tr.prevAll(),function(){var t=$(this);index_view--,t.data("index-view",index_view),that.view[t.data("index")]["index-view"]=index_view}),that._createTableHeader(),that._draw())}),inspector.on(Metro.events.click,"input[type=checkbox]",function(){var check=$(this),status=check.is(":checked"),index=check.val(),op=["cls","clsColumn"];status?$.each(op,function(){var a;a=Utils.isValue(that.heads[index][this])?Utils.strToArray(that.heads[index][this]):[],Utils.arrayDelete(a,"hidden"),that.heads[index][this]=a.join(" "),that.view[index].show=!0}):$.each(op,function(){var a;-1===(a=Utils.isValue(that.heads[index][this])?Utils.strToArray(that.heads[index][this]):[]).indexOf("hidden")&&a.push("hidden"),that.heads[index][this]=a.join(" "),that.view[index].show=!1}),that._createTableHeader(),that._draw()}),inspector.find("input[type=number]").on(Metro.events.inputchange,function(){var input=$(this),index=input.attr("data-index"),val=parseInt(input.val());that.view[index].size=0===val?"":val,that._createTableHeader()}),inspector.on(Metro.events.click,".js-table-inspector-save",function(){that._saveTableView(),that.openInspector(!1)}),inspector.on(Metro.events.click,".js-table-inspector-cancel",function(){that.openInspector(!1)}),inspector.on(Metro.events.click,".js-table-inspector-reset",function(){that.resetView()})},_removeInspectorEvents:function(){var inspector=this.inspector;inspector.off(Metro.events.click,".js-table-inspector-field-up"),inspector.off(Metro.events.click,".js-table-inspector-field-down"),inspector.off(Metro.events.click,"input[type=checkbox]"),inspector.off(Metro.events.click,".js-table-inspector-save"),inspector.off(Metro.events.click,".js-table-inspector-cancel"),inspector.off(Metro.events.click,".js-table-inspector-reset"),inspector.find("input[type=number]").off(Metro.events.inputchange)},_saveTableView:function(){var element=this.element,o=this.options,view=this.view,id=element.attr("id");"client"===o.viewSaveMode.toLowerCase()?(Metro.storage.setItem(o.viewSavePath.replace("$1",id),view),Utils.exec(o.onViewSave,[o.viewSavePath,view],element[0])):$.post(o.viewSavePath,{id:element.attr("id"),view:view},function(data,status,xhr){Utils.exec(o.onViewSave,[o.viewSavePath,view,data,status,xhr],element[0])})},_info:function(start,stop,length){var text,element=this.element,o=this.options,component=element.closest(".table-component"),info=Utils.isValue(this.wrapperInfo)?this.wrapperInfo:component.find(".table-info");0!==info.length&&(length<stop&&(stop=length),0===this.items.length&&(start=stop=length=0),text=(text=(text=(text=o.tableInfoTitle).replace("$1",start)).replace("$2",stop)).replace("$3",length),info.html(text))},_paging:function(length){var i,prev,next,pagination,element=this.element,o=this.options,component=element.closest(".table-component"),pagination_wrapper=Utils.isValue(this.wrapperPagination)?this.wrapperPagination:component.find(".table-pagination");if(pagination_wrapper.html(""),pagination=$("<ul>").addClass("pagination").addClass(o.clsPagination).appendTo(pagination_wrapper),0!==this.items.length&&-1!==o.rows){this.pagesCount=Math.ceil(length/o.rows);var add_item=function(item_title,item_type,data){var li,a;return li=$("<li>").addClass("page-item").addClass(item_type),(a=$("<a>").addClass("page-link").html(item_title)).data("page",data),a.appendTo(li),li};if(prev=add_item(o.paginationPrevTitle,"service prev-page","prev"),pagination.append(prev),pagination.append(add_item(1,1===this.currentPage?"active":"",1)),!0!==o.paginationShortMode||this.pagesCount<=7)for(i=2;i<this.pagesCount;i++)pagination.append(add_item(i,i===this.currentPage?"active":"",i));else if(this.currentPage<5){for(i=2;i<=5;i++)pagination.append(add_item(i,i===this.currentPage?"active":"",i));5<this.pagesCount&&pagination.append(add_item("...","no-link",null))}else if(this.currentPage<=this.pagesCount&&this.currentPage>this.pagesCount-5+1)for(5<this.pagesCount&&pagination.append(add_item("...","no-link",null)),i=this.pagesCount-5+1;i<this.pagesCount;i++)pagination.append(add_item(i,i===this.currentPage?"active":"",i));else pagination.append(add_item("...","no-link",null)),pagination.append(add_item(this.currentPage-1,"",this.currentPage-1)),pagination.append(add_item(this.currentPage,"active",this.currentPage)),pagination.append(add_item(this.currentPage+1,"",this.currentPage+1)),pagination.append(add_item("...","no-link",null));(1<this.pagesCount||this.currentPage<this.pagesCount)&&pagination.append(add_item(this.pagesCount,this.currentPage===this.pagesCount?"active":"",this.pagesCount)),next=add_item(o.paginationNextTitle,"service next-page","next"),pagination.append(next),1===this.currentPage&&prev.addClass("disabled"),this.currentPage===this.pagesCount&&next.addClass("disabled"),0===this.filteredItems.length&&(pagination.addClass("disabled"),pagination.children().addClass("disabled"))}},_filter:function(){var items,that=this,o=this.options,element=this.element;return items=Utils.isValue(this.searchString)&&that.searchString.length>=o.searchMinLength||0<this.filters.length?this.items.filter(function(row){var result,search_result,i,row_data="",j=0;if(0<that.filters.length){for(result="and"===o.filtersOperator.toLowerCase(),i=0;i<that.filters.length;i++)Utils.isNull(that.filters[i])||(j++,result="and"===o.filtersOperator.toLowerCase()?result&&Utils.exec(that.filters[i],[row,that.heads]):result||Utils.exec(that.filters[i],[row,that.heads]));0===j&&(result=!0)}else result=!0;return 0<that.searchFields.length?$.each(that.heads,function(i,v){-1<that.searchFields.indexOf(v.name)&&(row_data+="•"+row[i])}):row_data=row.join("•"),row_data=row_data.replace(/[\n\r]+|[\s]{2,}/g," ").trim().toLowerCase(),search_result=!(Utils.isValue(that.searchString)&&that.searchString.length>=o.searchMinLength)||~row_data.indexOf(that.searchString),(result=result&&search_result)?Utils.exec(o.onFilterRowAccepted,[row],element[0]):Utils.exec(o.onFilterRowDeclined,[row],element[0]),result}):this.items,Utils.exec(o.onSearch,[that.searchString,items],element[0]),this.filteredItems=items},_draw:function(cb){var i,items,that=this,element=this.element,o=this.options,body=element.find("tbody"),start=-1===parseInt(o.rows)?0:o.rows*(this.currentPage-1),stop=-1===parseInt(o.rows)?this.items.length-1:start+o.rows-1,stored_keys=Metro.storage.getItem(o.checkStoreKey.replace("$1",element.attr("id"))),view=o.staticView?this.viewDefault:this.view;for(body.html(""),items=this._filter(),i=start;i<=stop;i++){var j,tr,td,check,is_even_row,cells=items[i],tds=[];if(Utils.isValue(cells)){for((tr=$("<tr>").addClass(o.clsBodyRow)).data("original",cells),is_even_row=i%2==0,td=$("<td>").html(i+1),void 0!==that.service[0].clsColumn&&td.addClass(that.service[0].clsColumn),td.appendTo(tr),td=$("<td>"),check="checkbox"===o.checkType?$("<input type='checkbox' data-style='"+o.checkStyle+"' data-role='checkbox' name='"+(Utils.isValue(o.checkName)?o.checkName:"table_row_check")+"[]' value='"+items[i][o.checkColIndex]+"'>"):$("<input type='radio' data-style='"+o.checkStyle+"' data-role='radio' name='"+(Utils.isValue(o.checkName)?o.checkName:"table_row_check")+"' value='"+items[i][o.checkColIndex]+"'>"),Utils.isValue(stored_keys)&&Array.isArray(stored_keys)&&-1<stored_keys.indexOf(""+items[i][o.checkColIndex])&&check.prop("checked",!0),check.addClass("table-service-check"),Utils.exec(o.onCheckDraw,[check],check[0]),check.appendTo(td),void 0!==that.service[1].clsColumn&&td.addClass(that.service[1].clsColumn),td.appendTo(tr),j=0;j<cells.length;j++)tds[j]=null;for($.each(cells,function(cell_index){!0===o.cellWrapper?(td=$("<td>"),$("<div>").addClass("cell-wrapper").addClass(o.clsCellWrapper).html(this).appendTo(td)):td=$("<td>").html(this),td.addClass(o.clsBodyCell),Utils.isValue(that.heads[cell_index].clsColumn)&&td.addClass(that.heads[cell_index].clsColumn),!1===Utils.bool(view[cell_index].show)&&td.addClass("hidden"),Utils.bool(view[cell_index].show)&&td.removeClass("hidden"),td.data("original",this),tds[view[cell_index]["index-view"]]=td,Utils.exec(o.onDrawCell,[td,this,cell_index,that.heads[cell_index],cells],td[0])}),j=0;j<cells.length;j++)tds[j].appendTo(tr),Utils.exec(o.onAppendCell,[tds[j],tr,j,element],tds[j][0]);Utils.exec(o.onDrawRow,[tr,that.view,that.heads,cells],tr[0]),tr.addClass(o.clsRow).addClass(is_even_row?o.clsEvenRow:o.clsOddRow).appendTo(body),Utils.exec(o.onAppendRow,[tr,element],tr[0])}}this._info(start+1,stop+1,items.length),this._paging(items.length),this.activity&&this.activity.hide(),Utils.exec(o.onDraw,[element],element[0]),void 0!==cb&&Utils.exec(cb,[element],element[0])},_getItemContent:function(row){var result,col=row[this.sort.colIndex],format=this.heads[this.sort.colIndex].format,formatMask=Utils.isNull(this.heads)||Utils.isNull(this.heads[this.sort.colIndex])||!Utils.isValue(this.heads[this.sort.colIndex].formatMask)?"%Y-%m-%d":this.heads[this.sort.colIndex].formatMask,o=this.options;if(result=(""+col).toLowerCase().replace(/[\n\r]+|[\s]{2,}/g," ").trim(),Utils.isValue(format))switch(-1===["number","int","float","money"].indexOf(format)||","===o.thousandSeparator&&"."===o.decimalSeparator||(result=Utils.parseNumber(result,o.thousandSeparator,o.decimalSeparator)),format){case"date":result=Utils.isValue(formatMask)?result.toDate(formatMask):new Date(result);break;case"number":result=Number(result);break;case"int":result=parseInt(result);break;case"float":result=parseFloat(result);break;case"money":result=Utils.parseMoney(result);break;case"card":result=Utils.parseCard(result);break;case"phone":result=Utils.parsePhone(result)}return result},updateItem:function(key,field,value){var item=this.items[this.index[key]],fieldIndex=null;return Utils.isNull(item)?(console.log("Item is undefined for update"),this):(isNaN(field)&&this.heads.forEach(function(v,i){v.name===field&&(fieldIndex=i)}),Utils.isNull(fieldIndex)?console.log("Item is undefined for update. Field "+field+" not found in data structure"):(item[fieldIndex]=value,this.items[this.index[key]]=item),this)},getItem:function(key){return this.items[this.index[key]]},deleteItem:function(fieldIndex,value){var i,deleteIndexes=[],is_func=Utils.isFunc(value);for(i=0;i<this.items.length;i++)is_func?Utils.exec(value,[this.items[i][fieldIndex]])&&deleteIndexes.push(i):this.items[i][fieldIndex]===value&&deleteIndexes.push(i);return this.items=Utils.arrayDeleteByMultipleKeys(this.items,deleteIndexes),this},deleteItemByName:function(fieldName,value){var i,fieldIndex,deleteIndexes=[],is_func=Utils.isFunc(value);for(i=0;i<this.heads.length;i++)if(this.heads[i].name===fieldName){fieldIndex=i;break}for(i=0;i<this.items.length;i++)is_func?Utils.exec(value,[this.items[i][fieldIndex]])&&deleteIndexes.push(i):this.items[i][fieldIndex]===value&&deleteIndexes.push(i);return this.items=Utils.arrayDeleteByMultipleKeys(this.items,deleteIndexes),this},draw:function(){return this._draw(),this},sorting:function(dir){var that=this,element=this.element,o=this.options;return Utils.isValue(dir)&&(this.sort.dir=dir),Utils.exec(o.onSortStart,[this.items],element[0]),this.items.sort(function(a,b){var c1=that._getItemContent(a),c2=that._getItemContent(b),result=0;return c1<c2&&(result="asc"===that.sort.dir?-1:1),c2<c1&&(result="asc"===that.sort.dir?1:-1),0!==result&&Utils.exec(o.onSortItemSwitch,[a,b,result],element[0]),result}),Utils.exec(o.onSortStop,[this.items],element[0]),this},search:function(val){return this.searchString=val.trim().toLowerCase(),this.currentPage=1,this._draw(),this},_rebuild:function(review){var sortable_columns,that=this,element=this.element,need_sort=!1;this._createIndex(),!0===review&&(this.view=this._createView()),this._createTableHeader(),this._createTableBody(),this._createTableFooter(),0<this.heads.length&&$.each(this.heads,function(i){!need_sort&&-1<["asc","desc"].indexOf(this.sortDir)&&(need_sort=!0,that.sort.colIndex=i,that.sort.dir=this.sortDir)}),need_sort&&(sortable_columns=element.find(".sortable-column"),this._resetSortClass(sortable_columns),$(sortable_columns.get(that.sort.colIndex)).addClass("sort-"+that.sort.dir),this.sorting()),that.currentPage=1,that._draw()},setHeads:function(data){return this.heads=data,this},setHeadItem:function(name,data){var i,index;for(i=0;i<this.heads.length;i++)if(item.name===name){index=i;break}return this.heads[index]=data,this},setItems:function(data){return this.items=data,this},setData:function(data){return this.items=[],this.heads=[],this.foots=[],this._createItemsFromJSON(data),this._rebuild(!0),this},loadData:function(source,review){var that=this,element=this.element,o=this.options;Utils.isValue(review)||(review=!0),element.html(""),Utils.isValue(source)?(o.source=source,Utils.exec(o.onDataLoad,[o.source],element[0]),$.get(o.source,function(data){that.items=[],that.heads=[],that.foots=[],that._createItemsFromJSON(data),that._rebuild(review),Utils.exec(o.onDataLoaded,[o.source,data],element[0])}).fail(function(jqXHR,textStatus,errorThrown){Utils.exec(o.onDataLoadError,[o.source,jqXHR,textStatus,errorThrown],element[0]),console.log(textStatus),console.log(jqXHR),console.log(errorThrown)})):this._rebuild(review)},reload:function(review){this.loadData(this.options.source,review)},next:function(){if(0!==this.items.length){if(this.currentPage++,!(this.currentPage>this.pagesCount))return this._draw(),this;this.currentPage=this.pagesCount}},prev:function(){if(0!==this.items.length){if(this.currentPage--,0!==this.currentPage)return this._draw(),this;this.currentPage=1}},first:function(){if(0!==this.items.length)return this.currentPage=1,this._draw(),this},last:function(){if(0!==this.items.length)return this.currentPage=this.pagesCount,this._draw(),this},page:function(num){return num<=0&&(num=1),num>this.pagesCount&&(num=this.pagesCount),this.currentPage=num,this._draw(),this},addFilter:function(f,redraw){var i,filterIndex=null,func=Utils.isFunc(f);if(!1!==func){for(i=0;i<this.filters.length;i++)if(Utils.isNull(this.filters[i])){filterIndex=i,this.filters[i]=func;break}return Utils.isNull(filterIndex)&&(this.filters.push(func),filterIndex=this.filters.length-1),!0===redraw&&(this.currentPage=1,this.draw()),filterIndex}},removeFilter:function(key,redraw){return!(this.filters[key]=null)===redraw&&(this.currentPage=1,this.draw()),this},removeFilters:function(redraw){return this.filters=[],!0===redraw&&(this.currentPage=1,this.draw()),this},getItems:function(){return this.items},getHeads:function(){return this.heads},getView:function(){return this.view},getFilteredItems:function(){return 0<this.filteredItems.length?this.filteredItems:this.items},getSelectedItems:function(){var element=this.element,o=this.options,stored_keys=Metro.storage.getItem(o.checkStoreKey.replace("$1",element.attr("id"))),selected=[];return Utils.isValue(stored_keys)?($.each(this.items,function(){-1!==stored_keys.indexOf(""+this[o.checkColIndex])&&selected.push(this)}),selected):[]},getStoredKeys:function(){var element=this.element,o=this.options;return Metro.storage.getItem(o.checkStoreKey.replace("$1",element.attr("id")),[])},clearSelected:function(redraw){var element=this.element,o=this.options;Metro.storage.setItem(o.checkStoreKey.replace("$1",element.attr("id")),[]),element.find("table-service-check-all input").prop("checked",!1),!0===redraw&&this._draw()},getFilters:function(){return this.filters},getFiltersIndexes:function(){return this.filtersIndexes},openInspector:function(mode){var ins=this.inspector;mode?ins.show(0,function(){ins.css({top:($(window).height()-ins.outerHeight(!0))/2+pageYOffset,left:($(window).width()-ins.outerWidth(!0))/2+pageXOffset}).data("open",!0)}):ins.hide().data("open",!1)},closeInspector:function(){this.openInspector(!1)},toggleInspector:function(){this.openInspector(!this.inspector.data("open"))},resetView:function(){this.view=this._createView(),this._createTableHeader(),this._createTableFooter(),this._draw(),this._resetInspector(),this._saveTableView()},rebuildIndex:function(){this._createIndex()},getIndex:function(){return this.index},export:function(to,mode,filename,options){var i,j,cells,items,tr,td,start,stop,that=this,o=this.options,table=document.createElement("table"),head=$("<thead>").appendTo(table),body=$("<tbody>").appendTo(table),tds=[];if("function"==typeof Export.tableToCSV){for(mode=Utils.isValue(mode)?mode.toLowerCase():"all-filtered",filename=Utils.isValue(filename)?filename:Utils.elementId("table")+"-export.csv",tr=$("<tr>"),cells=this.heads,j=0;j<cells.length;j++)tds[j]=null;for($.each(cells,function(cell_index){!1!==Utils.bool(that.view[cell_index].show)&&(td=$("<th>"),Utils.isValue(this.title)&&td.html(this.title),tds[that.view[cell_index]["index-view"]]=td)}),j=0;j<cells.length;j++)Utils.isValue(tds[j])&&tds[j].appendTo(tr);for(tr.appendTo(head),stop="checked"===mode?(start=0,(items=this.getSelectedItems()).length-1):"view"===mode?(items=this._filter(),start=-1===parseInt(o.rows)?0:o.rows*(this.currentPage-1),-1===parseInt(o.rows)?items.length-1:start+o.rows-1):"all"===mode?(start=0,(items=this.items).length-1):(start=0,(items=this._filter()).length-1),i=start;i<=stop;i++)if(Utils.isValue(items[i])){for(tr=$("<tr>"),cells=items[i],j=0;j<cells.length;j++)tds[j]=null;for($.each(cells,function(cell_index){!1!==Utils.bool(that.view[cell_index].show)&&(td=$("<td>").html(this),tds[that.view[cell_index]["index-view"]]=td)}),j=0;j<cells.length;j++)Utils.isValue(tds[j])&&tds[j].appendTo(tr);tr.appendTo(body)}Export.tableToCSV(table,filename,options),table.remove()}},changeAttribute:function(attributeName){var that=this,element=this.element,o=this.options;switch(attributeName){case"data-check":o.check=Utils.bool(element.attr("data-check")),that._service(),that._createTableHeader(),that._draw();break;case"data-rownum":o.rownum=Utils.bool(element.attr("data-rownum")),that._service(),that._createTableHeader(),that._draw()}}};Metro.plugin("table",Table);var Tabs={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this._targets=[],this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onTabsCreate,[this.element],this.elem),this},options:{expand:!1,expandPoint:null,tabsPosition:"top",tabsType:"default",clsTabs:"",clsTabsList:"",clsTabsListItem:"",clsTabsListItemActive:"",onTab:Metro.noop,onBeforeTab:Metro.noop_true,onTabsCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,tab=0<element.find(".active").length?$(element.find(".active")[0]):void 0;this._createStructure(),this._createEvents(),this._open(tab)},_createStructure:function(){var expandTitle,hamburger,element=this.element,o=this.options,parent=element.parent(),right_parent=parent.hasClass("tabs"),container=right_parent?parent:$("<div>").addClass("tabs tabs-wrapper");if(Utils.isValue(element.attr("id"))||element.attr("id",Utils.elementId("tabs")),container.addClass(o.tabsPosition.replace(["-","_","+"]," ")),element.addClass("tabs-list"),"default"!==o.tabsType&&element.addClass("tabs-"+o.tabsType),right_parent||(container.insertBefore(element),element.appendTo(container)),element.data("expanded",!1),expandTitle=$("<div>").addClass("expand-title"),container.prepend(expandTitle),0===(hamburger=container.find(".hamburger")).length){hamburger=$("<button>").attr("type","button").addClass("hamburger menu-down").appendTo(container);for(var i=0;i<3;i++)$("<span>").addClass("line").appendTo(hamburger);!0===Colors.isLight(Utils.computedRgbToHex(Utils.getStyleOne(container,"background-color")))&&hamburger.addClass("dark")}container.addClass(o.clsTabs),element.addClass(o.clsTabsList),element.children("li").addClass(o.clsTabsListItem),!0!==o.expand||o.tabsPosition.contains("vertical")?Utils.isValue(o.expandPoint)&&Utils.mediaExist(o.expandPoint)&&!o.tabsPosition.contains("vertical")&&container.addClass("tabs-expand"):container.addClass("tabs-expand"),o.tabsPosition.contains("vertical")&&container.addClass("tabs-expand")},_createEvents:function(){var that=this,element=this.element,o=this.options,container=element.parent();$(window).on(Metro.events.resize+"-"+element.attr("id"),function(){o.tabsPosition.contains("vertical")||(!0!==o.expand||o.tabsPosition.contains("vertical")?Utils.isValue(o.expandPoint)&&Utils.mediaExist(o.expandPoint)&&!o.tabsPosition.contains("vertical")?container.hasClass("tabs-expand")||container.addClass("tabs-expand"):container.hasClass("tabs-expand")&&container.removeClass("tabs-expand"):container.addClass("tabs-expand"))}),container.on(Metro.events.click,".hamburger, .expand-title",function(){!1===element.data("expanded")?(element.addClass("expand"),element.data("expanded",!0),container.find(".hamburger").addClass("active")):(element.removeClass("expand"),element.data("expanded",!1),container.find(".hamburger").removeClass("active"))}),element.on(Metro.events.click,"a",function(e){var link=$(this),href=link.attr("href").trim(),tab=link.parent("li");if(tab.hasClass("active")&&e.preventDefault(),!0===element.data("expanded")&&(element.removeClass("expand"),element.data("expanded",!1),container.find(".hamburger").removeClass("active")),!0!==Utils.exec(o.onBeforeTab,[tab,element],tab[0]))return!1;Utils.isValue(href)&&"#"===href[0]&&(that._open(tab),e.preventDefault())})},_collectTargets:function(){var that=this,tabs=this.element.find("li");this._targets=[],$.each(tabs,function(){var target=$(this).find("a").attr("href").trim();1<target.length&&"#"===target[0]&&that._targets.push(target)})},_open:function(tab){var element=this.element,o=this.options,tabs=element.find("li"),expandTitle=element.siblings(".expand-title");if(0!==tabs.length){this._collectTargets(),void 0===tab&&(tab=$(tabs[0]));var target=tab.find("a").attr("href");void 0!==target&&(tabs.removeClass("active"),tab.parent().hasClass("d-menu")?tab.parent().parent().addClass("active"):tab.addClass("active"),$.each(this._targets,function(){var t=$(this);0<t.length&&t.hide()}),"#"!==target&&"#"===target[0]&&$(target).show(),expandTitle.html(tab.find("a").html()),tab.addClass(o.clsTabsListItemActive),Utils.exec(o.onTab,[tab,element],tab[0]))}},next:function(){var next;0<(next=this.element.find("li.active").next("li")).length&&this._open(next)},prev:function(){var next;0<(next=this.element.find("li.active").prev("li")).length&&this._open(next)},open:function(tab){var tabs=this.element.find("li");Utils.isValue(tab)||(tab=1),Utils.isInt(tab)?Utils.isValue(tabs[tab-1])&&this._open($(tabs[tab-1])):this._open($(tab))},changeAttribute:function(attributeName){}};Metro.plugin("tabs",Tabs);var MaterialTabs={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.marker=null,this._setOptionsFromDOM(),this._create(),this},options:{deep:!1,fixedTabs:!1,clsComponent:"",clsTab:"",clsTabActive:"",clsMarker:"",onBeforeTabOpen:Metro.noop_true,onTabOpen:Metro.noop,onTabsCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createStructure(),this._createEvents(),Utils.exec(o.onTabsCreate,[element])},_applyColor:function(to,color,option){Utils.isJQueryObject(to)||(to=$(to)),Utils.isValue(color)&&(Utils.isColor(color)?to.css(option,color):to.addClass(color))},_createStructure:function(){var element=this.element,o=this.options,tabs=element.find("li"),active_tab=element.find("li.active");element.addClass("tabs-material").addClass(o.clsComponent),tabs.addClass(o.clsTab),!0===o.deep&&element.addClass("deep"),!0===o.fixedTabs&&element.addClass("fixed-tabs"),this.marker=element.find(".tab-marker"),0===this.marker.length&&(this.marker=$("<span>").addClass("tab-marker").addClass(o.clsMarker).appendTo(element)),this.openTab(0===active_tab.length?tabs[0]:active_tab[0])},_createEvents:function(){var that=this,element=this.element,o=this.options,tabs=element.find("li");element.on(Metro.events.click,"li",function(e){var tab=$(this),active_tab=element.find("li.active"),tab_next=tabs.index(tab)>tabs.index(active_tab),target=tab.children("a").attr("href");if(Utils.isValue(target)&&"#"===target[0]){if(tab.hasClass("active"))return;if(tab.hasClass("disabled"))return;if(!1===Utils.exec(o.onBeforeTabOpen,[tab,target,tab_next],this))return;if(!Utils.isValue(target))return;that.openTab(tab,tab_next),e.preventDefault()}});$("html").hasClass("metro-touch-device")||$(element).mousewheel(function(event,delta,deltaX,deltaY){var scroll_value=delta*METRO_SCROLL_MULTIPLE;return element.scrollLeft(element.scrollLeft()-scroll_value),!1})},openTab:function(tab,tab_next){var shift,tab_width,target,tab_left,element=this.element,o=this.options,tabs=element.find("li"),element_scroll=element.scrollLeft(),width=element.width();Utils.isJQueryObject(tab)||(tab=$(tab)),$.each(tabs,function(){var target=$(this).find("a").attr("href");Utils.isValue(target)&&"#"!==target.trim()&&0<$(target).length&&$(target).hide()}),tab_left=tab.position().left,tab_width=tab.width(),shift=tab.position().left+tab.width(),tabs.removeClass("active").removeClass(o.clsTabActive),tab.addClass("active").addClass(o.clsTabActive),width<shift+32&&element.animate({scrollLeft:element_scroll+(shift-width)+tab_width/2}),tab_left-32<0&&element.animate({scrollLeft:tab_left+element_scroll-tab_width/2}),this.marker.animate({left:tab_left+element_scroll,width:tab.width()}),target=tab.find("a").attr("href"),Utils.isValue(target)&&"#"!==target.trim()&&0<$(target).length&&$(target).show(),Utils.exec(o.onTabOpen,[tab,target,tab_next],tab[0])},changeAttribute:function(attributeName){},destroy:function(){}};Metro.plugin("materialtabs",MaterialTabs);var TagInput={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.values=[],this._setOptionsFromDOM(),this._create(),this},options:{randomColor:!1,maxTags:0,tagSeparator:",",tagTrigger:"13,188",clsTag:"",clsTagTitle:"",clsTagRemover:"",onBeforeTagAdd:Metro.noop_true,onTagAdd:Metro.noop,onBeforeTagRemove:Metro.noop_true,onTagRemove:Metro.noop,onTag:Metro.noop,onTagInputCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createStructure(),this._createEvents(),Utils.exec(o.onTagInputCreate,[element],element[0])},_createStructure:function(){var container,that=this,element=this.element,o=this.options,values=element.val().trim();container=$("<div>").addClass("tag-input "+element[0].className).insertBefore(element),element.appendTo(container),element[0].className="",element.addClass("original-input"),$("<input type='text'>").addClass("input-wrapper").attr("size",1).appendTo(container),Utils.isValue(values)&&$.each(Utils.strToArray(values,o.tagSeparator),function(){that._addTag(this)}),element.is(":disabled")?this.disable():this.enable()},_createEvents:function(){var that=this,element=this.element,o=this.options,container=element.closest(".tag-input"),input=container.find(".input-wrapper");input.on(Metro.events.focus,function(){container.addClass("focused")}),input.on(Metro.events.blur,function(){container.removeClass("focused")}),input.on(Metro.events.inputchange,function(){input.attr("size",Math.ceil(input.val().length/2)+2)}),input.on(Metro.events.keyup,function(e){var val=input.val().trim();""!==val&&-1!==Utils.strToArray(o.tagTrigger,",","integer").indexOf(e.keyCode)&&(input.val(""),that._addTag(val.replace(",","")),input.attr("size",1),e.keyCode===Metro.keyCode.ENTER&&e.preventDefault())}),container.on(Metro.events.click,".tag .remover",function(){var tag=$(this).closest(".tag");that._delTag(tag)}),container.on(Metro.events.click,function(){input.focus()})},_addTag:function(val){var tag,title,remover,element=this.element,o=this.options,input=element.closest(".tag-input").find(".input-wrapper");if(!(0<o.maxTags&&this.values.length===o.maxTags)&&Utils.exec(o.onBeforeTagAdd,[val,this.values],element[0])){if((tag=$("<span>").addClass("tag").addClass(o.clsTag).insertBefore(input)).data("value",val),title=$("<span>").addClass("title").addClass(o.clsTagTitle).html(val),remover=$("<span>").addClass("remover").addClass(o.clsTagRemover).html("&times;"),title.appendTo(tag),remover.appendTo(tag),!0===o.randomColor){var bg,fg,bg_r,colors=Colors.colors(Colors.PALETTES.ALL);bg=colors[Utils.random(0,colors.length-1)],bg_r=Colors.darken(bg,15),fg=Colors.isDark(bg)?"#ffffff":"#000000",tag.css({backgroundColor:bg,color:fg}),remover.css({backgroundColor:bg_r,color:fg})}this.values.push(val),element.val(this.values.join(o.tagSeparator)),Utils.exec(o.onTagAdd,[tag,val,this.values],element[0]),Utils.exec(o.onTag,[tag,val,this.values],element[0])}},_delTag:function(tag){var element=this.element,o=this.options,val=tag.data("value");Utils.exec(o.onBeforeTagRemove,[tag,val,this.values],element[0])&&(Utils.arrayDelete(this.values,val),element.val(this.values.join(o.tagSeparator)),Utils.exec(o.onTagRemove,[tag,val,this.values],element[0]),Utils.exec(o.onTag,[tag,val,this.values],element[0]),tag.remove())},tags:function(){return this.values},val:function(v){var that=this,o=this.options;if(!Utils.isValue(v))return this.tags();this.values=[],Utils.isValue(v)&&$.each(Utils.strToArray(v,o.tagSeparator),function(){that._addTag(this)})},clear:function(){var element=this.element,container=element.closest(".tag-input");this.values=[],element.val(""),container.find(".tag").remove()},disable:function(){this.element.data("disabled",!0),this.element.parent().addClass("disabled")},enable:function(){this.element.data("disabled",!1),this.element.parent().removeClass("disabled")},toggleState:function(){this.elem.disabled?this.disable():this.enable()},changeAttribute:function(attributeName){var val,that=this,element=this.element;this.options;switch(attributeName){case"value":val=element.attr("value").trim(),that.clear(),Utils.isValue(val)&&that.val(Utils.strToArray(val,","));break;case"disabled":this.toggleState()}},destroy:function(){var element=this.element,container=element.closest(".tag-input"),input=container.find(".input-wrapper");input.off(Metro.events.focus),input.off(Metro.events.blur),input.off(Metro.events.keydown),container.off(Metro.events.click,".tag .remover"),container.off(Metro.events.click),element.insertBefore(container),container.remove()}};Metro.plugin("taginput",TagInput);var Textarea={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onTextareaCreate,[this.element]),this},options:{charsCounter:null,charsCounterTemplate:"$1",defaultValue:"",prepend:"",append:"",copyInlineStyles:!0,clearButton:!0,clearButtonIcon:"<span class='default-icon-cross'></span>",autoSize:!0,clsPrepend:"",clsAppend:"",clsComponent:"",clsTextarea:"",onChange:Metro.noop,onTextareaCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){this._createStructure(),this._createEvents()},_createStructure:function(){var clearButton,that=this,element=this.element,o=this.options,prev=element.prev(),parent=element.parent(),container=$("<div>").addClass("textarea "+element[0].className);(0===prev.length?parent.prepend(container):container.insertAfter(prev),!1!==o.clearButton&&(clearButton=$("<button>").addClass("button input-clear-button").attr("tabindex",-1).attr("type","button").html(o.clearButtonIcon)).appendTo(container),element.appendTo(container),o.autoSize&&(container.addClass("autosize"),setTimeout(function(){null,that.resize()},0)),"rtl"===element.attr("dir")&&container.addClass("rtl").attr("dir","rtl"),""!==o.prepend)&&$("<div>").html(o.prepend).addClass("prepend").addClass(o.clsPrepend).appendTo(container);if(""!==o.append){var append=$("<div>").html(o.append);append.addClass("append").addClass(o.clsAppend).appendTo(container),clearButton.css({right:append.outerWidth()+4})}if(!(element[0].className="")===o.copyInlineStyles)for(var i=0,l=element[0].style.length;i<l;i++)container.css(element[0].style[i],element.css(element[0].style[i]));Utils.isValue(o.defaultValue)&&""===element.val().trim()&&element.val(o.defaultValue),container.addClass(o.clsComponent),element.addClass(o.clsTextarea),element.is(":disabled")?this.disable():this.enable()},_createEvents:function(){var that=this,element=this.element,o=this.options,textarea=element.closest(".textarea"),chars_counter=$(o.charsCounter);textarea.on(Metro.events.click,".input-clear-button",function(){element.val(Utils.isValue(o.defaultValue)?o.defaultValue:"").trigger("change").trigger("keyup").focus()}),o.autoSize&&(element.on(Metro.events.keyup,$.proxy(this.resize,that)),element.on(Metro.events.keydown,$.proxy(this.resize,that)),element.on(Metro.events.change,$.proxy(this.resize,that)),element.on(Metro.events.focus,$.proxy(this.resize,that)),element.on(Metro.events.cut,$.proxy(this.resize,that)),element.on(Metro.events.paste,$.proxy(this.resize,that)),element.on(Metro.events.drop,$.proxy(this.resize,that))),element.on(Metro.events.blur,function(){textarea.removeClass("focused")}),element.on(Metro.events.focus,function(){textarea.addClass("focused")}),element.on(Metro.events.keyup,function(){Utils.isValue(o.charsCounter)&&0<chars_counter.length&&("INPUT"===chars_counter[0].tagName?chars_counter.val(that.length()):chars_counter.html(o.charsCounterTemplate.replace("$1",that.length()))),Utils.exec(o.onChange,[element.val(),that.length()],element[0])})},resize:function(){var element=this.element;element[0].style.cssText="height:auto;",element[0].style.cssText="height:"+element[0].scrollHeight+"px"},clear:function(){this.element.val("").trigger("change").trigger("keyup").focus()},toDefault:function(){this.element.val(Utils.isValue(this.options.defaultValue)?this.options.defaultValue:"").trigger("change").trigger("keyup").focus()},length:function(){return this.elem.value.split("").length},disable:function(){this.element.data("disabled",!0),this.element.parent().addClass("disabled")},enable:function(){this.element.data("disabled",!1),this.element.parent().removeClass("disabled")},toggleState:function(){this.elem.disabled?this.disable():this.enable()},changeAttribute:function(attributeName){switch(attributeName){case"disabled":this.toggleState()}}};Metro.plugin("textarea",Textarea);var Tile={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.effectInterval=!1,this.images=[],this.slides=[],this.currentSlide=-1,this.unload=!1,this._setOptionsFromDOM(),this._create(),this},options:{size:"medium",cover:"",coverPosition:"center",effect:"",effectInterval:3e3,effectDuration:500,target:null,canTransform:!0,onClick:Metro.noop,onTileCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createTile(),this._createEvents(),Utils.exec(o.onTileCreate,[element])},_createTile:function(){function switchImage(el,img_src){setTimeout(function(){el.fadeOut(500,function(){el.css("background-image","url("+img_src+")"),el.fadeIn()})},Utils.random(0,1e3))}var that=this,element=this.element,o=this.options,slides=element.find(".slide"),slides2=element.find(".slide-front, .slide-back");element.addClass("tile-"+o.size),-1<o.effect.indexOf("hover-")&&(element.addClass("effect-"+o.effect),$.each(slides2,function(){var slide=$(this);void 0!==slide.data("cover")&&that._setCover(slide,slide.data("cover"),slide.data("cover-position"))})),-1<o.effect.indexOf("animate-")&&1<slides.length&&($.each(slides,function(i){var slide=$(this);that.slides.push(this),void 0!==slide.data("cover")&&that._setCover(slide,slide.data("cover"),slide.data("cover-position")),0<i&&(-1<["animate-slide-up","animate-slide-down"].indexOf(o.effect)&&slide.css("top","100%"),-1<["animate-slide-left","animate-slide-right"].indexOf(o.effect)&&slide.css("left","100%"),-1<["animate-fade"].indexOf(o.effect)&&slide.css("opacity",0))}),this.currentSlide=0,this._runEffects()),""!==o.cover&&this._setCover(element,o.cover),"image-set"===o.effect&&(element.addClass("image-set"),$.each(element.children("img"),function(){var img=$(this),src=this.src,div=$("<div>").addClass("img");img.hasClass("icon")||(that.images.push(this),div.css("background-image","url("+src+")"),element.prepend(div),img.remove())}),setInterval(function(){for(var temp=that.images.slice(),i=0;i<element.find(".img").length;i++){var rnd_index=Utils.random(0,temp.length-1);switchImage($(element.find(".img").get(i)),temp[rnd_index].src),temp.splice(rnd_index,1)}},3e3))},_runEffects:function(){var that=this,o=this.options;!1===this.effectInterval&&(this.effectInterval=setInterval(function(){var current,next;current=$(that.slides[that.currentSlide]),that.currentSlide++,that.currentSlide===that.slides.length&&(that.currentSlide=0),next=that.slides[that.currentSlide],"animate-slide-up"===o.effect&&Animation.slideUp($(current),$(next),o.effectDuration),"animate-slide-down"===o.effect&&Animation.slideDown($(current),$(next),o.effectDuration),"animate-slide-left"===o.effect&&Animation.slideLeft($(current),$(next),o.effectDuration),"animate-slide-right"===o.effect&&Animation.slideRight($(current),$(next),o.effectDuration),"animate-fade"===o.effect&&Animation.fade($(current),$(next),o.effectDuration)},o.effectInterval))},_stopEffects:function(){clearInterval(this.effectInterval),this.effectInterval=!1},_setCover:function(to,src,pos){Utils.isValue(pos)||(pos=this.options.coverPosition),to.css({backgroundImage:"url("+src+")",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:pos})},_createEvents:function(){var that=this,element=this.element,o=this.options;element.on(Metro.events.start,function(e){var side,tile=$(this),dim_w=element.width(),dim_h=element.height(),X=Utils.pageXY(e).x-tile.offset().left,Y=Utils.pageXY(e).y-tile.offset().top;!1===Utils.isRightMouse(e)&&(side=X<1*dim_w/3&&(Y<1*dim_h/2||1*dim_h/2<Y)?"left":2*dim_w/3<X&&(Y<1*dim_h/2||1*dim_h/2<Y)?"right":1*dim_w/3<X&&X<2*dim_w/3&&dim_h/2<Y?"bottom":"top",!0===o.canTransform&&tile.addClass("transform-"+side),null!==o.target&&setTimeout(function(){document.location.href=o.target},100),Utils.exec(o.onClick,[tile]))}),element.on([Metro.events.stop,Metro.events.leave].join(" "),function(e){$(this).removeClass("transform-left").removeClass("transform-right").removeClass("transform-top").removeClass("transform-bottom")}),$(window).on(Metro.events.blur,function(){that._stopEffects()}),$(window).on(Metro.events.focus,function(){that._runEffects()})},changeAttribute:function(attributeName){}};Metro.plugin("tile",Tile);var TimePicker={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.picker=null,this.isOpen=!1,this.value=[],this.locale=Metro.locales[METRO_LOCALE].calendar,this._setOptionsFromDOM(),this._create(),this},options:{hoursStep:1,minutesStep:1,secondsStep:1,value:null,locale:METRO_LOCALE,distance:3,hours:!0,minutes:!0,seconds:!0,showLabels:!0,scrollSpeed:1,copyInlineStyles:!0,clsPicker:"",clsPart:"",clsHours:"",clsMinutes:"",clsSeconds:"",okButtonIcon:"<span class='default-icon-check'></span>",cancelButtonIcon:"<span class='default-icon-cross'></span>",onSet:Metro.noop,onOpen:Metro.noop,onClose:Metro.noop,onScroll:Metro.noop,onTimePickerCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var i,element=this.element,o=this.options,picker=this.picker;for(o.distance<1&&(o.distance=1),o.hoursStep<1&&(o.hoursStep=1),23<o.hoursStep&&(o.hoursStep=23),o.minutesStep<1&&(o.minutesStep=1),59<o.minutesStep&&(o.minutesStep=59),o.secondsStep<1&&(o.secondsStep=1),59<o.secondsStep&&(o.secondsStep=59),""!==element.val()||Utils.isValue(o.value)||(o.value=(new Date).format("%H:%M:%S")),this.value=Utils.strToArray(""!==element.val()?element.val():String(o.value),":"),i=0;i<3;i++)void 0===this.value[i]||null===this.value[i]?this.value[i]=0:this.value[i]=parseInt(this.value[i]);this._normalizeValue(),void 0===Metro.locales[o.locale]&&(o.locale=METRO_LOCALE),this.locale=Metro.locales[o.locale].calendar,this._createStructure(),this._createEvents(),this._set(),Utils.exec(o.onTimePickerCreate,[element,picker])},_normalizeValue:function(){var o=this.options;1<o.hoursStep&&(this.value[0]=Utils.nearest(this.value[0],o.hoursStep,!0)),1<o.minutesStep&&(this.value[1]=Utils.nearest(this.value[1],o.minutesStep,!0)),1<o.minutesStep&&(this.value[2]=Utils.nearest(this.value[2],o.secondsStep,!0))},_createStructure:function(){var picker,hours,minutes,seconds,i,timeWrapper,selectWrapper,selectBlock,actionBlock,element=this.element,o=this.options,prev=element.prev(),parent=element.parent(),id=Utils.elementId("time-picker");if(picker=$("<div>").attr("id",id).addClass("wheel-picker time-picker "+element[0].className).addClass(o.clsPicker),0===prev.length?parent.prepend(picker):picker.insertAfter(prev),element.attr("readonly",!0).appendTo(picker),timeWrapper=$("<div>").addClass("time-wrapper").appendTo(picker),!0===o.hours&&(hours=$("<div>").attr("data-title",this.locale.time.hours).addClass("hours").addClass(o.clsPart).addClass(o.clsHours).appendTo(timeWrapper)),!0===o.minutes&&(minutes=$("<div>").attr("data-title",this.locale.time.minutes).addClass("minutes").addClass(o.clsPart).addClass(o.clsMinutes).appendTo(timeWrapper)),!0===o.seconds&&(seconds=$("<div>").attr("data-title",this.locale.time.seconds).addClass("seconds").addClass(o.clsPart).addClass(o.clsSeconds).appendTo(timeWrapper)),selectWrapper=$("<div>").addClass("select-wrapper").appendTo(picker),selectBlock=$("<div>").addClass("select-block").appendTo(selectWrapper),!0===o.hours){for(hours=$("<ul>").addClass("sel-hours").appendTo(selectBlock),i=0;i<o.distance;i++)$("<li>").html("&nbsp;").data("value",-1).appendTo(hours);for(i=0;i<24;i+=o.hoursStep)$("<li>").addClass("js-hours-"+i).html(i<10?"0"+i:i).data("value",i).appendTo(hours);for(i=0;i<o.distance;i++)$("<li>").html("&nbsp;").data("value",-1).appendTo(hours)}if(!0===o.minutes){for(minutes=$("<ul>").addClass("sel-minutes").appendTo(selectBlock),i=0;i<o.distance;i++)$("<li>").html("&nbsp;").data("value",-1).appendTo(minutes);for(i=0;i<60;i+=o.minutesStep)$("<li>").addClass("js-minutes-"+i).html(i<10?"0"+i:i).data("value",i).appendTo(minutes);for(i=0;i<o.distance;i++)$("<li>").html("&nbsp;").data("value",-1).appendTo(minutes)}if(!0===o.seconds){for(seconds=$("<ul>").addClass("sel-seconds").appendTo(selectBlock),i=0;i<o.distance;i++)$("<li>").html("&nbsp;").data("value",-1).appendTo(seconds);for(i=0;i<60;i+=o.secondsStep)$("<li>").addClass("js-seconds-"+i).html(i<10?"0"+i:i).data("value",i).appendTo(seconds);for(i=0;i<o.distance;i++)$("<li>").html("&nbsp;").data("value",-1).appendTo(seconds)}if(selectBlock.height(40*(2*o.distance+1)),actionBlock=$("<div>").addClass("action-block").appendTo(selectWrapper),$("<button>").attr("type","button").addClass("button action-ok").html(o.okButtonIcon).appendTo(actionBlock),$("<button>").attr("type","button").addClass("button action-cancel").html(o.cancelButtonIcon).appendTo(actionBlock),!(element[0].className="")===o.copyInlineStyles)for(i=0;i<element[0].style.length;i++)picker.css(element[0].style[i],element.css(element[0].style[i]));!0===o.showLabels&&picker.addClass("show-labels"),this.picker=picker},_createEvents:function(){var that=this,o=(this.element,this.options),picker=this.picker;picker.on(Metro.events.start,".select-block ul",function(e){if(!e.changedTouches){var target=this,pageY=Utils.pageXY(e).y;$(document).on(Metro.events.move+"-picker",function(e){target.scrollTop-=o.scrollSpeed*(pageY>Utils.pageXY(e).y?-1:1),pageY=Utils.pageXY(e).y}),$(document).on(Metro.events.stop+"-picker",function(e){$(document).off(Metro.events.move+"-picker"),$(document).off(Metro.events.stop+"-picker")})}}),picker.on(Metro.events.click,function(e){!1===that.isOpen&&that.open(),e.stopPropagation()}),picker.on(Metro.events.click,".action-ok",function(e){var h,m,s,sh=picker.find(".sel-hours li.active"),sm=picker.find(".sel-minutes li.active"),ss=picker.find(".sel-seconds li.active");h=0===sh.length?0:sh.data("value"),m=0===sm.length?0:sm.data("value"),s=0===ss.length?0:ss.data("value"),that.value=[h,m,s],that._normalizeValue(),that._set(),that.close(),e.stopPropagation()}),picker.on(Metro.events.click,".action-cancel",function(e){that.close(),e.stopPropagation()}),this._addScrollEvents()},_addScrollEvents:function(){var picker=this.picker,o=this.options;$.each(["hours","minutes","seconds"],function(){var list=picker.find(".sel-"+this);0!==list.length&&(list.on(Metro.events.scrollStart,function(){list.find(".active").removeClass("active")}),list.on(Metro.events.scrollStop,{latency:50},function(){var target=Math.round(Math.ceil(list.scrollTop()+40)/40),target_element=list.find("li").eq(target+o.distance-1),scroll_to=target_element.position().top-40*o.distance+list.scrollTop();list.animate({scrollTop:scroll_to},100,function(){target_element.addClass("active"),Utils.exec(o.onScroll,[target_element,list,picker])})}))})},_removeScrollEvents:function(){var picker=this.picker;$.each(["hours","minutes","seconds"],function(){picker.find(".sel-"+this).off("scrollstart scrollstop")})},_set:function(){var element=this.element,o=this.options,picker=this.picker,h="00",m="00",s="00";!0===o.hours&&((h=parseInt(this.value[0]))<10&&(h="0"+h),picker.find(".hours").html(h)),!0===o.minutes&&((m=parseInt(this.value[1]))<10&&(m="0"+m),picker.find(".minutes").html(m)),!0===o.seconds&&((s=parseInt(this.value[2]))<10&&(s="0"+s),picker.find(".seconds").html(s)),element.val([h,m,s].join(":")).trigger("change"),Utils.exec(o.onSet,[this.value,element.val(),element,picker])},open:function(){var h,m,s,h_list,m_list,s_list,select_wrapper_in_viewport,select_wrapper_rect,element=this.element,o=this.options,picker=this.picker,items=picker.find("li"),select_wrapper=picker.find(".select-wrapper");select_wrapper.parent().removeClass("for-top for-bottom"),select_wrapper.show(),items.removeClass("active"),select_wrapper_in_viewport=Utils.inViewport(select_wrapper),select_wrapper_rect=Utils.rect(select_wrapper),!select_wrapper_in_viewport&&0<select_wrapper_rect.top&&select_wrapper.parent().addClass("for-bottom"),!select_wrapper_in_viewport&&select_wrapper_rect.top<0&&select_wrapper.parent().addClass("for-top");var animateList=function(list,item){list.scrollTop(0).animate({scrollTop:item.position().top-40*o.distance+list.scrollTop()},100)};!0===o.hours&&(h=parseInt(this.value[0]),animateList(h_list=picker.find(".sel-hours"),h_list.find("li.js-hours-"+h).addClass("active"))),!0===o.minutes&&(m=parseInt(this.value[1]),animateList(m_list=picker.find(".sel-minutes"),m_list.find("li.js-minutes-"+m).addClass("active"))),!0===o.seconds&&(s=parseInt(this.value[2]),animateList(s_list=picker.find(".sel-seconds"),s_list.find("li.js-seconds-"+s).addClass("active"))),this.isOpen=!0,Utils.exec(o.onOpen,[this.value,element,picker])},close:function(){var picker=this.picker,o=this.options,element=this.element;picker.find(".select-wrapper").hide(),this.isOpen=!1,Utils.exec(o.onClose,[this.value,element,picker])},_convert:function(t){return Array.isArray(t)?t:"function"==typeof t.getMonth?[t.getHours(),t.getMinutes(),t.getSeconds()]:Utils.isObject(t)?[t.h,t.m,t.s]:Utils.strToArray(t,":")},val:function(t){if(void 0===t)return this.element.val();this.value=this._convert(t),this._normalizeValue(),this._set()},time:function(t){if(void 0===t)return{h:this.value[0],m:this.value[1],s:this.value[2]};this.value=this._convert(t),this._normalizeValue(),this._set()},date:function(t){if(void 0===t||"function"!=typeof t.getMonth){var ret=new Date;return ret.setHours(this.value[0]),ret.setMinutes(this.value[1]),ret.setSeconds(this.value[2]),ret.setMilliseconds(0),ret}this.value=this._convert(t),this._normalizeValue(),this._set()},changeAttribute:function(attributeName){var that=this,element=this.element;switch(attributeName){case"data-value":that.val(element.attr("data-value"))}}};Metro.plugin("timepicker",TimePicker),$(document).on(Metro.events.click,function(e){$.each($(".time-picker"),function(){$(this).find("input").data("timepicker").close()})});var Toast={options:{callback:Metro.noop,timeout:METRO_TIMEOUT,distance:20,showTop:!1,clsToast:""},create:function(message,callback,timeout,cls,options){var o=options||Toast.options,toast=$("<div>").addClass("toast").html(message).appendTo($("body")).hide(),width=toast.outerWidth();timeout=timeout||o.timeout,callback=callback||o.callback,cls=cls||o.clsToast,!0===o.showTop?toast.addClass("show-top").css({top:o.distance}):toast.css({bottom:o.distance}),toast.css({left:"50%","margin-left":-width/2}).addClass(o.clsToast).addClass(cls).fadeIn(METRO_ANIMATION_DURATION),setTimeout(function(){null,toast.fadeOut(METRO_ANIMATION_DURATION,function(){toast.remove(),Utils.callback(callback)})},timeout)}};Metro.toast=Toast;var Treeview={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this._setOptionsFromDOM(),this._create(),this},options:{effect:"slide",duration:100,onNodeClick:Metro.noop,onNodeDblClick:Metro.noop,onNodeDelete:Metro.noop,onNodeInsert:Metro.noop,onNodeClean:Metro.noop,onCheckClick:Metro.noop,onRadioClick:Metro.noop,onExpandNode:Metro.noop,onCollapseNode:Metro.noop,onTreeviewCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var that=this,element=this.element,o=this.options;this._createTree(),this._createEvents(),$.each(element.find("input"),function(){$(this).is(":checked")&&that._recheck(this)}),Utils.exec(o.onTreeviewCreate,[element],element[0])},_createIcon:function(data){var icon,src;return src=Utils.isTag(data)?$(data):$("<img>").attr("src",data),(icon=$("<span>").addClass("icon")).html(src),icon},_createCaption:function(data){return $("<span>").addClass("caption").html(data)},_createToggle:function(){return $("<span>").addClass("node-toggle")},_createNode:function(data){var node;return node=$("<li>"),void 0!==data.caption&&node.prepend(this._createCaption(data.caption)),void 0!==data.icon&&node.prepend(this._createIcon(data.icon)),void 0!==data.html&&node.append(data.html),node},_createTree:function(){var that=this,element=this.element,nodes=(this.options,element.find("li"));element.addClass("treeview"),$.each(nodes,function(){var node=$(this);void 0!==node.data("caption")&&node.prepend(that._createCaption(node.data("caption"))),void 0!==node.data("icon")&&node.prepend(that._createIcon(node.data("icon"))),0<node.children("ul").length&&(node.append(that._createToggle()),!0!==node.data("collapsed")?node.addClass("expanded"):node.children("ul").hide())})},_createEvents:function(){var that=this,element=this.element,o=this.options;element.on(Metro.events.click,".node-toggle",function(e){var node=$(this).parent();that.toggleNode(node),e.preventDefault()}),element.on(Metro.events.click,"li > .caption",function(e){var node=$(this).parent();that.current(node),Utils.exec(o.onNodeClick,[node,element],node[0]),e.preventDefault()}),element.on(Metro.events.dblclick,"li > .caption",function(e){var node=$(this).closest("li"),toggle=node.children(".node-toggle"),subtree=node.children("ul");(0<toggle.length||0<subtree.length)&&that.toggleNode(node),Utils.exec(o.onNodeDblClick,[node,element],node[0]),e.preventDefault()}),element.on(Metro.events.click,"input[type=radio]",function(e){var check=$(this),checked=check.is(":checked"),node=check.closest("li");that.current(node),Utils.exec(o.onRadioClick,[checked,check,node,element],this)}),element.on(Metro.events.click,"input[type=checkbox]",function(e){var check=$(this),checked=check.is(":checked"),node=check.closest("li");that._recheck(check),Utils.exec(o.onCheckClick,[checked,check,node,element],this)})},_recheck:function(check){var checked,node,checks,element=this.element;Utils.isJQueryObject(check)||(check=$(check)),checked=check.is(":checked"),node=check.closest("li"),this.current(node),(checks=check.closest("li").find("ul input[type=checkbox]")).attr("data-indeterminate",!1),checks.prop("checked",checked),checks=[],$.each(element.find(":checkbox"),function(){checks.push(this)}),$.each(checks.reverse(),function(){var ch=$(this),children=ch.closest("li").children("ul").find(":checkbox").length,children_checked=ch.closest("li").children("ul").find(":checkbox:checked").length;0<children&&0===children_checked&&(ch.attr("data-indeterminate",!1),ch.prop("checked",!1)),0===children_checked?ch.attr("data-indeterminate",!1):0<children_checked&&children_checked<children?ch.attr("data-indeterminate",!0):children===children_checked&&(ch.attr("data-indeterminate",!1),ch.prop("checked",!0))})},current:function(node){var element=this.element;this.options;if(void 0===node)return element.find("li.current");element.find("li").removeClass("current"),node.addClass("current")},toggleNode:function(node){var func,element=this.element,o=this.options,toBeExpanded=!node.data("collapsed");console.log(toBeExpanded),node.toggleClass("expanded"),node.data("collapsed",toBeExpanded),func="slide"===o.effect?!0===toBeExpanded?"slideUp":"slideDown":!0===toBeExpanded?"fadeOut":"fadeIn",toBeExpanded?Utils.exec(o.onExpandNode,[node,element]):Utils.exec(o.onCollapseNode,[node,element]),node.children("ul")[func](o.duration)},addTo:function(node,data){var target,new_node,element=this.element,o=this.options;return null===node?target=element:0===(target=node.children("ul")).length&&(target=$("<ul>").appendTo(node),this._createToggle().appendTo(node),node.addClass("expanded")),(new_node=this._createNode(data)).appendTo(target),Utils.exec(o.onNodeInsert,[new_node,element],new_node[0]),new_node},insertBefore:function(node,data){var element=this.element,o=this.options,new_node=this._createNode(data);return new_node.insertBefore(node),Utils.exec(o.onNodeInsert,[new_node,element],new_node[0]),new_node},insertAfter:function(node,data){var element=this.element,o=this.options,new_node=this._createNode(data);return new_node.insertAfter(node),Utils.exec(o.onNodeInsert,[new_node,element],new_node[0]),new_node},del:function(node){var element=this.element,o=this.options,parent_list=node.closest("ul"),parent_node=parent_list.closest("li");node.remove(),0!==parent_list.children().length||parent_list.is(element)||(parent_list.remove(),parent_node.removeClass("expanded"),parent_node.children(".node-toggle").remove()),Utils.exec(o.onNodeDelete,[element],element[0])},clean:function(node){var element=this.element,o=this.options;node.children("ul").remove(),node.removeClass("expanded"),node.children(".node-toggle").remove(),Utils.exec(o.onNodeClean,[node,element],node[0])},changeAttribute:function(attributeName){attributeName}};Metro.plugin("treeview",Treeview);var ValidatorFuncs={required:function(val){return Array.isArray(val)?0<val.length&&val:!!Utils.isValue(val)&&val.trim()},length:function(val,len){return Array.isArray(val)?val.length===parseInt(len):!(!Utils.isValue(len)||isNaN(len)||len<=0)&&val.trim().length===parseInt(len)},minlength:function(val,len){return Array.isArray(val)?val.length>=parseInt(len):!(!Utils.isValue(len)||isNaN(len)||len<=0)&&val.trim().length>=parseInt(len)},maxlength:function(val,len){return Array.isArray(val)?val.length<=parseInt(len):!(!Utils.isValue(len)||isNaN(len)||len<=0)&&val.trim().length<=parseInt(len)},min:function(val,min_value){return!(!Utils.isValue(min_value)||isNaN(min_value))&&(!!this.number(val)&&(!isNaN(val)&&Number(val)>=Number(min_value)))},max:function(val,max_value){return!(!Utils.isValue(max_value)||isNaN(max_value))&&(!!this.number(val)&&(!isNaN(val)&&Number(val)<=Number(max_value)))},email:function(val){return/^[a-z0-9\u007F-\uffff!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9\u007F-\uffff!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z]{2,}$/i.test(val)},domain:function(val){return/^((xn--)?[a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/.test(val)},url:function(val){return/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(val)},date:function(val,format,locale){return Utils.isNull(format)?"invalid date"!==String(new Date(val)).toLowerCase():"invalid date"!==String(val.toDate(format,locale)).toLowerCase()},number:function(val){return!isNaN(val)},integer:function(val){return Utils.isInt(val)},float:function(val){return Utils.isFloat(val)},digits:function(val){return/^\d+$/.test(val)},hexcolor:function(val){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(val)},color:function(val){return!!Utils.isValue(val)&&!1!==Colors.color(val,Colors.PALETTES.STANDARD)},pattern:function(val,pat){return!!Utils.isValue(val)&&(!!Utils.isValue(pat)&&new RegExp(pat).test(val))},compare:function(val,val2){return val===val2},not:function(val,not_this){return val!==not_this},notequals:function(val,val2){return!Utils.isNull(val)&&(!Utils.isNull(val2)&&val.trim()!==val2.trim())},equals:function(val,val2){return!Utils.isNull(val)&&(!Utils.isNull(val2)&&val.trim()===val2.trim())},custom:function(val,func){return!1!==Utils.isFunc(func)&&Utils.exec(func,[val])},is_control:function(el){return el.parent().hasClass("input")||el.parent().hasClass("select")||el.parent().hasClass("textarea")||el.parent().hasClass("checkbox")||el.parent().hasClass("switch")||el.parent().hasClass("radio")||el.parent().hasClass("spinner")},reset_state:function(el){var input=!1===Utils.isJQueryObject(el)?$(el):el;ValidatorFuncs.is_control(input)?input.parent().removeClass("invalid valid"):input.removeClass("invalid valid")},set_valid_state:function(input){!1===Utils.isJQueryObject(input)&&(input=$(input)),ValidatorFuncs.is_control(input)?input.parent().addClass("valid"):input.addClass("valid")},set_invalid_state:function(input){!1===Utils.isJQueryObject(input)&&(input=$(input)),ValidatorFuncs.is_control(input)?input.parent().addClass("invalid"):input.addClass("invalid")},reset:function(form){var that=this;return $.each($(form).find("[data-validate]"),function(){that.reset_state(this)}),this},validate:function(el,result,cb_ok,cb_error,required_mode){var this_result=!0,input=$(el),funcs=void 0!==input.data("validate")?String(input.data("validate")).split(" ").map(function(s){return s.trim()}):[],errors=[];if(0===funcs.length)return!0;if(this.reset_state(input),input.attr("type")&&"checkbox"===input.attr("type").toLowerCase())!1===(this_result=-1===funcs.indexOf("required")||input.is(":checked"))&&errors.push("required"),void 0!==result&&(result.val+=this_result?0:1);else if(input.attr("type")&&"radio"===input.attr("type").toLowerCase()){void 0===input.attr("name")&&(this_result=!0);var radio_selector="input[name="+input.attr("name")+"]:checked";this_result=0<$(radio_selector).length,void 0!==result&&(result.val+=this_result?0:1)}else $.each(funcs,function(){if(!1!==this_result){var f,a,b,rule=this.split("=");f=rule[0],rule.shift(),a=rule.join("="),-1<["compare","equals","notequals"].indexOf(f)&&(a=input[0].form.elements[a].value),"date"===f&&(a=input.attr("data-value-format"),b=input.attr("data-value-locale")),!1===(this_result=!1===Utils.isFunc(ValidatorFuncs[f])||(!0===required_mode||"required"===f?ValidatorFuncs[f](input.val(),a,b):""===input.val().trim()||ValidatorFuncs[f](input.val(),a,b)))&&errors.push(f),void 0!==result&&(result.val+=this_result?0:1)}});return!1===this_result?(this.set_invalid_state(input),void 0!==result&&result.log.push({input:input[0],name:input.attr("name"),value:input.val(),funcs:funcs,errors:errors}),void 0!==cb_error&&Utils.exec(cb_error,[input,input.val()],input[0])):(this.set_valid_state(input),void 0!==cb_ok&&Utils.exec(cb_ok,[input,input.val()],input[0])),this_result}};Metro.validator=ValidatorFuncs;var Validator={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this._onsubmit=null,this._onreset=null,this.result=[],this._setOptionsFromDOM(),this._create(),this},dependencies:["utils","colors"],options:{submitTimeout:200,interactiveCheck:!1,clearInvalid:0,requiredMode:!0,useRequiredClass:!0,onBeforeSubmit:Metro.noop_true,onSubmit:Metro.noop,onError:Metro.noop,onValidate:Metro.noop,onErrorForm:Metro.noop,onValidateForm:Metro.noop,onValidatorCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var that=this,element=this.element,o=this.options,inputs=element.find("[data-validate]");element.attr("novalidate","novalidate"),$.each(inputs,function(){var input=$(this);-1<input.data("validate").indexOf("required")&&!0===o.useRequiredClass&&(ValidatorFuncs.is_control(input)?input.parent().addClass("required"):input.addClass("required")),!0===o.interactiveCheck&&input.on(Metro.events.inputchange,function(){ValidatorFuncs.validate(this,void 0,void 0,void 0,o.requiredMode)})}),this._onsubmit=null,(this._onreset=null)!==element[0].onsubmit&&(this._onsubmit=element[0].onsubmit,element[0].onsubmit=null),null!==element[0].onreset&&(this._onreset=element[0].onreset,element[0].onreset=null),element[0].onsubmit=function(){return that._submit()},element[0].onreset=function(){return that._reset()},Utils.exec(this.options.onValidatorCreate,[element],this.elem)},_reset:function(){ValidatorFuncs.reset(this.element),null!==this._onsubmit&&Utils.exec(this._onsubmit,null,this.element[0])},_submit:function(){var that=this,element=this.element,o=this.options,form=this.elem,inputs=element.find("[data-validate]"),submit=element.find(":submit").attr("disabled","disabled").addClass("disabled"),result={val:0,log:[]},formData=Utils.formData(element);return $.each(inputs,function(){ValidatorFuncs.validate(this,result,o.onValidate,o.onError,o.requiredMode)}),submit.removeAttr("disabled").removeClass("disabled"),result.val+=!1===Utils.exec(o.onBeforeSubmit,[element,formData],this.elem)?1:0,0===result.val?(Utils.exec(o.onValidateForm,[element,formData],form),setTimeout(function(){Utils.exec(o.onSubmit,[element,formData],form),null!==that._onsubmit&&Utils.exec(that._onsubmit,null,form)},o.submitTimeout)):(Utils.exec(o.onErrorForm,[result.log,element,formData],form),0<o.clearInvalid&&setTimeout(function(){$.each(inputs,function(){var inp=$(this);ValidatorFuncs.is_control(inp)?inp.parent().removeClass("invalid"):inp.removeClass("invalid")})},o.clearInvalid)),0===result.val},changeAttribute:function(attributeName){attributeName}};Metro.plugin("validator",Validator);var Window={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this.win=null,this.overlay=null,this.position={top:0,left:0},this.hidden=!1,this._setOptionsFromDOM(),this._create(),Utils.exec(this.options.onWindowCreate,[this.win,this.element]),this},dependencies:["draggable","resizeable"],options:{hidden:!1,width:"auto",height:"auto",btnClose:!0,btnMin:!0,btnMax:!0,clsCaption:"",clsContent:"",clsWindow:"",draggable:!0,dragElement:".window-caption .icon, .window-caption .title",dragArea:"parent",shadow:!1,icon:"",title:"Window",content:"default",resizable:!0,overlay:!1,overlayColor:"transparent",overlayAlpha:.5,modal:!1,position:"absolute",checkEmbed:!0,top:"auto",left:"auto",place:"auto",closeAction:Metro.actions.REMOVE,customButtons:null,clsCustomButton:"",minWidth:0,minHeight:0,maxWidth:0,maxHeight:0,onDragStart:Metro.noop,onDragStop:Metro.noop,onDragMove:Metro.noop,onCaptionDblClick:Metro.noop,onCloseClick:Metro.noop,onMaxClick:Metro.noop,onMinClick:Metro.noop,onResizeStart:Metro.noop,onResizeStop:Metro.noop,onResize:Metro.noop,onWindowCreate:Metro.noop,onShow:Metro.noop,onWindowDestroy:Metro.noop,onCanClose:Metro.noop_true,onClose:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var win,overlay,that=this,element=this.element,o=this.options,parent="parent"===o.dragArea?element.parent():$(o.dragArea);!0===o.modal&&(o.btnMax=!1,o.btnMin=!1,o.resizable=!1),"default"===o.content&&(o.content=element),(win=this._window(o)).addClass("no-visible"),parent.append(win),!0===o.overlay&&((overlay=this._overlay()).appendTo(win.parent()),this.overlay=overlay),this.win=win,setTimeout(function(){that._setPosition(),!0!==o.hidden&&that.win.removeClass("no-visible"),Utils.exec(o.onShow,[win],win[0])},100)},_setPosition:function(){var top,left,right,bottom,o=this.options,win=this.win,parent="parent"===o.dragArea?win.parent():$(o.dragArea),top_center=parent.height()/2-win[0].offsetHeight/2,left_center=parent.width()/2-win[0].offsetWidth/2;if("auto"!==o.place){switch(o.place.toLowerCase()){case"top-left":left=top=0,bottom=right="auto";break;case"top-center":top=0,left=left_center,bottom=right="auto";break;case"top-right":right=top=0,bottom=left="auto";break;case"right-center":top=top_center,right=0,bottom=left="auto";break;case"bottom-right":right=bottom=0,top=left="auto";break;case"bottom-center":bottom=0,left=left_center,top=right="auto";break;case"bottom-left":left=bottom=0,top=right="auto";break;case"left-center":top=top_center,left=0,bottom=right="auto";break;default:top=top_center,left=left_center,right=bottom="auto"}win.css({top:top,left:left,bottom:bottom,right:right})}},_window:function(o){var win,caption,content,buttons,status,that=this,width=o.width,height=o.height;if(win=$("<div>").addClass("window"),!0===o.modal&&win.addClass("modal"),caption=$("<div>").addClass("window-caption"),content=$("<div>").addClass("window-content"),win.append(caption),win.append(content),!0===o.status&&(status=$("<div>").addClass("window-status"),win.append(status)),!0===o.shadow&&win.addClass("win-shadow"),Utils.isValue(o.icon)&&$("<span>").addClass("icon").html(o.icon).appendTo(caption),$("<span>").addClass("title").html(Utils.isValue(o.title)?o.title:"&nbsp;").appendTo(caption),void 0!==o.content&&"original"!==o.content&&(Utils.isUrl(o.content)&&Utils.isVideoUrl(o.content)&&(o.content=Utils.embedUrl(o.content)),!Utils.isJQueryObject(o.content)&&Utils.isFunc(o.content)&&(o.content=Utils.exec(o.content)),Utils.isJQueryObject(o.content)?o.content.appendTo(content):content.html(o.content)),(buttons=$("<div>").addClass("buttons")).appendTo(caption),!0===o.btnMax&&$("<span>").addClass("button btn-max sys-button").appendTo(buttons),!0===o.btnMin&&$("<span>").addClass("button btn-min sys-button").appendTo(buttons),!0===o.btnClose&&$("<span>").addClass("button btn-close sys-button").appendTo(buttons),Utils.isValue(o.customButtons)){var customButtons=[];!1!==Utils.isObject(o.customButtons)&&(o.customButtons=Utils.isObject(o.customButtons)),"string"==typeof o.customButtons&&-1<o.customButtons.indexOf("{")?customButtons=JSON.parse(o.customButtons):"object"==typeof o.customButtons&&0<Utils.objectLength(o.customButtons)?customButtons=o.customButtons:console.log("Unknown format for custom buttons"),$.each(customButtons,function(){var customButton=$("<span>");customButton.addClass("button btn-custom").addClass(o.clsCustomButton).addClass(this.cls).attr("tabindex",-1).html(this.html),customButton.data("action",this.onclick),buttons.prepend(customButton)})}return caption.on(Metro.events.stop,".btn-custom",function(e){if(!Utils.isRightMouse(e)){var button=$(this),action=button.data("action");Utils.exec(action,[button],this)}}),win.attr("id",void 0===o.id?Utils.elementId("window"):o.id),win.on(Metro.events.dblclick,".window-caption",function(e){that.maximized(e)}),caption.on(Metro.events.click,".btn-max, .btn-min, .btn-close",function(e){if(!Utils.isRightMouse(e)){var target=$(e.target);target.hasClass("btn-max")&&that.maximized(e),target.hasClass("btn-min")&&that.minimized(e),target.hasClass("btn-close")&&that.close(e)}}),!0===o.draggable&&win.draggable({dragElement:o.dragElement,dragArea:o.dragArea,onDragStart:o.onDragStart,onDragStop:o.onDragStop,onDragMove:o.onDragMove}),win.addClass(o.clsWindow),caption.addClass(o.clsCaption),content.addClass(o.clsContent),0===o.minWidth&&(o.minWidth=34,$.each(buttons.children(".btn-custom"),function(){o.minWidth+=Utils.hiddenElementSize(this).width}),o.btnMax&&(o.minWidth+=34),o.btnMin&&(o.minWidth+=34),o.btnClose&&(o.minWidth+=34)),0<o.minWidth&&!isNaN(o.width)&&o.width<o.minWidth&&(width=o.minWidth),0<o.minHeight&&!isNaN(o.height)&&o.height>o.minHeight&&(height=o.minHeight),!0===o.resizable&&($("<span>").addClass("resize-element").appendTo(win),win.addClass("resizable"),win.resizable({minWidth:o.minWidth,minHeight:o.minHeight,maxWidth:o.maxWidth,maxHeight:o.maxHeight,resizeElement:".resize-element",onResizeStart:o.onResizeStart,onResizeStop:o.onResizeStop,onResize:o.onResize})),win.css({width:width,height:height,position:o.position,top:o.top,left:o.left}),win},_overlay:function(){var o=this.options,overlay=$("<div>");return overlay.addClass("overlay"),"transparent"===o.overlayColor?overlay.addClass("transparent"):overlay.css({background:Utils.hex2rgba(o.overlayColor,o.overlayAlpha)}),overlay},maximized:function(e){var win=this.win,o=this.options,target=$(e.currentTarget);win.removeClass("minimized"),win.toggleClass("maximized"),target.hasClass("window-caption")?Utils.exec(o.onCaptionDblClick,[win]):Utils.exec(o.onMaxClick,[win])},minimized:function(){var win=this.win,element=this.element,o=this.options;win.removeClass("maximized"),win.toggleClass("minimized"),Utils.exec(o.onMinClick,[win],element[0])},close:function(){var that=this,win=this.win,element=this.element,o=this.options;if(!1===Utils.exec(o.onCanClose,[win]))return!1;var timeout=0;o.onClose!==Metro.noop&&(timeout=500),Utils.exec(o.onClose,[win],element[0]),setTimeout(function(){!null===o.modal&&win.siblings(".overlay").remove(),Utils.exec(o.onCloseClick,[win],element[0]),Utils.exec(o.onWindowDestroy,[win],element[0]),o.closeAction===Metro.actions.REMOVE?win.remove():that.hide()},timeout)},hide:function(){this.win.css({display:"none"})},show:function(){this.win.removeClass("no-visible"),this.win.css({display:"flex"})},toggle:function(){"none"===this.win.css("display")||this.win.hasClass("no-visible")?this.show():this.hide()},isOpen:function(){return this.win.hasClass("no-visible")},min:function(a){a?this.win.addClass("minimized"):this.win.removeClass("minimized")},max:function(a){a?this.win.addClass("maximized"):this.win.removeClass("maximized")},toggleButtons:function(a){var win=this.win,btnClose=win.find(".btn-close"),btnMin=win.find(".btn-min"),btnMax=win.find(".btn-max");"data-btn-close"===a&&btnClose.toggle(),"data-btn-min"===a&&btnMin.toggle(),"data-btn-max"===a&&btnMax.toggle()},changeSize:function(a){var element=this.element,win=this.win;"data-width"===a&&win.css("width",element.data("width")),"data-height"===a&&win.css("height",element.data("height"))},changeClass:function(a){var element=this.element,win=this.win,o=this.options;"data-cls-window"===a&&(win[0].className="window "+(o.resizable?" resizeable ":" ")+element.attr("data-cls-window")),"data-cls-caption"===a&&(win.find(".window-caption")[0].className="window-caption "+element.attr("data-cls-caption")),"data-cls-content"===a&&(win.find(".window-content")[0].className="window-content "+element.attr("data-cls-content"))},toggleShadow:function(){var element=this.element,win=this.win;!0===JSON.parse(element.attr("data-shadow"))?win.addClass("win-shadow"):win.removeClass("win-shadow")},setContent:function(){var result,element=this.element,win=this.win,content=element.attr("data-content");result=!Utils.isJQueryObject(content)&&Utils.isFunc(content)?Utils.exec(content):Utils.isJQueryObject(content)?content.html():content,win.find(".window-content").html(result)},setTitle:function(){var element=this.element,win=this.win,title=element.attr("data-title");win.find(".window-caption .title").html(title)},setIcon:function(){var element=this.element,win=this.win,icon=element.attr("data-icon");win.find(".window-caption .icon").html(icon)},getIcon:function(){return this.win.find(".window-caption .icon").html()},getTitle:function(){return this.win.find(".window-caption .title").html()},toggleDraggable:function(){var element=this.element,win=this.win,flag=JSON.parse(element.attr("data-draggable")),drag=win.data("draggable");!0===flag?drag.on():drag.off()},toggleResizable:function(){var element=this.element,win=this.win,flag=JSON.parse(element.attr("data-resizable")),resize=win.data("resizable");!0===flag?(resize.on(),win.find(".resize-element").removeClass("resize-element-disabled")):(resize.off(),win.find(".resize-element").addClass("resize-element-disabled"))},changeTopLeft:function(a){var pos,element=this.element,win=this.win;if("data-top"===a){if(pos=parseInt(element.attr("data-top")),!isNaN(pos))return;win.css("top",pos)}if("data-left"===a){if(pos=parseInt(element.attr("data-left")),!isNaN(pos))return;win.css("left",pos)}},changePlace:function(){var element=this.element,win=this.win,place=element.attr("data-place");win.addClass(place)},changeAttribute:function(attributeName){switch(attributeName){case"data-btn-close":case"data-btn-min":case"data-btn-max":this.toggleButtons(attributeName);break;case"data-width":case"data-height":this.changeSize(attributeName);break;case"data-cls-window":case"data-cls-caption":case"data-cls-content":this.changeClass(attributeName);break;case"data-shadow":this.toggleShadow();break;case"data-icon":this.setIcon();break;case"data-title":this.setTitle();break;case"data-content":this.setContent();break;case"data-draggable":this.toggleDraggable();break;case"data-resizable":this.toggleResizable();break;case"data-top":case"data-left":this.changeTopLeft(attributeName);break;case"data-place":this.changePlace()}}};Metro.plugin("window",Window),Metro.window={isWindow:function(el){return Utils.isMetroObject(el,"window")},min:function(el,a){if(!this.isWindow(el))return!1;$(el).data("window").min(a)},max:function(el,a){if(!this.isWindow(el))return!1;$(el).data("window").max(a)},show:function(el){if(!this.isWindow(el))return!1;$(el).data("window").show()},hide:function(el){if(!this.isWindow(el))return!1;$(el).data("window").hide()},toggle:function(el){if(!this.isWindow(el))return!1;$(el).data("window").toggle()},isOpen:function(el){return!!this.isWindow(el)&&$(el).data("window").isOpen()},close:function(el){if(!this.isWindow(el))return!1;$(el).data("window").close()},create:function(options){var w;w=$("<div>").appendTo($("body"));var w_options=$.extend({},{},void 0!==options?options:{});return w.window(w_options)}};var Wizard={init:function(options,elem){return this.options=$.extend({},this.options,options),this.elem=elem,this.element=$(elem),this._setOptionsFromDOM(),this._create(),this},options:{start:1,finish:0,iconHelp:"<span class='default-icon-help'></span>",iconPrev:"<span class='default-icon-left-arrow'></span>",iconNext:"<span class='default-icon-right-arrow'></span>",iconFinish:"<span class='default-icon-check'></span>",buttonMode:"cycle",buttonOutline:!0,clsWizard:"",clsActions:"",clsHelp:"",clsPrev:"",clsNext:"",clsFinish:"",onPage:Metro.noop,onHelpClick:Metro.noop,onPrevClick:Metro.noop,onNextClick:Metro.noop,onFinishClick:Metro.noop,onBeforePrev:Metro.noop_true,onBeforeNext:Metro.noop_true,onWizardCreate:Metro.noop},_setOptionsFromDOM:function(){var element=this.element,o=this.options;$.each(element.data(),function(key,value){if(key in o)try{o[key]=JSON.parse(value)}catch(e){o[key]=value}})},_create:function(){var element=this.element,o=this.options;this._createWizard(),this._createEvents(),Utils.exec(o.onWizardCreate,[element])},_createWizard:function(){var bar,element=this.element,o=this.options;element.addClass("wizard").addClass(o.view).addClass(o.clsWizard),bar=$("<div>").addClass("action-bar").addClass(o.clsActions).appendTo(element);var buttonMode="button"===o.buttonMode?"":o.buttonMode;!0===o.buttonOutline&&(buttonMode+=" outline"),!1!==o.iconHelp&&$("<button>").attr("type","button").addClass("button wizard-btn-help").addClass(buttonMode).addClass(o.clsHelp).html(Utils.isTag(o.iconHelp)?o.iconHelp:$("<img>").attr("src",o.iconHelp)).appendTo(bar),!1!==o.iconPrev&&$("<button>").attr("type","button").addClass("button wizard-btn-prev").addClass(buttonMode).addClass(o.clsPrev).html(Utils.isTag(o.iconPrev)?o.iconPrev:$("<img>").attr("src",o.iconPrev)).appendTo(bar),!1!==o.iconNext&&$("<button>").attr("type","button").addClass("button wizard-btn-next").addClass(buttonMode).addClass(o.clsNext).html(Utils.isTag(o.iconNext)?o.iconNext:$("<img>").attr("src",o.iconNext)).appendTo(bar),!1!==o.iconFinish&&$("<button>").attr("type","button").addClass("button wizard-btn-finish").addClass(buttonMode).addClass(o.clsFinish).html(Utils.isTag(o.iconFinish)?o.iconFinish:$("<img>").attr("src",o.iconFinish)).appendTo(bar),this.toPage(o.start),this._setHeight()},_setHeight:function(){var element=this.element,pages=(this.options,element.children("section")),max_height=0;pages.children(".page-content").css("max-height","none"),$.each(pages,function(){var h=$(this).height();max_height<parseInt(h)&&(max_height=h)}),element.height(max_height)},_createEvents:function(){var that=this,element=this.element,o=this.options;element.on(Metro.events.click,".wizard-btn-help",function(){var page=element.children("section").get(that.current-1);Utils.exec(o.onHelpClick,[that.current,page,element])}),element.on(Metro.events.click,".wizard-btn-prev",function(){that.prev(),Utils.exec(o.onPrevClick,[that.current,element])}),element.on(Metro.events.click,".wizard-btn-next",function(){that.next(),Utils.exec(o.onNextClick,[that.current,element])}),element.on(Metro.events.click,".wizard-btn-finish",function(){Utils.exec(o.onFinishClick,[that.current,element])}),element.on(Metro.events.click,".complete",function(){var index=$(this).index()+1;that.toPage(index)}),$(window).on(Metro.events.resize,function(){that._setHeight()})},next:function(){var element=this.element,o=this.options,pages=element.children("section"),page=$(element.children("section").get(this.current-1));this.current+1>pages.length||!1===Utils.exec(o.onBeforeNext,[this.current,page,element])||(this.current++,this.toPage(this.current))},prev:function(){var element=this.element,o=this.options,page=$(element.children("section").get(this.current-1));this.current-1!=0&&!1!==Utils.exec(o.onBeforePrev,[this.current,page,element])&&(this.current--,this.toPage(this.current))},last:function(){var element=this.element;this.options;this.toPage(element.children("section").length)},first:function(){this.toPage(1)},toPage:function(page){var element=this.element,o=this.options,target=$(element.children("section").get(page-1)),sections=element.children("section"),actions=element.find(".action-bar");if(0!==target.length){var finish=element.find(".wizard-btn-finish").addClass("disabled"),next=element.find(".wizard-btn-next").addClass("disabled"),prev=element.find(".wizard-btn-prev").addClass("disabled");this.current=page,element.children("section").removeClass("complete current").removeClass(o.clsCurrent).removeClass(o.clsComplete),target.addClass("current").addClass(o.clsCurrent),target.prevAll().addClass("complete").addClass(o.clsComplete);var border_size=0===element.children("section.complete").length?0:parseInt(Utils.getStyleOne(element.children("section.complete")[0],"border-left-width"));actions.animate({left:element.children("section.complete").length*border_size+41}),(this.current===sections.length||0<o.finish&&this.current>=o.finish)&&finish.removeClass("disabled"),this.current<sections.length&&next.removeClass("disabled"),1<this.current&&prev.removeClass("disabled"),element.trigger("onpage",[this.current,target,element]),Utils.exec(o.onPage,[this.current,target,element])}},changeAttribute:function(attributeName){}};return Metro.plugin("wizard",Wizard),!0===METRO_INIT?Metro.init():Metro});